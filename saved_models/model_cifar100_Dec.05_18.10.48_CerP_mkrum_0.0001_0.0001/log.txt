current path: saved_models/model_cifar100_Dec.05_18.10.48_CerP_mkrum_0.0001_0.0001
Loading data
build_classes_dict done
train loaders done
get poison test loader
load data done
Loaded parameters from saved model: LR is 0.01 and current epoch is 71
create model done
Poisoned following participants: [13, 36, 58, 71]
We use following environment for graphs:  cifar100_CerP
Server Epoch:71 choose agents : [13, 36, 58, 71, 89, 99, 77, 65, 67, 61, 30, 1, 69, 81, 12, 17, 52, 15, 86, 40].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  71, local model 13, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4308/4885 (88.1883%), train_poison_data_count: 385
Global model norm: 42.432124970265015.
Norm before scaling: 42.43998663784323. Distance: 2.2944222153866356
Total norm for 4 adversaries is: 42.43998663784323. distance: 2.2944222153866356
___Test Local_ResNet_18 poisoned: True, epoch: 71: Average loss: 0.4368, Accuracy: 8846/9900 (89.3535%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  71, local model 36, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4736/5305 (89.2743%), train_poison_data_count: 415
Global model norm: 42.432124970265015.
Norm before scaling: 42.435352658761275. Distance: 2.2518723432835968
Total norm for 4 adversaries is: 42.435352658761275. distance: 2.2518723432835968
___Test Local_ResNet_18 poisoned: True, epoch: 71: Average loss: 0.7293, Accuracy: 8309/9900 (83.9293%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  71, local model 58, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4179/4717 (88.5944%), train_poison_data_count: 370
Global model norm: 42.432124970265015.
Norm before scaling: 42.43865057350434. Distance: 2.177645037405212
Total norm for 4 adversaries is: 42.43865057350434. distance: 2.177645037405212
___Test Local_ResNet_18 poisoned: True, epoch: 71: Average loss: 0.4137, Accuracy: 8915/9900 (90.0505%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  71, local model 71, internal_epoch   1,  Average loss: 0.0074, Accuracy: 4459/5066 (88.0182%), train_poison_data_count: 400
Global model norm: 42.432124970265015.
Norm before scaling: 42.44030446826902. Distance: 2.303243825013357
Total norm for 4 adversaries is: 42.44030446826902. distance: 2.303243825013357
___Test Local_ResNet_18 poisoned: True, epoch: 71: Average loss: 0.6208, Accuracy: 8470/9900 (85.5556%)
___Train Local_ResNet_18,  epoch  71, local model 89, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3845/4356 (88.2691%)
___Train Local_ResNet_18,  epoch  71, local model 89, internal_epoch   2,  Average loss: 0.0080, Accuracy: 3695/4356 (84.8255%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.4119, Accuracy: 4753/10000 (47.5300%)
___Train Local_ResNet_18,  epoch  71, local model 99, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3928/4465 (87.9731%)
___Train Local_ResNet_18,  epoch  71, local model 99, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4090/4465 (91.6013%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.0340, Accuracy: 5491/10000 (54.9100%)
___Train Local_ResNet_18,  epoch  71, local model 77, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4050/4647 (87.1530%)
___Train Local_ResNet_18,  epoch  71, local model 77, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4178/4647 (89.9075%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 1.9600, Accuracy: 5429/10000 (54.2900%)
___Train Local_ResNet_18,  epoch  71, local model 65, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4444/5055 (87.9130%)
___Train Local_ResNet_18,  epoch  71, local model 65, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4528/5055 (89.5747%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.1192, Accuracy: 5316/10000 (53.1600%)
___Train Local_ResNet_18,  epoch  71, local model 67, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4444/5116 (86.8647%)
___Train Local_ResNet_18,  epoch  71, local model 67, internal_epoch   2,  Average loss: 0.0066, Accuracy: 4447/5116 (86.9234%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.0436, Accuracy: 5204/10000 (52.0400%)
___Train Local_ResNet_18,  epoch  71, local model 61, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3630/4126 (87.9787%)
___Train Local_ResNet_18,  epoch  71, local model 61, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3753/4126 (90.9598%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 1.9815, Accuracy: 5421/10000 (54.2100%)
___Train Local_ResNet_18,  epoch  71, local model 30, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3081/3472 (88.7385%)
___Train Local_ResNet_18,  epoch  71, local model 30, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3217/3472 (92.6555%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.1117, Accuracy: 5420/10000 (54.2000%)
___Train Local_ResNet_18,  epoch  71, local model 1, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4428/4986 (88.8087%)
___Train Local_ResNet_18,  epoch  71, local model 1, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4459/4986 (89.4304%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.1466, Accuracy: 5282/10000 (52.8200%)
___Train Local_ResNet_18,  epoch  71, local model 69, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3547/4013 (88.3877%)
___Train Local_ResNet_18,  epoch  71, local model 69, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3668/4013 (91.4029%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 1.8314, Accuracy: 5693/10000 (56.9300%)
___Train Local_ResNet_18,  epoch  71, local model 81, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4030/4618 (87.2672%)
___Train Local_ResNet_18,  epoch  71, local model 81, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4078/4618 (88.3066%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.0324, Accuracy: 5401/10000 (54.0100%)
___Train Local_ResNet_18,  epoch  71, local model 12, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4427/5083 (87.0942%)
___Train Local_ResNet_18,  epoch  71, local model 12, internal_epoch   2,  Average loss: 0.0065, Accuracy: 4420/5083 (86.9565%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.2054, Accuracy: 5141/10000 (51.4100%)
___Train Local_ResNet_18,  epoch  71, local model 17, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3970/4511 (88.0071%)
___Train Local_ResNet_18,  epoch  71, local model 17, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4022/4511 (89.1598%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.2225, Accuracy: 5058/10000 (50.5800%)
___Train Local_ResNet_18,  epoch  71, local model 52, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3333/3797 (87.7798%)
___Train Local_ResNet_18,  epoch  71, local model 52, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3390/3797 (89.2810%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.0123, Accuracy: 5464/10000 (54.6400%)
___Train Local_ResNet_18,  epoch  71, local model 15, internal_epoch   1,  Average loss: 0.0055, Accuracy: 5006/5582 (89.6811%)
___Train Local_ResNet_18,  epoch  71, local model 15, internal_epoch   2,  Average loss: 0.0045, Accuracy: 5089/5582 (91.1680%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.0956, Accuracy: 5283/10000 (52.8300%)
___Train Local_ResNet_18,  epoch  71, local model 86, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3150/3616 (87.1128%)
___Train Local_ResNet_18,  epoch  71, local model 86, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3213/3616 (88.8551%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.1080, Accuracy: 5457/10000 (54.5700%)
___Train Local_ResNet_18,  epoch  71, local model 40, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4826/5455 (88.4693%)
___Train Local_ResNet_18,  epoch  71, local model 40, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4860/5455 (89.0926%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 1.9333, Accuracy: 5347/10000 (53.4700%)
time spent on training: 264.1179111003876
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 71: Average loss: 1.1579, Accuracy: 6967/10000 (69.6700%)
___Test Target_ResNet_18 poisoned: True, epoch: 71: Average loss: 9.8300, Accuracy: 60/9900 (0.6061%)
Done in 294.3163936138153 sec.
Server Epoch:72 choose agents : [13, 36, 58, 71, 78, 52, 95, 7, 20, 73, 98, 74, 76, 9, 79, 48, 33, 12, 16, 84].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  72, local model 13, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4377/4885 (89.6008%), train_poison_data_count: 385
Global model norm: 42.46547167028393.
Norm before scaling: 42.47220483555981. Distance: 2.158616577867158
Total norm for 4 adversaries is: 42.47220483555981. distance: 2.158616577867158
___Test Local_ResNet_18 poisoned: True, epoch: 72: Average loss: 0.2111, Accuracy: 9349/9900 (94.4343%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  72, local model 36, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4762/5305 (89.7644%), train_poison_data_count: 415
Global model norm: 42.46547167028393.
Norm before scaling: 42.4681420693243. Distance: 2.2055475429685103
Total norm for 4 adversaries is: 42.4681420693243. distance: 2.2055475429685103
___Test Local_ResNet_18 poisoned: True, epoch: 72: Average loss: 0.4112, Accuracy: 8891/9900 (89.8081%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  72, local model 58, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4176/4717 (88.5308%), train_poison_data_count: 370
Global model norm: 42.46547167028393.
Norm before scaling: 42.47334440977732. Distance: 2.2060751135135046
Total norm for 4 adversaries is: 42.47334440977732. distance: 2.2060751135135046
___Test Local_ResNet_18 poisoned: True, epoch: 72: Average loss: 0.2072, Accuracy: 9377/9900 (94.7172%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  72, local model 71, internal_epoch   1,  Average loss: 0.0073, Accuracy: 4462/5066 (88.0774%), train_poison_data_count: 400
Global model norm: 42.46547167028393.
Norm before scaling: 42.47629307781945. Distance: 2.352961634098203
Total norm for 4 adversaries is: 42.47629307781945. distance: 2.352961634098203
___Test Local_ResNet_18 poisoned: True, epoch: 72: Average loss: 0.1936, Accuracy: 9379/9900 (94.7374%)
___Train Local_ResNet_18,  epoch  72, local model 78, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3588/4025 (89.1429%)
___Train Local_ResNet_18,  epoch  72, local model 78, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3704/4025 (92.0248%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 1.9015, Accuracy: 5583/10000 (55.8300%)
___Train Local_ResNet_18,  epoch  72, local model 52, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3327/3797 (87.6218%)
___Train Local_ResNet_18,  epoch  72, local model 52, internal_epoch   2,  Average loss: 0.0056, Accuracy: 3402/3797 (89.5971%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.0676, Accuracy: 5367/10000 (53.6700%)
___Train Local_ResNet_18,  epoch  72, local model 95, internal_epoch   1,  Average loss: 0.0078, Accuracy: 3920/4625 (84.7568%)
___Train Local_ResNet_18,  epoch  72, local model 95, internal_epoch   2,  Average loss: 0.0066, Accuracy: 4046/4625 (87.4811%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.1604, Accuracy: 5223/10000 (52.2300%)
___Train Local_ResNet_18,  epoch  72, local model 7, internal_epoch   1,  Average loss: 0.0082, Accuracy: 3856/4481 (86.0522%)
___Train Local_ResNet_18,  epoch  72, local model 7, internal_epoch   2,  Average loss: 0.0081, Accuracy: 3903/4481 (87.1011%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.1909, Accuracy: 5195/10000 (51.9500%)
___Train Local_ResNet_18,  epoch  72, local model 20, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3834/4315 (88.8528%)
___Train Local_ResNet_18,  epoch  72, local model 20, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3967/4315 (91.9351%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 1.9453, Accuracy: 5550/10000 (55.5000%)
___Train Local_ResNet_18,  epoch  72, local model 73, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3698/4235 (87.3200%)
___Train Local_ResNet_18,  epoch  72, local model 73, internal_epoch   2,  Average loss: 0.0056, Accuracy: 3796/4235 (89.6340%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.1601, Accuracy: 5358/10000 (53.5800%)
___Train Local_ResNet_18,  epoch  72, local model 98, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3378/3828 (88.2445%)
___Train Local_ResNet_18,  epoch  72, local model 98, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3475/3828 (90.7785%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 1.9068, Accuracy: 5555/10000 (55.5500%)
___Train Local_ResNet_18,  epoch  72, local model 74, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3824/4416 (86.5942%)
___Train Local_ResNet_18,  epoch  72, local model 74, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3943/4416 (89.2889%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 1.9613, Accuracy: 5512/10000 (55.1200%)
___Train Local_ResNet_18,  epoch  72, local model 76, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3152/3638 (86.6410%)
___Train Local_ResNet_18,  epoch  72, local model 76, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3279/3638 (90.1319%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.0024, Accuracy: 5393/10000 (53.9300%)
___Train Local_ResNet_18,  epoch  72, local model 9, internal_epoch   1,  Average loss: 0.0073, Accuracy: 4537/5265 (86.1728%)
___Train Local_ResNet_18,  epoch  72, local model 9, internal_epoch   2,  Average loss: 0.0067, Accuracy: 4547/5265 (86.3628%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.0613, Accuracy: 5352/10000 (53.5200%)
___Train Local_ResNet_18,  epoch  72, local model 79, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3340/3781 (88.3364%)
___Train Local_ResNet_18,  epoch  72, local model 79, internal_epoch   2,  Average loss: 0.0064, Accuracy: 3339/3781 (88.3100%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.2519, Accuracy: 5108/10000 (51.0800%)
___Train Local_ResNet_18,  epoch  72, local model 48, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3943/4441 (88.7863%)
___Train Local_ResNet_18,  epoch  72, local model 48, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3990/4441 (89.8446%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.1652, Accuracy: 5251/10000 (52.5100%)
___Train Local_ResNet_18,  epoch  72, local model 33, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3962/4433 (89.3751%)
___Train Local_ResNet_18,  epoch  72, local model 33, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4017/4433 (90.6158%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.0400, Accuracy: 5401/10000 (54.0100%)
___Train Local_ResNet_18,  epoch  72, local model 12, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4411/5083 (86.7795%)
___Train Local_ResNet_18,  epoch  72, local model 12, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4483/5083 (88.1959%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.1346, Accuracy: 5155/10000 (51.5500%)
___Train Local_ResNet_18,  epoch  72, local model 16, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4297/4928 (87.1956%)
___Train Local_ResNet_18,  epoch  72, local model 16, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4405/4928 (89.3872%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 1.9520, Accuracy: 5532/10000 (55.3200%)
___Train Local_ResNet_18,  epoch  72, local model 84, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4156/4793 (86.7098%)
___Train Local_ResNet_18,  epoch  72, local model 84, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4345/4793 (90.6530%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.0079, Accuracy: 5405/10000 (54.0500%)
time spent on training: 260.4247145652771
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 72: Average loss: 1.1633, Accuracy: 6940/10000 (69.4000%)
___Test Target_ResNet_18 poisoned: True, epoch: 72: Average loss: 9.3415, Accuracy: 76/9900 (0.7677%)
Done in 290.6665823459625 sec.
Server Epoch:73 choose agents : [13, 36, 58, 71, 86, 39, 96, 76, 59, 34, 52, 80, 90, 57, 87, 82, 78, 10, 18, 0].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  73, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4409/4885 (90.2559%), train_poison_data_count: 385
Global model norm: 42.50164145497427.
Norm before scaling: 42.503575791668695. Distance: 2.117146734429378
Total norm for 4 adversaries is: 42.503575791668695. distance: 2.117146734429378
___Test Local_ResNet_18 poisoned: True, epoch: 73: Average loss: 0.1873, Accuracy: 9402/9900 (94.9697%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  73, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4745/5305 (89.4439%), train_poison_data_count: 415
Global model norm: 42.50164145497427.
Norm before scaling: 42.50504048694549. Distance: 2.195846655538007
Total norm for 4 adversaries is: 42.50504048694549. distance: 2.195846655538007
___Test Local_ResNet_18 poisoned: True, epoch: 73: Average loss: 0.0766, Accuracy: 9686/9900 (97.8384%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  73, local model 58, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4208/4717 (89.2092%), train_poison_data_count: 370
Global model norm: 42.50164145497427.
Norm before scaling: 42.50430096573684. Distance: 2.0876255705750255
Total norm for 4 adversaries is: 42.50430096573684. distance: 2.0876255705750255
___Test Local_ResNet_18 poisoned: True, epoch: 73: Average loss: 0.1920, Accuracy: 9378/9900 (94.7273%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  73, local model 71, internal_epoch   1,  Average loss: 0.0072, Accuracy: 4459/5066 (88.0182%), train_poison_data_count: 400
Global model norm: 42.50164145497427.
Norm before scaling: 42.50819802595803. Distance: 2.258793917863891
Total norm for 4 adversaries is: 42.50819802595803. distance: 2.258793917863891
___Test Local_ResNet_18 poisoned: True, epoch: 73: Average loss: 0.1532, Accuracy: 9481/9900 (95.7677%)
___Train Local_ResNet_18,  epoch  73, local model 86, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3119/3616 (86.2555%)
___Train Local_ResNet_18,  epoch  73, local model 86, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3260/3616 (90.1549%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 1.8030, Accuracy: 5758/10000 (57.5800%)
___Train Local_ResNet_18,  epoch  73, local model 39, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3405/3837 (88.7412%)
___Train Local_ResNet_18,  epoch  73, local model 39, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3506/3837 (91.3735%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 1.9542, Accuracy: 5497/10000 (54.9700%)
___Train Local_ResNet_18,  epoch  73, local model 96, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4171/4679 (89.1430%)
___Train Local_ResNet_18,  epoch  73, local model 96, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4294/4679 (91.7717%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 1.9599, Accuracy: 5535/10000 (55.3500%)
___Train Local_ResNet_18,  epoch  73, local model 76, internal_epoch   1,  Average loss: 0.0072, Accuracy: 3100/3638 (85.2117%)
___Train Local_ResNet_18,  epoch  73, local model 76, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3270/3638 (89.8846%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.0382, Accuracy: 5336/10000 (53.3600%)
___Train Local_ResNet_18,  epoch  73, local model 59, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3611/4046 (89.2486%)
___Train Local_ResNet_18,  epoch  73, local model 59, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3636/4046 (89.8665%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 1.9814, Accuracy: 5403/10000 (54.0300%)
___Train Local_ResNet_18,  epoch  73, local model 34, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3975/4518 (87.9814%)
___Train Local_ResNet_18,  epoch  73, local model 34, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4112/4518 (91.0137%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.0453, Accuracy: 5273/10000 (52.7300%)
___Train Local_ResNet_18,  epoch  73, local model 52, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3355/3797 (88.3592%)
___Train Local_ResNet_18,  epoch  73, local model 52, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3408/3797 (89.7551%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.1661, Accuracy: 5277/10000 (52.7700%)
___Train Local_ResNet_18,  epoch  73, local model 80, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4424/5025 (88.0398%)
___Train Local_ResNet_18,  epoch  73, local model 80, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4489/5025 (89.3333%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.2130, Accuracy: 5212/10000 (52.1200%)
___Train Local_ResNet_18,  epoch  73, local model 90, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3889/4362 (89.1564%)
___Train Local_ResNet_18,  epoch  73, local model 90, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3971/4362 (91.0362%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.0558, Accuracy: 5304/10000 (53.0400%)
___Train Local_ResNet_18,  epoch  73, local model 57, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3970/4558 (87.0996%)
___Train Local_ResNet_18,  epoch  73, local model 57, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4031/4558 (88.4379%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.1430, Accuracy: 5178/10000 (51.7800%)
___Train Local_ResNet_18,  epoch  73, local model 87, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3190/3672 (86.8736%)
___Train Local_ResNet_18,  epoch  73, local model 87, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3281/3672 (89.3519%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.2030, Accuracy: 5099/10000 (50.9900%)
___Train Local_ResNet_18,  epoch  73, local model 82, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4299/4874 (88.2027%)
___Train Local_ResNet_18,  epoch  73, local model 82, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4355/4874 (89.3517%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.2666, Accuracy: 5090/10000 (50.9000%)
___Train Local_ResNet_18,  epoch  73, local model 78, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3591/4025 (89.2174%)
___Train Local_ResNet_18,  epoch  73, local model 78, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3711/4025 (92.1988%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 1.9462, Accuracy: 5576/10000 (55.7600%)
___Train Local_ResNet_18,  epoch  73, local model 10, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4100/4663 (87.9262%)
___Train Local_ResNet_18,  epoch  73, local model 10, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4232/4663 (90.7570%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.0410, Accuracy: 5331/10000 (53.3100%)
___Train Local_ResNet_18,  epoch  73, local model 18, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3453/3911 (88.2894%)
___Train Local_ResNet_18,  epoch  73, local model 18, internal_epoch   2,  Average loss: 0.0064, Accuracy: 3430/3911 (87.7014%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.0426, Accuracy: 5312/10000 (53.1200%)
___Train Local_ResNet_18,  epoch  73, local model 0, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4433/5017 (88.3596%)
___Train Local_ResNet_18,  epoch  73, local model 0, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4575/5017 (91.1900%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 1.7652, Accuracy: 5785/10000 (57.8500%)
time spent on training: 258.55295515060425
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 73: Average loss: 1.1967, Accuracy: 6863/10000 (68.6300%)
___Test Target_ResNet_18 poisoned: True, epoch: 73: Average loss: 9.4111, Accuracy: 61/9900 (0.6162%)
Done in 289.246924161911 sec.
Server Epoch:74 choose agents : [13, 36, 58, 71, 53, 55, 91, 40, 17, 22, 11, 3, 61, 19, 27, 54, 96, 2, 86, 28].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  74, local model 13, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4384/4885 (89.7441%), train_poison_data_count: 385
Global model norm: 42.530868270696935.
Norm before scaling: 42.534965223937384. Distance: 2.1155483756001408
Total norm for 4 adversaries is: 42.534965223937384. distance: 2.1155483756001408
___Test Local_ResNet_18 poisoned: True, epoch: 74: Average loss: 0.5803, Accuracy: 8602/9900 (86.8889%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  74, local model 36, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4782/5305 (90.1414%), train_poison_data_count: 415
Global model norm: 42.530868270696935.
Norm before scaling: 42.53009475607758. Distance: 2.1474640461550942
Total norm for 4 adversaries is: 42.53009475607758. distance: 2.1474640461550942
___Test Local_ResNet_18 poisoned: True, epoch: 74: Average loss: 0.1026, Accuracy: 9629/9900 (97.2626%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  74, local model 58, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4218/4717 (89.4212%), train_poison_data_count: 370
Global model norm: 42.530868270696935.
Norm before scaling: 42.53290029402974. Distance: 2.0863952134542614
Total norm for 4 adversaries is: 42.53290029402974. distance: 2.0863952134542614
___Test Local_ResNet_18 poisoned: True, epoch: 74: Average loss: 0.1370, Accuracy: 9541/9900 (96.3737%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  74, local model 71, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4485/5066 (88.5314%), train_poison_data_count: 400
Global model norm: 42.530868270696935.
Norm before scaling: 42.53734428922059. Distance: 2.2651345610068674
Total norm for 4 adversaries is: 42.53734428922059. distance: 2.2651345610068674
___Test Local_ResNet_18 poisoned: True, epoch: 74: Average loss: 0.2757, Accuracy: 9178/9900 (92.7071%)
___Train Local_ResNet_18,  epoch  74, local model 53, internal_epoch   1,  Average loss: 0.0072, Accuracy: 5289/6124 (86.3651%)
___Train Local_ResNet_18,  epoch  74, local model 53, internal_epoch   2,  Average loss: 0.0066, Accuracy: 5320/6124 (86.8713%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.1718, Accuracy: 5071/10000 (50.7100%)
___Train Local_ResNet_18,  epoch  74, local model 55, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3874/4356 (88.9348%)
___Train Local_ResNet_18,  epoch  74, local model 55, internal_epoch   2,  Average loss: 0.0082, Accuracy: 3682/4356 (84.5271%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.3561, Accuracy: 4919/10000 (49.1900%)
___Train Local_ResNet_18,  epoch  74, local model 91, internal_epoch   1,  Average loss: 0.0079, Accuracy: 3510/4158 (84.4156%)
___Train Local_ResNet_18,  epoch  74, local model 91, internal_epoch   2,  Average loss: 0.0069, Accuracy: 3613/4158 (86.8927%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.0843, Accuracy: 5261/10000 (52.6100%)
___Train Local_ResNet_18,  epoch  74, local model 40, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4874/5455 (89.3492%)
___Train Local_ResNet_18,  epoch  74, local model 40, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4873/5455 (89.3309%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 1.9875, Accuracy: 5403/10000 (54.0300%)
___Train Local_ResNet_18,  epoch  74, local model 17, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3886/4511 (86.1450%)
___Train Local_ResNet_18,  epoch  74, local model 17, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4015/4511 (89.0047%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 1.9911, Accuracy: 5316/10000 (53.1600%)
___Train Local_ResNet_18,  epoch  74, local model 22, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4525/5232 (86.4870%)
___Train Local_ResNet_18,  epoch  74, local model 22, internal_epoch   2,  Average loss: 0.0066, Accuracy: 4545/5232 (86.8693%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.1259, Accuracy: 5301/10000 (53.0100%)
___Train Local_ResNet_18,  epoch  74, local model 11, internal_epoch   1,  Average loss: 0.0073, Accuracy: 4472/5244 (85.2784%)
___Train Local_ResNet_18,  epoch  74, local model 11, internal_epoch   2,  Average loss: 0.0069, Accuracy: 4519/5244 (86.1747%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 1.9715, Accuracy: 5502/10000 (55.0200%)
___Train Local_ResNet_18,  epoch  74, local model 3, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4368/4918 (88.8166%)
___Train Local_ResNet_18,  epoch  74, local model 3, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4423/4918 (89.9349%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.0267, Accuracy: 5342/10000 (53.4200%)
___Train Local_ResNet_18,  epoch  74, local model 61, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3596/4126 (87.1546%)
___Train Local_ResNet_18,  epoch  74, local model 61, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3721/4126 (90.1842%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 1.8717, Accuracy: 5551/10000 (55.5100%)
___Train Local_ResNet_18,  epoch  74, local model 19, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4335/4928 (87.9667%)
___Train Local_ResNet_18,  epoch  74, local model 19, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4387/4928 (89.0219%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.0421, Accuracy: 5308/10000 (53.0800%)
___Train Local_ResNet_18,  epoch  74, local model 27, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3697/4223 (87.5444%)
___Train Local_ResNet_18,  epoch  74, local model 27, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3851/4223 (91.1911%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 1.9743, Accuracy: 5488/10000 (54.8800%)
___Train Local_ResNet_18,  epoch  74, local model 54, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4529/5195 (87.1800%)
___Train Local_ResNet_18,  epoch  74, local model 54, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4589/5195 (88.3349%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.0792, Accuracy: 5373/10000 (53.7300%)
___Train Local_ResNet_18,  epoch  74, local model 96, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4127/4679 (88.2026%)
___Train Local_ResNet_18,  epoch  74, local model 96, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4142/4679 (88.5232%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.0015, Accuracy: 5363/10000 (53.6300%)
___Train Local_ResNet_18,  epoch  74, local model 2, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3169/3646 (86.9172%)
___Train Local_ResNet_18,  epoch  74, local model 2, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3286/3646 (90.1262%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 1.8317, Accuracy: 5717/10000 (57.1700%)
___Train Local_ResNet_18,  epoch  74, local model 86, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3166/3616 (87.5553%)
___Train Local_ResNet_18,  epoch  74, local model 86, internal_epoch   2,  Average loss: 0.0055, Accuracy: 3218/3616 (88.9934%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 1.8384, Accuracy: 5746/10000 (57.4600%)
___Train Local_ResNet_18,  epoch  74, local model 28, internal_epoch   1,  Average loss: 0.0075, Accuracy: 4034/4716 (85.5386%)
___Train Local_ResNet_18,  epoch  74, local model 28, internal_epoch   2,  Average loss: 0.0064, Accuracy: 4130/4716 (87.5742%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.0374, Accuracy: 5351/10000 (53.5100%)
time spent on training: 269.75478434562683
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 74: Average loss: 1.2472, Accuracy: 6775/10000 (67.7500%)
___Test Target_ResNet_18 poisoned: True, epoch: 74: Average loss: 9.4004, Accuracy: 58/9900 (0.5859%)
Done in 300.4007887840271 sec.
Server Epoch:75 choose agents : [13, 36, 58, 71, 53, 33, 79, 24, 80, 96, 47, 1, 20, 74, 94, 84, 22, 44, 46, 50].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  75, local model 13, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4403/4885 (90.1331%), train_poison_data_count: 385
Global model norm: 42.568159670972825.
Norm before scaling: 42.57291252497737. Distance: 2.130331531745739
Total norm for 4 adversaries is: 42.57291252497737. distance: 2.130331531745739
___Test Local_ResNet_18 poisoned: True, epoch: 75: Average loss: 0.1323, Accuracy: 9560/9900 (96.5657%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  75, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4798/5305 (90.4430%), train_poison_data_count: 415
Global model norm: 42.568159670972825.
Norm before scaling: 42.56333888903469. Distance: 2.1466445377149124
Total norm for 4 adversaries is: 42.56333888903469. distance: 2.1466445377149124
___Test Local_ResNet_18 poisoned: True, epoch: 75: Average loss: 0.1384, Accuracy: 9554/9900 (96.5051%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  75, local model 58, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4218/4717 (89.4212%), train_poison_data_count: 370
Global model norm: 42.568159670972825.
Norm before scaling: 42.56992610280687. Distance: 2.0876977472811253
Total norm for 4 adversaries is: 42.56992610280687. distance: 2.0876977472811253
___Test Local_ResNet_18 poisoned: True, epoch: 75: Average loss: 0.2139, Accuracy: 9357/9900 (94.5152%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  75, local model 71, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4480/5066 (88.4327%), train_poison_data_count: 400
Global model norm: 42.568159670972825.
Norm before scaling: 42.57731793959886. Distance: 2.288854491902296
Total norm for 4 adversaries is: 42.57731793959886. distance: 2.288854491902296
___Test Local_ResNet_18 poisoned: True, epoch: 75: Average loss: 0.2220, Accuracy: 9331/9900 (94.2525%)
___Train Local_ResNet_18,  epoch  75, local model 53, internal_epoch   1,  Average loss: 0.0073, Accuracy: 5255/6124 (85.8099%)
___Train Local_ResNet_18,  epoch  75, local model 53, internal_epoch   2,  Average loss: 0.0064, Accuracy: 5357/6124 (87.4755%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 2.0232, Accuracy: 5286/10000 (52.8600%)
___Train Local_ResNet_18,  epoch  75, local model 33, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3917/4433 (88.3600%)
___Train Local_ResNet_18,  epoch  75, local model 33, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3996/4433 (90.1421%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.9538, Accuracy: 5556/10000 (55.5600%)
___Train Local_ResNet_18,  epoch  75, local model 79, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3362/3781 (88.9183%)
___Train Local_ResNet_18,  epoch  75, local model 79, internal_epoch   2,  Average loss: 0.0075, Accuracy: 3255/3781 (86.0883%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 2.3810, Accuracy: 4833/10000 (48.3300%)
___Train Local_ResNet_18,  epoch  75, local model 24, internal_epoch   1,  Average loss: 0.0071, Accuracy: 3529/3969 (88.9141%)
___Train Local_ResNet_18,  epoch  75, local model 24, internal_epoch   2,  Average loss: 0.0062, Accuracy: 3593/3969 (90.5266%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.9234, Accuracy: 5553/10000 (55.5300%)
___Train Local_ResNet_18,  epoch  75, local model 80, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4437/5025 (88.2985%)
___Train Local_ResNet_18,  epoch  75, local model 80, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4543/5025 (90.4080%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 2.1294, Accuracy: 5241/10000 (52.4100%)
___Train Local_ResNet_18,  epoch  75, local model 96, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4140/4679 (88.4804%)
___Train Local_ResNet_18,  epoch  75, local model 96, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4254/4679 (90.9169%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.9070, Accuracy: 5619/10000 (56.1900%)
___Train Local_ResNet_18,  epoch  75, local model 47, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4152/4707 (88.2091%)
___Train Local_ResNet_18,  epoch  75, local model 47, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4250/4707 (90.2911%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.9122, Accuracy: 5507/10000 (55.0700%)
___Train Local_ResNet_18,  epoch  75, local model 1, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4402/4986 (88.2872%)
___Train Local_ResNet_18,  epoch  75, local model 1, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4400/4986 (88.2471%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.9482, Accuracy: 5482/10000 (54.8200%)
___Train Local_ResNet_18,  epoch  75, local model 20, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3883/4315 (89.9884%)
___Train Local_ResNet_18,  epoch  75, local model 20, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3952/4315 (91.5875%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.8641, Accuracy: 5621/10000 (56.2100%)
___Train Local_ResNet_18,  epoch  75, local model 74, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3823/4416 (86.5716%)
___Train Local_ResNet_18,  epoch  75, local model 74, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3891/4416 (88.1114%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.9662, Accuracy: 5461/10000 (54.6100%)
___Train Local_ResNet_18,  epoch  75, local model 94, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4248/4804 (88.4263%)
___Train Local_ResNet_18,  epoch  75, local model 94, internal_epoch   2,  Average loss: 0.0077, Accuracy: 4089/4804 (85.1166%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 2.2915, Accuracy: 5040/10000 (50.4000%)
___Train Local_ResNet_18,  epoch  75, local model 84, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4152/4793 (86.6263%)
___Train Local_ResNet_18,  epoch  75, local model 84, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4277/4793 (89.2343%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 2.0345, Accuracy: 5430/10000 (54.3000%)
___Train Local_ResNet_18,  epoch  75, local model 22, internal_epoch   1,  Average loss: 0.0073, Accuracy: 4492/5232 (85.8563%)
___Train Local_ResNet_18,  epoch  75, local model 22, internal_epoch   2,  Average loss: 0.0064, Accuracy: 4546/5232 (86.8884%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.9180, Accuracy: 5483/10000 (54.8300%)
___Train Local_ResNet_18,  epoch  75, local model 44, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4088/4662 (87.6877%)
___Train Local_ResNet_18,  epoch  75, local model 44, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4271/4662 (91.6130%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 2.0464, Accuracy: 5376/10000 (53.7600%)
___Train Local_ResNet_18,  epoch  75, local model 46, internal_epoch   1,  Average loss: 0.0075, Accuracy: 4227/4956 (85.2906%)
___Train Local_ResNet_18,  epoch  75, local model 46, internal_epoch   2,  Average loss: 0.0063, Accuracy: 4323/4956 (87.2276%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 2.1612, Accuracy: 5133/10000 (51.3300%)
___Train Local_ResNet_18,  epoch  75, local model 50, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3809/4368 (87.2024%)
___Train Local_ResNet_18,  epoch  75, local model 50, internal_epoch   2,  Average loss: 0.0061, Accuracy: 3847/4368 (88.0723%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.9416, Accuracy: 5455/10000 (54.5500%)
time spent on training: 269.62849497795105
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.2602, Accuracy: 6773/10000 (67.7300%)
___Test Target_ResNet_18 poisoned: True, epoch: 75: Average loss: 9.5569, Accuracy: 46/9900 (0.4646%)
Done in 300.3894143104553 sec.
Server Epoch:76 choose agents : [13, 36, 58, 71, 53, 25, 47, 77, 68, 92, 10, 46, 59, 23, 32, 21, 98, 76, 79, 39].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  76, local model 13, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4371/4885 (89.4780%), train_poison_data_count: 385
Global model norm: 42.605186354443696.
Norm before scaling: 42.60946094600793. Distance: 2.1570954807532137
Total norm for 4 adversaries is: 42.60946094600793. distance: 2.1570954807532137
___Test Local_ResNet_18 poisoned: True, epoch: 76: Average loss: 0.2854, Accuracy: 9216/9900 (93.0909%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  76, local model 36, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4747/5305 (89.4816%), train_poison_data_count: 415
Global model norm: 42.605186354443696.
Norm before scaling: 42.60409471774691. Distance: 2.1708125527742435
Total norm for 4 adversaries is: 42.60409471774691. distance: 2.1708125527742435
___Test Local_ResNet_18 poisoned: True, epoch: 76: Average loss: 0.1965, Accuracy: 9401/9900 (94.9596%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  76, local model 58, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4239/4717 (89.8664%), train_poison_data_count: 370
Global model norm: 42.605186354443696.
Norm before scaling: 42.604381239272215. Distance: 2.065433035051956
Total norm for 4 adversaries is: 42.604381239272215. distance: 2.065433035051956
___Test Local_ResNet_18 poisoned: True, epoch: 76: Average loss: 0.1789, Accuracy: 9421/9900 (95.1616%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  76, local model 71, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4481/5066 (88.4524%), train_poison_data_count: 400
Global model norm: 42.605186354443696.
Norm before scaling: 42.6154251755233. Distance: 2.291741791852049
Total norm for 4 adversaries is: 42.6154251755233. distance: 2.291741791852049
___Test Local_ResNet_18 poisoned: True, epoch: 76: Average loss: 0.1209, Accuracy: 9586/9900 (96.8283%)
___Train Local_ResNet_18,  epoch  76, local model 53, internal_epoch   1,  Average loss: 0.0071, Accuracy: 5303/6124 (86.5937%)
___Train Local_ResNet_18,  epoch  76, local model 53, internal_epoch   2,  Average loss: 0.0065, Accuracy: 5347/6124 (87.3122%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.9968, Accuracy: 5348/10000 (53.4800%)
___Train Local_ResNet_18,  epoch  76, local model 25, internal_epoch   1,  Average loss: 0.0074, Accuracy: 5050/5902 (85.5642%)
___Train Local_ResNet_18,  epoch  76, local model 25, internal_epoch   2,  Average loss: 0.0068, Accuracy: 5120/5902 (86.7503%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 2.0881, Accuracy: 5379/10000 (53.7900%)
___Train Local_ResNet_18,  epoch  76, local model 47, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4172/4707 (88.6339%)
___Train Local_ResNet_18,  epoch  76, local model 47, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4240/4707 (90.0786%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.8253, Accuracy: 5705/10000 (57.0500%)
___Train Local_ResNet_18,  epoch  76, local model 77, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4078/4647 (87.7555%)
___Train Local_ResNet_18,  epoch  76, local model 77, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4163/4647 (89.5847%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.9672, Accuracy: 5496/10000 (54.9600%)
___Train Local_ResNet_18,  epoch  76, local model 68, internal_epoch   1,  Average loss: 0.0059, Accuracy: 2921/3297 (88.5957%)
___Train Local_ResNet_18,  epoch  76, local model 68, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3009/3297 (91.2648%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.8091, Accuracy: 5744/10000 (57.4400%)
___Train Local_ResNet_18,  epoch  76, local model 92, internal_epoch   1,  Average loss: 0.0061, Accuracy: 5550/6263 (88.6157%)
___Train Local_ResNet_18,  epoch  76, local model 92, internal_epoch   2,  Average loss: 0.0051, Accuracy: 5642/6263 (90.0846%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 2.1352, Accuracy: 5226/10000 (52.2600%)
___Train Local_ResNet_18,  epoch  76, local model 10, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4135/4663 (88.6768%)
___Train Local_ResNet_18,  epoch  76, local model 10, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4274/4663 (91.6577%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 2.1446, Accuracy: 5127/10000 (51.2700%)
___Train Local_ResNet_18,  epoch  76, local model 46, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4290/4956 (86.5617%)
___Train Local_ResNet_18,  epoch  76, local model 46, internal_epoch   2,  Average loss: 0.0066, Accuracy: 4328/4956 (87.3285%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 2.1238, Accuracy: 5291/10000 (52.9100%)
___Train Local_ResNet_18,  epoch  76, local model 59, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3604/4046 (89.0756%)
___Train Local_ResNet_18,  epoch  76, local model 59, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3691/4046 (91.2259%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 2.0811, Accuracy: 5365/10000 (53.6500%)
___Train Local_ResNet_18,  epoch  76, local model 23, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3656/4184 (87.3805%)
___Train Local_ResNet_18,  epoch  76, local model 23, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3735/4184 (89.2686%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.8255, Accuracy: 5663/10000 (56.6300%)
___Train Local_ResNet_18,  epoch  76, local model 32, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4808/5591 (85.9953%)
___Train Local_ResNet_18,  epoch  76, local model 32, internal_epoch   2,  Average loss: 0.0064, Accuracy: 4890/5591 (87.4620%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 2.1537, Accuracy: 5265/10000 (52.6500%)
___Train Local_ResNet_18,  epoch  76, local model 21, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4070/4634 (87.8291%)
___Train Local_ResNet_18,  epoch  76, local model 21, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4204/4634 (90.7208%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.9437, Accuracy: 5518/10000 (55.1800%)
___Train Local_ResNet_18,  epoch  76, local model 98, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3338/3828 (87.1996%)
___Train Local_ResNet_18,  epoch  76, local model 98, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3489/3828 (91.1442%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.8361, Accuracy: 5685/10000 (56.8500%)
___Train Local_ResNet_18,  epoch  76, local model 76, internal_epoch   1,  Average loss: 0.0073, Accuracy: 3090/3638 (84.9368%)
___Train Local_ResNet_18,  epoch  76, local model 76, internal_epoch   2,  Average loss: 0.0055, Accuracy: 3241/3638 (89.0874%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.8621, Accuracy: 5570/10000 (55.7000%)
___Train Local_ResNet_18,  epoch  76, local model 79, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3354/3781 (88.7067%)
___Train Local_ResNet_18,  epoch  76, local model 79, internal_epoch   2,  Average loss: 0.0061, Accuracy: 3351/3781 (88.6273%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 2.2972, Accuracy: 4920/10000 (49.2000%)
___Train Local_ResNet_18,  epoch  76, local model 39, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3382/3837 (88.1418%)
___Train Local_ResNet_18,  epoch  76, local model 39, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3505/3837 (91.3474%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.9330, Accuracy: 5571/10000 (55.7100%)
time spent on training: 268.0338399410248
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.2536, Accuracy: 6802/10000 (68.0200%)
___Test Target_ResNet_18 poisoned: True, epoch: 76: Average loss: 9.3783, Accuracy: 75/9900 (0.7576%)
Done in 298.6286609172821 sec.
Server Epoch:77 choose agents : [13, 36, 58, 71, 8, 31, 86, 21, 57, 35, 89, 28, 53, 65, 80, 3, 27, 7, 76, 69].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  77, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4396/4885 (89.9898%), train_poison_data_count: 385
Global model norm: 42.650467499544334.
Norm before scaling: 42.653412508647094. Distance: 2.1160124160604243
Total norm for 4 adversaries is: 42.653412508647094. distance: 2.1160124160604243
___Test Local_ResNet_18 poisoned: True, epoch: 77: Average loss: 0.2061, Accuracy: 9416/9900 (95.1111%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  77, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4781/5305 (90.1225%), train_poison_data_count: 415
Global model norm: 42.650467499544334.
Norm before scaling: 42.650188442945364. Distance: 2.139385114908337
Total norm for 4 adversaries is: 42.650188442945364. distance: 2.139385114908337
___Test Local_ResNet_18 poisoned: True, epoch: 77: Average loss: 0.1948, Accuracy: 9426/9900 (95.2121%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  77, local model 58, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4188/4717 (88.7852%), train_poison_data_count: 370
Global model norm: 42.650467499544334.
Norm before scaling: 42.65213035280667. Distance: 2.088342202064495
Total norm for 4 adversaries is: 42.65213035280667. distance: 2.088342202064495
___Test Local_ResNet_18 poisoned: True, epoch: 77: Average loss: 0.1632, Accuracy: 9490/9900 (95.8586%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  77, local model 71, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4488/5066 (88.5906%), train_poison_data_count: 400
Global model norm: 42.650467499544334.
Norm before scaling: 42.65544155598366. Distance: 2.229464704132783
Total norm for 4 adversaries is: 42.65544155598366. distance: 2.229464704132783
___Test Local_ResNet_18 poisoned: True, epoch: 77: Average loss: 0.1676, Accuracy: 9468/9900 (95.6364%)
___Train Local_ResNet_18,  epoch  77, local model 8, internal_epoch   1,  Average loss: 0.0074, Accuracy: 3858/4501 (85.7143%)
___Train Local_ResNet_18,  epoch  77, local model 8, internal_epoch   2,  Average loss: 0.0063, Accuracy: 3938/4501 (87.4917%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.9769, Accuracy: 5500/10000 (55.0000%)
___Train Local_ResNet_18,  epoch  77, local model 31, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3634/4175 (87.0419%)
___Train Local_ResNet_18,  epoch  77, local model 31, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3748/4175 (89.7725%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.8535, Accuracy: 5583/10000 (55.8300%)
___Train Local_ResNet_18,  epoch  77, local model 86, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3110/3616 (86.0066%)
___Train Local_ResNet_18,  epoch  77, local model 86, internal_epoch   2,  Average loss: 0.0055, Accuracy: 3215/3616 (88.9104%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.9169, Accuracy: 5588/10000 (55.8800%)
___Train Local_ResNet_18,  epoch  77, local model 21, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4054/4634 (87.4838%)
___Train Local_ResNet_18,  epoch  77, local model 21, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4128/4634 (89.0807%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.9070, Accuracy: 5558/10000 (55.5800%)
___Train Local_ResNet_18,  epoch  77, local model 57, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3960/4558 (86.8802%)
___Train Local_ResNet_18,  epoch  77, local model 57, internal_epoch   2,  Average loss: 0.0065, Accuracy: 3976/4558 (87.2312%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 2.1294, Accuracy: 5217/10000 (52.1700%)
___Train Local_ResNet_18,  epoch  77, local model 35, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4560/5167 (88.2524%)
___Train Local_ResNet_18,  epoch  77, local model 35, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4632/5167 (89.6458%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 2.2276, Accuracy: 5085/10000 (50.8500%)
___Train Local_ResNet_18,  epoch  77, local model 89, internal_epoch   1,  Average loss: 0.0051, Accuracy: 3925/4356 (90.1056%)
___Train Local_ResNet_18,  epoch  77, local model 89, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3967/4356 (91.0698%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 2.0193, Accuracy: 5372/10000 (53.7200%)
___Train Local_ResNet_18,  epoch  77, local model 28, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4119/4716 (87.3410%)
___Train Local_ResNet_18,  epoch  77, local model 28, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4144/4716 (87.8711%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.9977, Accuracy: 5408/10000 (54.0800%)
___Train Local_ResNet_18,  epoch  77, local model 53, internal_epoch   1,  Average loss: 0.0068, Accuracy: 5346/6124 (87.2959%)
___Train Local_ResNet_18,  epoch  77, local model 53, internal_epoch   2,  Average loss: 0.0062, Accuracy: 5373/6124 (87.7368%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.9017, Accuracy: 5506/10000 (55.0600%)
___Train Local_ResNet_18,  epoch  77, local model 65, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4422/5055 (87.4777%)
___Train Local_ResNet_18,  epoch  77, local model 65, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4544/5055 (89.8912%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.9877, Accuracy: 5477/10000 (54.7700%)
___Train Local_ResNet_18,  epoch  77, local model 80, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4478/5025 (89.1144%)
___Train Local_ResNet_18,  epoch  77, local model 80, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4542/5025 (90.3881%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 2.1611, Accuracy: 5332/10000 (53.3200%)
___Train Local_ResNet_18,  epoch  77, local model 3, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4353/4918 (88.5116%)
___Train Local_ResNet_18,  epoch  77, local model 3, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4378/4918 (89.0199%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 2.1348, Accuracy: 5118/10000 (51.1800%)
___Train Local_ResNet_18,  epoch  77, local model 27, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3699/4223 (87.5918%)
___Train Local_ResNet_18,  epoch  77, local model 27, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3836/4223 (90.8359%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.9480, Accuracy: 5579/10000 (55.7900%)
___Train Local_ResNet_18,  epoch  77, local model 7, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3970/4481 (88.5963%)
___Train Local_ResNet_18,  epoch  77, local model 7, internal_epoch   2,  Average loss: 0.0068, Accuracy: 3923/4481 (87.5474%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.9796, Accuracy: 5528/10000 (55.2800%)
___Train Local_ResNet_18,  epoch  77, local model 76, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3165/3638 (86.9984%)
___Train Local_ResNet_18,  epoch  77, local model 76, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3277/3638 (90.0770%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.9575, Accuracy: 5528/10000 (55.2800%)
___Train Local_ResNet_18,  epoch  77, local model 69, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3570/4013 (88.9609%)
___Train Local_ResNet_18,  epoch  77, local model 69, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3664/4013 (91.3033%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.8673, Accuracy: 5627/10000 (56.2700%)
time spent on training: 267.12225461006165
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.2462, Accuracy: 6814/10000 (68.1400%)
___Test Target_ResNet_18 poisoned: True, epoch: 77: Average loss: 9.8140, Accuracy: 61/9900 (0.6162%)
Done in 297.3861255645752 sec.
Server Epoch:78 choose agents : [13, 36, 58, 71, 2, 8, 93, 35, 40, 32, 96, 0, 84, 66, 42, 31, 67, 4, 22, 30].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  78, local model 13, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4394/4885 (89.9488%), train_poison_data_count: 385
Global model norm: 42.69465132722277.
Norm before scaling: 42.69786631772058. Distance: 2.1144269562826215
Total norm for 4 adversaries is: 42.69786631772058. distance: 2.1144269562826215
___Test Local_ResNet_18 poisoned: True, epoch: 78: Average loss: 0.2544, Accuracy: 9258/9900 (93.5152%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  78, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4752/5305 (89.5759%), train_poison_data_count: 415
Global model norm: 42.69465132722277.
Norm before scaling: 42.693949400701825. Distance: 2.165442181861954
Total norm for 4 adversaries is: 42.693949400701825. distance: 2.165442181861954
___Test Local_ResNet_18 poisoned: True, epoch: 78: Average loss: 0.2210, Accuracy: 9372/9900 (94.6667%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  78, local model 58, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4219/4717 (89.4424%), train_poison_data_count: 370
Global model norm: 42.69465132722277.
Norm before scaling: 42.69573778951038. Distance: 2.0518034794194984
Total norm for 4 adversaries is: 42.69573778951038. distance: 2.0518034794194984
___Test Local_ResNet_18 poisoned: True, epoch: 78: Average loss: 0.2931, Accuracy: 9179/9900 (92.7172%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  78, local model 71, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4487/5066 (88.5709%), train_poison_data_count: 400
Global model norm: 42.69465132722277.
Norm before scaling: 42.70069942571565. Distance: 2.257881137108214
Total norm for 4 adversaries is: 42.70069942571565. distance: 2.257881137108214
___Test Local_ResNet_18 poisoned: True, epoch: 78: Average loss: 0.1049, Accuracy: 9612/9900 (97.0909%)
___Train Local_ResNet_18,  epoch  78, local model 2, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3180/3646 (87.2189%)
___Train Local_ResNet_18,  epoch  78, local model 2, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3304/3646 (90.6199%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.7890, Accuracy: 5807/10000 (58.0700%)
___Train Local_ResNet_18,  epoch  78, local model 8, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3900/4501 (86.6474%)
___Train Local_ResNet_18,  epoch  78, local model 8, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4033/4501 (89.6023%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.9456, Accuracy: 5417/10000 (54.1700%)
___Train Local_ResNet_18,  epoch  78, local model 93, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4029/4651 (86.6265%)
___Train Local_ResNet_18,  epoch  78, local model 93, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4199/4651 (90.2817%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.9069, Accuracy: 5541/10000 (55.4100%)
___Train Local_ResNet_18,  epoch  78, local model 35, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4549/5167 (88.0395%)
___Train Local_ResNet_18,  epoch  78, local model 35, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4684/5167 (90.6522%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 2.0107, Accuracy: 5388/10000 (53.8800%)
___Train Local_ResNet_18,  epoch  78, local model 40, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4855/5455 (89.0009%)
___Train Local_ResNet_18,  epoch  78, local model 40, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4843/5455 (88.7809%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 2.2632, Accuracy: 5022/10000 (50.2200%)
___Train Local_ResNet_18,  epoch  78, local model 32, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4885/5591 (87.3726%)
___Train Local_ResNet_18,  epoch  78, local model 32, internal_epoch   2,  Average loss: 0.0062, Accuracy: 4919/5591 (87.9807%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 2.2602, Accuracy: 5013/10000 (50.1300%)
___Train Local_ResNet_18,  epoch  78, local model 96, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4171/4679 (89.1430%)
___Train Local_ResNet_18,  epoch  78, local model 96, internal_epoch   2,  Average loss: 0.0070, Accuracy: 4041/4679 (86.3646%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 2.1207, Accuracy: 5220/10000 (52.2000%)
___Train Local_ResNet_18,  epoch  78, local model 0, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4439/5017 (88.4792%)
___Train Local_ResNet_18,  epoch  78, local model 0, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4511/5017 (89.9143%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.9234, Accuracy: 5549/10000 (55.4900%)
___Train Local_ResNet_18,  epoch  78, local model 84, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4183/4793 (87.2731%)
___Train Local_ResNet_18,  epoch  78, local model 84, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4303/4793 (89.7768%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 2.1131, Accuracy: 5308/10000 (53.0800%)
___Train Local_ResNet_18,  epoch  78, local model 66, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3994/4456 (89.6320%)
___Train Local_ResNet_18,  epoch  78, local model 66, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4060/4456 (91.1131%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.9854, Accuracy: 5517/10000 (55.1700%)
___Train Local_ResNet_18,  epoch  78, local model 42, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4790/5424 (88.3112%)
___Train Local_ResNet_18,  epoch  78, local model 42, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4934/5424 (90.9661%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 2.1851, Accuracy: 5221/10000 (52.2100%)
___Train Local_ResNet_18,  epoch  78, local model 31, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3617/4175 (86.6347%)
___Train Local_ResNet_18,  epoch  78, local model 31, internal_epoch   2,  Average loss: 0.0066, Accuracy: 3653/4175 (87.4970%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.9584, Accuracy: 5495/10000 (54.9500%)
___Train Local_ResNet_18,  epoch  78, local model 67, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4490/5116 (87.7639%)
___Train Local_ResNet_18,  epoch  78, local model 67, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4532/5116 (88.5848%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 2.0139, Accuracy: 5410/10000 (54.1000%)
___Train Local_ResNet_18,  epoch  78, local model 4, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3244/3704 (87.5810%)
___Train Local_ResNet_18,  epoch  78, local model 4, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3319/3704 (89.6058%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.9523, Accuracy: 5550/10000 (55.5000%)
___Train Local_ResNet_18,  epoch  78, local model 22, internal_epoch   1,  Average loss: 0.0073, Accuracy: 4476/5232 (85.5505%)
___Train Local_ResNet_18,  epoch  78, local model 22, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4615/5232 (88.2072%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 2.0825, Accuracy: 5224/10000 (52.2400%)
___Train Local_ResNet_18,  epoch  78, local model 30, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3086/3472 (88.8825%)
___Train Local_ResNet_18,  epoch  78, local model 30, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3177/3472 (91.5035%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 2.0969, Accuracy: 5433/10000 (54.3300%)
time spent on training: 267.88843059539795
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.2609, Accuracy: 6830/10000 (68.3000%)
___Test Target_ResNet_18 poisoned: True, epoch: 78: Average loss: 9.9203, Accuracy: 64/9900 (0.6465%)
Done in 298.3816497325897 sec.
Server Epoch:79 choose agents : [13, 36, 58, 71, 63, 50, 4, 19, 55, 18, 93, 23, 29, 84, 60, 1, 53, 47, 73, 59].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  79, local model 13, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4381/4885 (89.6827%), train_poison_data_count: 385
Global model norm: 42.731067056614386.
Norm before scaling: 42.73287674475956. Distance: 2.106285375643263
Total norm for 4 adversaries is: 42.73287674475956. distance: 2.106285375643263
___Test Local_ResNet_18 poisoned: True, epoch: 79: Average loss: 0.3562, Accuracy: 9005/9900 (90.9596%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  79, local model 36, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4743/5305 (89.4062%), train_poison_data_count: 415
Global model norm: 42.731067056614386.
Norm before scaling: 42.73140557553587. Distance: 2.194935722191983
Total norm for 4 adversaries is: 42.73140557553587. distance: 2.194935722191983
___Test Local_ResNet_18 poisoned: True, epoch: 79: Average loss: 0.2284, Accuracy: 9358/9900 (94.5253%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  79, local model 58, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4235/4717 (89.7816%), train_poison_data_count: 370
Global model norm: 42.731067056614386.
Norm before scaling: 42.730895653606126. Distance: 2.0457323685209907
Total norm for 4 adversaries is: 42.730895653606126. distance: 2.0457323685209907
___Test Local_ResNet_18 poisoned: True, epoch: 79: Average loss: 0.1709, Accuracy: 9462/9900 (95.5758%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  79, local model 71, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4494/5066 (88.7090%), train_poison_data_count: 400
Global model norm: 42.731067056614386.
Norm before scaling: 42.737499885748754. Distance: 2.255533619269243
Total norm for 4 adversaries is: 42.737499885748754. distance: 2.255533619269243
___Test Local_ResNet_18 poisoned: True, epoch: 79: Average loss: 0.3133, Accuracy: 9093/9900 (91.8485%)
___Train Local_ResNet_18,  epoch  79, local model 63, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3209/3590 (89.3872%)
___Train Local_ResNet_18,  epoch  79, local model 63, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3327/3590 (92.6741%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 2.0313, Accuracy: 5551/10000 (55.5100%)
___Train Local_ResNet_18,  epoch  79, local model 50, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3820/4368 (87.4542%)
___Train Local_ResNet_18,  epoch  79, local model 50, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3877/4368 (88.7592%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.8877, Accuracy: 5461/10000 (54.6100%)
___Train Local_ResNet_18,  epoch  79, local model 4, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3259/3704 (87.9860%)
___Train Local_ResNet_18,  epoch  79, local model 4, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3359/3704 (90.6857%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.9050, Accuracy: 5564/10000 (55.6400%)
___Train Local_ResNet_18,  epoch  79, local model 19, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4315/4928 (87.5609%)
___Train Local_ResNet_18,  epoch  79, local model 19, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4394/4928 (89.1640%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 2.1241, Accuracy: 5291/10000 (52.9100%)
___Train Local_ResNet_18,  epoch  79, local model 55, internal_epoch   1,  Average loss: 0.0050, Accuracy: 3962/4356 (90.9550%)
___Train Local_ResNet_18,  epoch  79, local model 55, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3969/4356 (91.1157%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 2.0334, Accuracy: 5395/10000 (53.9500%)
___Train Local_ResNet_18,  epoch  79, local model 18, internal_epoch   1,  Average loss: 0.0051, Accuracy: 3528/3911 (90.2071%)
___Train Local_ResNet_18,  epoch  79, local model 18, internal_epoch   2,  Average loss: 0.0067, Accuracy: 3420/3911 (87.4457%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 2.1640, Accuracy: 5279/10000 (52.7900%)
___Train Local_ResNet_18,  epoch  79, local model 93, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4097/4651 (88.0886%)
___Train Local_ResNet_18,  epoch  79, local model 93, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4197/4651 (90.2387%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 2.0850, Accuracy: 5327/10000 (53.2700%)
___Train Local_ResNet_18,  epoch  79, local model 23, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3696/4184 (88.3365%)
___Train Local_ResNet_18,  epoch  79, local model 23, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3783/4184 (90.4159%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.8164, Accuracy: 5692/10000 (56.9200%)
___Train Local_ResNet_18,  epoch  79, local model 29, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3913/4346 (90.0368%)
___Train Local_ResNet_18,  epoch  79, local model 29, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4009/4346 (92.2457%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.9578, Accuracy: 5554/10000 (55.5400%)
___Train Local_ResNet_18,  epoch  79, local model 84, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4153/4793 (86.6472%)
___Train Local_ResNet_18,  epoch  79, local model 84, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4357/4793 (90.9034%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.9892, Accuracy: 5414/10000 (54.1400%)
___Train Local_ResNet_18,  epoch  79, local model 60, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3357/3804 (88.2492%)
___Train Local_ResNet_18,  epoch  79, local model 60, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3473/3804 (91.2986%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 2.0501, Accuracy: 5429/10000 (54.2900%)
___Train Local_ResNet_18,  epoch  79, local model 1, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4454/4986 (89.3301%)
___Train Local_ResNet_18,  epoch  79, local model 1, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4510/4986 (90.4533%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.9144, Accuracy: 5612/10000 (56.1200%)
___Train Local_ResNet_18,  epoch  79, local model 53, internal_epoch   1,  Average loss: 0.0057, Accuracy: 5479/6124 (89.4677%)
___Train Local_ResNet_18,  epoch  79, local model 53, internal_epoch   2,  Average loss: 0.0060, Accuracy: 5396/6124 (88.1123%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.9821, Accuracy: 5355/10000 (53.5500%)
___Train Local_ResNet_18,  epoch  79, local model 47, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4153/4707 (88.2303%)
___Train Local_ResNet_18,  epoch  79, local model 47, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4264/4707 (90.5885%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.9477, Accuracy: 5494/10000 (54.9400%)
___Train Local_ResNet_18,  epoch  79, local model 73, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3769/4235 (88.9965%)
___Train Local_ResNet_18,  epoch  79, local model 73, internal_epoch   2,  Average loss: 0.0071, Accuracy: 3666/4235 (86.5643%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 2.1547, Accuracy: 5278/10000 (52.7800%)
___Train Local_ResNet_18,  epoch  79, local model 59, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3625/4046 (89.5947%)
___Train Local_ResNet_18,  epoch  79, local model 59, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3723/4046 (92.0168%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.9206, Accuracy: 5551/10000 (55.5100%)
time spent on training: 261.31363010406494
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.3213, Accuracy: 6680/10000 (66.8000%)
___Test Target_ResNet_18 poisoned: True, epoch: 79: Average loss: 9.7006, Accuracy: 64/9900 (0.6465%)
Done in 291.4237563610077 sec.
Server Epoch:80 choose agents : [13, 36, 58, 71, 1, 21, 28, 53, 3, 52, 15, 46, 33, 37, 16, 18, 7, 49, 40, 97].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  80, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4407/4885 (90.2149%), train_poison_data_count: 385
Global model norm: 42.76157298350281.
Norm before scaling: 42.76487856719796. Distance: 2.1347771283927828
Total norm for 4 adversaries is: 42.76487856719796. distance: 2.1347771283927828
___Test Local_ResNet_18 poisoned: True, epoch: 80: Average loss: 0.1310, Accuracy: 9553/9900 (96.4949%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  80, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4751/5305 (89.5570%), train_poison_data_count: 415
Global model norm: 42.76157298350281.
Norm before scaling: 42.76403221367081. Distance: 2.18555996561093
Total norm for 4 adversaries is: 42.76403221367081. distance: 2.18555996561093
___Test Local_ResNet_18 poisoned: True, epoch: 80: Average loss: 0.0870, Accuracy: 9691/9900 (97.8889%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  80, local model 58, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4240/4717 (89.8876%), train_poison_data_count: 370
Global model norm: 42.76157298350281.
Norm before scaling: 42.75978021120943. Distance: 2.0274767528852187
Total norm for 4 adversaries is: 42.75978021120943. distance: 2.0274767528852187
___Test Local_ResNet_18 poisoned: True, epoch: 80: Average loss: 0.3610, Accuracy: 9075/9900 (91.6667%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  80, local model 71, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4473/5066 (88.2945%), train_poison_data_count: 400
Global model norm: 42.76157298350281.
Norm before scaling: 42.76914861488579. Distance: 2.2881968036254183
Total norm for 4 adversaries is: 42.76914861488579. distance: 2.2881968036254183
___Test Local_ResNet_18 poisoned: True, epoch: 80: Average loss: 0.2762, Accuracy: 9187/9900 (92.7980%)
___Train Local_ResNet_18,  epoch  80, local model 1, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4388/4986 (88.0064%)
___Train Local_ResNet_18,  epoch  80, local model 1, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4485/4986 (89.9519%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 1.9567, Accuracy: 5560/10000 (55.6000%)
___Train Local_ResNet_18,  epoch  80, local model 21, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4053/4634 (87.4622%)
___Train Local_ResNet_18,  epoch  80, local model 21, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4173/4634 (90.0518%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 1.9198, Accuracy: 5609/10000 (56.0900%)
___Train Local_ResNet_18,  epoch  80, local model 28, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4123/4716 (87.4258%)
___Train Local_ResNet_18,  epoch  80, local model 28, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4229/4716 (89.6735%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 1.9908, Accuracy: 5474/10000 (54.7400%)
___Train Local_ResNet_18,  epoch  80, local model 53, internal_epoch   1,  Average loss: 0.0059, Accuracy: 5434/6124 (88.7329%)
___Train Local_ResNet_18,  epoch  80, local model 53, internal_epoch   2,  Average loss: 0.0054, Accuracy: 5474/6124 (89.3860%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.1700, Accuracy: 5225/10000 (52.2500%)
___Train Local_ResNet_18,  epoch  80, local model 3, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4336/4918 (88.1659%)
___Train Local_ResNet_18,  epoch  80, local model 3, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4467/4918 (90.8296%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.0439, Accuracy: 5457/10000 (54.5700%)
___Train Local_ResNet_18,  epoch  80, local model 52, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3321/3797 (87.4638%)
___Train Local_ResNet_18,  epoch  80, local model 52, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3415/3797 (89.9394%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.0202, Accuracy: 5392/10000 (53.9200%)
___Train Local_ResNet_18,  epoch  80, local model 15, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4959/5582 (88.8391%)
___Train Local_ResNet_18,  epoch  80, local model 15, internal_epoch   2,  Average loss: 0.0052, Accuracy: 5047/5582 (90.4156%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.1073, Accuracy: 5285/10000 (52.8500%)
___Train Local_ResNet_18,  epoch  80, local model 46, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4282/4956 (86.4003%)
___Train Local_ResNet_18,  epoch  80, local model 46, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4360/4956 (87.9742%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.0518, Accuracy: 5317/10000 (53.1700%)
___Train Local_ResNet_18,  epoch  80, local model 33, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3931/4433 (88.6758%)
___Train Local_ResNet_18,  epoch  80, local model 33, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4009/4433 (90.4354%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.0063, Accuracy: 5508/10000 (55.0800%)
___Train Local_ResNet_18,  epoch  80, local model 37, internal_epoch   1,  Average loss: 0.0071, Accuracy: 3834/4354 (88.0570%)
___Train Local_ResNet_18,  epoch  80, local model 37, internal_epoch   2,  Average loss: 0.0110, Accuracy: 3426/4354 (78.6863%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.4760, Accuracy: 4676/10000 (46.7600%)
___Train Local_ResNet_18,  epoch  80, local model 16, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4288/4928 (87.0130%)
___Train Local_ResNet_18,  epoch  80, local model 16, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4389/4928 (89.0625%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 1.9968, Accuracy: 5446/10000 (54.4600%)
___Train Local_ResNet_18,  epoch  80, local model 18, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3537/3911 (90.4372%)
___Train Local_ResNet_18,  epoch  80, local model 18, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3548/3911 (90.7185%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 1.8858, Accuracy: 5652/10000 (56.5200%)
___Train Local_ResNet_18,  epoch  80, local model 7, internal_epoch   1,  Average loss: 0.0075, Accuracy: 3912/4481 (87.3019%)
___Train Local_ResNet_18,  epoch  80, local model 7, internal_epoch   2,  Average loss: 0.0078, Accuracy: 3873/4481 (86.4316%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.0432, Accuracy: 5387/10000 (53.8700%)
___Train Local_ResNet_18,  epoch  80, local model 49, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4560/5197 (87.7429%)
___Train Local_ResNet_18,  epoch  80, local model 49, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4603/5197 (88.5703%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 1.9595, Accuracy: 5420/10000 (54.2000%)
___Train Local_ResNet_18,  epoch  80, local model 40, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4816/5455 (88.2860%)
___Train Local_ResNet_18,  epoch  80, local model 40, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4885/5455 (89.5509%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.0489, Accuracy: 5278/10000 (52.7800%)
___Train Local_ResNet_18,  epoch  80, local model 97, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3797/4361 (87.0672%)
___Train Local_ResNet_18,  epoch  80, local model 97, internal_epoch   2,  Average loss: 0.0071, Accuracy: 3763/4361 (86.2875%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.1649, Accuracy: 5151/10000 (51.5100%)
time spent on training: 271.5636818408966
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 80: Average loss: 1.3588, Accuracy: 6626/10000 (66.2600%)
___Test Target_ResNet_18 poisoned: True, epoch: 80: Average loss: 9.9394, Accuracy: 63/9900 (0.6364%)
Done in 302.33588552474976 sec.
Server Epoch:81 choose agents : [13, 36, 58, 71, 19, 23, 47, 98, 64, 44, 73, 11, 84, 7, 29, 97, 65, 54, 20, 10].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  81, local model 13, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4379/4885 (89.6418%), train_poison_data_count: 385
Global model norm: 42.80618823227037.
Norm before scaling: 42.809510331288394. Distance: 2.13968331444789
Total norm for 4 adversaries is: 42.809510331288394. distance: 2.13968331444789
___Test Local_ResNet_18 poisoned: True, epoch: 81: Average loss: 0.1932, Accuracy: 9447/9900 (95.4242%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  81, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4762/5305 (89.7644%), train_poison_data_count: 415
Global model norm: 42.80618823227037.
Norm before scaling: 42.80495628109627. Distance: 2.1693192408283135
Total norm for 4 adversaries is: 42.80495628109627. distance: 2.1693192408283135
___Test Local_ResNet_18 poisoned: True, epoch: 81: Average loss: 0.2534, Accuracy: 9255/9900 (93.4848%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  81, local model 58, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4198/4717 (88.9972%), train_poison_data_count: 370
Global model norm: 42.80618823227037.
Norm before scaling: 42.80516731228617. Distance: 2.0798907128380217
Total norm for 4 adversaries is: 42.80516731228617. distance: 2.0798907128380217
___Test Local_ResNet_18 poisoned: True, epoch: 81: Average loss: 0.1378, Accuracy: 9529/9900 (96.2525%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  81, local model 71, internal_epoch   1,  Average loss: 0.0073, Accuracy: 4460/5066 (88.0379%), train_poison_data_count: 400
Global model norm: 42.80618823227037.
Norm before scaling: 42.811784323397745. Distance: 2.300352824142321
Total norm for 4 adversaries is: 42.811784323397745. distance: 2.300352824142321
___Test Local_ResNet_18 poisoned: True, epoch: 81: Average loss: 0.1929, Accuracy: 9414/9900 (95.0909%)
___Train Local_ResNet_18,  epoch  81, local model 19, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4228/4928 (85.7955%)
___Train Local_ResNet_18,  epoch  81, local model 19, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4368/4928 (88.6364%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 2.1110, Accuracy: 5265/10000 (52.6500%)
___Train Local_ResNet_18,  epoch  81, local model 23, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3708/4184 (88.6233%)
___Train Local_ResNet_18,  epoch  81, local model 23, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3755/4184 (89.7467%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.9240, Accuracy: 5502/10000 (55.0200%)
___Train Local_ResNet_18,  epoch  81, local model 47, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4183/4707 (88.8676%)
___Train Local_ResNet_18,  epoch  81, local model 47, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4243/4707 (90.1423%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 2.0739, Accuracy: 5356/10000 (53.5600%)
___Train Local_ResNet_18,  epoch  81, local model 98, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3359/3828 (87.7482%)
___Train Local_ResNet_18,  epoch  81, local model 98, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3520/3828 (91.9540%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.8743, Accuracy: 5607/10000 (56.0700%)
___Train Local_ResNet_18,  epoch  81, local model 64, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3921/4503 (87.0753%)
___Train Local_ResNet_18,  epoch  81, local model 64, internal_epoch   2,  Average loss: 0.0057, Accuracy: 3996/4503 (88.7408%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 2.0673, Accuracy: 5320/10000 (53.2000%)
___Train Local_ResNet_18,  epoch  81, local model 44, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4099/4662 (87.9236%)
___Train Local_ResNet_18,  epoch  81, local model 44, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4225/4662 (90.6263%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.9583, Accuracy: 5516/10000 (55.1600%)
___Train Local_ResNet_18,  epoch  81, local model 73, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3680/4235 (86.8949%)
___Train Local_ResNet_18,  epoch  81, local model 73, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3783/4235 (89.3270%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.9343, Accuracy: 5579/10000 (55.7900%)
___Train Local_ResNet_18,  epoch  81, local model 11, internal_epoch   1,  Average loss: 0.0080, Accuracy: 4411/5244 (84.1152%)
___Train Local_ResNet_18,  epoch  81, local model 11, internal_epoch   2,  Average loss: 0.0070, Accuracy: 4513/5244 (86.0603%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 2.0284, Accuracy: 5302/10000 (53.0200%)
___Train Local_ResNet_18,  epoch  81, local model 84, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4187/4793 (87.3566%)
___Train Local_ResNet_18,  epoch  81, local model 84, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4313/4793 (89.9854%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 2.0299, Accuracy: 5393/10000 (53.9300%)
___Train Local_ResNet_18,  epoch  81, local model 7, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3973/4481 (88.6632%)
___Train Local_ResNet_18,  epoch  81, local model 7, internal_epoch   2,  Average loss: 0.0068, Accuracy: 3962/4481 (88.4178%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 2.0926, Accuracy: 5311/10000 (53.1100%)
___Train Local_ResNet_18,  epoch  81, local model 29, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3889/4346 (89.4846%)
___Train Local_ResNet_18,  epoch  81, local model 29, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4022/4346 (92.5449%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.6975, Accuracy: 5872/10000 (58.7200%)
___Train Local_ResNet_18,  epoch  81, local model 97, internal_epoch   1,  Average loss: 0.0071, Accuracy: 3791/4361 (86.9296%)
___Train Local_ResNet_18,  epoch  81, local model 97, internal_epoch   2,  Average loss: 0.0076, Accuracy: 3733/4361 (85.5996%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 2.2283, Accuracy: 5060/10000 (50.6000%)
___Train Local_ResNet_18,  epoch  81, local model 65, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4486/5055 (88.7438%)
___Train Local_ResNet_18,  epoch  81, local model 65, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4535/5055 (89.7132%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.9692, Accuracy: 5477/10000 (54.7700%)
___Train Local_ResNet_18,  epoch  81, local model 54, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4500/5195 (86.6218%)
___Train Local_ResNet_18,  epoch  81, local model 54, internal_epoch   2,  Average loss: 0.0071, Accuracy: 4488/5195 (86.3908%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 2.0546, Accuracy: 5311/10000 (53.1100%)
___Train Local_ResNet_18,  epoch  81, local model 20, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3872/4315 (89.7335%)
___Train Local_ResNet_18,  epoch  81, local model 20, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3983/4315 (92.3059%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.8743, Accuracy: 5672/10000 (56.7200%)
___Train Local_ResNet_18,  epoch  81, local model 10, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4160/4663 (89.2130%)
___Train Local_ResNet_18,  epoch  81, local model 10, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4293/4663 (92.0652%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 2.0684, Accuracy: 5419/10000 (54.1900%)
time spent on training: 264.9252059459686
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.3719, Accuracy: 6548/10000 (65.4800%)
___Test Target_ResNet_18 poisoned: True, epoch: 81: Average loss: 9.7276, Accuracy: 72/9900 (0.7273%)
Done in 295.3085687160492 sec.
Server Epoch:82 choose agents : [13, 36, 58, 71, 20, 63, 96, 35, 51, 98, 73, 77, 3, 33, 7, 75, 64, 37, 1, 92].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  82, local model 13, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4411/4885 (90.2968%), train_poison_data_count: 385
Global model norm: 42.839854969737296.
Norm before scaling: 42.840319428664394. Distance: 2.0817725502168054
Total norm for 4 adversaries is: 42.840319428664394. distance: 2.0817725502168054
___Test Local_ResNet_18 poisoned: True, epoch: 82: Average loss: 0.1887, Accuracy: 9438/9900 (95.3333%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  82, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4746/5305 (89.4628%), train_poison_data_count: 415
Global model norm: 42.839854969737296.
Norm before scaling: 42.84218006332223. Distance: 2.2009949905012665
Total norm for 4 adversaries is: 42.84218006332223. distance: 2.2009949905012665
___Test Local_ResNet_18 poisoned: True, epoch: 82: Average loss: 0.3285, Accuracy: 9124/9900 (92.1616%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  82, local model 58, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4231/4717 (89.6968%), train_poison_data_count: 370
Global model norm: 42.839854969737296.
Norm before scaling: 42.83761238860366. Distance: 2.008421453017437
Total norm for 4 adversaries is: 42.83761238860366. distance: 2.008421453017437
___Test Local_ResNet_18 poisoned: True, epoch: 82: Average loss: 0.1660, Accuracy: 9492/9900 (95.8788%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  82, local model 71, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4480/5066 (88.4327%), train_poison_data_count: 400
Global model norm: 42.839854969737296.
Norm before scaling: 42.84577430711881. Distance: 2.255866244747386
Total norm for 4 adversaries is: 42.84577430711881. distance: 2.255866244747386
___Test Local_ResNet_18 poisoned: True, epoch: 82: Average loss: 0.1524, Accuracy: 9497/9900 (95.9293%)
___Train Local_ResNet_18,  epoch  82, local model 20, internal_epoch   1,  Average loss: 0.0052, Accuracy: 3896/4315 (90.2897%)
___Train Local_ResNet_18,  epoch  82, local model 20, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3954/4315 (91.6338%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.8963, Accuracy: 5595/10000 (55.9500%)
___Train Local_ResNet_18,  epoch  82, local model 63, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3189/3590 (88.8301%)
___Train Local_ResNet_18,  epoch  82, local model 63, internal_epoch   2,  Average loss: 0.0065, Accuracy: 3159/3590 (87.9944%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 2.1489, Accuracy: 5308/10000 (53.0800%)
___Train Local_ResNet_18,  epoch  82, local model 96, internal_epoch   1,  Average loss: 0.0050, Accuracy: 4234/4679 (90.4894%)
___Train Local_ResNet_18,  epoch  82, local model 96, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4337/4679 (92.6907%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.8653, Accuracy: 5661/10000 (56.6100%)
___Train Local_ResNet_18,  epoch  82, local model 35, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4526/5167 (87.5943%)
___Train Local_ResNet_18,  epoch  82, local model 35, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4647/5167 (89.9361%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 2.0808, Accuracy: 5301/10000 (53.0100%)
___Train Local_ResNet_18,  epoch  82, local model 51, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3360/3775 (89.0066%)
___Train Local_ResNet_18,  epoch  82, local model 51, internal_epoch   2,  Average loss: 0.0034, Accuracy: 3529/3775 (93.4834%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.7758, Accuracy: 5832/10000 (58.3200%)
___Train Local_ResNet_18,  epoch  82, local model 98, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3356/3828 (87.6698%)
___Train Local_ResNet_18,  epoch  82, local model 98, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3484/3828 (91.0136%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.9418, Accuracy: 5506/10000 (55.0600%)
___Train Local_ResNet_18,  epoch  82, local model 73, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3739/4235 (88.2881%)
___Train Local_ResNet_18,  epoch  82, local model 73, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3851/4235 (90.9327%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.9056, Accuracy: 5617/10000 (56.1700%)
___Train Local_ResNet_18,  epoch  82, local model 77, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4058/4647 (87.3252%)
___Train Local_ResNet_18,  epoch  82, local model 77, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4191/4647 (90.1872%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.9155, Accuracy: 5558/10000 (55.5800%)
___Train Local_ResNet_18,  epoch  82, local model 3, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4305/4918 (87.5356%)
___Train Local_ResNet_18,  epoch  82, local model 3, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4414/4918 (89.7519%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 2.1130, Accuracy: 5122/10000 (51.2200%)
___Train Local_ResNet_18,  epoch  82, local model 33, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3944/4433 (88.9691%)
___Train Local_ResNet_18,  epoch  82, local model 33, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4002/4433 (90.2775%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.9771, Accuracy: 5546/10000 (55.4600%)
___Train Local_ResNet_18,  epoch  82, local model 7, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3952/4481 (88.1946%)
___Train Local_ResNet_18,  epoch  82, local model 7, internal_epoch   2,  Average loss: 0.0067, Accuracy: 4005/4481 (89.3774%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.9570, Accuracy: 5548/10000 (55.4800%)
___Train Local_ResNet_18,  epoch  82, local model 75, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3740/4295 (87.0780%)
___Train Local_ResNet_18,  epoch  82, local model 75, internal_epoch   2,  Average loss: 0.0080, Accuracy: 3624/4295 (84.3772%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 2.1718, Accuracy: 5139/10000 (51.3900%)
___Train Local_ResNet_18,  epoch  82, local model 64, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3983/4503 (88.4521%)
___Train Local_ResNet_18,  epoch  82, local model 64, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4036/4503 (89.6291%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.9731, Accuracy: 5484/10000 (54.8400%)
___Train Local_ResNet_18,  epoch  82, local model 37, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3887/4354 (89.2742%)
___Train Local_ResNet_18,  epoch  82, local model 37, internal_epoch   2,  Average loss: 0.0060, Accuracy: 3857/4354 (88.5852%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 2.3131, Accuracy: 5057/10000 (50.5700%)
___Train Local_ResNet_18,  epoch  82, local model 1, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4415/4986 (88.5479%)
___Train Local_ResNet_18,  epoch  82, local model 1, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4466/4986 (89.5708%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.9633, Accuracy: 5537/10000 (55.3700%)
___Train Local_ResNet_18,  epoch  82, local model 92, internal_epoch   1,  Average loss: 0.0059, Accuracy: 5547/6263 (88.5678%)
___Train Local_ResNet_18,  epoch  82, local model 92, internal_epoch   2,  Average loss: 0.0046, Accuracy: 5694/6263 (90.9149%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 2.0665, Accuracy: 5376/10000 (53.7600%)
time spent on training: 266.3328492641449
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.3508, Accuracy: 6607/10000 (66.0700%)
___Test Target_ResNet_18 poisoned: True, epoch: 82: Average loss: 9.6182, Accuracy: 82/9900 (0.8283%)
Done in 297.1478328704834 sec.
Server Epoch:83 choose agents : [13, 36, 58, 71, 27, 40, 15, 99, 32, 18, 55, 45, 96, 90, 34, 12, 69, 49, 68, 48].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  83, local model 13, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4376/4885 (89.5803%), train_poison_data_count: 385
Global model norm: 42.87624844437842.
Norm before scaling: 42.87675521416368. Distance: 2.1274502035873595
Total norm for 4 adversaries is: 42.87675521416368. distance: 2.1274502035873595
___Test Local_ResNet_18 poisoned: True, epoch: 83: Average loss: 0.1886, Accuracy: 9443/9900 (95.3838%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  83, local model 36, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4702/5305 (88.6334%), train_poison_data_count: 415
Global model norm: 42.87624844437842.
Norm before scaling: 42.880068999277654. Distance: 2.3053405870875445
Total norm for 4 adversaries is: 42.880068999277654. distance: 2.3053405870875445
___Test Local_ResNet_18 poisoned: True, epoch: 83: Average loss: 0.0609, Accuracy: 9742/9900 (98.4040%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  83, local model 58, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4240/4717 (89.8876%), train_poison_data_count: 370
Global model norm: 42.87624844437842.
Norm before scaling: 42.876147374407076. Distance: 2.0364543267590327
Total norm for 4 adversaries is: 42.876147374407076. distance: 2.0364543267590327
___Test Local_ResNet_18 poisoned: True, epoch: 83: Average loss: 0.1517, Accuracy: 9510/9900 (96.0606%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  83, local model 71, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4482/5066 (88.4722%), train_poison_data_count: 400
Global model norm: 42.87624844437842.
Norm before scaling: 42.87916940596346. Distance: 2.2281687514194806
Total norm for 4 adversaries is: 42.87916940596346. distance: 2.2281687514194806
___Test Local_ResNet_18 poisoned: True, epoch: 83: Average loss: 0.1008, Accuracy: 9638/9900 (97.3535%)
___Train Local_ResNet_18,  epoch  83, local model 27, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3709/4223 (87.8286%)
___Train Local_ResNet_18,  epoch  83, local model 27, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3854/4223 (91.2621%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 2.0287, Accuracy: 5355/10000 (53.5500%)
___Train Local_ResNet_18,  epoch  83, local model 40, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4818/5455 (88.3226%)
___Train Local_ResNet_18,  epoch  83, local model 40, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4849/5455 (88.8909%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.9617, Accuracy: 5468/10000 (54.6800%)
___Train Local_ResNet_18,  epoch  83, local model 15, internal_epoch   1,  Average loss: 0.0054, Accuracy: 5026/5582 (90.0394%)
___Train Local_ResNet_18,  epoch  83, local model 15, internal_epoch   2,  Average loss: 0.0044, Accuracy: 5109/5582 (91.5263%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 2.0530, Accuracy: 5354/10000 (53.5400%)
___Train Local_ResNet_18,  epoch  83, local model 99, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3964/4465 (88.7794%)
___Train Local_ResNet_18,  epoch  83, local model 99, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4053/4465 (90.7727%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.8147, Accuracy: 5782/10000 (57.8200%)
___Train Local_ResNet_18,  epoch  83, local model 32, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4908/5591 (87.7839%)
___Train Local_ResNet_18,  epoch  83, local model 32, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4964/5591 (88.7855%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 2.1647, Accuracy: 5185/10000 (51.8500%)
___Train Local_ResNet_18,  epoch  83, local model 18, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3525/3911 (90.1304%)
___Train Local_ResNet_18,  epoch  83, local model 18, internal_epoch   2,  Average loss: 0.0067, Accuracy: 3414/3911 (87.2923%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.9750, Accuracy: 5514/10000 (55.1400%)
___Train Local_ResNet_18,  epoch  83, local model 55, internal_epoch   1,  Average loss: 0.0046, Accuracy: 4013/4356 (92.1258%)
___Train Local_ResNet_18,  epoch  83, local model 55, internal_epoch   2,  Average loss: 0.0138, Accuracy: 3319/4356 (76.1938%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 2.6271, Accuracy: 4557/10000 (45.5700%)
___Train Local_ResNet_18,  epoch  83, local model 45, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4422/5037 (87.7904%)
___Train Local_ResNet_18,  epoch  83, local model 45, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4539/5037 (90.1132%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.9092, Accuracy: 5479/10000 (54.7900%)
___Train Local_ResNet_18,  epoch  83, local model 96, internal_epoch   1,  Average loss: 0.0048, Accuracy: 4243/4679 (90.6818%)
___Train Local_ResNet_18,  epoch  83, local model 96, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4340/4679 (92.7549%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.9418, Accuracy: 5537/10000 (55.3700%)
___Train Local_ResNet_18,  epoch  83, local model 90, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3935/4362 (90.2109%)
___Train Local_ResNet_18,  epoch  83, local model 90, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3946/4362 (90.4631%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 2.0471, Accuracy: 5365/10000 (53.6500%)
___Train Local_ResNet_18,  epoch  83, local model 34, internal_epoch   1,  Average loss: 0.0050, Accuracy: 4079/4518 (90.2833%)
___Train Local_ResNet_18,  epoch  83, local model 34, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4149/4518 (91.8327%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.9736, Accuracy: 5392/10000 (53.9200%)
___Train Local_ResNet_18,  epoch  83, local model 12, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4500/5083 (88.5304%)
___Train Local_ResNet_18,  epoch  83, local model 12, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4490/5083 (88.3337%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 2.2017, Accuracy: 5089/10000 (50.8900%)
___Train Local_ResNet_18,  epoch  83, local model 69, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3573/4013 (89.0356%)
___Train Local_ResNet_18,  epoch  83, local model 69, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3719/4013 (92.6738%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.8170, Accuracy: 5729/10000 (57.2900%)
___Train Local_ResNet_18,  epoch  83, local model 49, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4541/5197 (87.3773%)
___Train Local_ResNet_18,  epoch  83, local model 49, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4619/5197 (88.8782%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.9469, Accuracy: 5443/10000 (54.4300%)
___Train Local_ResNet_18,  epoch  83, local model 68, internal_epoch   1,  Average loss: 0.0060, Accuracy: 2927/3297 (88.7777%)
___Train Local_ResNet_18,  epoch  83, local model 68, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3047/3297 (92.4173%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.8050, Accuracy: 5706/10000 (57.0600%)
___Train Local_ResNet_18,  epoch  83, local model 48, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3978/4441 (89.5744%)
___Train Local_ResNet_18,  epoch  83, local model 48, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4026/4441 (90.6553%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 2.1462, Accuracy: 5357/10000 (53.5700%)
time spent on training: 268.8413281440735
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.4250, Accuracy: 6523/10000 (65.2300%)
___Test Target_ResNet_18 poisoned: True, epoch: 83: Average loss: 9.9262, Accuracy: 74/9900 (0.7475%)
Done in 299.5128309726715 sec.
Server Epoch:84 choose agents : [13, 36, 58, 71, 8, 17, 37, 29, 47, 32, 77, 6, 88, 94, 92, 7, 62, 27, 48, 26].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  84, local model 13, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4364/4885 (89.3347%), train_poison_data_count: 385
Global model norm: 42.92049421013448.
Norm before scaling: 42.9207885738004. Distance: 2.1172956037899207
Total norm for 4 adversaries is: 42.9207885738004. distance: 2.1172956037899207
___Test Local_ResNet_18 poisoned: True, epoch: 84: Average loss: 0.2188, Accuracy: 9381/9900 (94.7576%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  84, local model 36, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4747/5305 (89.4816%), train_poison_data_count: 415
Global model norm: 42.92049421013448.
Norm before scaling: 42.919003874212734. Distance: 2.18593050646805
Total norm for 4 adversaries is: 42.919003874212734. distance: 2.18593050646805
___Test Local_ResNet_18 poisoned: True, epoch: 84: Average loss: 0.2405, Accuracy: 9318/9900 (94.1212%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  84, local model 58, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4224/4717 (89.5484%), train_poison_data_count: 370
Global model norm: 42.92049421013448.
Norm before scaling: 42.92017993558653. Distance: 2.0574726910360512
Total norm for 4 adversaries is: 42.92017993558653. distance: 2.0574726910360512
___Test Local_ResNet_18 poisoned: True, epoch: 84: Average loss: 0.3591, Accuracy: 9008/9900 (90.9899%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  84, local model 71, internal_epoch   1,  Average loss: 0.0076, Accuracy: 4434/5066 (87.5247%), train_poison_data_count: 400
Global model norm: 42.92049421013448.
Norm before scaling: 42.92500329881321. Distance: 2.2870433872779388
Total norm for 4 adversaries is: 42.92500329881321. distance: 2.2870433872779388
___Test Local_ResNet_18 poisoned: True, epoch: 84: Average loss: 0.2865, Accuracy: 9156/9900 (92.4848%)
___Train Local_ResNet_18,  epoch  84, local model 8, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3934/4501 (87.4028%)
___Train Local_ResNet_18,  epoch  84, local model 8, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4038/4501 (89.7134%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 2.0247, Accuracy: 5480/10000 (54.8000%)
___Train Local_ResNet_18,  epoch  84, local model 17, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3928/4511 (87.0760%)
___Train Local_ResNet_18,  epoch  84, local model 17, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4084/4511 (90.5342%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.9654, Accuracy: 5438/10000 (54.3800%)
___Train Local_ResNet_18,  epoch  84, local model 37, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3912/4354 (89.8484%)
___Train Local_ResNet_18,  epoch  84, local model 37, internal_epoch   2,  Average loss: 0.0090, Accuracy: 3611/4354 (82.9352%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 2.4873, Accuracy: 4659/10000 (46.5900%)
___Train Local_ResNet_18,  epoch  84, local model 29, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3881/4346 (89.3005%)
___Train Local_ResNet_18,  epoch  84, local model 29, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4038/4346 (92.9130%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.9191, Accuracy: 5514/10000 (55.1400%)
___Train Local_ResNet_18,  epoch  84, local model 47, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4153/4707 (88.2303%)
___Train Local_ResNet_18,  epoch  84, local model 47, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4278/4707 (90.8859%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.8733, Accuracy: 5639/10000 (56.3900%)
___Train Local_ResNet_18,  epoch  84, local model 32, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4895/5591 (87.5514%)
___Train Local_ResNet_18,  epoch  84, local model 32, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4939/5591 (88.3384%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 2.0833, Accuracy: 5222/10000 (52.2200%)
___Train Local_ResNet_18,  epoch  84, local model 77, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4065/4647 (87.4758%)
___Train Local_ResNet_18,  epoch  84, local model 77, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4214/4647 (90.6822%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.8961, Accuracy: 5551/10000 (55.5100%)
___Train Local_ResNet_18,  epoch  84, local model 6, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4027/4538 (88.7395%)
___Train Local_ResNet_18,  epoch  84, local model 6, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4202/4538 (92.5959%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.9264, Accuracy: 5611/10000 (56.1100%)
___Train Local_ResNet_18,  epoch  84, local model 88, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4280/4934 (86.7450%)
___Train Local_ResNet_18,  epoch  84, local model 88, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4391/4934 (88.9947%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 2.0358, Accuracy: 5323/10000 (53.2300%)
___Train Local_ResNet_18,  epoch  84, local model 94, internal_epoch   1,  Average loss: 0.0050, Accuracy: 4329/4804 (90.1124%)
___Train Local_ResNet_18,  epoch  84, local model 94, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4304/4804 (89.5920%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 2.2782, Accuracy: 5241/10000 (52.4100%)
___Train Local_ResNet_18,  epoch  84, local model 92, internal_epoch   1,  Average loss: 0.0057, Accuracy: 5571/6263 (88.9510%)
___Train Local_ResNet_18,  epoch  84, local model 92, internal_epoch   2,  Average loss: 0.0049, Accuracy: 5663/6263 (90.4199%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 2.0175, Accuracy: 5406/10000 (54.0600%)
___Train Local_ResNet_18,  epoch  84, local model 7, internal_epoch   1,  Average loss: 0.0074, Accuracy: 3958/4481 (88.3285%)
___Train Local_ResNet_18,  epoch  84, local model 7, internal_epoch   2,  Average loss: 0.0065, Accuracy: 4007/4481 (89.4220%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 2.0610, Accuracy: 5455/10000 (54.5500%)
___Train Local_ResNet_18,  epoch  84, local model 62, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4365/5063 (86.2137%)
___Train Local_ResNet_18,  epoch  84, local model 62, internal_epoch   2,  Average loss: 0.0062, Accuracy: 4460/5063 (88.0901%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.9572, Accuracy: 5464/10000 (54.6400%)
___Train Local_ResNet_18,  epoch  84, local model 27, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3692/4223 (87.4260%)
___Train Local_ResNet_18,  epoch  84, local model 27, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3871/4223 (91.6647%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.9391, Accuracy: 5511/10000 (55.1100%)
___Train Local_ResNet_18,  epoch  84, local model 48, internal_epoch   1,  Average loss: 0.0052, Accuracy: 3992/4441 (89.8897%)
___Train Local_ResNet_18,  epoch  84, local model 48, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4122/4441 (92.8169%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.9639, Accuracy: 5564/10000 (55.6400%)
___Train Local_ResNet_18,  epoch  84, local model 26, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3347/3756 (89.1108%)
___Train Local_ResNet_18,  epoch  84, local model 26, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3438/3756 (91.5335%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.8709, Accuracy: 5710/10000 (57.1000%)
time spent on training: 266.4406011104584
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.3758, Accuracy: 6592/10000 (65.9200%)
___Test Target_ResNet_18 poisoned: True, epoch: 84: Average loss: 10.3231, Accuracy: 53/9900 (0.5354%)
Done in 292.11469745635986 sec.
Server Epoch:85 choose agents : [13, 36, 58, 71, 11, 16, 60, 69, 91, 15, 40, 37, 33, 2, 34, 73, 90, 70, 32, 26].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  85, local model 13, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4389/4885 (89.8465%), train_poison_data_count: 385
Global model norm: 42.958826979209846.
Norm before scaling: 42.96123229690636. Distance: 2.1718109999633413
Total norm for 4 adversaries is: 42.96123229690636. distance: 2.1718109999633413
___Test Local_ResNet_18 poisoned: True, epoch: 85: Average loss: 0.1589, Accuracy: 9505/9900 (96.0101%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  85, local model 36, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4726/5305 (89.0858%), train_poison_data_count: 415
Global model norm: 42.958826979209846.
Norm before scaling: 42.9578437863615. Distance: 2.251730677129901
Total norm for 4 adversaries is: 42.9578437863615. distance: 2.251730677129901
___Test Local_ResNet_18 poisoned: True, epoch: 85: Average loss: 0.1134, Accuracy: 9609/9900 (97.0606%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  85, local model 58, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4200/4717 (89.0396%), train_poison_data_count: 370
Global model norm: 42.958826979209846.
Norm before scaling: 42.96024631763504. Distance: 2.0648339677247707
Total norm for 4 adversaries is: 42.96024631763504. distance: 2.0648339677247707
___Test Local_ResNet_18 poisoned: True, epoch: 85: Average loss: 0.2698, Accuracy: 9241/9900 (93.3434%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  85, local model 71, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4470/5066 (88.2353%), train_poison_data_count: 400
Global model norm: 42.958826979209846.
Norm before scaling: 42.964370515452245. Distance: 2.278460011489405
Total norm for 4 adversaries is: 42.964370515452245. distance: 2.278460011489405
___Test Local_ResNet_18 poisoned: True, epoch: 85: Average loss: 0.2672, Accuracy: 9195/9900 (92.8788%)
___Train Local_ResNet_18,  epoch  85, local model 11, internal_epoch   1,  Average loss: 0.0077, Accuracy: 4437/5244 (84.6110%)
___Train Local_ResNet_18,  epoch  85, local model 11, internal_epoch   2,  Average loss: 0.0062, Accuracy: 4577/5244 (87.2807%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.9621, Accuracy: 5483/10000 (54.8300%)
___Train Local_ResNet_18,  epoch  85, local model 16, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4290/4928 (87.0536%)
___Train Local_ResNet_18,  epoch  85, local model 16, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4457/4928 (90.4424%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.8719, Accuracy: 5666/10000 (56.6600%)
___Train Local_ResNet_18,  epoch  85, local model 60, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3390/3804 (89.1167%)
___Train Local_ResNet_18,  epoch  85, local model 60, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3446/3804 (90.5889%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.9615, Accuracy: 5541/10000 (55.4100%)
___Train Local_ResNet_18,  epoch  85, local model 69, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3567/4013 (88.8861%)
___Train Local_ResNet_18,  epoch  85, local model 69, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3653/4013 (91.0292%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.9114, Accuracy: 5559/10000 (55.5900%)
___Train Local_ResNet_18,  epoch  85, local model 91, internal_epoch   1,  Average loss: 0.0076, Accuracy: 3554/4158 (85.4738%)
___Train Local_ResNet_18,  epoch  85, local model 91, internal_epoch   2,  Average loss: 0.0066, Accuracy: 3629/4158 (87.2775%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.8809, Accuracy: 5536/10000 (55.3600%)
___Train Local_ResNet_18,  epoch  85, local model 15, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4986/5582 (89.3228%)
___Train Local_ResNet_18,  epoch  85, local model 15, internal_epoch   2,  Average loss: 0.0051, Accuracy: 5027/5582 (90.0573%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 2.0455, Accuracy: 5322/10000 (53.2200%)
___Train Local_ResNet_18,  epoch  85, local model 40, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4806/5455 (88.1027%)
___Train Local_ResNet_18,  epoch  85, local model 40, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4911/5455 (90.0275%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.9402, Accuracy: 5475/10000 (54.7500%)
___Train Local_ResNet_18,  epoch  85, local model 37, internal_epoch   1,  Average loss: 0.0051, Accuracy: 3991/4354 (91.6628%)
___Train Local_ResNet_18,  epoch  85, local model 37, internal_epoch   2,  Average loss: 0.0078, Accuracy: 3733/4354 (85.7373%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 2.4366, Accuracy: 4906/10000 (49.0600%)
___Train Local_ResNet_18,  epoch  85, local model 33, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3921/4433 (88.4503%)
___Train Local_ResNet_18,  epoch  85, local model 33, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4020/4433 (90.6835%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 2.0167, Accuracy: 5426/10000 (54.2600%)
___Train Local_ResNet_18,  epoch  85, local model 2, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3145/3646 (86.2589%)
___Train Local_ResNet_18,  epoch  85, local model 2, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3345/3646 (91.7444%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.9219, Accuracy: 5540/10000 (55.4000%)
___Train Local_ResNet_18,  epoch  85, local model 34, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4047/4518 (89.5750%)
___Train Local_ResNet_18,  epoch  85, local model 34, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4090/4518 (90.5268%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 2.0406, Accuracy: 5382/10000 (53.8200%)
___Train Local_ResNet_18,  epoch  85, local model 73, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3757/4235 (88.7131%)
___Train Local_ResNet_18,  epoch  85, local model 73, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3812/4235 (90.0118%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 2.1166, Accuracy: 5267/10000 (52.6700%)
___Train Local_ResNet_18,  epoch  85, local model 90, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3914/4362 (89.7295%)
___Train Local_ResNet_18,  epoch  85, local model 90, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3926/4362 (90.0046%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 2.1662, Accuracy: 5275/10000 (52.7500%)
___Train Local_ResNet_18,  epoch  85, local model 70, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4768/5392 (88.4273%)
___Train Local_ResNet_18,  epoch  85, local model 70, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4773/5392 (88.5200%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 2.0978, Accuracy: 5341/10000 (53.4100%)
___Train Local_ResNet_18,  epoch  85, local model 32, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4826/5591 (86.3173%)
___Train Local_ResNet_18,  epoch  85, local model 32, internal_epoch   2,  Average loss: 0.0064, Accuracy: 4863/5591 (86.9791%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 2.1320, Accuracy: 5083/10000 (50.8300%)
___Train Local_ResNet_18,  epoch  85, local model 26, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3326/3756 (88.5517%)
___Train Local_ResNet_18,  epoch  85, local model 26, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3436/3756 (91.4803%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 2.0066, Accuracy: 5557/10000 (55.5700%)
time spent on training: 237.57418203353882
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.4095, Accuracy: 6502/10000 (65.0200%)
___Test Target_ResNet_18 poisoned: True, epoch: 85: Average loss: 10.4599, Accuracy: 59/9900 (0.5960%)
Done in 263.5270082950592 sec.
Server Epoch:86 choose agents : [13, 36, 58, 71, 21, 64, 16, 60, 63, 77, 95, 55, 52, 66, 78, 30, 68, 74, 89, 76].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  86, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4387/4885 (89.8055%), train_poison_data_count: 385
Global model norm: 42.99308543833313.
Norm before scaling: 42.995273064133166. Distance: 2.105052786593363
Total norm for 4 adversaries is: 42.995273064133166. distance: 2.105052786593363
___Test Local_ResNet_18 poisoned: True, epoch: 86: Average loss: 0.2095, Accuracy: 9361/9900 (94.5556%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  86, local model 36, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4720/5305 (88.9727%), train_poison_data_count: 415
Global model norm: 42.99308543833313.
Norm before scaling: 42.99358373277924. Distance: 2.2583822303724217
Total norm for 4 adversaries is: 42.99358373277924. distance: 2.2583822303724217
___Test Local_ResNet_18 poisoned: True, epoch: 86: Average loss: 0.0434, Accuracy: 9773/9900 (98.7172%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  86, local model 58, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4178/4717 (88.5732%), train_poison_data_count: 370
Global model norm: 42.99308543833313.
Norm before scaling: 42.99560808330457. Distance: 2.112169124716927
Total norm for 4 adversaries is: 42.99560808330457. distance: 2.112169124716927
___Test Local_ResNet_18 poisoned: True, epoch: 86: Average loss: 0.1405, Accuracy: 9548/9900 (96.4444%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  86, local model 71, internal_epoch   1,  Average loss: 0.0073, Accuracy: 4440/5066 (87.6431%), train_poison_data_count: 400
Global model norm: 42.99308543833313.
Norm before scaling: 43.000410211070225. Distance: 2.3491116041659033
Total norm for 4 adversaries is: 43.000410211070225. distance: 2.3491116041659033
___Test Local_ResNet_18 poisoned: True, epoch: 86: Average loss: 0.1274, Accuracy: 9575/9900 (96.7172%)
___Train Local_ResNet_18,  epoch  86, local model 21, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4067/4634 (87.7644%)
___Train Local_ResNet_18,  epoch  86, local model 21, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4216/4634 (90.9797%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.9019, Accuracy: 5720/10000 (57.2000%)
___Train Local_ResNet_18,  epoch  86, local model 64, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3997/4503 (88.7630%)
___Train Local_ResNet_18,  epoch  86, local model 64, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4026/4503 (89.4071%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.9788, Accuracy: 5502/10000 (55.0200%)
___Train Local_ResNet_18,  epoch  86, local model 16, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4279/4928 (86.8304%)
___Train Local_ResNet_18,  epoch  86, local model 16, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4473/4928 (90.7670%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.7964, Accuracy: 5778/10000 (57.7800%)
___Train Local_ResNet_18,  epoch  86, local model 60, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3350/3804 (88.0652%)
___Train Local_ResNet_18,  epoch  86, local model 60, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3418/3804 (89.8528%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.9382, Accuracy: 5552/10000 (55.5200%)
___Train Local_ResNet_18,  epoch  86, local model 63, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3201/3590 (89.1643%)
___Train Local_ResNet_18,  epoch  86, local model 63, internal_epoch   2,  Average loss: 0.0075, Accuracy: 3092/3590 (86.1281%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 2.1906, Accuracy: 5139/10000 (51.3900%)
___Train Local_ResNet_18,  epoch  86, local model 77, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4071/4647 (87.6049%)
___Train Local_ResNet_18,  epoch  86, local model 77, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4253/4647 (91.5214%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.9185, Accuracy: 5581/10000 (55.8100%)
___Train Local_ResNet_18,  epoch  86, local model 95, internal_epoch   1,  Average loss: 0.0075, Accuracy: 3961/4625 (85.6432%)
___Train Local_ResNet_18,  epoch  86, local model 95, internal_epoch   2,  Average loss: 0.0063, Accuracy: 4059/4625 (87.7622%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 2.0680, Accuracy: 5395/10000 (53.9500%)
___Train Local_ResNet_18,  epoch  86, local model 55, internal_epoch   1,  Average loss: 0.0036, Accuracy: 4080/4356 (93.6639%)
___Train Local_ResNet_18,  epoch  86, local model 55, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4004/4356 (91.9192%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.9657, Accuracy: 5557/10000 (55.5700%)
___Train Local_ResNet_18,  epoch  86, local model 52, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3343/3797 (88.0432%)
___Train Local_ResNet_18,  epoch  86, local model 52, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3448/3797 (90.8085%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.8906, Accuracy: 5668/10000 (56.6800%)
___Train Local_ResNet_18,  epoch  86, local model 66, internal_epoch   1,  Average loss: 0.0053, Accuracy: 4023/4456 (90.2828%)
___Train Local_ResNet_18,  epoch  86, local model 66, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4088/4456 (91.7415%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.8709, Accuracy: 5680/10000 (56.8000%)
___Train Local_ResNet_18,  epoch  86, local model 78, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3541/4025 (87.9752%)
___Train Local_ResNet_18,  epoch  86, local model 78, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3715/4025 (92.2981%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.8751, Accuracy: 5593/10000 (55.9300%)
___Train Local_ResNet_18,  epoch  86, local model 30, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3088/3472 (88.9401%)
___Train Local_ResNet_18,  epoch  86, local model 30, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3150/3472 (90.7258%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.9908, Accuracy: 5471/10000 (54.7100%)
___Train Local_ResNet_18,  epoch  86, local model 68, internal_epoch   1,  Average loss: 0.0065, Accuracy: 2871/3297 (87.0792%)
___Train Local_ResNet_18,  epoch  86, local model 68, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3019/3297 (91.5681%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.8246, Accuracy: 5659/10000 (56.5900%)
___Train Local_ResNet_18,  epoch  86, local model 74, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3830/4416 (86.7301%)
___Train Local_ResNet_18,  epoch  86, local model 74, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3991/4416 (90.3759%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.9997, Accuracy: 5510/10000 (55.1000%)
___Train Local_ResNet_18,  epoch  86, local model 89, internal_epoch   1,  Average loss: 0.0050, Accuracy: 3946/4356 (90.5877%)
___Train Local_ResNet_18,  epoch  86, local model 89, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4069/4356 (93.4114%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 2.0302, Accuracy: 5502/10000 (55.0200%)
___Train Local_ResNet_18,  epoch  86, local model 76, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3138/3638 (86.2562%)
___Train Local_ResNet_18,  epoch  86, local model 76, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3304/3638 (90.8191%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.8832, Accuracy: 5564/10000 (55.6400%)
time spent on training: 235.24667716026306
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.4908, Accuracy: 6415/10000 (64.1500%)
___Test Target_ResNet_18 poisoned: True, epoch: 86: Average loss: 11.7268, Accuracy: 9/9900 (0.0909%)
Done in 266.06334590911865 sec.
Server Epoch:87 choose agents : [13, 36, 58, 71, 31, 46, 45, 84, 60, 70, 99, 5, 53, 83, 63, 8, 22, 87, 27, 37].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  87, local model 13, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4351/4885 (89.0686%), train_poison_data_count: 385
Global model norm: 43.0161287089106.
Norm before scaling: 43.021166892371134. Distance: 2.229928881618792
Total norm for 4 adversaries is: 43.021166892371134. distance: 2.229928881618792
___Test Local_ResNet_18 poisoned: True, epoch: 87: Average loss: 0.1556, Accuracy: 9542/9900 (96.3838%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  87, local model 36, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4707/5305 (88.7276%), train_poison_data_count: 415
Global model norm: 43.0161287089106.
Norm before scaling: 43.02033693090324. Distance: 2.267926645233033
Total norm for 4 adversaries is: 43.02033693090324. distance: 2.267926645233033
___Test Local_ResNet_18 poisoned: True, epoch: 87: Average loss: 0.1321, Accuracy: 9561/9900 (96.5758%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  87, local model 58, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4203/4717 (89.1032%), train_poison_data_count: 370
Global model norm: 43.0161287089106.
Norm before scaling: 43.012599784648856. Distance: 2.0639446863111073
Total norm for 4 adversaries is: 43.012599784648856. distance: 2.0639446863111073
___Test Local_ResNet_18 poisoned: True, epoch: 87: Average loss: 0.1516, Accuracy: 9487/9900 (95.8283%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  87, local model 71, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4459/5066 (88.0182%), train_poison_data_count: 400
Global model norm: 43.0161287089106.
Norm before scaling: 43.02354886380176. Distance: 2.3159922443714636
Total norm for 4 adversaries is: 43.02354886380176. distance: 2.3159922443714636
___Test Local_ResNet_18 poisoned: True, epoch: 87: Average loss: 0.1436, Accuracy: 9548/9900 (96.4444%)
___Train Local_ResNet_18,  epoch  87, local model 31, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3632/4175 (86.9940%)
___Train Local_ResNet_18,  epoch  87, local model 31, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3723/4175 (89.1737%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.9675, Accuracy: 5385/10000 (53.8500%)
___Train Local_ResNet_18,  epoch  87, local model 46, internal_epoch   1,  Average loss: 0.0079, Accuracy: 4198/4956 (84.7054%)
___Train Local_ResNet_18,  epoch  87, local model 46, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4421/4956 (89.2050%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.1106, Accuracy: 5317/10000 (53.1700%)
___Train Local_ResNet_18,  epoch  87, local model 45, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4369/5037 (86.7381%)
___Train Local_ResNet_18,  epoch  87, local model 45, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4582/5037 (90.9668%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.8712, Accuracy: 5617/10000 (56.1700%)
___Train Local_ResNet_18,  epoch  87, local model 84, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4138/4793 (86.3342%)
___Train Local_ResNet_18,  epoch  87, local model 84, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4355/4793 (90.8617%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.0290, Accuracy: 5534/10000 (55.3400%)
___Train Local_ResNet_18,  epoch  87, local model 60, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3303/3804 (86.8297%)
___Train Local_ResNet_18,  epoch  87, local model 60, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3429/3804 (90.1420%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.0511, Accuracy: 5450/10000 (54.5000%)
___Train Local_ResNet_18,  epoch  87, local model 70, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4736/5392 (87.8338%)
___Train Local_ResNet_18,  epoch  87, local model 70, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4830/5392 (89.5772%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.0223, Accuracy: 5400/10000 (54.0000%)
___Train Local_ResNet_18,  epoch  87, local model 99, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3947/4465 (88.3987%)
___Train Local_ResNet_18,  epoch  87, local model 99, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4058/4465 (90.8847%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.0066, Accuracy: 5447/10000 (54.4700%)
___Train Local_ResNet_18,  epoch  87, local model 5, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4090/4596 (88.9904%)
___Train Local_ResNet_18,  epoch  87, local model 5, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4156/4596 (90.4265%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.9422, Accuracy: 5472/10000 (54.7200%)
___Train Local_ResNet_18,  epoch  87, local model 53, internal_epoch   1,  Average loss: 0.0066, Accuracy: 5316/6124 (86.8060%)
___Train Local_ResNet_18,  epoch  87, local model 53, internal_epoch   2,  Average loss: 0.0059, Accuracy: 5409/6124 (88.3246%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.9156, Accuracy: 5396/10000 (53.9600%)
___Train Local_ResNet_18,  epoch  87, local model 83, internal_epoch   1,  Average loss: 0.0066, Accuracy: 2858/3271 (87.3739%)
___Train Local_ResNet_18,  epoch  87, local model 83, internal_epoch   2,  Average loss: 0.0056, Accuracy: 2929/3271 (89.5445%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.9434, Accuracy: 5538/10000 (55.3800%)
___Train Local_ResNet_18,  epoch  87, local model 63, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3185/3590 (88.7187%)
___Train Local_ResNet_18,  epoch  87, local model 63, internal_epoch   2,  Average loss: 0.0056, Accuracy: 3249/3590 (90.5014%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.0322, Accuracy: 5474/10000 (54.7400%)
___Train Local_ResNet_18,  epoch  87, local model 8, internal_epoch   1,  Average loss: 0.0074, Accuracy: 3855/4501 (85.6476%)
___Train Local_ResNet_18,  epoch  87, local model 8, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4022/4501 (89.3579%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.0877, Accuracy: 5337/10000 (53.3700%)
___Train Local_ResNet_18,  epoch  87, local model 22, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4512/5232 (86.2385%)
___Train Local_ResNet_18,  epoch  87, local model 22, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4600/5232 (87.9205%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.9526, Accuracy: 5385/10000 (53.8500%)
___Train Local_ResNet_18,  epoch  87, local model 87, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3211/3672 (87.4455%)
___Train Local_ResNet_18,  epoch  87, local model 87, internal_epoch   2,  Average loss: 0.0055, Accuracy: 3262/3672 (88.8344%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.0653, Accuracy: 5406/10000 (54.0600%)
___Train Local_ResNet_18,  epoch  87, local model 27, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3704/4223 (87.7102%)
___Train Local_ResNet_18,  epoch  87, local model 27, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3876/4223 (91.7831%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.9417, Accuracy: 5526/10000 (55.2600%)
___Train Local_ResNet_18,  epoch  87, local model 37, internal_epoch   1,  Average loss: 0.0043, Accuracy: 4080/4354 (93.7069%)
___Train Local_ResNet_18,  epoch  87, local model 37, internal_epoch   2,  Average loss: 0.0129, Accuracy: 3365/4354 (77.2853%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.5551, Accuracy: 4505/10000 (45.0500%)
time spent on training: 258.6920838356018
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.5491, Accuracy: 6309/10000 (63.0900%)
___Test Target_ResNet_18 poisoned: True, epoch: 87: Average loss: 10.6401, Accuracy: 63/9900 (0.6364%)
Done in 284.2148542404175 sec.
Server Epoch:88 choose agents : [13, 36, 58, 71, 15, 77, 99, 12, 74, 46, 90, 55, 79, 63, 93, 44, 30, 42, 83, 45].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  88, local model 13, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4359/4885 (89.2323%), train_poison_data_count: 385
Global model norm: 43.06297906573145.
Norm before scaling: 43.06700272404399. Distance: 2.1507284261172854
Total norm for 4 adversaries is: 43.06700272404399. distance: 2.1507284261172854
___Test Local_ResNet_18 poisoned: True, epoch: 88: Average loss: 0.4213, Accuracy: 8899/9900 (89.8889%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  88, local model 36, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4730/5305 (89.1612%), train_poison_data_count: 415
Global model norm: 43.06297906573145.
Norm before scaling: 43.06287985137257. Distance: 2.1944961930731055
Total norm for 4 adversaries is: 43.06287985137257. distance: 2.1944961930731055
___Test Local_ResNet_18 poisoned: True, epoch: 88: Average loss: 0.1710, Accuracy: 9470/9900 (95.6566%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  88, local model 58, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4183/4717 (88.6792%), train_poison_data_count: 370
Global model norm: 43.06297906573145.
Norm before scaling: 43.06604042503356. Distance: 2.1839144066956253
Total norm for 4 adversaries is: 43.06604042503356. distance: 2.1839144066956253
___Test Local_ResNet_18 poisoned: True, epoch: 88: Average loss: 0.0661, Accuracy: 9734/9900 (98.3232%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  88, local model 71, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4442/5066 (87.6826%), train_poison_data_count: 400
Global model norm: 43.06297906573145.
Norm before scaling: 43.07113228745487. Distance: 2.294927588922408
Total norm for 4 adversaries is: 43.07113228745487. distance: 2.294927588922408
___Test Local_ResNet_18 poisoned: True, epoch: 88: Average loss: 0.2025, Accuracy: 9413/9900 (95.0808%)
___Train Local_ResNet_18,  epoch  88, local model 15, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4962/5582 (88.8929%)
___Train Local_ResNet_18,  epoch  88, local model 15, internal_epoch   2,  Average loss: 0.0052, Accuracy: 5021/5582 (89.9498%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 2.0325, Accuracy: 5378/10000 (53.7800%)
___Train Local_ResNet_18,  epoch  88, local model 77, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4056/4647 (87.2821%)
___Train Local_ResNet_18,  epoch  88, local model 77, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4218/4647 (90.7682%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 2.0270, Accuracy: 5470/10000 (54.7000%)
___Train Local_ResNet_18,  epoch  88, local model 99, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3923/4465 (87.8611%)
___Train Local_ResNet_18,  epoch  88, local model 99, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4084/4465 (91.4670%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.9816, Accuracy: 5545/10000 (55.4500%)
___Train Local_ResNet_18,  epoch  88, local model 12, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4414/5083 (86.8385%)
___Train Local_ResNet_18,  epoch  88, local model 12, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4495/5083 (88.4320%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 2.0510, Accuracy: 5367/10000 (53.6700%)
___Train Local_ResNet_18,  epoch  88, local model 74, internal_epoch   1,  Average loss: 0.0075, Accuracy: 3768/4416 (85.3261%)
___Train Local_ResNet_18,  epoch  88, local model 74, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3993/4416 (90.4212%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.9386, Accuracy: 5560/10000 (55.6000%)
___Train Local_ResNet_18,  epoch  88, local model 46, internal_epoch   1,  Average loss: 0.0073, Accuracy: 4234/4956 (85.4318%)
___Train Local_ResNet_18,  epoch  88, local model 46, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4376/4956 (88.2970%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 2.1515, Accuracy: 5183/10000 (51.8300%)
___Train Local_ResNet_18,  epoch  88, local model 90, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3890/4362 (89.1793%)
___Train Local_ResNet_18,  epoch  88, local model 90, internal_epoch   2,  Average loss: 0.0062, Accuracy: 3838/4362 (87.9872%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 2.1323, Accuracy: 5176/10000 (51.7600%)
___Train Local_ResNet_18,  epoch  88, local model 55, internal_epoch   1,  Average loss: 0.0042, Accuracy: 4026/4356 (92.4242%)
___Train Local_ResNet_18,  epoch  88, local model 55, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3956/4356 (90.8173%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 2.1526, Accuracy: 5245/10000 (52.4500%)
___Train Local_ResNet_18,  epoch  88, local model 79, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3294/3781 (87.1198%)
___Train Local_ResNet_18,  epoch  88, local model 79, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3458/3781 (91.4573%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.9769, Accuracy: 5506/10000 (55.0600%)
___Train Local_ResNet_18,  epoch  88, local model 63, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3185/3590 (88.7187%)
___Train Local_ResNet_18,  epoch  88, local model 63, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3235/3590 (90.1114%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 2.0035, Accuracy: 5463/10000 (54.6300%)
___Train Local_ResNet_18,  epoch  88, local model 93, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4072/4651 (87.5511%)
___Train Local_ResNet_18,  epoch  88, local model 93, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4211/4651 (90.5397%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.9603, Accuracy: 5562/10000 (55.6200%)
___Train Local_ResNet_18,  epoch  88, local model 44, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4103/4662 (88.0094%)
___Train Local_ResNet_18,  epoch  88, local model 44, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4233/4662 (90.7979%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.9546, Accuracy: 5493/10000 (54.9300%)
___Train Local_ResNet_18,  epoch  88, local model 30, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3053/3472 (87.9320%)
___Train Local_ResNet_18,  epoch  88, local model 30, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3223/3472 (92.8283%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.8920, Accuracy: 5540/10000 (55.4000%)
___Train Local_ResNet_18,  epoch  88, local model 42, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4808/5424 (88.6431%)
___Train Local_ResNet_18,  epoch  88, local model 42, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4894/5424 (90.2286%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 2.1041, Accuracy: 5313/10000 (53.1300%)
___Train Local_ResNet_18,  epoch  88, local model 83, internal_epoch   1,  Average loss: 0.0065, Accuracy: 2864/3271 (87.5573%)
___Train Local_ResNet_18,  epoch  88, local model 83, internal_epoch   2,  Average loss: 0.0060, Accuracy: 2887/3271 (88.2605%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.8877, Accuracy: 5589/10000 (55.8900%)
___Train Local_ResNet_18,  epoch  88, local model 45, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4360/5037 (86.5595%)
___Train Local_ResNet_18,  epoch  88, local model 45, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4527/5037 (89.8749%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.9416, Accuracy: 5536/10000 (55.3600%)
time spent on training: 241.9016432762146
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.5063, Accuracy: 6375/10000 (63.7500%)
___Test Target_ResNet_18 poisoned: True, epoch: 88: Average loss: 10.2905, Accuracy: 76/9900 (0.7677%)
Done in 267.6550323963165 sec.
Server Epoch:89 choose agents : [13, 36, 58, 71, 56, 69, 54, 24, 55, 48, 34, 18, 90, 60, 27, 21, 37, 11, 45, 4].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  89, local model 13, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4376/4885 (89.5803%), train_poison_data_count: 385
Global model norm: 43.09266224152901.
Norm before scaling: 43.09514506670458. Distance: 2.13331927751838
Total norm for 4 adversaries is: 43.09514506670458. distance: 2.13331927751838
___Test Local_ResNet_18 poisoned: True, epoch: 89: Average loss: 0.1825, Accuracy: 9423/9900 (95.1818%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  89, local model 36, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4704/5305 (88.6711%), train_poison_data_count: 415
Global model norm: 43.09266224152901.
Norm before scaling: 43.094642281371534. Distance: 2.278902910535456
Total norm for 4 adversaries is: 43.094642281371534. distance: 2.278902910535456
___Test Local_ResNet_18 poisoned: True, epoch: 89: Average loss: 0.2030, Accuracy: 9378/9900 (94.7273%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  89, local model 58, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4197/4717 (88.9760%), train_poison_data_count: 370
Global model norm: 43.09266224152901.
Norm before scaling: 43.089958306268265. Distance: 2.0474061931877525
Total norm for 4 adversaries is: 43.089958306268265. distance: 2.0474061931877525
___Test Local_ResNet_18 poisoned: True, epoch: 89: Average loss: 0.3065, Accuracy: 9159/9900 (92.5152%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  89, local model 71, internal_epoch   1,  Average loss: 0.0075, Accuracy: 4430/5066 (87.4457%), train_poison_data_count: 400
Global model norm: 43.09266224152901.
Norm before scaling: 43.10050255289954. Distance: 2.3239094504346722
Total norm for 4 adversaries is: 43.10050255289954. distance: 2.3239094504346722
___Test Local_ResNet_18 poisoned: True, epoch: 89: Average loss: 0.6270, Accuracy: 8405/9900 (84.8990%)
___Train Local_ResNet_18,  epoch  89, local model 56, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4290/4989 (85.9892%)
___Train Local_ResNet_18,  epoch  89, local model 56, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4440/4989 (88.9958%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.9269, Accuracy: 5622/10000 (56.2200%)
___Train Local_ResNet_18,  epoch  89, local model 69, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3555/4013 (88.5871%)
___Train Local_ResNet_18,  epoch  89, local model 69, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3698/4013 (92.1505%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.9101, Accuracy: 5569/10000 (55.6900%)
___Train Local_ResNet_18,  epoch  89, local model 54, internal_epoch   1,  Average loss: 0.0077, Accuracy: 4455/5195 (85.7555%)
___Train Local_ResNet_18,  epoch  89, local model 54, internal_epoch   2,  Average loss: 0.0077, Accuracy: 4425/5195 (85.1781%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 2.1445, Accuracy: 5264/10000 (52.6400%)
___Train Local_ResNet_18,  epoch  89, local model 24, internal_epoch   1,  Average loss: 0.0074, Accuracy: 3464/3969 (87.2764%)
___Train Local_ResNet_18,  epoch  89, local model 24, internal_epoch   2,  Average loss: 0.0064, Accuracy: 3546/3969 (89.3424%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.9578, Accuracy: 5612/10000 (56.1200%)
___Train Local_ResNet_18,  epoch  89, local model 55, internal_epoch   1,  Average loss: 0.0032, Accuracy: 4106/4356 (94.2608%)
___Train Local_ResNet_18,  epoch  89, local model 55, internal_epoch   2,  Average loss: 0.0032, Accuracy: 4152/4356 (95.3168%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.8704, Accuracy: 5734/10000 (57.3400%)
___Train Local_ResNet_18,  epoch  89, local model 48, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3937/4441 (88.6512%)
___Train Local_ResNet_18,  epoch  89, local model 48, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4019/4441 (90.4976%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 2.0521, Accuracy: 5434/10000 (54.3400%)
___Train Local_ResNet_18,  epoch  89, local model 34, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4028/4518 (89.1545%)
___Train Local_ResNet_18,  epoch  89, local model 34, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4110/4518 (90.9695%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.8705, Accuracy: 5586/10000 (55.8600%)
___Train Local_ResNet_18,  epoch  89, local model 18, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3426/3911 (87.5991%)
___Train Local_ResNet_18,  epoch  89, local model 18, internal_epoch   2,  Average loss: 0.0080, Accuracy: 3320/3911 (84.8888%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 2.0901, Accuracy: 5275/10000 (52.7500%)
___Train Local_ResNet_18,  epoch  89, local model 90, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3866/4362 (88.6291%)
___Train Local_ResNet_18,  epoch  89, local model 90, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3943/4362 (90.3943%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 2.1224, Accuracy: 5272/10000 (52.7200%)
___Train Local_ResNet_18,  epoch  89, local model 60, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3352/3804 (88.1178%)
___Train Local_ResNet_18,  epoch  89, local model 60, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3463/3804 (91.0358%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 2.0653, Accuracy: 5383/10000 (53.8300%)
___Train Local_ResNet_18,  epoch  89, local model 27, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3692/4223 (87.4260%)
___Train Local_ResNet_18,  epoch  89, local model 27, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3868/4223 (91.5937%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 2.0490, Accuracy: 5345/10000 (53.4500%)
___Train Local_ResNet_18,  epoch  89, local model 21, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4096/4634 (88.3902%)
___Train Local_ResNet_18,  epoch  89, local model 21, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4223/4634 (91.1308%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.8078, Accuracy: 5713/10000 (57.1300%)
___Train Local_ResNet_18,  epoch  89, local model 37, internal_epoch   1,  Average loss: 0.0037, Accuracy: 4068/4354 (93.4313%)
___Train Local_ResNet_18,  epoch  89, local model 37, internal_epoch   2,  Average loss: 0.0095, Accuracy: 3619/4354 (83.1190%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 2.4356, Accuracy: 4782/10000 (47.8200%)
___Train Local_ResNet_18,  epoch  89, local model 11, internal_epoch   1,  Average loss: 0.0087, Accuracy: 4346/5244 (82.8757%)
___Train Local_ResNet_18,  epoch  89, local model 11, internal_epoch   2,  Average loss: 0.0069, Accuracy: 4530/5244 (86.3844%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.9596, Accuracy: 5398/10000 (53.9800%)
___Train Local_ResNet_18,  epoch  89, local model 45, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4371/5037 (86.7778%)
___Train Local_ResNet_18,  epoch  89, local model 45, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4621/5037 (91.7411%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.9010, Accuracy: 5520/10000 (55.2000%)
___Train Local_ResNet_18,  epoch  89, local model 4, internal_epoch   1,  Average loss: 0.0073, Accuracy: 3181/3704 (85.8801%)
___Train Local_ResNet_18,  epoch  89, local model 4, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3305/3704 (89.2279%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 2.0586, Accuracy: 5371/10000 (53.7100%)
time spent on training: 236.18268537521362
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.5670, Accuracy: 6237/10000 (62.3700%)
___Test Target_ResNet_18 poisoned: True, epoch: 89: Average loss: 9.5658, Accuracy: 152/9900 (1.5354%)
Done in 261.73737144470215 sec.
Server Epoch:90 choose agents : [13, 36, 58, 71, 74, 49, 3, 92, 2, 47, 62, 75, 84, 6, 12, 76, 53, 81, 24, 91].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  90, local model 13, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4370/4885 (89.4575%), train_poison_data_count: 385
Global model norm: 43.13245944317559.
Norm before scaling: 43.13405277491396. Distance: 2.140606288410464
Total norm for 4 adversaries is: 43.13405277491396. distance: 2.140606288410464
___Test Local_ResNet_18 poisoned: True, epoch: 90: Average loss: 0.2829, Accuracy: 9197/9900 (92.8990%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  90, local model 36, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4718/5305 (88.9350%), train_poison_data_count: 415
Global model norm: 43.13245944317559.
Norm before scaling: 43.13667471048417. Distance: 2.270159058396821
Total norm for 4 adversaries is: 43.13667471048417. distance: 2.270159058396821
___Test Local_ResNet_18 poisoned: True, epoch: 90: Average loss: 0.1732, Accuracy: 9486/9900 (95.8182%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  90, local model 58, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4201/4717 (89.0608%), train_poison_data_count: 370
Global model norm: 43.13245944317559.
Norm before scaling: 43.130560386549725. Distance: 2.07594115732845
Total norm for 4 adversaries is: 43.130560386549725. distance: 2.07594115732845
___Test Local_ResNet_18 poisoned: True, epoch: 90: Average loss: 0.1797, Accuracy: 9389/9900 (94.8384%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  90, local model 71, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4478/5066 (88.3932%), train_poison_data_count: 400
Global model norm: 43.13245944317559.
Norm before scaling: 43.13681337290401. Distance: 2.270940923912624
Total norm for 4 adversaries is: 43.13681337290401. distance: 2.270940923912624
___Test Local_ResNet_18 poisoned: True, epoch: 90: Average loss: 0.2630, Accuracy: 9277/9900 (93.7071%)
___Train Local_ResNet_18,  epoch  90, local model 74, internal_epoch   1,  Average loss: 0.0071, Accuracy: 3796/4416 (85.9601%)
___Train Local_ResNet_18,  epoch  90, local model 74, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3973/4416 (89.9683%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.8326, Accuracy: 5624/10000 (56.2400%)
___Train Local_ResNet_18,  epoch  90, local model 49, internal_epoch   1,  Average loss: 0.0072, Accuracy: 4478/5197 (86.1651%)
___Train Local_ResNet_18,  epoch  90, local model 49, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4611/5197 (88.7243%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.9713, Accuracy: 5409/10000 (54.0900%)
___Train Local_ResNet_18,  epoch  90, local model 3, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4279/4918 (87.0069%)
___Train Local_ResNet_18,  epoch  90, local model 3, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4450/4918 (90.4839%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 2.0427, Accuracy: 5352/10000 (53.5200%)
___Train Local_ResNet_18,  epoch  90, local model 92, internal_epoch   1,  Average loss: 0.0061, Accuracy: 5520/6263 (88.1367%)
___Train Local_ResNet_18,  epoch  90, local model 92, internal_epoch   2,  Average loss: 0.0047, Accuracy: 5694/6263 (90.9149%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.9907, Accuracy: 5453/10000 (54.5300%)
___Train Local_ResNet_18,  epoch  90, local model 2, internal_epoch   1,  Average loss: 0.0073, Accuracy: 3126/3646 (85.7378%)
___Train Local_ResNet_18,  epoch  90, local model 2, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3284/3646 (90.0713%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.8805, Accuracy: 5603/10000 (56.0300%)
___Train Local_ResNet_18,  epoch  90, local model 47, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4172/4707 (88.6339%)
___Train Local_ResNet_18,  epoch  90, local model 47, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4243/4707 (90.1423%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.9543, Accuracy: 5466/10000 (54.6600%)
___Train Local_ResNet_18,  epoch  90, local model 62, internal_epoch   1,  Average loss: 0.0074, Accuracy: 4337/5063 (85.6607%)
___Train Local_ResNet_18,  epoch  90, local model 62, internal_epoch   2,  Average loss: 0.0081, Accuracy: 4244/5063 (83.8238%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 2.1862, Accuracy: 5120/10000 (51.2000%)
___Train Local_ResNet_18,  epoch  90, local model 75, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3744/4295 (87.1711%)
___Train Local_ResNet_18,  epoch  90, local model 75, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3947/4295 (91.8976%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.8764, Accuracy: 5678/10000 (56.7800%)
___Train Local_ResNet_18,  epoch  90, local model 84, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4143/4793 (86.4386%)
___Train Local_ResNet_18,  epoch  90, local model 84, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4340/4793 (90.5487%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 2.1364, Accuracy: 5283/10000 (52.8300%)
___Train Local_ResNet_18,  epoch  90, local model 6, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4034/4538 (88.8938%)
___Train Local_ResNet_18,  epoch  90, local model 6, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4172/4538 (91.9348%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.9002, Accuracy: 5557/10000 (55.5700%)
___Train Local_ResNet_18,  epoch  90, local model 12, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4488/5083 (88.2943%)
___Train Local_ResNet_18,  epoch  90, local model 12, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4521/5083 (88.9435%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 2.0203, Accuracy: 5339/10000 (53.3900%)
___Train Local_ResNet_18,  epoch  90, local model 76, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3112/3638 (85.5415%)
___Train Local_ResNet_18,  epoch  90, local model 76, internal_epoch   2,  Average loss: 0.0055, Accuracy: 3251/3638 (89.3623%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.8648, Accuracy: 5581/10000 (55.8100%)
___Train Local_ResNet_18,  epoch  90, local model 53, internal_epoch   1,  Average loss: 0.0063, Accuracy: 5362/6124 (87.5572%)
___Train Local_ResNet_18,  epoch  90, local model 53, internal_epoch   2,  Average loss: 0.0053, Accuracy: 5478/6124 (89.4513%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.9434, Accuracy: 5460/10000 (54.6000%)
___Train Local_ResNet_18,  epoch  90, local model 81, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4051/4618 (87.7220%)
___Train Local_ResNet_18,  epoch  90, local model 81, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4085/4618 (88.4582%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.9783, Accuracy: 5528/10000 (55.2800%)
___Train Local_ResNet_18,  epoch  90, local model 24, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3493/3969 (88.0071%)
___Train Local_ResNet_18,  epoch  90, local model 24, internal_epoch   2,  Average loss: 0.0065, Accuracy: 3556/3969 (89.5944%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.8966, Accuracy: 5747/10000 (57.4700%)
___Train Local_ResNet_18,  epoch  90, local model 91, internal_epoch   1,  Average loss: 0.0086, Accuracy: 3485/4158 (83.8143%)
___Train Local_ResNet_18,  epoch  90, local model 91, internal_epoch   2,  Average loss: 0.0064, Accuracy: 3643/4158 (87.6142%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.9620, Accuracy: 5377/10000 (53.7700%)
time spent on training: 238.21152925491333
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.4932, Accuracy: 6417/10000 (64.1700%)
___Test Target_ResNet_18 poisoned: True, epoch: 90: Average loss: 9.8829, Accuracy: 158/9900 (1.5960%)
Done in 263.5653636455536 sec.
Server Epoch:91 choose agents : [13, 36, 58, 71, 28, 7, 97, 84, 75, 11, 56, 49, 89, 77, 69, 6, 47, 92, 73, 14].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  91, local model 13, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4334/4885 (88.7206%), train_poison_data_count: 385
Global model norm: 43.171692623121835.
Norm before scaling: 43.17547855255559. Distance: 2.1395625241266534
Total norm for 4 adversaries is: 43.17547855255559. distance: 2.1395625241266534
___Test Local_ResNet_18 poisoned: True, epoch: 91: Average loss: 0.2875, Accuracy: 9183/9900 (92.7576%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  91, local model 36, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4682/5305 (88.2564%), train_poison_data_count: 415
Global model norm: 43.171692623121835.
Norm before scaling: 43.17361531734761. Distance: 2.261412288478743
Total norm for 4 adversaries is: 43.17361531734761. distance: 2.261412288478743
___Test Local_ResNet_18 poisoned: True, epoch: 91: Average loss: 0.1776, Accuracy: 9429/9900 (95.2424%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  91, local model 58, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4171/4717 (88.4248%), train_poison_data_count: 370
Global model norm: 43.171692623121835.
Norm before scaling: 43.170227925059216. Distance: 2.088067385379071
Total norm for 4 adversaries is: 43.170227925059216. distance: 2.088067385379071
___Test Local_ResNet_18 poisoned: True, epoch: 91: Average loss: 0.2152, Accuracy: 9321/9900 (94.1515%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  91, local model 71, internal_epoch   1,  Average loss: 0.0073, Accuracy: 4452/5066 (87.8800%), train_poison_data_count: 400
Global model norm: 43.171692623121835.
Norm before scaling: 43.17690490513997. Distance: 2.2879374476665255
Total norm for 4 adversaries is: 43.17690490513997. distance: 2.2879374476665255
___Test Local_ResNet_18 poisoned: True, epoch: 91: Average loss: 0.2755, Accuracy: 9182/9900 (92.7475%)
___Train Local_ResNet_18,  epoch  91, local model 28, internal_epoch   1,  Average loss: 0.0074, Accuracy: 4046/4716 (85.7930%)
___Train Local_ResNet_18,  epoch  91, local model 28, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4153/4716 (88.0619%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.0318, Accuracy: 5422/10000 (54.2200%)
___Train Local_ResNet_18,  epoch  91, local model 7, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3929/4481 (87.6813%)
___Train Local_ResNet_18,  epoch  91, local model 7, internal_epoch   2,  Average loss: 0.0060, Accuracy: 3986/4481 (88.9534%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.9852, Accuracy: 5520/10000 (55.2000%)
___Train Local_ResNet_18,  epoch  91, local model 97, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3834/4361 (87.9156%)
___Train Local_ResNet_18,  epoch  91, local model 97, internal_epoch   2,  Average loss: 0.0072, Accuracy: 3770/4361 (86.4481%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.1295, Accuracy: 5224/10000 (52.2400%)
___Train Local_ResNet_18,  epoch  91, local model 84, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4143/4793 (86.4386%)
___Train Local_ResNet_18,  epoch  91, local model 84, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4347/4793 (90.6948%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.9285, Accuracy: 5608/10000 (56.0800%)
___Train Local_ResNet_18,  epoch  91, local model 75, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3813/4295 (88.7776%)
___Train Local_ResNet_18,  epoch  91, local model 75, internal_epoch   2,  Average loss: 0.0062, Accuracy: 3791/4295 (88.2654%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.0091, Accuracy: 5409/10000 (54.0900%)
___Train Local_ResNet_18,  epoch  91, local model 11, internal_epoch   1,  Average loss: 0.0083, Accuracy: 4384/5244 (83.6003%)
___Train Local_ResNet_18,  epoch  91, local model 11, internal_epoch   2,  Average loss: 0.0063, Accuracy: 4586/5244 (87.4523%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.9696, Accuracy: 5479/10000 (54.7900%)
___Train Local_ResNet_18,  epoch  91, local model 56, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4320/4989 (86.5905%)
___Train Local_ResNet_18,  epoch  91, local model 56, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4428/4989 (88.7553%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.0117, Accuracy: 5480/10000 (54.8000%)
___Train Local_ResNet_18,  epoch  91, local model 49, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4519/5197 (86.9540%)
___Train Local_ResNet_18,  epoch  91, local model 49, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4663/5197 (89.7248%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.0089, Accuracy: 5409/10000 (54.0900%)
___Train Local_ResNet_18,  epoch  91, local model 89, internal_epoch   1,  Average loss: 0.0050, Accuracy: 3985/4356 (91.4830%)
___Train Local_ResNet_18,  epoch  91, local model 89, internal_epoch   2,  Average loss: 0.0077, Accuracy: 3758/4356 (86.2718%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.4503, Accuracy: 4672/10000 (46.7200%)
___Train Local_ResNet_18,  epoch  91, local model 77, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4029/4647 (86.7011%)
___Train Local_ResNet_18,  epoch  91, local model 77, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4140/4647 (89.0897%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.9425, Accuracy: 5520/10000 (55.2000%)
___Train Local_ResNet_18,  epoch  91, local model 69, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3579/4013 (89.1851%)
___Train Local_ResNet_18,  epoch  91, local model 69, internal_epoch   2,  Average loss: 0.0038, Accuracy: 3728/4013 (92.8981%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.7448, Accuracy: 5848/10000 (58.4800%)
___Train Local_ResNet_18,  epoch  91, local model 6, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4012/4538 (88.4090%)
___Train Local_ResNet_18,  epoch  91, local model 6, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4179/4538 (92.0890%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.8189, Accuracy: 5693/10000 (56.9300%)
___Train Local_ResNet_18,  epoch  91, local model 47, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4138/4707 (87.9116%)
___Train Local_ResNet_18,  epoch  91, local model 47, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4252/4707 (90.3335%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.8428, Accuracy: 5628/10000 (56.2800%)
___Train Local_ResNet_18,  epoch  91, local model 92, internal_epoch   1,  Average loss: 0.0062, Accuracy: 5496/6263 (87.7535%)
___Train Local_ResNet_18,  epoch  91, local model 92, internal_epoch   2,  Average loss: 0.0046, Accuracy: 5689/6263 (90.8351%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.0970, Accuracy: 5288/10000 (52.8800%)
___Train Local_ResNet_18,  epoch  91, local model 73, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3743/4235 (88.3825%)
___Train Local_ResNet_18,  epoch  91, local model 73, internal_epoch   2,  Average loss: 0.0057, Accuracy: 3779/4235 (89.2326%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.0150, Accuracy: 5456/10000 (54.5600%)
___Train Local_ResNet_18,  epoch  91, local model 14, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3365/3861 (87.1536%)
___Train Local_ResNet_18,  epoch  91, local model 14, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3468/3861 (89.8213%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.0650, Accuracy: 5344/10000 (53.4400%)
time spent on training: 259.086701631546
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.5547, Accuracy: 6276/10000 (62.7600%)
___Test Target_ResNet_18 poisoned: True, epoch: 91: Average loss: 9.3279, Accuracy: 220/9900 (2.2222%)
Done in 289.9752426147461 sec.
Server Epoch:92 choose agents : [13, 36, 58, 71, 65, 98, 97, 69, 34, 57, 61, 96, 73, 45, 87, 16, 55, 66, 84, 80].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  92, local model 13, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4314/4885 (88.3112%), train_poison_data_count: 385
Global model norm: 43.202739317898725.
Norm before scaling: 43.2074237802552. Distance: 2.22882896313412
Total norm for 4 adversaries is: 43.2074237802552. distance: 2.22882896313412
___Test Local_ResNet_18 poisoned: True, epoch: 92: Average loss: 0.1595, Accuracy: 9485/9900 (95.8081%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  92, local model 36, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4690/5305 (88.4072%), train_poison_data_count: 415
Global model norm: 43.202739317898725.
Norm before scaling: 43.20644906968099. Distance: 2.2348773098239243
Total norm for 4 adversaries is: 43.20644906968099. distance: 2.2348773098239243
___Test Local_ResNet_18 poisoned: True, epoch: 92: Average loss: 0.2355, Accuracy: 9353/9900 (94.4747%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  92, local model 58, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4178/4717 (88.5732%), train_poison_data_count: 370
Global model norm: 43.202739317898725.
Norm before scaling: 43.203225305037265. Distance: 2.1243735119196323
Total norm for 4 adversaries is: 43.203225305037265. distance: 2.1243735119196323
___Test Local_ResNet_18 poisoned: True, epoch: 92: Average loss: 0.1848, Accuracy: 9442/9900 (95.3737%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  92, local model 71, internal_epoch   1,  Average loss: 0.0076, Accuracy: 4414/5066 (87.1299%), train_poison_data_count: 400
Global model norm: 43.202739317898725.
Norm before scaling: 43.20929120779103. Distance: 2.3442690465299223
Total norm for 4 adversaries is: 43.20929120779103. distance: 2.3442690465299223
___Test Local_ResNet_18 poisoned: True, epoch: 92: Average loss: 0.1816, Accuracy: 9431/9900 (95.2626%)
___Train Local_ResNet_18,  epoch  92, local model 65, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4446/5055 (87.9525%)
___Train Local_ResNet_18,  epoch  92, local model 65, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4586/5055 (90.7221%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.9433, Accuracy: 5502/10000 (55.0200%)
___Train Local_ResNet_18,  epoch  92, local model 98, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3346/3828 (87.4086%)
___Train Local_ResNet_18,  epoch  92, local model 98, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3528/3828 (92.1630%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.8706, Accuracy: 5625/10000 (56.2500%)
___Train Local_ResNet_18,  epoch  92, local model 97, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3812/4361 (87.4111%)
___Train Local_ResNet_18,  epoch  92, local model 97, internal_epoch   2,  Average loss: 0.0056, Accuracy: 3904/4361 (89.5208%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 2.0197, Accuracy: 5373/10000 (53.7300%)
___Train Local_ResNet_18,  epoch  92, local model 69, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3560/4013 (88.7117%)
___Train Local_ResNet_18,  epoch  92, local model 69, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3721/4013 (92.7236%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.9563, Accuracy: 5587/10000 (55.8700%)
___Train Local_ResNet_18,  epoch  92, local model 34, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4007/4518 (88.6897%)
___Train Local_ResNet_18,  epoch  92, local model 34, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4152/4518 (91.8991%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.8874, Accuracy: 5605/10000 (56.0500%)
___Train Local_ResNet_18,  epoch  92, local model 57, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3957/4558 (86.8144%)
___Train Local_ResNet_18,  epoch  92, local model 57, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4037/4558 (88.5695%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 2.0568, Accuracy: 5271/10000 (52.7100%)
___Train Local_ResNet_18,  epoch  92, local model 61, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3605/4126 (87.3728%)
___Train Local_ResNet_18,  epoch  92, local model 61, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3763/4126 (91.2021%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.8904, Accuracy: 5589/10000 (55.8900%)
___Train Local_ResNet_18,  epoch  92, local model 96, internal_epoch   1,  Average loss: 0.0053, Accuracy: 4221/4679 (90.2116%)
___Train Local_ResNet_18,  epoch  92, local model 96, internal_epoch   2,  Average loss: 0.0073, Accuracy: 4020/4679 (85.9158%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 2.3197, Accuracy: 4934/10000 (49.3400%)
___Train Local_ResNet_18,  epoch  92, local model 73, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3729/4235 (88.0519%)
___Train Local_ResNet_18,  epoch  92, local model 73, internal_epoch   2,  Average loss: 0.0061, Accuracy: 3720/4235 (87.8394%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.9655, Accuracy: 5513/10000 (55.1300%)
___Train Local_ResNet_18,  epoch  92, local model 45, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4331/5037 (85.9837%)
___Train Local_ResNet_18,  epoch  92, local model 45, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4575/5037 (90.8279%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.8573, Accuracy: 5620/10000 (56.2000%)
___Train Local_ResNet_18,  epoch  92, local model 87, internal_epoch   1,  Average loss: 0.0073, Accuracy: 3165/3672 (86.1928%)
___Train Local_ResNet_18,  epoch  92, local model 87, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3338/3672 (90.9041%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.8296, Accuracy: 5692/10000 (56.9200%)
___Train Local_ResNet_18,  epoch  92, local model 16, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4265/4928 (86.5463%)
___Train Local_ResNet_18,  epoch  92, local model 16, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4431/4928 (89.9148%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.9502, Accuracy: 5549/10000 (55.4900%)
___Train Local_ResNet_18,  epoch  92, local model 55, internal_epoch   1,  Average loss: 0.0037, Accuracy: 4063/4356 (93.2736%)
___Train Local_ResNet_18,  epoch  92, local model 55, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3986/4356 (91.5060%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.9752, Accuracy: 5480/10000 (54.8000%)
___Train Local_ResNet_18,  epoch  92, local model 66, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3944/4456 (88.5099%)
___Train Local_ResNet_18,  epoch  92, local model 66, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4085/4456 (91.6741%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 2.0714, Accuracy: 5450/10000 (54.5000%)
___Train Local_ResNet_18,  epoch  92, local model 84, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4131/4793 (86.1882%)
___Train Local_ResNet_18,  epoch  92, local model 84, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4342/4793 (90.5904%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.8625, Accuracy: 5699/10000 (56.9900%)
___Train Local_ResNet_18,  epoch  92, local model 80, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4414/5025 (87.8408%)
___Train Local_ResNet_18,  epoch  92, local model 80, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4557/5025 (90.6866%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 2.0672, Accuracy: 5408/10000 (54.0800%)
time spent on training: 254.91933417320251
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.5460, Accuracy: 6307/10000 (63.0700%)
___Test Target_ResNet_18 poisoned: True, epoch: 92: Average loss: 9.4584, Accuracy: 167/9900 (1.6869%)
Done in 285.1926612854004 sec.
Server Epoch:93 choose agents : [13, 36, 58, 71, 29, 23, 55, 2, 12, 89, 57, 31, 30, 8, 42, 7, 40, 22, 85, 51].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  93, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4381/4885 (89.6827%), train_poison_data_count: 385
Global model norm: 43.23983521718573.
Norm before scaling: 43.245160664500226. Distance: 2.161178484958532
Total norm for 4 adversaries is: 43.245160664500226. distance: 2.161178484958532
___Test Local_ResNet_18 poisoned: True, epoch: 93: Average loss: 0.1075, Accuracy: 9638/9900 (97.3535%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  93, local model 36, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4704/5305 (88.6711%), train_poison_data_count: 415
Global model norm: 43.23983521718573.
Norm before scaling: 43.243108475964846. Distance: 2.2832691192879015
Total norm for 4 adversaries is: 43.243108475964846. distance: 2.2832691192879015
___Test Local_ResNet_18 poisoned: True, epoch: 93: Average loss: 0.1668, Accuracy: 9462/9900 (95.5758%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  93, local model 58, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4217/4717 (89.4000%), train_poison_data_count: 370
Global model norm: 43.23983521718573.
Norm before scaling: 43.23660406026429. Distance: 2.038730989013201
Total norm for 4 adversaries is: 43.23660406026429. distance: 2.038730989013201
___Test Local_ResNet_18 poisoned: True, epoch: 93: Average loss: 0.2862, Accuracy: 9196/9900 (92.8889%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  93, local model 71, internal_epoch   1,  Average loss: 0.0072, Accuracy: 4427/5066 (87.3865%), train_poison_data_count: 400
Global model norm: 43.23983521718573.
Norm before scaling: 43.24492637554795. Distance: 2.2988069674313114
Total norm for 4 adversaries is: 43.24492637554795. distance: 2.2988069674313114
___Test Local_ResNet_18 poisoned: True, epoch: 93: Average loss: 0.2179, Accuracy: 9337/9900 (94.3131%)
___Train Local_ResNet_18,  epoch  93, local model 29, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3875/4346 (89.1624%)
___Train Local_ResNet_18,  epoch  93, local model 29, internal_epoch   2,  Average loss: 0.0037, Accuracy: 4038/4346 (92.9130%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 1.8794, Accuracy: 5693/10000 (56.9300%)
___Train Local_ResNet_18,  epoch  93, local model 23, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3628/4184 (86.7113%)
___Train Local_ResNet_18,  epoch  93, local model 23, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3796/4184 (90.7266%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 1.9994, Accuracy: 5455/10000 (54.5500%)
___Train Local_ResNet_18,  epoch  93, local model 55, internal_epoch   1,  Average loss: 0.0041, Accuracy: 4022/4356 (92.3324%)
___Train Local_ResNet_18,  epoch  93, local model 55, internal_epoch   2,  Average loss: 0.0080, Accuracy: 3725/4356 (85.5142%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.1461, Accuracy: 5210/10000 (52.1000%)
___Train Local_ResNet_18,  epoch  93, local model 2, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3177/3646 (87.1366%)
___Train Local_ResNet_18,  epoch  93, local model 2, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3332/3646 (91.3878%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 1.7411, Accuracy: 5771/10000 (57.7100%)
___Train Local_ResNet_18,  epoch  93, local model 12, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4466/5083 (87.8615%)
___Train Local_ResNet_18,  epoch  93, local model 12, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4537/5083 (89.2583%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.0805, Accuracy: 5324/10000 (53.2400%)
___Train Local_ResNet_18,  epoch  93, local model 89, internal_epoch   1,  Average loss: 0.0041, Accuracy: 4023/4356 (92.3554%)
___Train Local_ResNet_18,  epoch  93, local model 89, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3985/4356 (91.4830%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.0075, Accuracy: 5411/10000 (54.1100%)
___Train Local_ResNet_18,  epoch  93, local model 57, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3969/4558 (87.0777%)
___Train Local_ResNet_18,  epoch  93, local model 57, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4111/4558 (90.1931%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 1.9622, Accuracy: 5562/10000 (55.6200%)
___Train Local_ResNet_18,  epoch  93, local model 31, internal_epoch   1,  Average loss: 0.0074, Accuracy: 3597/4175 (86.1557%)
___Train Local_ResNet_18,  epoch  93, local model 31, internal_epoch   2,  Average loss: 0.0056, Accuracy: 3720/4175 (89.1018%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 1.8807, Accuracy: 5560/10000 (55.6000%)
___Train Local_ResNet_18,  epoch  93, local model 30, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3052/3472 (87.9032%)
___Train Local_ResNet_18,  epoch  93, local model 30, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3150/3472 (90.7258%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.0696, Accuracy: 5384/10000 (53.8400%)
___Train Local_ResNet_18,  epoch  93, local model 8, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3914/4501 (86.9585%)
___Train Local_ResNet_18,  epoch  93, local model 8, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4042/4501 (89.8023%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.2096, Accuracy: 5247/10000 (52.4700%)
___Train Local_ResNet_18,  epoch  93, local model 42, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4810/5424 (88.6799%)
___Train Local_ResNet_18,  epoch  93, local model 42, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4943/5424 (91.1320%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.2079, Accuracy: 5115/10000 (51.1500%)
___Train Local_ResNet_18,  epoch  93, local model 7, internal_epoch   1,  Average loss: 0.0073, Accuracy: 3918/4481 (87.4358%)
___Train Local_ResNet_18,  epoch  93, local model 7, internal_epoch   2,  Average loss: 0.0070, Accuracy: 3952/4481 (88.1946%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 1.9551, Accuracy: 5547/10000 (55.4700%)
___Train Local_ResNet_18,  epoch  93, local model 40, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4773/5455 (87.4977%)
___Train Local_ResNet_18,  epoch  93, local model 40, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4868/5455 (89.2392%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.2425, Accuracy: 5030/10000 (50.3000%)
___Train Local_ResNet_18,  epoch  93, local model 22, internal_epoch   1,  Average loss: 0.0073, Accuracy: 4499/5232 (85.9901%)
___Train Local_ResNet_18,  epoch  93, local model 22, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4631/5232 (88.5130%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.1432, Accuracy: 5221/10000 (52.2100%)
___Train Local_ResNet_18,  epoch  93, local model 85, internal_epoch   1,  Average loss: 0.0074, Accuracy: 5470/6391 (85.5891%)
___Train Local_ResNet_18,  epoch  93, local model 85, internal_epoch   2,  Average loss: 0.0069, Accuracy: 5504/6391 (86.1211%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.0348, Accuracy: 5304/10000 (53.0400%)
___Train Local_ResNet_18,  epoch  93, local model 51, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3380/3775 (89.5364%)
___Train Local_ResNet_18,  epoch  93, local model 51, internal_epoch   2,  Average loss: 0.0033, Accuracy: 3547/3775 (93.9603%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 1.8545, Accuracy: 5701/10000 (57.0100%)
time spent on training: 259.99256706237793
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 93: Average loss: 1.5561, Accuracy: 6275/10000 (62.7500%)
___Test Target_ResNet_18 poisoned: True, epoch: 93: Average loss: 9.2291, Accuracy: 194/9900 (1.9596%)
Done in 289.3811182975769 sec.
Server Epoch:94 choose agents : [13, 36, 58, 71, 78, 27, 76, 62, 82, 94, 91, 34, 73, 88, 85, 75, 26, 7, 31, 63].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  94, local model 13, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4352/4885 (89.0890%), train_poison_data_count: 385
Global model norm: 43.276277354234445.
Norm before scaling: 43.27611234173031. Distance: 2.2077517793354704
Total norm for 4 adversaries is: 43.27611234173031. distance: 2.2077517793354704
___Test Local_ResNet_18 poisoned: True, epoch: 94: Average loss: 0.1730, Accuracy: 9437/9900 (95.3232%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  94, local model 36, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4707/5305 (88.7276%), train_poison_data_count: 415
Global model norm: 43.276277354234445.
Norm before scaling: 43.272807728085716. Distance: 2.226205897636028
Total norm for 4 adversaries is: 43.272807728085716. distance: 2.226205897636028
___Test Local_ResNet_18 poisoned: True, epoch: 94: Average loss: 0.0947, Accuracy: 9636/9900 (97.3333%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  94, local model 58, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4194/4717 (88.9124%), train_poison_data_count: 370
Global model norm: 43.276277354234445.
Norm before scaling: 43.273362040690664. Distance: 2.091901276135344
Total norm for 4 adversaries is: 43.273362040690664. distance: 2.091901276135344
___Test Local_ResNet_18 poisoned: True, epoch: 94: Average loss: 0.1728, Accuracy: 9473/9900 (95.6869%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  94, local model 71, internal_epoch   1,  Average loss: 0.0074, Accuracy: 4426/5066 (87.3668%), train_poison_data_count: 400
Global model norm: 43.276277354234445.
Norm before scaling: 43.28118513081781. Distance: 2.323226691343076
Total norm for 4 adversaries is: 43.28118513081781. distance: 2.323226691343076
___Test Local_ResNet_18 poisoned: True, epoch: 94: Average loss: 0.1899, Accuracy: 9394/9900 (94.8889%)
___Train Local_ResNet_18,  epoch  94, local model 78, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3545/4025 (88.0745%)
___Train Local_ResNet_18,  epoch  94, local model 78, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3730/4025 (92.6708%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 1.8034, Accuracy: 5695/10000 (56.9500%)
___Train Local_ResNet_18,  epoch  94, local model 27, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3712/4223 (87.8996%)
___Train Local_ResNet_18,  epoch  94, local model 27, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3857/4223 (91.3332%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.0002, Accuracy: 5427/10000 (54.2700%)
___Train Local_ResNet_18,  epoch  94, local model 76, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3136/3638 (86.2012%)
___Train Local_ResNet_18,  epoch  94, local model 76, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3324/3638 (91.3689%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.0397, Accuracy: 5374/10000 (53.7400%)
___Train Local_ResNet_18,  epoch  94, local model 62, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4416/5063 (87.2210%)
___Train Local_ResNet_18,  epoch  94, local model 62, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4486/5063 (88.6036%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.1419, Accuracy: 5250/10000 (52.5000%)
___Train Local_ResNet_18,  epoch  94, local model 82, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4217/4874 (86.5203%)
___Train Local_ResNet_18,  epoch  94, local model 82, internal_epoch   2,  Average loss: 0.0065, Accuracy: 4256/4874 (87.3205%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.2133, Accuracy: 5060/10000 (50.6000%)
___Train Local_ResNet_18,  epoch  94, local model 94, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4315/4804 (89.8210%)
___Train Local_ResNet_18,  epoch  94, local model 94, internal_epoch   2,  Average loss: 0.0070, Accuracy: 4184/4804 (87.0941%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.3275, Accuracy: 5128/10000 (51.2800%)
___Train Local_ResNet_18,  epoch  94, local model 91, internal_epoch   1,  Average loss: 0.0080, Accuracy: 3504/4158 (84.2713%)
___Train Local_ResNet_18,  epoch  94, local model 91, internal_epoch   2,  Average loss: 0.0066, Accuracy: 3628/4158 (87.2535%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 1.9731, Accuracy: 5438/10000 (54.3800%)
___Train Local_ResNet_18,  epoch  94, local model 34, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3977/4518 (88.0257%)
___Train Local_ResNet_18,  epoch  94, local model 34, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4153/4518 (91.9212%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 1.9748, Accuracy: 5382/10000 (53.8200%)
___Train Local_ResNet_18,  epoch  94, local model 73, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3723/4235 (87.9103%)
___Train Local_ResNet_18,  epoch  94, local model 73, internal_epoch   2,  Average loss: 0.0063, Accuracy: 3724/4235 (87.9339%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.0726, Accuracy: 5445/10000 (54.4500%)
___Train Local_ResNet_18,  epoch  94, local model 88, internal_epoch   1,  Average loss: 0.0074, Accuracy: 4252/4934 (86.1775%)
___Train Local_ResNet_18,  epoch  94, local model 88, internal_epoch   2,  Average loss: 0.0090, Accuracy: 4094/4934 (82.9753%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.2427, Accuracy: 4963/10000 (49.6300%)
___Train Local_ResNet_18,  epoch  94, local model 85, internal_epoch   1,  Average loss: 0.0078, Accuracy: 5429/6391 (84.9476%)
___Train Local_ResNet_18,  epoch  94, local model 85, internal_epoch   2,  Average loss: 0.0064, Accuracy: 5600/6391 (87.6232%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.1025, Accuracy: 5220/10000 (52.2000%)
___Train Local_ResNet_18,  epoch  94, local model 75, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3782/4295 (88.0559%)
___Train Local_ResNet_18,  epoch  94, local model 75, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3873/4295 (90.1746%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.0135, Accuracy: 5440/10000 (54.4000%)
___Train Local_ResNet_18,  epoch  94, local model 26, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3335/3756 (88.7913%)
___Train Local_ResNet_18,  epoch  94, local model 26, internal_epoch   2,  Average loss: 0.0036, Accuracy: 3509/3756 (93.4239%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 1.8906, Accuracy: 5723/10000 (57.2300%)
___Train Local_ResNet_18,  epoch  94, local model 7, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3925/4481 (87.5921%)
___Train Local_ResNet_18,  epoch  94, local model 7, internal_epoch   2,  Average loss: 0.0070, Accuracy: 3931/4481 (87.7260%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.0487, Accuracy: 5512/10000 (55.1200%)
___Train Local_ResNet_18,  epoch  94, local model 31, internal_epoch   1,  Average loss: 0.0075, Accuracy: 3574/4175 (85.6048%)
___Train Local_ResNet_18,  epoch  94, local model 31, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3696/4175 (88.5269%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 1.9241, Accuracy: 5548/10000 (55.4800%)
___Train Local_ResNet_18,  epoch  94, local model 63, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3141/3590 (87.4930%)
___Train Local_ResNet_18,  epoch  94, local model 63, internal_epoch   2,  Average loss: 0.0070, Accuracy: 3117/3590 (86.8245%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.1995, Accuracy: 5210/10000 (52.1000%)
time spent on training: 250.01818466186523
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 94: Average loss: 1.5509, Accuracy: 6329/10000 (63.2900%)
___Test Target_ResNet_18 poisoned: True, epoch: 94: Average loss: 9.4583, Accuracy: 149/9900 (1.5051%)
Done in 280.19603848457336 sec.
Server Epoch:95 choose agents : [13, 36, 58, 71, 98, 18, 90, 49, 96, 84, 67, 95, 81, 83, 31, 86, 7, 50, 38, 77].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  95, local model 13, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4374/4885 (89.5394%), train_poison_data_count: 385
Global model norm: 43.316672384259995.
Norm before scaling: 43.318604142374554. Distance: 2.1690966722077114
Total norm for 4 adversaries is: 43.318604142374554. distance: 2.1690966722077114
___Test Local_ResNet_18 poisoned: True, epoch: 95: Average loss: 0.2378, Accuracy: 9286/9900 (93.7980%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  95, local model 36, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4725/5305 (89.0669%), train_poison_data_count: 415
Global model norm: 43.316672384259995.
Norm before scaling: 43.31833361688501. Distance: 2.2383463319167625
Total norm for 4 adversaries is: 43.31833361688501. distance: 2.2383463319167625
___Test Local_ResNet_18 poisoned: True, epoch: 95: Average loss: 0.2500, Accuracy: 9287/9900 (93.8081%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  95, local model 58, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4192/4717 (88.8700%), train_poison_data_count: 370
Global model norm: 43.316672384259995.
Norm before scaling: 43.32032024909759. Distance: 2.110712602156866
Total norm for 4 adversaries is: 43.32032024909759. distance: 2.110712602156866
___Test Local_ResNet_18 poisoned: True, epoch: 95: Average loss: 0.1251, Accuracy: 9586/9900 (96.8283%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  95, local model 71, internal_epoch   1,  Average loss: 0.0074, Accuracy: 4426/5066 (87.3668%), train_poison_data_count: 400
Global model norm: 43.316672384259995.
Norm before scaling: 43.32445947801888. Distance: 2.3306406242274496
Total norm for 4 adversaries is: 43.32445947801888. distance: 2.3306406242274496
___Test Local_ResNet_18 poisoned: True, epoch: 95: Average loss: 0.2524, Accuracy: 9256/9900 (93.4949%)
___Train Local_ResNet_18,  epoch  95, local model 98, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3340/3828 (87.2518%)
___Train Local_ResNet_18,  epoch  95, local model 98, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3532/3828 (92.2675%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.8281, Accuracy: 5735/10000 (57.3500%)
___Train Local_ResNet_18,  epoch  95, local model 18, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3456/3911 (88.3661%)
___Train Local_ResNet_18,  epoch  95, local model 18, internal_epoch   2,  Average loss: 0.0068, Accuracy: 3388/3911 (86.6275%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 2.1073, Accuracy: 5324/10000 (53.2400%)
___Train Local_ResNet_18,  epoch  95, local model 90, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3910/4362 (89.6378%)
___Train Local_ResNet_18,  epoch  95, local model 90, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3995/4362 (91.5864%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.9429, Accuracy: 5446/10000 (54.4600%)
___Train Local_ResNet_18,  epoch  95, local model 49, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4600/5197 (88.5126%)
___Train Local_ResNet_18,  epoch  95, local model 49, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4573/5197 (87.9931%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 2.0469, Accuracy: 5345/10000 (53.4500%)
___Train Local_ResNet_18,  epoch  95, local model 96, internal_epoch   1,  Average loss: 0.0040, Accuracy: 4331/4679 (92.5625%)
___Train Local_ResNet_18,  epoch  95, local model 96, internal_epoch   2,  Average loss: 0.0037, Accuracy: 4355/4679 (93.0754%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.9913, Accuracy: 5496/10000 (54.9600%)
___Train Local_ResNet_18,  epoch  95, local model 84, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4138/4793 (86.3342%)
___Train Local_ResNet_18,  epoch  95, local model 84, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4303/4793 (89.7768%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 2.0034, Accuracy: 5482/10000 (54.8200%)
___Train Local_ResNet_18,  epoch  95, local model 67, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4413/5116 (86.2588%)
___Train Local_ResNet_18,  epoch  95, local model 67, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4584/5116 (89.6013%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 2.0491, Accuracy: 5409/10000 (54.0900%)
___Train Local_ResNet_18,  epoch  95, local model 95, internal_epoch   1,  Average loss: 0.0076, Accuracy: 3970/4625 (85.8378%)
___Train Local_ResNet_18,  epoch  95, local model 95, internal_epoch   2,  Average loss: 0.0062, Accuracy: 4063/4625 (87.8486%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 2.0410, Accuracy: 5358/10000 (53.5800%)
___Train Local_ResNet_18,  epoch  95, local model 81, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4085/4618 (88.4582%)
___Train Local_ResNet_18,  epoch  95, local model 81, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4153/4618 (89.9307%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 2.0271, Accuracy: 5412/10000 (54.1200%)
___Train Local_ResNet_18,  epoch  95, local model 83, internal_epoch   1,  Average loss: 0.0061, Accuracy: 2851/3271 (87.1599%)
___Train Local_ResNet_18,  epoch  95, local model 83, internal_epoch   2,  Average loss: 0.0045, Accuracy: 2989/3271 (91.3788%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.8493, Accuracy: 5644/10000 (56.4400%)
___Train Local_ResNet_18,  epoch  95, local model 31, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3635/4175 (87.0659%)
___Train Local_ResNet_18,  epoch  95, local model 31, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3728/4175 (89.2934%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.8787, Accuracy: 5590/10000 (55.9000%)
___Train Local_ResNet_18,  epoch  95, local model 86, internal_epoch   1,  Average loss: 0.0071, Accuracy: 3109/3616 (85.9790%)
___Train Local_ResNet_18,  epoch  95, local model 86, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3320/3616 (91.8142%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.8140, Accuracy: 5822/10000 (58.2200%)
___Train Local_ResNet_18,  epoch  95, local model 7, internal_epoch   1,  Average loss: 0.0073, Accuracy: 3907/4481 (87.1904%)
___Train Local_ResNet_18,  epoch  95, local model 7, internal_epoch   2,  Average loss: 0.0067, Accuracy: 4010/4481 (89.4890%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.9772, Accuracy: 5615/10000 (56.1500%)
___Train Local_ResNet_18,  epoch  95, local model 50, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3844/4368 (88.0037%)
___Train Local_ResNet_18,  epoch  95, local model 50, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3888/4368 (89.0110%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.8612, Accuracy: 5606/10000 (56.0600%)
___Train Local_ResNet_18,  epoch  95, local model 38, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4968/5740 (86.5505%)
___Train Local_ResNet_18,  epoch  95, local model 38, internal_epoch   2,  Average loss: 0.0049, Accuracy: 5167/5740 (90.0174%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 2.0738, Accuracy: 5334/10000 (53.3400%)
___Train Local_ResNet_18,  epoch  95, local model 77, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4024/4647 (86.5935%)
___Train Local_ResNet_18,  epoch  95, local model 77, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4195/4647 (90.2733%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.9386, Accuracy: 5499/10000 (54.9900%)
time spent on training: 265.3591253757477
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.5476, Accuracy: 6364/10000 (63.6400%)
___Test Target_ResNet_18 poisoned: True, epoch: 95: Average loss: 8.0907, Accuracy: 401/9900 (4.0505%)
Done in 295.9477252960205 sec.
Server Epoch:96 choose agents : [13, 36, 58, 71, 32, 46, 17, 69, 63, 84, 60, 39, 97, 62, 50, 96, 9, 72, 25, 27].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  96, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4396/4885 (89.9898%), train_poison_data_count: 385
Global model norm: 43.35064242017859.
Norm before scaling: 43.35061285340295. Distance: 2.1242185165444427
Total norm for 4 adversaries is: 43.35061285340295. distance: 2.1242185165444427
___Test Local_ResNet_18 poisoned: True, epoch: 96: Average loss: 0.2634, Accuracy: 9206/9900 (92.9899%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  96, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4774/5305 (89.9906%), train_poison_data_count: 415
Global model norm: 43.35064242017859.
Norm before scaling: 43.34398657109196. Distance: 2.1589801477011603
Total norm for 4 adversaries is: 43.34398657109196. distance: 2.1589801477011603
___Test Local_ResNet_18 poisoned: True, epoch: 96: Average loss: 0.2062, Accuracy: 9382/9900 (94.7677%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  96, local model 58, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4209/4717 (89.2304%), train_poison_data_count: 370
Global model norm: 43.35064242017859.
Norm before scaling: 43.35020877211478. Distance: 2.0538936575427025
Total norm for 4 adversaries is: 43.35020877211478. distance: 2.0538936575427025
___Test Local_ResNet_18 poisoned: True, epoch: 96: Average loss: 0.2001, Accuracy: 9390/9900 (94.8485%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  96, local model 71, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4442/5066 (87.6826%), train_poison_data_count: 400
Global model norm: 43.35064242017859.
Norm before scaling: 43.35750136717622. Distance: 2.2864967522546995
Total norm for 4 adversaries is: 43.35750136717622. distance: 2.2864967522546995
___Test Local_ResNet_18 poisoned: True, epoch: 96: Average loss: 0.1515, Accuracy: 9482/9900 (95.7778%)
___Train Local_ResNet_18,  epoch  96, local model 32, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4847/5591 (86.6929%)
___Train Local_ResNet_18,  epoch  96, local model 32, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4897/5591 (87.5872%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.1949, Accuracy: 5191/10000 (51.9100%)
___Train Local_ResNet_18,  epoch  96, local model 46, internal_epoch   1,  Average loss: 0.0078, Accuracy: 4216/4956 (85.0686%)
___Train Local_ResNet_18,  epoch  96, local model 46, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4353/4956 (87.8329%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 1.9729, Accuracy: 5408/10000 (54.0800%)
___Train Local_ResNet_18,  epoch  96, local model 17, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3897/4511 (86.3888%)
___Train Local_ResNet_18,  epoch  96, local model 17, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4091/4511 (90.6894%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 1.9435, Accuracy: 5527/10000 (55.2700%)
___Train Local_ResNet_18,  epoch  96, local model 69, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3566/4013 (88.8612%)
___Train Local_ResNet_18,  epoch  96, local model 69, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3695/4013 (92.0758%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 1.8113, Accuracy: 5729/10000 (57.2900%)
___Train Local_ResNet_18,  epoch  96, local model 63, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3171/3590 (88.3287%)
___Train Local_ResNet_18,  epoch  96, local model 63, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3321/3590 (92.5070%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 1.9266, Accuracy: 5718/10000 (57.1800%)
___Train Local_ResNet_18,  epoch  96, local model 84, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4124/4793 (86.0421%)
___Train Local_ResNet_18,  epoch  96, local model 84, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4330/4793 (90.3401%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.0439, Accuracy: 5421/10000 (54.2100%)
___Train Local_ResNet_18,  epoch  96, local model 60, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3321/3804 (87.3028%)
___Train Local_ResNet_18,  epoch  96, local model 60, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3413/3804 (89.7213%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 1.9462, Accuracy: 5491/10000 (54.9100%)
___Train Local_ResNet_18,  epoch  96, local model 39, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3374/3837 (87.9333%)
___Train Local_ResNet_18,  epoch  96, local model 39, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3553/3837 (92.5984%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 1.8833, Accuracy: 5623/10000 (56.2300%)
___Train Local_ResNet_18,  epoch  96, local model 97, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3872/4361 (88.7870%)
___Train Local_ResNet_18,  epoch  96, local model 97, internal_epoch   2,  Average loss: 0.0059, Accuracy: 3855/4361 (88.3972%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.1930, Accuracy: 5224/10000 (52.2400%)
___Train Local_ResNet_18,  epoch  96, local model 62, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4449/5063 (87.8728%)
___Train Local_ResNet_18,  epoch  96, local model 62, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4459/5063 (88.0703%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.2940, Accuracy: 5014/10000 (50.1400%)
___Train Local_ResNet_18,  epoch  96, local model 50, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3786/4368 (86.6758%)
___Train Local_ResNet_18,  epoch  96, local model 50, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3881/4368 (88.8507%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.0606, Accuracy: 5307/10000 (53.0700%)
___Train Local_ResNet_18,  epoch  96, local model 96, internal_epoch   1,  Average loss: 0.0041, Accuracy: 4335/4679 (92.6480%)
___Train Local_ResNet_18,  epoch  96, local model 96, internal_epoch   2,  Average loss: 0.0065, Accuracy: 4101/4679 (87.6469%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.0880, Accuracy: 5379/10000 (53.7900%)
___Train Local_ResNet_18,  epoch  96, local model 9, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4589/5265 (87.1605%)
___Train Local_ResNet_18,  epoch  96, local model 9, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4657/5265 (88.4520%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.0476, Accuracy: 5343/10000 (53.4300%)
___Train Local_ResNet_18,  epoch  96, local model 72, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4120/4767 (86.4275%)
___Train Local_ResNet_18,  epoch  96, local model 72, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4233/4767 (88.7980%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.0797, Accuracy: 5379/10000 (53.7900%)
___Train Local_ResNet_18,  epoch  96, local model 25, internal_epoch   1,  Average loss: 0.0066, Accuracy: 5198/5902 (88.0718%)
___Train Local_ResNet_18,  epoch  96, local model 25, internal_epoch   2,  Average loss: 0.0077, Accuracy: 5004/5902 (84.7848%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.2554, Accuracy: 5097/10000 (50.9700%)
___Train Local_ResNet_18,  epoch  96, local model 27, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3695/4223 (87.4970%)
___Train Local_ResNet_18,  epoch  96, local model 27, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3870/4223 (91.6410%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 1.9800, Accuracy: 5545/10000 (55.4500%)
time spent on training: 277.3858816623688
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 96: Average loss: 1.5252, Accuracy: 6360/10000 (63.6000%)
___Test Target_ResNet_18 poisoned: True, epoch: 96: Average loss: 8.4130, Accuracy: 331/9900 (3.3434%)
Done in 307.90751242637634 sec.
Server Epoch:97 choose agents : [13, 36, 58, 71, 52, 14, 47, 34, 69, 35, 24, 48, 57, 99, 76, 6, 38, 39, 97, 84].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  97, local model 13, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4395/4885 (89.9693%), train_poison_data_count: 385
Global model norm: 43.39779125868979.
Norm before scaling: 43.3936927818109. Distance: 2.063799015528247
Total norm for 4 adversaries is: 43.3936927818109. distance: 2.063799015528247
___Test Local_ResNet_18 poisoned: True, epoch: 97: Average loss: 0.3063, Accuracy: 9125/9900 (92.1717%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  97, local model 36, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4717/5305 (88.9161%), train_poison_data_count: 415
Global model norm: 43.39779125868979.
Norm before scaling: 43.39831444064461. Distance: 2.232928574830415
Total norm for 4 adversaries is: 43.39831444064461. distance: 2.232928574830415
___Test Local_ResNet_18 poisoned: True, epoch: 97: Average loss: 0.2422, Accuracy: 9248/9900 (93.4141%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  97, local model 58, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4211/4717 (89.2728%), train_poison_data_count: 370
Global model norm: 43.39779125868979.
Norm before scaling: 43.393870006045354. Distance: 2.032866201783641
Total norm for 4 adversaries is: 43.393870006045354. distance: 2.032866201783641
___Test Local_ResNet_18 poisoned: True, epoch: 97: Average loss: 0.2130, Accuracy: 9339/9900 (94.3333%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  97, local model 71, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4438/5066 (87.6036%), train_poison_data_count: 400
Global model norm: 43.39779125868979.
Norm before scaling: 43.40282592011219. Distance: 2.302848780720622
Total norm for 4 adversaries is: 43.40282592011219. distance: 2.302848780720622
___Test Local_ResNet_18 poisoned: True, epoch: 97: Average loss: 0.1419, Accuracy: 9531/9900 (96.2727%)
___Train Local_ResNet_18,  epoch  97, local model 52, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3371/3797 (88.7806%)
___Train Local_ResNet_18,  epoch  97, local model 52, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3424/3797 (90.1765%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.9445, Accuracy: 5452/10000 (54.5200%)
___Train Local_ResNet_18,  epoch  97, local model 14, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3366/3861 (87.1795%)
___Train Local_ResNet_18,  epoch  97, local model 14, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3480/3861 (90.1321%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.9737, Accuracy: 5480/10000 (54.8000%)
___Train Local_ResNet_18,  epoch  97, local model 47, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4163/4707 (88.4427%)
___Train Local_ResNet_18,  epoch  97, local model 47, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4286/4707 (91.0559%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 2.0468, Accuracy: 5322/10000 (53.2200%)
___Train Local_ResNet_18,  epoch  97, local model 34, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4017/4518 (88.9110%)
___Train Local_ResNet_18,  epoch  97, local model 34, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4163/4518 (92.1425%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 2.0936, Accuracy: 5345/10000 (53.4500%)
___Train Local_ResNet_18,  epoch  97, local model 69, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3574/4013 (89.0606%)
___Train Local_ResNet_18,  epoch  97, local model 69, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3667/4013 (91.3780%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.9317, Accuracy: 5523/10000 (55.2300%)
___Train Local_ResNet_18,  epoch  97, local model 35, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4580/5167 (88.6394%)
___Train Local_ResNet_18,  epoch  97, local model 35, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4670/5167 (90.3813%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 2.1924, Accuracy: 5199/10000 (51.9900%)
___Train Local_ResNet_18,  epoch  97, local model 24, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3487/3969 (87.8559%)
___Train Local_ResNet_18,  epoch  97, local model 24, internal_epoch   2,  Average loss: 0.0057, Accuracy: 3613/3969 (91.0305%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.8968, Accuracy: 5790/10000 (57.9000%)
___Train Local_ResNet_18,  epoch  97, local model 48, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3961/4441 (89.1916%)
___Train Local_ResNet_18,  epoch  97, local model 48, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4085/4441 (91.9838%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 2.0620, Accuracy: 5495/10000 (54.9500%)
___Train Local_ResNet_18,  epoch  97, local model 57, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3996/4558 (87.6700%)
___Train Local_ResNet_18,  epoch  97, local model 57, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4091/4558 (89.7543%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 2.0517, Accuracy: 5339/10000 (53.3900%)
___Train Local_ResNet_18,  epoch  97, local model 99, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3904/4465 (87.4356%)
___Train Local_ResNet_18,  epoch  97, local model 99, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4148/4465 (92.9003%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.8042, Accuracy: 5782/10000 (57.8200%)
___Train Local_ResNet_18,  epoch  97, local model 76, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3178/3638 (87.3557%)
___Train Local_ResNet_18,  epoch  97, local model 76, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3313/3638 (91.0665%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.8279, Accuracy: 5661/10000 (56.6100%)
___Train Local_ResNet_18,  epoch  97, local model 6, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4038/4538 (88.9819%)
___Train Local_ResNet_18,  epoch  97, local model 6, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4189/4538 (92.3094%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.8644, Accuracy: 5658/10000 (56.5800%)
___Train Local_ResNet_18,  epoch  97, local model 38, internal_epoch   1,  Average loss: 0.0064, Accuracy: 5048/5740 (87.9443%)
___Train Local_ResNet_18,  epoch  97, local model 38, internal_epoch   2,  Average loss: 0.0045, Accuracy: 5230/5740 (91.1150%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 2.1727, Accuracy: 5303/10000 (53.0300%)
___Train Local_ResNet_18,  epoch  97, local model 39, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3358/3837 (87.5163%)
___Train Local_ResNet_18,  epoch  97, local model 39, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3531/3837 (92.0250%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.8351, Accuracy: 5663/10000 (56.6300%)
___Train Local_ResNet_18,  epoch  97, local model 97, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3881/4361 (88.9934%)
___Train Local_ResNet_18,  epoch  97, local model 97, internal_epoch   2,  Average loss: 0.0074, Accuracy: 3732/4361 (85.5767%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.9363, Accuracy: 5391/10000 (53.9100%)
___Train Local_ResNet_18,  epoch  97, local model 84, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4174/4793 (87.0853%)
___Train Local_ResNet_18,  epoch  97, local model 84, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4335/4793 (90.4444%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 2.0577, Accuracy: 5364/10000 (53.6400%)
time spent on training: 261.151300907135
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.5040, Accuracy: 6369/10000 (63.6900%)
___Test Target_ResNet_18 poisoned: True, epoch: 97: Average loss: 8.5023, Accuracy: 295/9900 (2.9798%)
Done in 291.79367184638977 sec.
Server Epoch:98 choose agents : [13, 36, 58, 71, 72, 48, 55, 85, 23, 29, 45, 21, 88, 42, 79, 14, 65, 33, 35, 63].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  98, local model 13, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4372/4885 (89.4985%), train_poison_data_count: 385
Global model norm: 43.43045272194169.
Norm before scaling: 43.42794128190254. Distance: 2.1019990035180833
Total norm for 4 adversaries is: 43.42794128190254. distance: 2.1019990035180833
___Test Local_ResNet_18 poisoned: True, epoch: 98: Average loss: 0.1906, Accuracy: 9405/9900 (95.0000%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  98, local model 36, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4734/5305 (89.2366%), train_poison_data_count: 415
Global model norm: 43.43045272194169.
Norm before scaling: 43.427384726006984. Distance: 2.1964841275161584
Total norm for 4 adversaries is: 43.427384726006984. distance: 2.1964841275161584
___Test Local_ResNet_18 poisoned: True, epoch: 98: Average loss: 0.1512, Accuracy: 9523/9900 (96.1919%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  98, local model 58, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4228/4717 (89.6332%), train_poison_data_count: 370
Global model norm: 43.43045272194169.
Norm before scaling: 43.426398086662104. Distance: 2.029554510421611
Total norm for 4 adversaries is: 43.426398086662104. distance: 2.029554510421611
___Test Local_ResNet_18 poisoned: True, epoch: 98: Average loss: 0.1716, Accuracy: 9442/9900 (95.3737%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  98, local model 71, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4446/5066 (87.7615%), train_poison_data_count: 400
Global model norm: 43.43045272194169.
Norm before scaling: 43.43227261711618. Distance: 2.237710770211241
Total norm for 4 adversaries is: 43.43227261711618. distance: 2.237710770211241
___Test Local_ResNet_18 poisoned: True, epoch: 98: Average loss: 0.3259, Accuracy: 9080/9900 (91.7172%)
___Train Local_ResNet_18,  epoch  98, local model 72, internal_epoch   1,  Average loss: 0.0073, Accuracy: 4101/4767 (86.0289%)
___Train Local_ResNet_18,  epoch  98, local model 72, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4216/4767 (88.4414%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.1584, Accuracy: 5256/10000 (52.5600%)
___Train Local_ResNet_18,  epoch  98, local model 48, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3962/4441 (89.2141%)
___Train Local_ResNet_18,  epoch  98, local model 48, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4074/4441 (91.7361%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.1213, Accuracy: 5386/10000 (53.8600%)
___Train Local_ResNet_18,  epoch  98, local model 55, internal_epoch   1,  Average loss: 0.0030, Accuracy: 4136/4356 (94.9495%)
___Train Local_ResNet_18,  epoch  98, local model 55, internal_epoch   2,  Average loss: 0.0036, Accuracy: 4128/4356 (94.7658%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 1.9656, Accuracy: 5660/10000 (56.6000%)
___Train Local_ResNet_18,  epoch  98, local model 85, internal_epoch   1,  Average loss: 0.0074, Accuracy: 5451/6391 (85.2918%)
___Train Local_ResNet_18,  epoch  98, local model 85, internal_epoch   2,  Average loss: 0.0065, Accuracy: 5576/6391 (87.2477%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.1945, Accuracy: 5031/10000 (50.3100%)
___Train Local_ResNet_18,  epoch  98, local model 23, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3698/4184 (88.3843%)
___Train Local_ResNet_18,  epoch  98, local model 23, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3775/4184 (90.2247%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.0675, Accuracy: 5307/10000 (53.0700%)
___Train Local_ResNet_18,  epoch  98, local model 29, internal_epoch   1,  Average loss: 0.0052, Accuracy: 3911/4346 (89.9908%)
___Train Local_ResNet_18,  epoch  98, local model 29, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4002/4346 (92.0847%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 1.8383, Accuracy: 5731/10000 (57.3100%)
___Train Local_ResNet_18,  epoch  98, local model 45, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4355/5037 (86.4602%)
___Train Local_ResNet_18,  epoch  98, local model 45, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4570/5037 (90.7286%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.0523, Accuracy: 5392/10000 (53.9200%)
___Train Local_ResNet_18,  epoch  98, local model 21, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4071/4634 (87.8507%)
___Train Local_ResNet_18,  epoch  98, local model 21, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4226/4634 (91.1955%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 1.8887, Accuracy: 5592/10000 (55.9200%)
___Train Local_ResNet_18,  epoch  98, local model 88, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4356/4934 (88.2854%)
___Train Local_ResNet_18,  epoch  98, local model 88, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4383/4934 (88.8326%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.1310, Accuracy: 5212/10000 (52.1200%)
___Train Local_ResNet_18,  epoch  98, local model 42, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4796/5424 (88.4218%)
___Train Local_ResNet_18,  epoch  98, local model 42, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4898/5424 (90.3024%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.0120, Accuracy: 5457/10000 (54.5700%)
___Train Local_ResNet_18,  epoch  98, local model 79, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3352/3781 (88.6538%)
___Train Local_ResNet_18,  epoch  98, local model 79, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3385/3781 (89.5266%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.0380, Accuracy: 5306/10000 (53.0600%)
___Train Local_ResNet_18,  epoch  98, local model 14, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3381/3861 (87.5680%)
___Train Local_ResNet_18,  epoch  98, local model 14, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3461/3861 (89.6400%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 1.9176, Accuracy: 5564/10000 (55.6400%)
___Train Local_ResNet_18,  epoch  98, local model 65, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4498/5055 (88.9812%)
___Train Local_ResNet_18,  epoch  98, local model 65, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4644/5055 (91.8694%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 1.9166, Accuracy: 5606/10000 (56.0600%)
___Train Local_ResNet_18,  epoch  98, local model 33, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3934/4433 (88.7435%)
___Train Local_ResNet_18,  epoch  98, local model 33, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4030/4433 (90.9091%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 1.8219, Accuracy: 5753/10000 (57.5300%)
___Train Local_ResNet_18,  epoch  98, local model 35, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4576/5167 (88.5620%)
___Train Local_ResNet_18,  epoch  98, local model 35, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4694/5167 (90.8458%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.1256, Accuracy: 5310/10000 (53.1000%)
___Train Local_ResNet_18,  epoch  98, local model 63, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3189/3590 (88.8301%)
___Train Local_ResNet_18,  epoch  98, local model 63, internal_epoch   2,  Average loss: 0.0061, Accuracy: 3174/3590 (88.4123%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.0614, Accuracy: 5466/10000 (54.6600%)
time spent on training: 267.96143984794617
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 98: Average loss: 1.4561, Accuracy: 6467/10000 (64.6700%)
___Test Target_ResNet_18 poisoned: True, epoch: 98: Average loss: 8.4046, Accuracy: 312/9900 (3.1515%)
Done in 298.3796167373657 sec.
Server Epoch:99 choose agents : [13, 36, 58, 71, 50, 98, 55, 14, 30, 6, 70, 75, 73, 66, 9, 48, 69, 99, 92, 1].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  99, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4391/4885 (89.8874%), train_poison_data_count: 385
Global model norm: 43.476943647251126.
Norm before scaling: 43.47601007622983. Distance: 2.129413173412865
Total norm for 4 adversaries is: 43.47601007622983. distance: 2.129413173412865
___Test Local_ResNet_18 poisoned: True, epoch: 99: Average loss: 0.2436, Accuracy: 9303/9900 (93.9697%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  99, local model 36, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4772/5305 (89.9529%), train_poison_data_count: 415
Global model norm: 43.476943647251126.
Norm before scaling: 43.47490520763099. Distance: 2.133732523922007
Total norm for 4 adversaries is: 43.47490520763099. distance: 2.133732523922007
___Test Local_ResNet_18 poisoned: True, epoch: 99: Average loss: 0.2939, Accuracy: 9182/9900 (92.7475%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  99, local model 58, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4221/4717 (89.4848%), train_poison_data_count: 370
Global model norm: 43.476943647251126.
Norm before scaling: 43.47398844019764. Distance: 2.0340282513842327
Total norm for 4 adversaries is: 43.47398844019764. distance: 2.0340282513842327
___Test Local_ResNet_18 poisoned: True, epoch: 99: Average loss: 0.1713, Accuracy: 9464/9900 (95.5960%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  99, local model 71, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4473/5066 (88.2945%), train_poison_data_count: 400
Global model norm: 43.476943647251126.
Norm before scaling: 43.48078862546294. Distance: 2.254695866411301
Total norm for 4 adversaries is: 43.48078862546294. distance: 2.254695866411301
___Test Local_ResNet_18 poisoned: True, epoch: 99: Average loss: 0.1776, Accuracy: 9480/9900 (95.7576%)
___Train Local_ResNet_18,  epoch  99, local model 50, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3831/4368 (87.7060%)
___Train Local_ResNet_18,  epoch  99, local model 50, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3967/4368 (90.8196%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.9906, Accuracy: 5445/10000 (54.4500%)
___Train Local_ResNet_18,  epoch  99, local model 98, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3366/3828 (87.9310%)
___Train Local_ResNet_18,  epoch  99, local model 98, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3516/3828 (91.8495%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.7534, Accuracy: 5876/10000 (58.7600%)
___Train Local_ResNet_18,  epoch  99, local model 55, internal_epoch   1,  Average loss: 0.0033, Accuracy: 4146/4356 (95.1791%)
___Train Local_ResNet_18,  epoch  99, local model 55, internal_epoch   2,  Average loss: 0.0065, Accuracy: 3831/4356 (87.9477%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 2.1205, Accuracy: 5281/10000 (52.8100%)
___Train Local_ResNet_18,  epoch  99, local model 14, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3377/3861 (87.4644%)
___Train Local_ResNet_18,  epoch  99, local model 14, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3494/3861 (90.4947%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.9510, Accuracy: 5562/10000 (55.6200%)
___Train Local_ResNet_18,  epoch  99, local model 30, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3075/3472 (88.5657%)
___Train Local_ResNet_18,  epoch  99, local model 30, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3208/3472 (92.3963%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 2.0229, Accuracy: 5417/10000 (54.1700%)
___Train Local_ResNet_18,  epoch  99, local model 6, internal_epoch   1,  Average loss: 0.0052, Accuracy: 4080/4538 (89.9074%)
___Train Local_ResNet_18,  epoch  99, local model 6, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4217/4538 (92.9264%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.8612, Accuracy: 5717/10000 (57.1700%)
___Train Local_ResNet_18,  epoch  99, local model 70, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4758/5392 (88.2418%)
___Train Local_ResNet_18,  epoch  99, local model 70, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4867/5392 (90.2634%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 2.0200, Accuracy: 5442/10000 (54.4200%)
___Train Local_ResNet_18,  epoch  99, local model 75, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3829/4295 (89.1502%)
___Train Local_ResNet_18,  epoch  99, local model 75, internal_epoch   2,  Average loss: 0.0066, Accuracy: 3762/4295 (87.5902%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.9453, Accuracy: 5495/10000 (54.9500%)
___Train Local_ResNet_18,  epoch  99, local model 73, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3736/4235 (88.2172%)
___Train Local_ResNet_18,  epoch  99, local model 73, internal_epoch   2,  Average loss: 0.0055, Accuracy: 3808/4235 (89.9174%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.9646, Accuracy: 5546/10000 (55.4600%)
___Train Local_ResNet_18,  epoch  99, local model 66, internal_epoch   1,  Average loss: 0.0053, Accuracy: 4012/4456 (90.0359%)
___Train Local_ResNet_18,  epoch  99, local model 66, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4059/4456 (91.0907%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.9071, Accuracy: 5667/10000 (56.6700%)
___Train Local_ResNet_18,  epoch  99, local model 9, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4579/5265 (86.9706%)
___Train Local_ResNet_18,  epoch  99, local model 9, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4683/5265 (88.9459%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 2.0635, Accuracy: 5358/10000 (53.5800%)
___Train Local_ResNet_18,  epoch  99, local model 48, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3998/4441 (90.0248%)
___Train Local_ResNet_18,  epoch  99, local model 48, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4070/4441 (91.6460%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 2.0426, Accuracy: 5476/10000 (54.7600%)
___Train Local_ResNet_18,  epoch  99, local model 69, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3596/4013 (89.6088%)
___Train Local_ResNet_18,  epoch  99, local model 69, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3716/4013 (92.5991%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.7504, Accuracy: 5828/10000 (58.2800%)
___Train Local_ResNet_18,  epoch  99, local model 99, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3937/4465 (88.1747%)
___Train Local_ResNet_18,  epoch  99, local model 99, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4090/4465 (91.6013%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.8547, Accuracy: 5710/10000 (57.1000%)
___Train Local_ResNet_18,  epoch  99, local model 92, internal_epoch   1,  Average loss: 0.0062, Accuracy: 5538/6263 (88.4241%)
___Train Local_ResNet_18,  epoch  99, local model 92, internal_epoch   2,  Average loss: 0.0048, Accuracy: 5668/6263 (90.4998%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.9906, Accuracy: 5365/10000 (53.6500%)
___Train Local_ResNet_18,  epoch  99, local model 1, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4386/4986 (87.9663%)
___Train Local_ResNet_18,  epoch  99, local model 1, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4505/4986 (90.3530%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.9087, Accuracy: 5701/10000 (57.0100%)
time spent on training: 264.4995596408844
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.4832, Accuracy: 6410/10000 (64.1000%)
___Test Target_ResNet_18 poisoned: True, epoch: 99: Average loss: 8.5127, Accuracy: 232/9900 (2.3434%)
Done in 294.6955814361572 sec.
Server Epoch:100 choose agents : [13, 36, 58, 71, 91, 35, 98, 10, 33, 23, 28, 27, 96, 4, 39, 14, 42, 43, 78, 51].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 100, local model 13, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4376/4885 (89.5803%), train_poison_data_count: 385
Global model norm: 43.507653275655855.
Norm before scaling: 43.50798996080705. Distance: 2.144238728235112
Total norm for 4 adversaries is: 43.50798996080705. distance: 2.144238728235112
___Test Local_ResNet_18 poisoned: True, epoch: 100: Average loss: 0.1903, Accuracy: 9412/9900 (95.0707%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 100, local model 36, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4757/5305 (89.6701%), train_poison_data_count: 415
Global model norm: 43.507653275655855.
Norm before scaling: 43.50864789218633. Distance: 2.2020962524997487
Total norm for 4 adversaries is: 43.50864789218633. distance: 2.2020962524997487
___Test Local_ResNet_18 poisoned: True, epoch: 100: Average loss: 0.1524, Accuracy: 9535/9900 (96.3131%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 100, local model 58, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4215/4717 (89.3576%), train_poison_data_count: 370
Global model norm: 43.507653275655855.
Norm before scaling: 43.50241888928419. Distance: 2.0226540245376903
Total norm for 4 adversaries is: 43.50241888928419. distance: 2.0226540245376903
___Test Local_ResNet_18 poisoned: True, epoch: 100: Average loss: 0.1952, Accuracy: 9403/9900 (94.9798%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 100, local model 71, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4456/5066 (87.9589%), train_poison_data_count: 400
Global model norm: 43.507653275655855.
Norm before scaling: 43.51097512185503. Distance: 2.273538069450557
Total norm for 4 adversaries is: 43.51097512185503. distance: 2.273538069450557
___Test Local_ResNet_18 poisoned: True, epoch: 100: Average loss: 0.1734, Accuracy: 9459/9900 (95.5455%)
___Train Local_ResNet_18,  epoch 100, local model 91, internal_epoch   1,  Average loss: 0.0074, Accuracy: 3551/4158 (85.4016%)
___Train Local_ResNet_18,  epoch 100, local model 91, internal_epoch   2,  Average loss: 0.0063, Accuracy: 3638/4158 (87.4940%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.9848, Accuracy: 5392/10000 (53.9200%)
___Train Local_ResNet_18,  epoch 100, local model 35, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4539/5167 (87.8459%)
___Train Local_ResNet_18,  epoch 100, local model 35, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4648/5167 (89.9555%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 2.0646, Accuracy: 5343/10000 (53.4300%)
___Train Local_ResNet_18,  epoch 100, local model 98, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3358/3828 (87.7220%)
___Train Local_ResNet_18,  epoch 100, local model 98, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3450/3828 (90.1254%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.8996, Accuracy: 5595/10000 (55.9500%)
___Train Local_ResNet_18,  epoch 100, local model 10, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4134/4663 (88.6554%)
___Train Local_ResNet_18,  epoch 100, local model 10, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4266/4663 (91.4862%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 2.0570, Accuracy: 5351/10000 (53.5100%)
___Train Local_ResNet_18,  epoch 100, local model 33, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3934/4433 (88.7435%)
___Train Local_ResNet_18,  epoch 100, local model 33, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4067/4433 (91.7437%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.8622, Accuracy: 5727/10000 (57.2700%)
___Train Local_ResNet_18,  epoch 100, local model 23, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3671/4184 (87.7390%)
___Train Local_ResNet_18,  epoch 100, local model 23, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3781/4184 (90.3681%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.9048, Accuracy: 5626/10000 (56.2600%)
___Train Local_ResNet_18,  epoch 100, local model 28, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4102/4716 (86.9805%)
___Train Local_ResNet_18,  epoch 100, local model 28, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4207/4716 (89.2070%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 2.0757, Accuracy: 5295/10000 (52.9500%)
___Train Local_ResNet_18,  epoch 100, local model 27, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3742/4223 (88.6100%)
___Train Local_ResNet_18,  epoch 100, local model 27, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3879/4223 (91.8541%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.8969, Accuracy: 5658/10000 (56.5800%)
___Train Local_ResNet_18,  epoch 100, local model 96, internal_epoch   1,  Average loss: 0.0044, Accuracy: 4303/4679 (91.9641%)
___Train Local_ResNet_18,  epoch 100, local model 96, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4168/4679 (89.0789%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 2.1558, Accuracy: 5202/10000 (52.0200%)
___Train Local_ResNet_18,  epoch 100, local model 4, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3192/3704 (86.1771%)
___Train Local_ResNet_18,  epoch 100, local model 4, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3337/3704 (90.0918%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.8272, Accuracy: 5657/10000 (56.5700%)
___Train Local_ResNet_18,  epoch 100, local model 39, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3371/3837 (87.8551%)
___Train Local_ResNet_18,  epoch 100, local model 39, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3523/3837 (91.8165%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.9025, Accuracy: 5659/10000 (56.5900%)
___Train Local_ResNet_18,  epoch 100, local model 14, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3400/3861 (88.0601%)
___Train Local_ResNet_18,  epoch 100, local model 14, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3484/3861 (90.2357%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.9373, Accuracy: 5647/10000 (56.4700%)
___Train Local_ResNet_18,  epoch 100, local model 42, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4816/5424 (88.7906%)
___Train Local_ResNet_18,  epoch 100, local model 42, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4896/5424 (90.2655%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 2.1531, Accuracy: 5256/10000 (52.5600%)
___Train Local_ResNet_18,  epoch 100, local model 43, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4050/4576 (88.5052%)
___Train Local_ResNet_18,  epoch 100, local model 43, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4193/4576 (91.6302%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.8760, Accuracy: 5678/10000 (56.7800%)
___Train Local_ResNet_18,  epoch 100, local model 78, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3601/4025 (89.4658%)
___Train Local_ResNet_18,  epoch 100, local model 78, internal_epoch   2,  Average loss: 0.0035, Accuracy: 3771/4025 (93.6894%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.8215, Accuracy: 5715/10000 (57.1500%)
___Train Local_ResNet_18,  epoch 100, local model 51, internal_epoch   1,  Average loss: 0.0052, Accuracy: 3390/3775 (89.8013%)
___Train Local_ResNet_18,  epoch 100, local model 51, internal_epoch   2,  Average loss: 0.0034, Accuracy: 3530/3775 (93.5099%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.8432, Accuracy: 5753/10000 (57.5300%)
time spent on training: 259.128808259964
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.4678, Accuracy: 6414/10000 (64.1400%)
___Test Target_ResNet_18 poisoned: True, epoch: 100: Average loss: 8.7152, Accuracy: 188/9900 (1.8990%)
Done in 289.6723771095276 sec.
Server Epoch:101 choose agents : [13, 36, 58, 71, 43, 87, 81, 6, 80, 63, 47, 3, 41, 25, 48, 22, 94, 24, 70, 98].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 101, local model 13, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4392/4885 (89.9079%), train_poison_data_count: 385
Global model norm: 43.53719730102209.
Norm before scaling: 43.53490792465068. Distance: 2.0900208014954287
Total norm for 4 adversaries is: 43.53490792465068. distance: 2.0900208014954287
___Test Local_ResNet_18 poisoned: True, epoch: 101: Average loss: 0.2313, Accuracy: 9324/9900 (94.1818%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 101, local model 36, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4727/5305 (89.1046%), train_poison_data_count: 415
Global model norm: 43.53719730102209.
Norm before scaling: 43.535875281466865. Distance: 2.221533842225254
Total norm for 4 adversaries is: 43.535875281466865. distance: 2.221533842225254
___Test Local_ResNet_18 poisoned: True, epoch: 101: Average loss: 0.2764, Accuracy: 9181/9900 (92.7374%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 101, local model 58, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4239/4717 (89.8664%), train_poison_data_count: 370
Global model norm: 43.53719730102209.
Norm before scaling: 43.53323953412998. Distance: 1.981886737924665
Total norm for 4 adversaries is: 43.53323953412998. distance: 1.981886737924665
___Test Local_ResNet_18 poisoned: True, epoch: 101: Average loss: 0.2564, Accuracy: 9288/9900 (93.8182%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 101, local model 71, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4502/5066 (88.8670%), train_poison_data_count: 400
Global model norm: 43.53719730102209.
Norm before scaling: 43.53803563408666. Distance: 2.2356278968218515
Total norm for 4 adversaries is: 43.53803563408666. distance: 2.2356278968218515
___Test Local_ResNet_18 poisoned: True, epoch: 101: Average loss: 0.0545, Accuracy: 9737/9900 (98.3535%)
___Train Local_ResNet_18,  epoch 101, local model 43, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4061/4576 (88.7456%)
___Train Local_ResNet_18,  epoch 101, local model 43, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4208/4576 (91.9580%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.9181, Accuracy: 5655/10000 (56.5500%)
___Train Local_ResNet_18,  epoch 101, local model 87, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3225/3672 (87.8268%)
___Train Local_ResNet_18,  epoch 101, local model 87, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3390/3672 (92.3203%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.9681, Accuracy: 5470/10000 (54.7000%)
___Train Local_ResNet_18,  epoch 101, local model 81, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4139/4618 (89.6275%)
___Train Local_ResNet_18,  epoch 101, local model 81, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4105/4618 (88.8913%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 2.0095, Accuracy: 5379/10000 (53.7900%)
___Train Local_ResNet_18,  epoch 101, local model 6, internal_epoch   1,  Average loss: 0.0053, Accuracy: 4071/4538 (89.7091%)
___Train Local_ResNet_18,  epoch 101, local model 6, internal_epoch   2,  Average loss: 0.0037, Accuracy: 4229/4538 (93.1908%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.8059, Accuracy: 5799/10000 (57.9900%)
___Train Local_ResNet_18,  epoch 101, local model 80, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4433/5025 (88.2189%)
___Train Local_ResNet_18,  epoch 101, local model 80, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4571/5025 (90.9652%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 2.1173, Accuracy: 5441/10000 (54.4100%)
___Train Local_ResNet_18,  epoch 101, local model 63, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3198/3590 (89.0808%)
___Train Local_ResNet_18,  epoch 101, local model 63, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3257/3590 (90.7242%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.9656, Accuracy: 5539/10000 (55.3900%)
___Train Local_ResNet_18,  epoch 101, local model 47, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4155/4707 (88.2728%)
___Train Local_ResNet_18,  epoch 101, local model 47, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4311/4707 (91.5870%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.9813, Accuracy: 5487/10000 (54.8700%)
___Train Local_ResNet_18,  epoch 101, local model 3, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4339/4918 (88.2269%)
___Train Local_ResNet_18,  epoch 101, local model 3, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4446/4918 (90.4026%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.9255, Accuracy: 5508/10000 (55.0800%)
___Train Local_ResNet_18,  epoch 101, local model 41, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3863/4336 (89.0913%)
___Train Local_ResNet_18,  epoch 101, local model 41, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3963/4336 (91.3976%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 2.0006, Accuracy: 5414/10000 (54.1400%)
___Train Local_ResNet_18,  epoch 101, local model 25, internal_epoch   1,  Average loss: 0.0051, Accuracy: 5306/5902 (89.9017%)
___Train Local_ResNet_18,  epoch 101, local model 25, internal_epoch   2,  Average loss: 0.0055, Accuracy: 5260/5902 (89.1223%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 2.0945, Accuracy: 5336/10000 (53.3600%)
___Train Local_ResNet_18,  epoch 101, local model 48, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3964/4441 (89.2592%)
___Train Local_ResNet_18,  epoch 101, local model 48, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4087/4441 (92.0288%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 2.0446, Accuracy: 5450/10000 (54.5000%)
___Train Local_ResNet_18,  epoch 101, local model 22, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4483/5232 (85.6843%)
___Train Local_ResNet_18,  epoch 101, local model 22, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4655/5232 (88.9717%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 2.1419, Accuracy: 5214/10000 (52.1400%)
___Train Local_ResNet_18,  epoch 101, local model 94, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4299/4804 (89.4879%)
___Train Local_ResNet_18,  epoch 101, local model 94, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4284/4804 (89.1757%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 2.0817, Accuracy: 5352/10000 (53.5200%)
___Train Local_ResNet_18,  epoch 101, local model 24, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3546/3969 (89.3424%)
___Train Local_ResNet_18,  epoch 101, local model 24, internal_epoch   2,  Average loss: 0.0056, Accuracy: 3635/3969 (91.5848%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.9627, Accuracy: 5665/10000 (56.6500%)
___Train Local_ResNet_18,  epoch 101, local model 70, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4778/5392 (88.6128%)
___Train Local_ResNet_18,  epoch 101, local model 70, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4874/5392 (90.3932%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 2.0819, Accuracy: 5352/10000 (53.5200%)
___Train Local_ResNet_18,  epoch 101, local model 98, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3356/3828 (87.6698%)
___Train Local_ResNet_18,  epoch 101, local model 98, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3514/3828 (91.7973%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.9670, Accuracy: 5593/10000 (55.9300%)
time spent on training: 267.7787253856659
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.4659, Accuracy: 6424/10000 (64.2400%)
___Test Target_ResNet_18 poisoned: True, epoch: 101: Average loss: 8.5982, Accuracy: 174/9900 (1.7576%)
Done in 298.5521717071533 sec.
Server Epoch:102 choose agents : [13, 36, 58, 71, 22, 46, 62, 78, 48, 95, 32, 15, 25, 6, 80, 27, 97, 37, 87, 89].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 102, local model 13, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4430/4885 (90.6858%), train_poison_data_count: 385
Global model norm: 43.56759267891603.
Norm before scaling: 43.56455115328861. Distance: 2.0411896699865655
Total norm for 4 adversaries is: 43.56455115328861. distance: 2.0411896699865655
___Test Local_ResNet_18 poisoned: True, epoch: 102: Average loss: 0.1717, Accuracy: 9456/9900 (95.5152%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 102, local model 36, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4694/5305 (88.4826%), train_poison_data_count: 415
Global model norm: 43.56759267891603.
Norm before scaling: 43.56784624654402. Distance: 2.2461006496157614
Total norm for 4 adversaries is: 43.56784624654402. distance: 2.2461006496157614
___Test Local_ResNet_18 poisoned: True, epoch: 102: Average loss: 0.2163, Accuracy: 9350/9900 (94.4444%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 102, local model 58, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4208/4717 (89.2092%), train_poison_data_count: 370
Global model norm: 43.56759267891603.
Norm before scaling: 43.561161934704664. Distance: 1.9983955146250543
Total norm for 4 adversaries is: 43.561161934704664. distance: 1.9983955146250543
___Test Local_ResNet_18 poisoned: True, epoch: 102: Average loss: 0.2409, Accuracy: 9312/9900 (94.0606%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 102, local model 71, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4469/5066 (88.2156%), train_poison_data_count: 400
Global model norm: 43.56759267891603.
Norm before scaling: 43.56762209844026. Distance: 2.2563769782942455
Total norm for 4 adversaries is: 43.56762209844026. distance: 2.2563769782942455
___Test Local_ResNet_18 poisoned: True, epoch: 102: Average loss: 0.1424, Accuracy: 9524/9900 (96.2020%)
___Train Local_ResNet_18,  epoch 102, local model 22, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4514/5232 (86.2768%)
___Train Local_ResNet_18,  epoch 102, local model 22, internal_epoch   2,  Average loss: 0.0063, Accuracy: 4585/5232 (87.6338%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.1007, Accuracy: 5263/10000 (52.6300%)
___Train Local_ResNet_18,  epoch 102, local model 46, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4284/4956 (86.4407%)
___Train Local_ResNet_18,  epoch 102, local model 46, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4376/4956 (88.2970%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.2520, Accuracy: 5073/10000 (50.7300%)
___Train Local_ResNet_18,  epoch 102, local model 62, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4413/5063 (87.1618%)
___Train Local_ResNet_18,  epoch 102, local model 62, internal_epoch   2,  Average loss: 0.0062, Accuracy: 4472/5063 (88.3271%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.0468, Accuracy: 5345/10000 (53.4500%)
___Train Local_ResNet_18,  epoch 102, local model 78, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3591/4025 (89.2174%)
___Train Local_ResNet_18,  epoch 102, local model 78, internal_epoch   2,  Average loss: 0.0037, Accuracy: 3759/4025 (93.3913%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 1.8011, Accuracy: 5835/10000 (58.3500%)
___Train Local_ResNet_18,  epoch 102, local model 48, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3997/4441 (90.0023%)
___Train Local_ResNet_18,  epoch 102, local model 48, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4107/4441 (92.4792%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.0776, Accuracy: 5453/10000 (54.5300%)
___Train Local_ResNet_18,  epoch 102, local model 95, internal_epoch   1,  Average loss: 0.0073, Accuracy: 3984/4625 (86.1405%)
___Train Local_ResNet_18,  epoch 102, local model 95, internal_epoch   2,  Average loss: 0.0063, Accuracy: 4044/4625 (87.4378%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.0003, Accuracy: 5518/10000 (55.1800%)
___Train Local_ResNet_18,  epoch 102, local model 32, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4831/5591 (86.4067%)
___Train Local_ResNet_18,  epoch 102, local model 32, internal_epoch   2,  Average loss: 0.0062, Accuracy: 4875/5591 (87.1937%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.1939, Accuracy: 5176/10000 (51.7600%)
___Train Local_ResNet_18,  epoch 102, local model 15, internal_epoch   1,  Average loss: 0.0054, Accuracy: 5003/5582 (89.6274%)
___Train Local_ResNet_18,  epoch 102, local model 15, internal_epoch   2,  Average loss: 0.0051, Accuracy: 5046/5582 (90.3977%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.1381, Accuracy: 5241/10000 (52.4100%)
___Train Local_ResNet_18,  epoch 102, local model 25, internal_epoch   1,  Average loss: 0.0054, Accuracy: 5289/5902 (89.6137%)
___Train Local_ResNet_18,  epoch 102, local model 25, internal_epoch   2,  Average loss: 0.0051, Accuracy: 5310/5902 (89.9695%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.1671, Accuracy: 5129/10000 (51.2900%)
___Train Local_ResNet_18,  epoch 102, local model 6, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4081/4538 (89.9295%)
___Train Local_ResNet_18,  epoch 102, local model 6, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4211/4538 (92.7942%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 1.8288, Accuracy: 5743/10000 (57.4300%)
___Train Local_ResNet_18,  epoch 102, local model 80, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4431/5025 (88.1791%)
___Train Local_ResNet_18,  epoch 102, local model 80, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4592/5025 (91.3831%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.0683, Accuracy: 5341/10000 (53.4100%)
___Train Local_ResNet_18,  epoch 102, local model 27, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3729/4223 (88.3022%)
___Train Local_ResNet_18,  epoch 102, local model 27, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3847/4223 (91.0964%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 1.8811, Accuracy: 5671/10000 (56.7100%)
___Train Local_ResNet_18,  epoch 102, local model 97, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3921/4361 (89.9106%)
___Train Local_ResNet_18,  epoch 102, local model 97, internal_epoch   2,  Average loss: 0.0060, Accuracy: 3841/4361 (88.0761%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.2967, Accuracy: 5157/10000 (51.5700%)
___Train Local_ResNet_18,  epoch 102, local model 37, internal_epoch   1,  Average loss: 0.0039, Accuracy: 4102/4354 (94.2122%)
___Train Local_ResNet_18,  epoch 102, local model 37, internal_epoch   2,  Average loss: 0.0066, Accuracy: 3853/4354 (88.4933%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.0519, Accuracy: 5313/10000 (53.1300%)
___Train Local_ResNet_18,  epoch 102, local model 87, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3216/3672 (87.5817%)
___Train Local_ResNet_18,  epoch 102, local model 87, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3344/3672 (91.0675%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 1.9754, Accuracy: 5555/10000 (55.5500%)
___Train Local_ResNet_18,  epoch 102, local model 89, internal_epoch   1,  Average loss: 0.0041, Accuracy: 4025/4356 (92.4013%)
___Train Local_ResNet_18,  epoch 102, local model 89, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4025/4356 (92.4013%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.2768, Accuracy: 5114/10000 (51.1400%)
time spent on training: 266.6879539489746
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 102: Average loss: 1.5061, Accuracy: 6352/10000 (63.5200%)
___Test Target_ResNet_18 poisoned: True, epoch: 102: Average loss: 8.1836, Accuracy: 258/9900 (2.6061%)
Done in 297.11742544174194 sec.
Server Epoch:103 choose agents : [13, 36, 58, 71, 98, 73, 4, 59, 16, 38, 12, 43, 77, 42, 64, 85, 17, 66, 94, 60].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 103, local model 13, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4371/4885 (89.4780%), train_poison_data_count: 385
Global model norm: 43.60052170747573.
Norm before scaling: 43.599932357315645. Distance: 2.1092933921569035
Total norm for 4 adversaries is: 43.599932357315645. distance: 2.1092933921569035
___Test Local_ResNet_18 poisoned: True, epoch: 103: Average loss: 0.1238, Accuracy: 9593/9900 (96.8990%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 103, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4725/5305 (89.0669%), train_poison_data_count: 415
Global model norm: 43.60052170747573.
Norm before scaling: 43.60030892638907. Distance: 2.1900479328013644
Total norm for 4 adversaries is: 43.60030892638907. distance: 2.1900479328013644
___Test Local_ResNet_18 poisoned: True, epoch: 103: Average loss: 0.1783, Accuracy: 9477/9900 (95.7273%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 103, local model 58, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4223/4717 (89.5272%), train_poison_data_count: 370
Global model norm: 43.60052170747573.
Norm before scaling: 43.5983728507656. Distance: 2.0376429969831067
Total norm for 4 adversaries is: 43.5983728507656. distance: 2.0376429969831067
___Test Local_ResNet_18 poisoned: True, epoch: 103: Average loss: 0.3207, Accuracy: 9153/9900 (92.4545%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 103, local model 71, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4455/5066 (87.9392%), train_poison_data_count: 400
Global model norm: 43.60052170747573.
Norm before scaling: 43.60512704364233. Distance: 2.3131791225925937
Total norm for 4 adversaries is: 43.60512704364233. distance: 2.3131791225925937
___Test Local_ResNet_18 poisoned: True, epoch: 103: Average loss: 0.1413, Accuracy: 9553/9900 (96.4949%)
___Train Local_ResNet_18,  epoch 103, local model 98, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3391/3828 (88.5841%)
___Train Local_ResNet_18,  epoch 103, local model 98, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3494/3828 (91.2748%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.8720, Accuracy: 5743/10000 (57.4300%)
___Train Local_ResNet_18,  epoch 103, local model 73, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3772/4235 (89.0673%)
___Train Local_ResNet_18,  epoch 103, local model 73, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3798/4235 (89.6812%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 2.0395, Accuracy: 5433/10000 (54.3300%)
___Train Local_ResNet_18,  epoch 103, local model 4, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3226/3704 (87.0950%)
___Train Local_ResNet_18,  epoch 103, local model 4, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3322/3704 (89.6868%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.9252, Accuracy: 5618/10000 (56.1800%)
___Train Local_ResNet_18,  epoch 103, local model 59, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3582/4046 (88.5319%)
___Train Local_ResNet_18,  epoch 103, local model 59, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3727/4046 (92.1157%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.7746, Accuracy: 5775/10000 (57.7500%)
___Train Local_ResNet_18,  epoch 103, local model 16, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4367/4928 (88.6161%)
___Train Local_ResNet_18,  epoch 103, local model 16, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4418/4928 (89.6510%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.9171, Accuracy: 5591/10000 (55.9100%)
___Train Local_ResNet_18,  epoch 103, local model 38, internal_epoch   1,  Average loss: 0.0062, Accuracy: 5062/5740 (88.1882%)
___Train Local_ResNet_18,  epoch 103, local model 38, internal_epoch   2,  Average loss: 0.0057, Accuracy: 5101/5740 (88.8676%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 2.1786, Accuracy: 5157/10000 (51.5700%)
___Train Local_ResNet_18,  epoch 103, local model 12, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4478/5083 (88.0976%)
___Train Local_ResNet_18,  epoch 103, local model 12, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4560/5083 (89.7108%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 2.0136, Accuracy: 5368/10000 (53.6800%)
___Train Local_ResNet_18,  epoch 103, local model 43, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4055/4576 (88.6145%)
___Train Local_ResNet_18,  epoch 103, local model 43, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4143/4576 (90.5376%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.8995, Accuracy: 5608/10000 (56.0800%)
___Train Local_ResNet_18,  epoch 103, local model 77, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4101/4647 (88.2505%)
___Train Local_ResNet_18,  epoch 103, local model 77, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4239/4647 (91.2201%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.8760, Accuracy: 5619/10000 (56.1900%)
___Train Local_ResNet_18,  epoch 103, local model 42, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4856/5424 (89.5280%)
___Train Local_ResNet_18,  epoch 103, local model 42, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4947/5424 (91.2058%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 2.1035, Accuracy: 5267/10000 (52.6700%)
___Train Local_ResNet_18,  epoch 103, local model 64, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3925/4503 (87.1641%)
___Train Local_ResNet_18,  epoch 103, local model 64, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4063/4503 (90.2287%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 2.0726, Accuracy: 5416/10000 (54.1600%)
___Train Local_ResNet_18,  epoch 103, local model 85, internal_epoch   1,  Average loss: 0.0062, Accuracy: 5640/6391 (88.2491%)
___Train Local_ResNet_18,  epoch 103, local model 85, internal_epoch   2,  Average loss: 0.0056, Accuracy: 5694/6391 (89.0940%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.9653, Accuracy: 5530/10000 (55.3000%)
___Train Local_ResNet_18,  epoch 103, local model 17, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3927/4511 (87.0539%)
___Train Local_ResNet_18,  epoch 103, local model 17, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4059/4511 (89.9800%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.9415, Accuracy: 5426/10000 (54.2600%)
___Train Local_ResNet_18,  epoch 103, local model 66, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4030/4456 (90.4399%)
___Train Local_ResNet_18,  epoch 103, local model 66, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4088/4456 (91.7415%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.9755, Accuracy: 5606/10000 (56.0600%)
___Train Local_ResNet_18,  epoch 103, local model 94, internal_epoch   1,  Average loss: 0.0046, Accuracy: 4375/4804 (91.0699%)
___Train Local_ResNet_18,  epoch 103, local model 94, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4301/4804 (89.5296%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 2.0975, Accuracy: 5481/10000 (54.8100%)
___Train Local_ResNet_18,  epoch 103, local model 60, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3339/3804 (87.7760%)
___Train Local_ResNet_18,  epoch 103, local model 60, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3461/3804 (90.9832%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 2.0430, Accuracy: 5450/10000 (54.5000%)
time spent on training: 266.4034221172333
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.4951, Accuracy: 6402/10000 (64.0200%)
___Test Target_ResNet_18 poisoned: True, epoch: 103: Average loss: 8.3508, Accuracy: 241/9900 (2.4343%)
Done in 296.9334285259247 sec.
Server Epoch:104 choose agents : [13, 36, 58, 71, 16, 45, 70, 8, 60, 39, 62, 7, 34, 76, 10, 95, 49, 12, 98, 4].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 104, local model 13, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4405/4885 (90.1740%), train_poison_data_count: 385
Global model norm: 43.644010844756096.
Norm before scaling: 43.64212425817085. Distance: 2.1070855042824386
Total norm for 4 adversaries is: 43.64212425817085. distance: 2.1070855042824386
___Test Local_ResNet_18 poisoned: True, epoch: 104: Average loss: 0.1091, Accuracy: 9629/9900 (97.2626%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 104, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4768/5305 (89.8775%), train_poison_data_count: 415
Global model norm: 43.644010844756096.
Norm before scaling: 43.641783013637. Distance: 2.1966192625697296
Total norm for 4 adversaries is: 43.641783013637. distance: 2.1966192625697296
___Test Local_ResNet_18 poisoned: True, epoch: 104: Average loss: 0.1897, Accuracy: 9425/9900 (95.2020%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 104, local model 58, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4237/4717 (89.8240%), train_poison_data_count: 370
Global model norm: 43.644010844756096.
Norm before scaling: 43.63912009578533. Distance: 2.033729682919354
Total norm for 4 adversaries is: 43.63912009578533. distance: 2.033729682919354
___Test Local_ResNet_18 poisoned: True, epoch: 104: Average loss: 0.1588, Accuracy: 9486/9900 (95.8182%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 104, local model 71, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4495/5066 (88.7288%), train_poison_data_count: 400
Global model norm: 43.644010844756096.
Norm before scaling: 43.646729399860966. Distance: 2.2485681852385513
Total norm for 4 adversaries is: 43.646729399860966. distance: 2.2485681852385513
___Test Local_ResNet_18 poisoned: True, epoch: 104: Average loss: 0.1397, Accuracy: 9537/9900 (96.3333%)
___Train Local_ResNet_18,  epoch 104, local model 16, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4360/4928 (88.4740%)
___Train Local_ResNet_18,  epoch 104, local model 16, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4454/4928 (90.3815%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.9902, Accuracy: 5580/10000 (55.8000%)
___Train Local_ResNet_18,  epoch 104, local model 45, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4383/5037 (87.0161%)
___Train Local_ResNet_18,  epoch 104, local model 45, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4575/5037 (90.8279%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.9640, Accuracy: 5514/10000 (55.1400%)
___Train Local_ResNet_18,  epoch 104, local model 70, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4833/5392 (89.6328%)
___Train Local_ResNet_18,  epoch 104, local model 70, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4890/5392 (90.6899%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.9683, Accuracy: 5508/10000 (55.0800%)
___Train Local_ResNet_18,  epoch 104, local model 8, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3983/4501 (88.4914%)
___Train Local_ResNet_18,  epoch 104, local model 8, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4033/4501 (89.6023%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 2.0110, Accuracy: 5394/10000 (53.9400%)
___Train Local_ResNet_18,  epoch 104, local model 60, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3357/3804 (88.2492%)
___Train Local_ResNet_18,  epoch 104, local model 60, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3459/3804 (90.9306%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.9398, Accuracy: 5564/10000 (55.6400%)
___Train Local_ResNet_18,  epoch 104, local model 39, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3375/3837 (87.9593%)
___Train Local_ResNet_18,  epoch 104, local model 39, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3555/3837 (92.6505%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.8980, Accuracy: 5619/10000 (56.1900%)
___Train Local_ResNet_18,  epoch 104, local model 62, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4433/5063 (87.5568%)
___Train Local_ResNet_18,  epoch 104, local model 62, internal_epoch   2,  Average loss: 0.0089, Accuracy: 4218/5063 (83.3103%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 2.3317, Accuracy: 4926/10000 (49.2600%)
___Train Local_ResNet_18,  epoch 104, local model 7, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4036/4481 (90.0692%)
___Train Local_ResNet_18,  epoch 104, local model 7, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4050/4481 (90.3816%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 2.0734, Accuracy: 5471/10000 (54.7100%)
___Train Local_ResNet_18,  epoch 104, local model 34, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4029/4518 (89.1766%)
___Train Local_ResNet_18,  epoch 104, local model 34, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4179/4518 (92.4967%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.9208, Accuracy: 5602/10000 (56.0200%)
___Train Local_ResNet_18,  epoch 104, local model 76, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3163/3638 (86.9434%)
___Train Local_ResNet_18,  epoch 104, local model 76, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3285/3638 (90.2969%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.8317, Accuracy: 5724/10000 (57.2400%)
___Train Local_ResNet_18,  epoch 104, local model 10, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4147/4663 (88.9342%)
___Train Local_ResNet_18,  epoch 104, local model 10, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4283/4663 (91.8507%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.9030, Accuracy: 5576/10000 (55.7600%)
___Train Local_ResNet_18,  epoch 104, local model 95, internal_epoch   1,  Average loss: 0.0073, Accuracy: 3963/4625 (85.6865%)
___Train Local_ResNet_18,  epoch 104, local model 95, internal_epoch   2,  Average loss: 0.0062, Accuracy: 4038/4625 (87.3081%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 2.1089, Accuracy: 5255/10000 (52.5500%)
___Train Local_ResNet_18,  epoch 104, local model 49, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4535/5197 (87.2619%)
___Train Local_ResNet_18,  epoch 104, local model 49, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4681/5197 (90.0712%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 2.0384, Accuracy: 5444/10000 (54.4400%)
___Train Local_ResNet_18,  epoch 104, local model 12, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4473/5083 (87.9992%)
___Train Local_ResNet_18,  epoch 104, local model 12, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4532/5083 (89.1599%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.9690, Accuracy: 5492/10000 (54.9200%)
___Train Local_ResNet_18,  epoch 104, local model 98, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3364/3828 (87.8788%)
___Train Local_ResNet_18,  epoch 104, local model 98, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3508/3828 (91.6405%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.8929, Accuracy: 5676/10000 (56.7600%)
___Train Local_ResNet_18,  epoch 104, local model 4, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3189/3704 (86.0961%)
___Train Local_ResNet_18,  epoch 104, local model 4, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3365/3704 (90.8477%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.8341, Accuracy: 5776/10000 (57.7600%)
time spent on training: 266.8146274089813
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.5094, Accuracy: 6395/10000 (63.9500%)
___Test Target_ResNet_18 poisoned: True, epoch: 104: Average loss: 8.7565, Accuracy: 186/9900 (1.8788%)
Done in 297.20556640625 sec.
Server Epoch:105 choose agents : [13, 36, 58, 71, 14, 23, 45, 49, 80, 67, 7, 43, 22, 37, 83, 40, 61, 52, 4, 88].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 105, local model 13, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4411/4885 (90.2968%), train_poison_data_count: 385
Global model norm: 43.68360335581804.
Norm before scaling: 43.67867372169097. Distance: 2.1110928922279757
Total norm for 4 adversaries is: 43.67867372169097. distance: 2.1110928922279757
___Test Local_ResNet_18 poisoned: True, epoch: 105: Average loss: 0.1896, Accuracy: 9426/9900 (95.2121%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 105, local model 36, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4755/5305 (89.6324%), train_poison_data_count: 415
Global model norm: 43.68360335581804.
Norm before scaling: 43.68222987704783. Distance: 2.1733526239338623
Total norm for 4 adversaries is: 43.68222987704783. distance: 2.1733526239338623
___Test Local_ResNet_18 poisoned: True, epoch: 105: Average loss: 0.1313, Accuracy: 9570/9900 (96.6667%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 105, local model 58, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4254/4717 (90.1844%), train_poison_data_count: 370
Global model norm: 43.68360335581804.
Norm before scaling: 43.67983491859402. Distance: 2.0487985672468714
Total norm for 4 adversaries is: 43.67983491859402. distance: 2.0487985672468714
___Test Local_ResNet_18 poisoned: True, epoch: 105: Average loss: 0.2056, Accuracy: 9381/9900 (94.7576%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 105, local model 71, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4475/5066 (88.3340%), train_poison_data_count: 400
Global model norm: 43.68360335581804.
Norm before scaling: 43.682161411564074. Distance: 2.231747983610025
Total norm for 4 adversaries is: 43.682161411564074. distance: 2.231747983610025
___Test Local_ResNet_18 poisoned: True, epoch: 105: Average loss: 0.1853, Accuracy: 9429/9900 (95.2424%)
___Train Local_ResNet_18,  epoch 105, local model 14, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3427/3861 (88.7594%)
___Train Local_ResNet_18,  epoch 105, local model 14, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3510/3861 (90.9091%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.8975, Accuracy: 5602/10000 (56.0200%)
___Train Local_ResNet_18,  epoch 105, local model 23, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3742/4184 (89.4359%)
___Train Local_ResNet_18,  epoch 105, local model 23, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3826/4184 (91.4436%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.9695, Accuracy: 5531/10000 (55.3100%)
___Train Local_ResNet_18,  epoch 105, local model 45, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4415/5037 (87.6514%)
___Train Local_ResNet_18,  epoch 105, local model 45, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4610/5037 (91.5227%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.9207, Accuracy: 5474/10000 (54.7400%)
___Train Local_ResNet_18,  epoch 105, local model 49, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4564/5197 (87.8199%)
___Train Local_ResNet_18,  epoch 105, local model 49, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4581/5197 (88.1470%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 2.0600, Accuracy: 5460/10000 (54.6000%)
___Train Local_ResNet_18,  epoch 105, local model 80, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4400/5025 (87.5622%)
___Train Local_ResNet_18,  epoch 105, local model 80, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4544/5025 (90.4279%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 2.0143, Accuracy: 5487/10000 (54.8700%)
___Train Local_ResNet_18,  epoch 105, local model 67, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4500/5116 (87.9593%)
___Train Local_ResNet_18,  epoch 105, local model 67, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4619/5116 (90.2854%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.9669, Accuracy: 5510/10000 (55.1000%)
___Train Local_ResNet_18,  epoch 105, local model 7, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4022/4481 (89.7568%)
___Train Local_ResNet_18,  epoch 105, local model 7, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4040/4481 (90.1584%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 2.1022, Accuracy: 5414/10000 (54.1400%)
___Train Local_ResNet_18,  epoch 105, local model 43, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4060/4576 (88.7238%)
___Train Local_ResNet_18,  epoch 105, local model 43, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4190/4576 (91.5647%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.9541, Accuracy: 5515/10000 (55.1500%)
___Train Local_ResNet_18,  epoch 105, local model 22, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4546/5232 (86.8884%)
___Train Local_ResNet_18,  epoch 105, local model 22, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4697/5232 (89.7745%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.9773, Accuracy: 5559/10000 (55.5900%)
___Train Local_ResNet_18,  epoch 105, local model 37, internal_epoch   1,  Average loss: 0.0031, Accuracy: 4115/4354 (94.5108%)
___Train Local_ResNet_18,  epoch 105, local model 37, internal_epoch   2,  Average loss: 0.0056, Accuracy: 3953/4354 (90.7901%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 2.0886, Accuracy: 5415/10000 (54.1500%)
___Train Local_ResNet_18,  epoch 105, local model 83, internal_epoch   1,  Average loss: 0.0060, Accuracy: 2889/3271 (88.3216%)
___Train Local_ResNet_18,  epoch 105, local model 83, internal_epoch   2,  Average loss: 0.0059, Accuracy: 2891/3271 (88.3828%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 2.0253, Accuracy: 5348/10000 (53.4800%)
___Train Local_ResNet_18,  epoch 105, local model 40, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4809/5455 (88.1577%)
___Train Local_ResNet_18,  epoch 105, local model 40, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4936/5455 (90.4858%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 2.0552, Accuracy: 5359/10000 (53.5900%)
___Train Local_ResNet_18,  epoch 105, local model 61, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3672/4126 (88.9966%)
___Train Local_ResNet_18,  epoch 105, local model 61, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3800/4126 (92.0989%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.8995, Accuracy: 5554/10000 (55.5400%)
___Train Local_ResNet_18,  epoch 105, local model 52, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3337/3797 (87.8852%)
___Train Local_ResNet_18,  epoch 105, local model 52, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3466/3797 (91.2826%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.9988, Accuracy: 5510/10000 (55.1000%)
___Train Local_ResNet_18,  epoch 105, local model 4, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3234/3704 (87.3110%)
___Train Local_ResNet_18,  epoch 105, local model 4, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3369/3704 (90.9557%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.9862, Accuracy: 5627/10000 (56.2700%)
___Train Local_ResNet_18,  epoch 105, local model 88, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4414/4934 (89.4609%)
___Train Local_ResNet_18,  epoch 105, local model 88, internal_epoch   2,  Average loss: 0.0068, Accuracy: 4282/4934 (86.7856%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.9676, Accuracy: 5433/10000 (54.3300%)
time spent on training: 267.54247975349426
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.6577, Accuracy: 6183/10000 (61.8300%)
___Test Target_ResNet_18 poisoned: True, epoch: 105: Average loss: 8.4913, Accuracy: 199/9900 (2.0101%)
Done in 297.8242049217224 sec.
Server Epoch:106 choose agents : [13, 36, 58, 71, 81, 95, 38, 74, 61, 86, 91, 29, 82, 9, 78, 93, 39, 76, 30, 66].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 106, local model 13, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4424/4885 (90.5629%), train_poison_data_count: 385
Global model norm: 43.713694478514824.
Norm before scaling: 43.709364499176544. Distance: 2.053745532504033
Total norm for 4 adversaries is: 43.709364499176544. distance: 2.053745532504033
___Test Local_ResNet_18 poisoned: True, epoch: 106: Average loss: 0.3059, Accuracy: 9137/9900 (92.2929%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 106, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4743/5305 (89.4062%), train_poison_data_count: 415
Global model norm: 43.713694478514824.
Norm before scaling: 43.71444704968113. Distance: 2.2324820015620697
Total norm for 4 adversaries is: 43.71444704968113. distance: 2.2324820015620697
___Test Local_ResNet_18 poisoned: True, epoch: 106: Average loss: 0.2443, Accuracy: 9302/9900 (93.9596%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 106, local model 58, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4222/4717 (89.5060%), train_poison_data_count: 370
Global model norm: 43.713694478514824.
Norm before scaling: 43.70678250471044. Distance: 2.0500352065622023
Total norm for 4 adversaries is: 43.70678250471044. distance: 2.0500352065622023
___Test Local_ResNet_18 poisoned: True, epoch: 106: Average loss: 0.2655, Accuracy: 9222/9900 (93.1515%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 106, local model 71, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4489/5066 (88.6103%), train_poison_data_count: 400
Global model norm: 43.713694478514824.
Norm before scaling: 43.711122514130345. Distance: 2.230365062648513
Total norm for 4 adversaries is: 43.711122514130345. distance: 2.230365062648513
___Test Local_ResNet_18 poisoned: True, epoch: 106: Average loss: 0.1720, Accuracy: 9470/9900 (95.6566%)
___Train Local_ResNet_18,  epoch 106, local model 81, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4091/4618 (88.5881%)
___Train Local_ResNet_18,  epoch 106, local model 81, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4111/4618 (89.0212%)
___Test Local_ResNet_18 poisoned: False, epoch: 106: Average loss: 1.8929, Accuracy: 5585/10000 (55.8500%)
___Train Local_ResNet_18,  epoch 106, local model 95, internal_epoch   1,  Average loss: 0.0078, Accuracy: 3914/4625 (84.6270%)
___Train Local_ResNet_18,  epoch 106, local model 95, internal_epoch   2,  Average loss: 0.0063, Accuracy: 4041/4625 (87.3730%)
___Test Local_ResNet_18 poisoned: False, epoch: 106: Average loss: 2.0858, Accuracy: 5353/10000 (53.5300%)
___Train Local_ResNet_18,  epoch 106, local model 38, internal_epoch   1,  Average loss: 0.0062, Accuracy: 5038/5740 (87.7700%)
___Train Local_ResNet_18,  epoch 106, local model 38, internal_epoch   2,  Average loss: 0.0054, Accuracy: 5132/5740 (89.4077%)
___Test Local_ResNet_18 poisoned: False, epoch: 106: Average loss: 2.1194, Accuracy: 5245/10000 (52.4500%)
___Train Local_ResNet_18,  epoch 106, local model 74, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3863/4416 (87.4774%)
___Train Local_ResNet_18,  epoch 106, local model 74, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4021/4416 (91.0553%)
___Test Local_ResNet_18 poisoned: False, epoch: 106: Average loss: 1.9591, Accuracy: 5506/10000 (55.0600%)
___Train Local_ResNet_18,  epoch 106, local model 61, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3667/4126 (88.8754%)
___Train Local_ResNet_18,  epoch 106, local model 61, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3797/4126 (92.0262%)
___Test Local_ResNet_18 poisoned: False, epoch: 106: Average loss: 1.8342, Accuracy: 5727/10000 (57.2700%)
___Train Local_ResNet_18,  epoch 106, local model 86, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3136/3616 (86.7257%)
___Train Local_ResNet_18,  epoch 106, local model 86, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3301/3616 (91.2887%)
___Test Local_ResNet_18 poisoned: False, epoch: 106: Average loss: 1.8712, Accuracy: 5715/10000 (57.1500%)
___Train Local_ResNet_18,  epoch 106, local model 91, internal_epoch   1,  Average loss: 0.0077, Accuracy: 3524/4158 (84.7523%)
___Train Local_ResNet_18,  epoch 106, local model 91, internal_epoch   2,  Average loss: 0.0059, Accuracy: 3687/4158 (88.6724%)
___Test Local_ResNet_18 poisoned: False, epoch: 106: Average loss: 1.8969, Accuracy: 5599/10000 (55.9900%)
___Train Local_ResNet_18,  epoch 106, local model 29, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3903/4346 (89.8067%)
___Train Local_ResNet_18,  epoch 106, local model 29, internal_epoch   2,  Average loss: 0.0037, Accuracy: 4034/4346 (92.8210%)
___Test Local_ResNet_18 poisoned: False, epoch: 106: Average loss: 1.9282, Accuracy: 5568/10000 (55.6800%)
___Train Local_ResNet_18,  epoch 106, local model 82, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4210/4874 (86.3767%)
___Train Local_ResNet_18,  epoch 106, local model 82, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4323/4874 (88.6951%)
___Test Local_ResNet_18 poisoned: False, epoch: 106: Average loss: 2.2480, Accuracy: 5112/10000 (51.1200%)
___Train Local_ResNet_18,  epoch 106, local model 9, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4634/5265 (88.0152%)
___Train Local_ResNet_18,  epoch 106, local model 9, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4741/5265 (90.0475%)
___Test Local_ResNet_18 poisoned: False, epoch: 106: Average loss: 1.9147, Accuracy: 5587/10000 (55.8700%)
___Train Local_ResNet_18,  epoch 106, local model 78, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3596/4025 (89.3416%)
___Train Local_ResNet_18,  epoch 106, local model 78, internal_epoch   2,  Average loss: 0.0037, Accuracy: 3738/4025 (92.8696%)
___Test Local_ResNet_18 poisoned: False, epoch: 106: Average loss: 1.8306, Accuracy: 5771/10000 (57.7100%)
___Train Local_ResNet_18,  epoch 106, local model 93, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4090/4651 (87.9381%)
___Train Local_ResNet_18,  epoch 106, local model 93, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4229/4651 (90.9267%)
___Test Local_ResNet_18 poisoned: False, epoch: 106: Average loss: 1.9963, Accuracy: 5448/10000 (54.4800%)
___Train Local_ResNet_18,  epoch 106, local model 39, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3344/3837 (87.1514%)
___Train Local_ResNet_18,  epoch 106, local model 39, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3479/3837 (90.6698%)
___Test Local_ResNet_18 poisoned: False, epoch: 106: Average loss: 2.0134, Accuracy: 5410/10000 (54.1000%)
___Train Local_ResNet_18,  epoch 106, local model 76, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3136/3638 (86.2012%)
___Train Local_ResNet_18,  epoch 106, local model 76, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3305/3638 (90.8466%)
___Test Local_ResNet_18 poisoned: False, epoch: 106: Average loss: 1.8594, Accuracy: 5644/10000 (56.4400%)
___Train Local_ResNet_18,  epoch 106, local model 30, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3102/3472 (89.3433%)
___Train Local_ResNet_18,  epoch 106, local model 30, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3196/3472 (92.0507%)
___Test Local_ResNet_18 poisoned: False, epoch: 106: Average loss: 2.0372, Accuracy: 5557/10000 (55.5700%)
___Train Local_ResNet_18,  epoch 106, local model 66, internal_epoch   1,  Average loss: 0.0053, Accuracy: 4009/4456 (89.9686%)
___Train Local_ResNet_18,  epoch 106, local model 66, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4120/4456 (92.4596%)
___Test Local_ResNet_18 poisoned: False, epoch: 106: Average loss: 1.8505, Accuracy: 5736/10000 (57.3600%)
time spent on training: 261.5499634742737
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 106: Average loss: 1.7026, Accuracy: 6073/10000 (60.7300%)
___Test Target_ResNet_18 poisoned: True, epoch: 106: Average loss: 8.7556, Accuracy: 144/9900 (1.4545%)
Done in 292.44956946372986 sec.
Server Epoch:107 choose agents : [13, 36, 58, 71, 42, 1, 35, 28, 50, 89, 94, 7, 78, 0, 86, 23, 54, 97, 26, 32].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 107, local model 13, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4378/4885 (89.6213%), train_poison_data_count: 385
Global model norm: 43.74554525311334.
Norm before scaling: 43.74478484541758. Distance: 2.157199263669791
Total norm for 4 adversaries is: 43.74478484541758. distance: 2.157199263669791
___Test Local_ResNet_18 poisoned: True, epoch: 107: Average loss: 0.1114, Accuracy: 9615/9900 (97.1212%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 107, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4763/5305 (89.7832%), train_poison_data_count: 415
Global model norm: 43.74554525311334.
Norm before scaling: 43.741599360888. Distance: 2.1657929370494067
Total norm for 4 adversaries is: 43.741599360888. distance: 2.1657929370494067
___Test Local_ResNet_18 poisoned: True, epoch: 107: Average loss: 0.1629, Accuracy: 9490/9900 (95.8586%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 107, local model 58, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4216/4717 (89.3788%), train_poison_data_count: 370
Global model norm: 43.74554525311334.
Norm before scaling: 43.74220633706506. Distance: 2.067496518705267
Total norm for 4 adversaries is: 43.74220633706506. distance: 2.067496518705267
___Test Local_ResNet_18 poisoned: True, epoch: 107: Average loss: 0.2087, Accuracy: 9338/9900 (94.3232%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 107, local model 71, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4478/5066 (88.3932%), train_poison_data_count: 400
Global model norm: 43.74554525311334.
Norm before scaling: 43.748493277626146. Distance: 2.287930048973653
Total norm for 4 adversaries is: 43.748493277626146. distance: 2.287930048973653
___Test Local_ResNet_18 poisoned: True, epoch: 107: Average loss: 0.1900, Accuracy: 9397/9900 (94.9192%)
___Train Local_ResNet_18,  epoch 107, local model 42, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4812/5424 (88.7168%)
___Train Local_ResNet_18,  epoch 107, local model 42, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4914/5424 (90.5973%)
___Test Local_ResNet_18 poisoned: False, epoch: 107: Average loss: 2.2431, Accuracy: 5153/10000 (51.5300%)
___Train Local_ResNet_18,  epoch 107, local model 1, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4379/4986 (87.8259%)
___Train Local_ResNet_18,  epoch 107, local model 1, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4491/4986 (90.0722%)
___Test Local_ResNet_18 poisoned: False, epoch: 107: Average loss: 1.8817, Accuracy: 5666/10000 (56.6600%)
___Train Local_ResNet_18,  epoch 107, local model 35, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4568/5167 (88.4072%)
___Train Local_ResNet_18,  epoch 107, local model 35, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4665/5167 (90.2845%)
___Test Local_ResNet_18 poisoned: False, epoch: 107: Average loss: 2.1830, Accuracy: 5184/10000 (51.8400%)
___Train Local_ResNet_18,  epoch 107, local model 28, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4116/4716 (87.2774%)
___Train Local_ResNet_18,  epoch 107, local model 28, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4256/4716 (90.2460%)
___Test Local_ResNet_18 poisoned: False, epoch: 107: Average loss: 2.0372, Accuracy: 5364/10000 (53.6400%)
___Train Local_ResNet_18,  epoch 107, local model 50, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3802/4368 (87.0421%)
___Train Local_ResNet_18,  epoch 107, local model 50, internal_epoch   2,  Average loss: 0.0057, Accuracy: 3864/4368 (88.4615%)
___Test Local_ResNet_18 poisoned: False, epoch: 107: Average loss: 1.9353, Accuracy: 5501/10000 (55.0100%)
___Train Local_ResNet_18,  epoch 107, local model 89, internal_epoch   1,  Average loss: 0.0043, Accuracy: 4018/4356 (92.2406%)
___Train Local_ResNet_18,  epoch 107, local model 89, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3888/4356 (89.2562%)
___Test Local_ResNet_18 poisoned: False, epoch: 107: Average loss: 2.1892, Accuracy: 5099/10000 (50.9900%)
___Train Local_ResNet_18,  epoch 107, local model 94, internal_epoch   1,  Average loss: 0.0044, Accuracy: 4407/4804 (91.7361%)
___Train Local_ResNet_18,  epoch 107, local model 94, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4271/4804 (88.9051%)
___Test Local_ResNet_18 poisoned: False, epoch: 107: Average loss: 2.1286, Accuracy: 5339/10000 (53.3900%)
___Train Local_ResNet_18,  epoch 107, local model 7, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4024/4481 (89.8014%)
___Train Local_ResNet_18,  epoch 107, local model 7, internal_epoch   2,  Average loss: 0.0062, Accuracy: 4017/4481 (89.6452%)
___Test Local_ResNet_18 poisoned: False, epoch: 107: Average loss: 2.1528, Accuracy: 5347/10000 (53.4700%)
___Train Local_ResNet_18,  epoch 107, local model 78, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3573/4025 (88.7702%)
___Train Local_ResNet_18,  epoch 107, local model 78, internal_epoch   2,  Average loss: 0.0037, Accuracy: 3734/4025 (92.7702%)
___Test Local_ResNet_18 poisoned: False, epoch: 107: Average loss: 1.8112, Accuracy: 5769/10000 (57.6900%)
___Train Local_ResNet_18,  epoch 107, local model 0, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4443/5017 (88.5589%)
___Train Local_ResNet_18,  epoch 107, local model 0, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4573/5017 (91.1501%)
___Test Local_ResNet_18 poisoned: False, epoch: 107: Average loss: 1.9718, Accuracy: 5493/10000 (54.9300%)
___Train Local_ResNet_18,  epoch 107, local model 86, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3176/3616 (87.8319%)
___Train Local_ResNet_18,  epoch 107, local model 86, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3341/3616 (92.3949%)
___Test Local_ResNet_18 poisoned: False, epoch: 107: Average loss: 1.7320, Accuracy: 5988/10000 (59.8800%)
___Train Local_ResNet_18,  epoch 107, local model 23, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3667/4184 (87.6434%)
___Train Local_ResNet_18,  epoch 107, local model 23, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3786/4184 (90.4876%)
___Test Local_ResNet_18 poisoned: False, epoch: 107: Average loss: 1.9038, Accuracy: 5613/10000 (56.1300%)
___Train Local_ResNet_18,  epoch 107, local model 54, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4503/5195 (86.6795%)
___Train Local_ResNet_18,  epoch 107, local model 54, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4658/5195 (89.6631%)
___Test Local_ResNet_18 poisoned: False, epoch: 107: Average loss: 2.0546, Accuracy: 5439/10000 (54.3900%)
___Train Local_ResNet_18,  epoch 107, local model 97, internal_epoch   1,  Average loss: 0.0049, Accuracy: 3933/4361 (90.1857%)
___Train Local_ResNet_18,  epoch 107, local model 97, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4033/4361 (92.4788%)
___Test Local_ResNet_18 poisoned: False, epoch: 107: Average loss: 1.9786, Accuracy: 5610/10000 (56.1000%)
___Train Local_ResNet_18,  epoch 107, local model 26, internal_epoch   1,  Average loss: 0.0049, Accuracy: 3395/3756 (90.3887%)
___Train Local_ResNet_18,  epoch 107, local model 26, internal_epoch   2,  Average loss: 0.0036, Accuracy: 3501/3756 (93.2109%)
___Test Local_ResNet_18 poisoned: False, epoch: 107: Average loss: 1.8351, Accuracy: 5804/10000 (58.0400%)
___Train Local_ResNet_18,  epoch 107, local model 32, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4905/5591 (87.7303%)
___Train Local_ResNet_18,  epoch 107, local model 32, internal_epoch   2,  Average loss: 0.0062, Accuracy: 4904/5591 (87.7124%)
___Test Local_ResNet_18 poisoned: False, epoch: 107: Average loss: 2.0188, Accuracy: 5475/10000 (54.7500%)
time spent on training: 268.7506401538849
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 107: Average loss: 1.6350, Accuracy: 6204/10000 (62.0400%)
___Test Target_ResNet_18 poisoned: True, epoch: 107: Average loss: 8.7324, Accuracy: 173/9900 (1.7475%)
Done in 299.04158067703247 sec.
Server Epoch:108 choose agents : [13, 36, 58, 71, 31, 40, 4, 56, 16, 60, 41, 59, 84, 26, 85, 87, 57, 43, 66, 55].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 108, local model 13, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4404/4885 (90.1535%), train_poison_data_count: 385
Global model norm: 43.774193924171094.
Norm before scaling: 43.76932469412439. Distance: 2.0975290611536312
Total norm for 4 adversaries is: 43.76932469412439. distance: 2.0975290611536312
___Test Local_ResNet_18 poisoned: True, epoch: 108: Average loss: 0.3896, Accuracy: 8911/9900 (90.0101%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 108, local model 36, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4718/5305 (88.9350%), train_poison_data_count: 415
Global model norm: 43.774193924171094.
Norm before scaling: 43.76944601313655. Distance: 2.2304030106405137
Total norm for 4 adversaries is: 43.76944601313655. distance: 2.2304030106405137
___Test Local_ResNet_18 poisoned: True, epoch: 108: Average loss: 0.2005, Accuracy: 9395/9900 (94.8990%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 108, local model 58, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4189/4717 (88.8064%), train_poison_data_count: 370
Global model norm: 43.774193924171094.
Norm before scaling: 43.769946624813954. Distance: 2.074302887153023
Total norm for 4 adversaries is: 43.769946624813954. distance: 2.074302887153023
___Test Local_ResNet_18 poisoned: True, epoch: 108: Average loss: 0.1025, Accuracy: 9622/9900 (97.1919%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 108, local model 71, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4476/5066 (88.3537%), train_poison_data_count: 400
Global model norm: 43.774193924171094.
Norm before scaling: 43.77475583080818. Distance: 2.2546393988772855
Total norm for 4 adversaries is: 43.77475583080818. distance: 2.2546393988772855
___Test Local_ResNet_18 poisoned: True, epoch: 108: Average loss: 0.2688, Accuracy: 9239/9900 (93.3232%)
___Train Local_ResNet_18,  epoch 108, local model 31, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3648/4175 (87.3772%)
___Train Local_ResNet_18,  epoch 108, local model 31, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3774/4175 (90.3952%)
___Test Local_ResNet_18 poisoned: False, epoch: 108: Average loss: 1.9935, Accuracy: 5547/10000 (55.4700%)
___Train Local_ResNet_18,  epoch 108, local model 40, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4841/5455 (88.7443%)
___Train Local_ResNet_18,  epoch 108, local model 40, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4967/5455 (91.0541%)
___Test Local_ResNet_18 poisoned: False, epoch: 108: Average loss: 1.9183, Accuracy: 5482/10000 (54.8200%)
___Train Local_ResNet_18,  epoch 108, local model 4, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3202/3704 (86.4471%)
___Train Local_ResNet_18,  epoch 108, local model 4, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3354/3704 (90.5508%)
___Test Local_ResNet_18 poisoned: False, epoch: 108: Average loss: 1.8418, Accuracy: 5699/10000 (56.9900%)
___Train Local_ResNet_18,  epoch 108, local model 56, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4329/4989 (86.7709%)
___Train Local_ResNet_18,  epoch 108, local model 56, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4414/4989 (88.4746%)
___Test Local_ResNet_18 poisoned: False, epoch: 108: Average loss: 1.9734, Accuracy: 5565/10000 (55.6500%)
___Train Local_ResNet_18,  epoch 108, local model 16, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4281/4928 (86.8709%)
___Train Local_ResNet_18,  epoch 108, local model 16, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4447/4928 (90.2394%)
___Test Local_ResNet_18 poisoned: False, epoch: 108: Average loss: 1.9081, Accuracy: 5644/10000 (56.4400%)
___Train Local_ResNet_18,  epoch 108, local model 60, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3323/3804 (87.3554%)
___Train Local_ResNet_18,  epoch 108, local model 60, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3468/3804 (91.1672%)
___Test Local_ResNet_18 poisoned: False, epoch: 108: Average loss: 1.9582, Accuracy: 5572/10000 (55.7200%)
___Train Local_ResNet_18,  epoch 108, local model 41, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3845/4336 (88.6762%)
___Train Local_ResNet_18,  epoch 108, local model 41, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3943/4336 (90.9363%)
___Test Local_ResNet_18 poisoned: False, epoch: 108: Average loss: 1.8912, Accuracy: 5534/10000 (55.3400%)
___Train Local_ResNet_18,  epoch 108, local model 59, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3613/4046 (89.2981%)
___Train Local_ResNet_18,  epoch 108, local model 59, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3655/4046 (90.3361%)
___Test Local_ResNet_18 poisoned: False, epoch: 108: Average loss: 1.9692, Accuracy: 5425/10000 (54.2500%)
___Train Local_ResNet_18,  epoch 108, local model 84, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4211/4793 (87.8573%)
___Train Local_ResNet_18,  epoch 108, local model 84, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4307/4793 (89.8602%)
___Test Local_ResNet_18 poisoned: False, epoch: 108: Average loss: 2.0207, Accuracy: 5392/10000 (53.9200%)
___Train Local_ResNet_18,  epoch 108, local model 26, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3340/3756 (88.9244%)
___Train Local_ResNet_18,  epoch 108, local model 26, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3496/3756 (93.0777%)
___Test Local_ResNet_18 poisoned: False, epoch: 108: Average loss: 2.0422, Accuracy: 5408/10000 (54.0800%)
___Train Local_ResNet_18,  epoch 108, local model 85, internal_epoch   1,  Average loss: 0.0052, Accuracy: 5727/6391 (89.6104%)
___Train Local_ResNet_18,  epoch 108, local model 85, internal_epoch   2,  Average loss: 0.0053, Accuracy: 5720/6391 (89.5009%)
___Test Local_ResNet_18 poisoned: False, epoch: 108: Average loss: 2.1689, Accuracy: 5265/10000 (52.6500%)
___Train Local_ResNet_18,  epoch 108, local model 87, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3186/3672 (86.7647%)
___Train Local_ResNet_18,  epoch 108, local model 87, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3313/3672 (90.2233%)
___Test Local_ResNet_18 poisoned: False, epoch: 108: Average loss: 1.8749, Accuracy: 5590/10000 (55.9000%)
___Train Local_ResNet_18,  epoch 108, local model 57, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3984/4558 (87.4068%)
___Train Local_ResNet_18,  epoch 108, local model 57, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4099/4558 (89.9298%)
___Test Local_ResNet_18 poisoned: False, epoch: 108: Average loss: 2.0427, Accuracy: 5407/10000 (54.0700%)
___Train Local_ResNet_18,  epoch 108, local model 43, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4015/4576 (87.7404%)
___Train Local_ResNet_18,  epoch 108, local model 43, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4148/4576 (90.6469%)
___Test Local_ResNet_18 poisoned: False, epoch: 108: Average loss: 1.8781, Accuracy: 5677/10000 (56.7700%)
___Train Local_ResNet_18,  epoch 108, local model 66, internal_epoch   1,  Average loss: 0.0050, Accuracy: 4027/4456 (90.3725%)
___Train Local_ResNet_18,  epoch 108, local model 66, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4151/4456 (93.1553%)
___Test Local_ResNet_18 poisoned: False, epoch: 108: Average loss: 1.9258, Accuracy: 5629/10000 (56.2900%)
___Train Local_ResNet_18,  epoch 108, local model 55, internal_epoch   1,  Average loss: 0.0028, Accuracy: 4157/4356 (95.4316%)
___Train Local_ResNet_18,  epoch 108, local model 55, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3955/4356 (90.7943%)
___Test Local_ResNet_18 poisoned: False, epoch: 108: Average loss: 1.9985, Accuracy: 5567/10000 (55.6700%)
time spent on training: 265.7877850532532
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 108: Average loss: 1.6414, Accuracy: 6215/10000 (62.1500%)
___Test Target_ResNet_18 poisoned: True, epoch: 108: Average loss: 8.7107, Accuracy: 161/9900 (1.6263%)
Done in 296.308265209198 sec.
Server Epoch:109 choose agents : [13, 36, 58, 71, 67, 15, 19, 61, 91, 62, 53, 37, 80, 96, 84, 34, 35, 33, 64, 47].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 109, local model 13, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4406/4885 (90.1945%), train_poison_data_count: 385
Global model norm: 43.81597146553697.
Norm before scaling: 43.8124609932066. Distance: 2.098186063721615
Total norm for 4 adversaries is: 43.8124609932066. distance: 2.098186063721615
___Test Local_ResNet_18 poisoned: True, epoch: 109: Average loss: 0.1897, Accuracy: 9426/9900 (95.2121%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 109, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4751/5305 (89.5570%), train_poison_data_count: 415
Global model norm: 43.81597146553697.
Norm before scaling: 43.81239969674681. Distance: 2.1987051491123486
Total norm for 4 adversaries is: 43.81239969674681. distance: 2.1987051491123486
___Test Local_ResNet_18 poisoned: True, epoch: 109: Average loss: 0.2641, Accuracy: 9263/9900 (93.5657%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 109, local model 58, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4216/4717 (89.3788%), train_poison_data_count: 370
Global model norm: 43.81597146553697.
Norm before scaling: 43.81086725737976. Distance: 2.11872126917081
Total norm for 4 adversaries is: 43.81086725737976. distance: 2.11872126917081
___Test Local_ResNet_18 poisoned: True, epoch: 109: Average loss: 0.0971, Accuracy: 9637/9900 (97.3434%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 109, local model 71, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4509/5066 (89.0051%), train_poison_data_count: 400
Global model norm: 43.81597146553697.
Norm before scaling: 43.81567197192761. Distance: 2.2233197071776942
Total norm for 4 adversaries is: 43.81567197192761. distance: 2.2233197071776942
___Test Local_ResNet_18 poisoned: True, epoch: 109: Average loss: 0.2042, Accuracy: 9374/9900 (94.6869%)
___Train Local_ResNet_18,  epoch 109, local model 67, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4492/5116 (87.8030%)
___Train Local_ResNet_18,  epoch 109, local model 67, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4590/5116 (89.7185%)
___Test Local_ResNet_18 poisoned: False, epoch: 109: Average loss: 2.0980, Accuracy: 5308/10000 (53.0800%)
___Train Local_ResNet_18,  epoch 109, local model 15, internal_epoch   1,  Average loss: 0.0051, Accuracy: 5051/5582 (90.4873%)
___Train Local_ResNet_18,  epoch 109, local model 15, internal_epoch   2,  Average loss: 0.0044, Accuracy: 5103/5582 (91.4188%)
___Test Local_ResNet_18 poisoned: False, epoch: 109: Average loss: 2.1184, Accuracy: 5320/10000 (53.2000%)
___Train Local_ResNet_18,  epoch 109, local model 19, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4296/4928 (87.1753%)
___Train Local_ResNet_18,  epoch 109, local model 19, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4473/4928 (90.7670%)
___Test Local_ResNet_18 poisoned: False, epoch: 109: Average loss: 1.9463, Accuracy: 5547/10000 (55.4700%)
___Train Local_ResNet_18,  epoch 109, local model 61, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3699/4126 (89.6510%)
___Train Local_ResNet_18,  epoch 109, local model 61, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3793/4126 (91.9292%)
___Test Local_ResNet_18 poisoned: False, epoch: 109: Average loss: 1.7419, Accuracy: 5840/10000 (58.4000%)
___Train Local_ResNet_18,  epoch 109, local model 91, internal_epoch   1,  Average loss: 0.0078, Accuracy: 3506/4158 (84.3194%)
___Train Local_ResNet_18,  epoch 109, local model 91, internal_epoch   2,  Average loss: 0.0060, Accuracy: 3674/4158 (88.3598%)
___Test Local_ResNet_18 poisoned: False, epoch: 109: Average loss: 1.9020, Accuracy: 5571/10000 (55.7100%)
___Train Local_ResNet_18,  epoch 109, local model 62, internal_epoch   1,  Average loss: 0.0052, Accuracy: 4543/5063 (89.7294%)
___Train Local_ResNet_18,  epoch 109, local model 62, internal_epoch   2,  Average loss: 0.0062, Accuracy: 4457/5063 (88.0308%)
___Test Local_ResNet_18 poisoned: False, epoch: 109: Average loss: 2.1825, Accuracy: 5283/10000 (52.8300%)
___Train Local_ResNet_18,  epoch 109, local model 53, internal_epoch   1,  Average loss: 0.0061, Accuracy: 5382/6124 (87.8837%)
___Train Local_ResNet_18,  epoch 109, local model 53, internal_epoch   2,  Average loss: 0.0051, Accuracy: 5526/6124 (90.2351%)
___Test Local_ResNet_18 poisoned: False, epoch: 109: Average loss: 2.0106, Accuracy: 5365/10000 (53.6500%)
___Train Local_ResNet_18,  epoch 109, local model 37, internal_epoch   1,  Average loss: 0.0031, Accuracy: 4134/4354 (94.9472%)
___Train Local_ResNet_18,  epoch 109, local model 37, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4044/4354 (92.8801%)
___Test Local_ResNet_18 poisoned: False, epoch: 109: Average loss: 2.1854, Accuracy: 5222/10000 (52.2200%)
___Train Local_ResNet_18,  epoch 109, local model 80, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4430/5025 (88.1592%)
___Train Local_ResNet_18,  epoch 109, local model 80, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4605/5025 (91.6418%)
___Test Local_ResNet_18 poisoned: False, epoch: 109: Average loss: 1.9677, Accuracy: 5548/10000 (55.4800%)
___Train Local_ResNet_18,  epoch 109, local model 96, internal_epoch   1,  Average loss: 0.0037, Accuracy: 4357/4679 (93.1182%)
___Train Local_ResNet_18,  epoch 109, local model 96, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4249/4679 (90.8100%)
___Test Local_ResNet_18 poisoned: False, epoch: 109: Average loss: 2.0525, Accuracy: 5354/10000 (53.5400%)
___Train Local_ResNet_18,  epoch 109, local model 84, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4200/4793 (87.6278%)
___Train Local_ResNet_18,  epoch 109, local model 84, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4349/4793 (90.7365%)
___Test Local_ResNet_18 poisoned: False, epoch: 109: Average loss: 1.8881, Accuracy: 5597/10000 (55.9700%)
___Train Local_ResNet_18,  epoch 109, local model 34, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4050/4518 (89.6414%)
___Train Local_ResNet_18,  epoch 109, local model 34, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4126/4518 (91.3236%)
___Test Local_ResNet_18 poisoned: False, epoch: 109: Average loss: 1.8794, Accuracy: 5636/10000 (56.3600%)
___Train Local_ResNet_18,  epoch 109, local model 35, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4551/5167 (88.0782%)
___Train Local_ResNet_18,  epoch 109, local model 35, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4678/5167 (90.5361%)
___Test Local_ResNet_18 poisoned: False, epoch: 109: Average loss: 2.0323, Accuracy: 5445/10000 (54.4500%)
___Train Local_ResNet_18,  epoch 109, local model 33, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3986/4433 (89.9165%)
___Train Local_ResNet_18,  epoch 109, local model 33, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4031/4433 (90.9316%)
___Test Local_ResNet_18 poisoned: False, epoch: 109: Average loss: 1.8432, Accuracy: 5721/10000 (57.2100%)
___Train Local_ResNet_18,  epoch 109, local model 64, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4004/4503 (88.9185%)
___Train Local_ResNet_18,  epoch 109, local model 64, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4065/4503 (90.2732%)
___Test Local_ResNet_18 poisoned: False, epoch: 109: Average loss: 2.0946, Accuracy: 5369/10000 (53.6900%)
___Train Local_ResNet_18,  epoch 109, local model 47, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4148/4707 (88.1241%)
___Train Local_ResNet_18,  epoch 109, local model 47, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4301/4707 (91.3745%)
___Test Local_ResNet_18 poisoned: False, epoch: 109: Average loss: 1.8887, Accuracy: 5639/10000 (56.3900%)
time spent on training: 272.7409327030182
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 109: Average loss: 1.7432, Accuracy: 6036/10000 (60.3600%)
___Test Target_ResNet_18 poisoned: True, epoch: 109: Average loss: 8.4401, Accuracy: 230/9900 (2.3232%)
Done in 303.50745940208435 sec.
Server Epoch:110 choose agents : [13, 36, 58, 71, 4, 70, 90, 6, 23, 26, 96, 30, 85, 9, 25, 53, 12, 99, 60, 3].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 110, local model 13, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4366/4885 (89.3756%), train_poison_data_count: 385
Global model norm: 43.84293282604464.
Norm before scaling: 43.840752692896224. Distance: 2.142023785078846
Total norm for 4 adversaries is: 43.840752692896224. distance: 2.142023785078846
___Test Local_ResNet_18 poisoned: True, epoch: 110: Average loss: 0.2252, Accuracy: 9343/9900 (94.3737%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 110, local model 36, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4747/5305 (89.4816%), train_poison_data_count: 415
Global model norm: 43.84293282604464.
Norm before scaling: 43.839480202370815. Distance: 2.207964620458796
Total norm for 4 adversaries is: 43.839480202370815. distance: 2.207964620458796
___Test Local_ResNet_18 poisoned: True, epoch: 110: Average loss: 0.2098, Accuracy: 9375/9900 (94.6970%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 110, local model 58, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4224/4717 (89.5484%), train_poison_data_count: 370
Global model norm: 43.84293282604464.
Norm before scaling: 43.84061625694902. Distance: 2.119333453568492
Total norm for 4 adversaries is: 43.84061625694902. distance: 2.119333453568492
___Test Local_ResNet_18 poisoned: True, epoch: 110: Average loss: 0.1421, Accuracy: 9500/9900 (95.9596%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 110, local model 71, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4457/5066 (87.9787%), train_poison_data_count: 400
Global model norm: 43.84293282604464.
Norm before scaling: 43.84180936100693. Distance: 2.2581966297773524
Total norm for 4 adversaries is: 43.84180936100693. distance: 2.2581966297773524
___Test Local_ResNet_18 poisoned: True, epoch: 110: Average loss: 0.1930, Accuracy: 9439/9900 (95.3434%)
___Train Local_ResNet_18,  epoch 110, local model 4, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3211/3704 (86.6901%)
___Train Local_ResNet_18,  epoch 110, local model 4, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3370/3704 (90.9827%)
___Test Local_ResNet_18 poisoned: False, epoch: 110: Average loss: 1.8300, Accuracy: 5792/10000 (57.9200%)
___Train Local_ResNet_18,  epoch 110, local model 70, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4724/5392 (87.6113%)
___Train Local_ResNet_18,  epoch 110, local model 70, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4859/5392 (90.1150%)
___Test Local_ResNet_18 poisoned: False, epoch: 110: Average loss: 2.0770, Accuracy: 5420/10000 (54.2000%)
___Train Local_ResNet_18,  epoch 110, local model 90, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3919/4362 (89.8441%)
___Train Local_ResNet_18,  epoch 110, local model 90, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4047/4362 (92.7785%)
___Test Local_ResNet_18 poisoned: False, epoch: 110: Average loss: 1.9171, Accuracy: 5505/10000 (55.0500%)
___Train Local_ResNet_18,  epoch 110, local model 6, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4044/4538 (89.1141%)
___Train Local_ResNet_18,  epoch 110, local model 6, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4204/4538 (92.6399%)
___Test Local_ResNet_18 poisoned: False, epoch: 110: Average loss: 1.8802, Accuracy: 5747/10000 (57.4700%)
___Train Local_ResNet_18,  epoch 110, local model 23, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3686/4184 (88.0975%)
___Train Local_ResNet_18,  epoch 110, local model 23, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3786/4184 (90.4876%)
___Test Local_ResNet_18 poisoned: False, epoch: 110: Average loss: 1.8355, Accuracy: 5747/10000 (57.4700%)
___Train Local_ResNet_18,  epoch 110, local model 26, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3331/3756 (88.6848%)
___Train Local_ResNet_18,  epoch 110, local model 26, internal_epoch   2,  Average loss: 0.0035, Accuracy: 3510/3756 (93.4505%)
___Test Local_ResNet_18 poisoned: False, epoch: 110: Average loss: 1.8859, Accuracy: 5689/10000 (56.8900%)
___Train Local_ResNet_18,  epoch 110, local model 96, internal_epoch   1,  Average loss: 0.0041, Accuracy: 4345/4679 (92.8617%)
___Train Local_ResNet_18,  epoch 110, local model 96, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4282/4679 (91.5153%)
___Test Local_ResNet_18 poisoned: False, epoch: 110: Average loss: 1.9066, Accuracy: 5667/10000 (56.6700%)
___Train Local_ResNet_18,  epoch 110, local model 30, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3085/3472 (88.8537%)
___Train Local_ResNet_18,  epoch 110, local model 30, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3170/3472 (91.3018%)
___Test Local_ResNet_18 poisoned: False, epoch: 110: Average loss: 2.1118, Accuracy: 5342/10000 (53.4200%)
___Train Local_ResNet_18,  epoch 110, local model 85, internal_epoch   1,  Average loss: 0.0045, Accuracy: 5832/6391 (91.2533%)
___Train Local_ResNet_18,  epoch 110, local model 85, internal_epoch   2,  Average loss: 0.0042, Accuracy: 5853/6391 (91.5819%)
___Test Local_ResNet_18 poisoned: False, epoch: 110: Average loss: 1.9937, Accuracy: 5484/10000 (54.8400%)
___Train Local_ResNet_18,  epoch 110, local model 9, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4602/5265 (87.4074%)
___Train Local_ResNet_18,  epoch 110, local model 9, internal_epoch   2,  Average loss: 0.0067, Accuracy: 4558/5265 (86.5717%)
___Test Local_ResNet_18 poisoned: False, epoch: 110: Average loss: 2.0316, Accuracy: 5405/10000 (54.0500%)
___Train Local_ResNet_18,  epoch 110, local model 25, internal_epoch   1,  Average loss: 0.0053, Accuracy: 5285/5902 (89.5459%)
___Train Local_ResNet_18,  epoch 110, local model 25, internal_epoch   2,  Average loss: 0.0055, Accuracy: 5264/5902 (89.1901%)
___Test Local_ResNet_18 poisoned: False, epoch: 110: Average loss: 2.0559, Accuracy: 5473/10000 (54.7300%)
___Train Local_ResNet_18,  epoch 110, local model 53, internal_epoch   1,  Average loss: 0.0063, Accuracy: 5360/6124 (87.5245%)
___Train Local_ResNet_18,  epoch 110, local model 53, internal_epoch   2,  Average loss: 0.0059, Accuracy: 5394/6124 (88.0797%)
___Test Local_ResNet_18 poisoned: False, epoch: 110: Average loss: 1.9883, Accuracy: 5438/10000 (54.3800%)
___Train Local_ResNet_18,  epoch 110, local model 12, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4464/5083 (87.8222%)
___Train Local_ResNet_18,  epoch 110, local model 12, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4523/5083 (88.9829%)
___Test Local_ResNet_18 poisoned: False, epoch: 110: Average loss: 2.0199, Accuracy: 5478/10000 (54.7800%)
___Train Local_ResNet_18,  epoch 110, local model 99, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3923/4465 (87.8611%)
___Train Local_ResNet_18,  epoch 110, local model 99, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4085/4465 (91.4894%)
___Test Local_ResNet_18 poisoned: False, epoch: 110: Average loss: 1.9073, Accuracy: 5635/10000 (56.3500%)
___Train Local_ResNet_18,  epoch 110, local model 60, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3328/3804 (87.4869%)
___Train Local_ResNet_18,  epoch 110, local model 60, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3453/3804 (90.7729%)
___Test Local_ResNet_18 poisoned: False, epoch: 110: Average loss: 1.9478, Accuracy: 5577/10000 (55.7700%)
___Train Local_ResNet_18,  epoch 110, local model 3, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4330/4918 (88.0439%)
___Train Local_ResNet_18,  epoch 110, local model 3, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4487/4918 (91.2363%)
___Test Local_ResNet_18 poisoned: False, epoch: 110: Average loss: 2.0822, Accuracy: 5372/10000 (53.7200%)
time spent on training: 269.455783367157
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 110: Average loss: 1.7232, Accuracy: 6109/10000 (61.0900%)
___Test Target_ResNet_18 poisoned: True, epoch: 110: Average loss: 8.6873, Accuracy: 197/9900 (1.9899%)
Done in 300.1082444190979 sec.
Server Epoch:111 choose agents : [13, 36, 58, 71, 6, 56, 84, 91, 14, 22, 10, 49, 35, 74, 37, 40, 66, 83, 68, 32].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 111, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4408/4885 (90.2354%), train_poison_data_count: 385
Global model norm: 43.88031373627301.
Norm before scaling: 43.87632849439932. Distance: 2.1131094194597733
Total norm for 4 adversaries is: 43.87632849439932. distance: 2.1131094194597733
___Test Local_ResNet_18 poisoned: True, epoch: 111: Average loss: 0.3208, Accuracy: 9136/9900 (92.2828%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 111, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4737/5305 (89.2931%), train_poison_data_count: 415
Global model norm: 43.88031373627301.
Norm before scaling: 43.876762506888966. Distance: 2.212032518730708
Total norm for 4 adversaries is: 43.876762506888966. distance: 2.212032518730708
___Test Local_ResNet_18 poisoned: True, epoch: 111: Average loss: 0.2232, Accuracy: 9336/9900 (94.3030%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 111, local model 58, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4250/4717 (90.0996%), train_poison_data_count: 370
Global model norm: 43.88031373627301.
Norm before scaling: 43.87918983733918. Distance: 2.046618380002847
Total norm for 4 adversaries is: 43.87918983733918. distance: 2.046618380002847
___Test Local_ResNet_18 poisoned: True, epoch: 111: Average loss: 0.1699, Accuracy: 9498/9900 (95.9394%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 111, local model 71, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4488/5066 (88.5906%), train_poison_data_count: 400
Global model norm: 43.88031373627301.
Norm before scaling: 43.8857547805236. Distance: 2.2878305290188123
Total norm for 4 adversaries is: 43.8857547805236. distance: 2.2878305290188123
___Test Local_ResNet_18 poisoned: True, epoch: 111: Average loss: 0.2090, Accuracy: 9350/9900 (94.4444%)
___Train Local_ResNet_18,  epoch 111, local model 6, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4052/4538 (89.2904%)
___Train Local_ResNet_18,  epoch 111, local model 6, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4202/4538 (92.5959%)
___Test Local_ResNet_18 poisoned: False, epoch: 111: Average loss: 1.9709, Accuracy: 5604/10000 (56.0400%)
___Train Local_ResNet_18,  epoch 111, local model 56, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4303/4989 (86.2497%)
___Train Local_ResNet_18,  epoch 111, local model 56, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4487/4989 (89.9379%)
___Test Local_ResNet_18 poisoned: False, epoch: 111: Average loss: 1.8801, Accuracy: 5688/10000 (56.8800%)
___Train Local_ResNet_18,  epoch 111, local model 84, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4182/4793 (87.2522%)
___Train Local_ResNet_18,  epoch 111, local model 84, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4349/4793 (90.7365%)
___Test Local_ResNet_18 poisoned: False, epoch: 111: Average loss: 1.9986, Accuracy: 5436/10000 (54.3600%)
___Train Local_ResNet_18,  epoch 111, local model 91, internal_epoch   1,  Average loss: 0.0077, Accuracy: 3534/4158 (84.9928%)
___Train Local_ResNet_18,  epoch 111, local model 91, internal_epoch   2,  Average loss: 0.0062, Accuracy: 3653/4158 (87.8547%)
___Test Local_ResNet_18 poisoned: False, epoch: 111: Average loss: 2.0119, Accuracy: 5390/10000 (53.9000%)
___Train Local_ResNet_18,  epoch 111, local model 14, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3412/3861 (88.3709%)
___Train Local_ResNet_18,  epoch 111, local model 14, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3489/3861 (90.3652%)
___Test Local_ResNet_18 poisoned: False, epoch: 111: Average loss: 1.9329, Accuracy: 5602/10000 (56.0200%)
___Train Local_ResNet_18,  epoch 111, local model 22, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4530/5232 (86.5826%)
___Train Local_ResNet_18,  epoch 111, local model 22, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4666/5232 (89.1820%)
___Test Local_ResNet_18 poisoned: False, epoch: 111: Average loss: 2.1491, Accuracy: 5195/10000 (51.9500%)
___Train Local_ResNet_18,  epoch 111, local model 10, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4152/4663 (89.0414%)
___Train Local_ResNet_18,  epoch 111, local model 10, internal_epoch   2,  Average loss: 0.0036, Accuracy: 4342/4663 (93.1160%)
___Test Local_ResNet_18 poisoned: False, epoch: 111: Average loss: 1.8341, Accuracy: 5702/10000 (57.0200%)
___Train Local_ResNet_18,  epoch 111, local model 49, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4632/5197 (89.1283%)
___Train Local_ResNet_18,  epoch 111, local model 49, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4672/5197 (89.8980%)
___Test Local_ResNet_18 poisoned: False, epoch: 111: Average loss: 1.9998, Accuracy: 5397/10000 (53.9700%)
___Train Local_ResNet_18,  epoch 111, local model 35, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4592/5167 (88.8717%)
___Train Local_ResNet_18,  epoch 111, local model 35, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4644/5167 (89.8781%)
___Test Local_ResNet_18 poisoned: False, epoch: 111: Average loss: 2.0789, Accuracy: 5346/10000 (53.4600%)
___Train Local_ResNet_18,  epoch 111, local model 74, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3856/4416 (87.3188%)
___Train Local_ResNet_18,  epoch 111, local model 74, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3977/4416 (90.0589%)
___Test Local_ResNet_18 poisoned: False, epoch: 111: Average loss: 1.8093, Accuracy: 5783/10000 (57.8300%)
___Train Local_ResNet_18,  epoch 111, local model 37, internal_epoch   1,  Average loss: 0.0027, Accuracy: 4214/4354 (96.7846%)
___Train Local_ResNet_18,  epoch 111, local model 37, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3969/4354 (91.1576%)
___Test Local_ResNet_18 poisoned: False, epoch: 111: Average loss: 2.2147, Accuracy: 5194/10000 (51.9400%)
___Train Local_ResNet_18,  epoch 111, local model 40, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4871/5455 (89.2942%)
___Train Local_ResNet_18,  epoch 111, local model 40, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4864/5455 (89.1659%)
___Test Local_ResNet_18 poisoned: False, epoch: 111: Average loss: 2.0233, Accuracy: 5420/10000 (54.2000%)
___Train Local_ResNet_18,  epoch 111, local model 66, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4046/4456 (90.7989%)
___Train Local_ResNet_18,  epoch 111, local model 66, internal_epoch   2,  Average loss: 0.0037, Accuracy: 4144/4456 (92.9982%)
___Test Local_ResNet_18 poisoned: False, epoch: 111: Average loss: 1.8929, Accuracy: 5716/10000 (57.1600%)
___Train Local_ResNet_18,  epoch 111, local model 83, internal_epoch   1,  Average loss: 0.0060, Accuracy: 2881/3271 (88.0770%)
___Train Local_ResNet_18,  epoch 111, local model 83, internal_epoch   2,  Average loss: 0.0054, Accuracy: 2920/3271 (89.2693%)
___Test Local_ResNet_18 poisoned: False, epoch: 111: Average loss: 1.8921, Accuracy: 5669/10000 (56.6900%)
___Train Local_ResNet_18,  epoch 111, local model 68, internal_epoch   1,  Average loss: 0.0057, Accuracy: 2950/3297 (89.4753%)
___Train Local_ResNet_18,  epoch 111, local model 68, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3051/3297 (92.5387%)
___Test Local_ResNet_18 poisoned: False, epoch: 111: Average loss: 1.7302, Accuracy: 5901/10000 (59.0100%)
___Train Local_ResNet_18,  epoch 111, local model 32, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4945/5591 (88.4457%)
___Train Local_ResNet_18,  epoch 111, local model 32, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4972/5591 (88.9286%)
___Test Local_ResNet_18 poisoned: False, epoch: 111: Average loss: 2.2965, Accuracy: 5088/10000 (50.8800%)
time spent on training: 267.9137215614319
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 111: Average loss: 1.7858, Accuracy: 6038/10000 (60.3800%)
___Test Target_ResNet_18 poisoned: True, epoch: 111: Average loss: 8.4299, Accuracy: 354/9900 (3.5758%)
Done in 298.3277060985565 sec.
Server Epoch:112 choose agents : [13, 36, 58, 71, 35, 51, 54, 61, 18, 33, 83, 63, 3, 1, 86, 75, 55, 84, 20, 94].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 112, local model 13, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4410/4885 (90.2764%), train_poison_data_count: 385
Global model norm: 43.910510525047556.
Norm before scaling: 43.90672124969522. Distance: 2.1298085951434746
Total norm for 4 adversaries is: 43.90672124969522. distance: 2.1298085951434746
___Test Local_ResNet_18 poisoned: True, epoch: 112: Average loss: 0.1644, Accuracy: 9476/9900 (95.7172%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 112, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4766/5305 (89.8398%), train_poison_data_count: 415
Global model norm: 43.910510525047556.
Norm before scaling: 43.91005877607943. Distance: 2.222907885099427
Total norm for 4 adversaries is: 43.91005877607943. distance: 2.222907885099427
___Test Local_ResNet_18 poisoned: True, epoch: 112: Average loss: 0.3966, Accuracy: 8943/9900 (90.3333%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 112, local model 58, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4226/4717 (89.5908%), train_poison_data_count: 370
Global model norm: 43.910510525047556.
Norm before scaling: 43.90783471339426. Distance: 2.117590608966383
Total norm for 4 adversaries is: 43.90783471339426. distance: 2.117590608966383
___Test Local_ResNet_18 poisoned: True, epoch: 112: Average loss: 0.1602, Accuracy: 9514/9900 (96.1010%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 112, local model 71, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4476/5066 (88.3537%), train_poison_data_count: 400
Global model norm: 43.910510525047556.
Norm before scaling: 43.91434116950364. Distance: 2.308771271827076
Total norm for 4 adversaries is: 43.91434116950364. distance: 2.308771271827076
___Test Local_ResNet_18 poisoned: True, epoch: 112: Average loss: 0.1972, Accuracy: 9381/9900 (94.7576%)
___Train Local_ResNet_18,  epoch 112, local model 35, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4542/5167 (87.9040%)
___Train Local_ResNet_18,  epoch 112, local model 35, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4666/5167 (90.3039%)
___Test Local_ResNet_18 poisoned: False, epoch: 112: Average loss: 2.1384, Accuracy: 5327/10000 (53.2700%)
___Train Local_ResNet_18,  epoch 112, local model 51, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3361/3775 (89.0331%)
___Train Local_ResNet_18,  epoch 112, local model 51, internal_epoch   2,  Average loss: 0.0035, Accuracy: 3513/3775 (93.0596%)
___Test Local_ResNet_18 poisoned: False, epoch: 112: Average loss: 1.8593, Accuracy: 5697/10000 (56.9700%)
___Train Local_ResNet_18,  epoch 112, local model 54, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4484/5195 (86.3138%)
___Train Local_ResNet_18,  epoch 112, local model 54, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4609/5195 (88.7199%)
___Test Local_ResNet_18 poisoned: False, epoch: 112: Average loss: 2.1780, Accuracy: 5245/10000 (52.4500%)
___Train Local_ResNet_18,  epoch 112, local model 61, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3647/4126 (88.3907%)
___Train Local_ResNet_18,  epoch 112, local model 61, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3813/4126 (92.4140%)
___Test Local_ResNet_18 poisoned: False, epoch: 112: Average loss: 1.8090, Accuracy: 5744/10000 (57.4400%)
___Train Local_ResNet_18,  epoch 112, local model 18, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3490/3911 (89.2355%)
___Train Local_ResNet_18,  epoch 112, local model 18, internal_epoch   2,  Average loss: 0.0071, Accuracy: 3388/3911 (86.6275%)
___Test Local_ResNet_18 poisoned: False, epoch: 112: Average loss: 2.2518, Accuracy: 5173/10000 (51.7300%)
___Train Local_ResNet_18,  epoch 112, local model 33, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3955/4433 (89.2172%)
___Train Local_ResNet_18,  epoch 112, local model 33, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4051/4433 (91.3828%)
___Test Local_ResNet_18 poisoned: False, epoch: 112: Average loss: 1.8658, Accuracy: 5668/10000 (56.6800%)
___Train Local_ResNet_18,  epoch 112, local model 83, internal_epoch   1,  Average loss: 0.0067, Accuracy: 2823/3271 (86.3039%)
___Train Local_ResNet_18,  epoch 112, local model 83, internal_epoch   2,  Average loss: 0.0060, Accuracy: 2878/3271 (87.9853%)
___Test Local_ResNet_18 poisoned: False, epoch: 112: Average loss: 1.9330, Accuracy: 5542/10000 (55.4200%)
___Train Local_ResNet_18,  epoch 112, local model 63, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3212/3590 (89.4708%)
___Train Local_ResNet_18,  epoch 112, local model 63, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3214/3590 (89.5265%)
___Test Local_ResNet_18 poisoned: False, epoch: 112: Average loss: 2.0473, Accuracy: 5500/10000 (55.0000%)
___Train Local_ResNet_18,  epoch 112, local model 3, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4275/4918 (86.9256%)
___Train Local_ResNet_18,  epoch 112, local model 3, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4500/4918 (91.5006%)
___Test Local_ResNet_18 poisoned: False, epoch: 112: Average loss: 2.1528, Accuracy: 5113/10000 (51.1300%)
___Train Local_ResNet_18,  epoch 112, local model 1, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4361/4986 (87.4649%)
___Train Local_ResNet_18,  epoch 112, local model 1, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4444/4986 (89.1296%)
___Test Local_ResNet_18 poisoned: False, epoch: 112: Average loss: 1.8705, Accuracy: 5699/10000 (56.9900%)
___Train Local_ResNet_18,  epoch 112, local model 86, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3147/3616 (87.0299%)
___Train Local_ResNet_18,  epoch 112, local model 86, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3307/3616 (91.4546%)
___Test Local_ResNet_18 poisoned: False, epoch: 112: Average loss: 1.8547, Accuracy: 5853/10000 (58.5300%)
___Train Local_ResNet_18,  epoch 112, local model 75, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3800/4295 (88.4750%)
___Train Local_ResNet_18,  epoch 112, local model 75, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3918/4295 (91.2224%)
___Test Local_ResNet_18 poisoned: False, epoch: 112: Average loss: 2.0156, Accuracy: 5545/10000 (55.4500%)
___Train Local_ResNet_18,  epoch 112, local model 55, internal_epoch   1,  Average loss: 0.0037, Accuracy: 4071/4356 (93.4573%)
___Train Local_ResNet_18,  epoch 112, local model 55, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4052/4356 (93.0211%)
___Test Local_ResNet_18 poisoned: False, epoch: 112: Average loss: 1.8959, Accuracy: 5637/10000 (56.3700%)
___Train Local_ResNet_18,  epoch 112, local model 84, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4198/4793 (87.5861%)
___Train Local_ResNet_18,  epoch 112, local model 84, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4390/4793 (91.5919%)
___Test Local_ResNet_18 poisoned: False, epoch: 112: Average loss: 1.9651, Accuracy: 5496/10000 (54.9600%)
___Train Local_ResNet_18,  epoch 112, local model 20, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3885/4315 (90.0348%)
___Train Local_ResNet_18,  epoch 112, local model 20, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3970/4315 (92.0046%)
___Test Local_ResNet_18 poisoned: False, epoch: 112: Average loss: 1.9146, Accuracy: 5566/10000 (55.6600%)
___Train Local_ResNet_18,  epoch 112, local model 94, internal_epoch   1,  Average loss: 0.0049, Accuracy: 4336/4804 (90.2581%)
___Train Local_ResNet_18,  epoch 112, local model 94, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4443/4804 (92.4854%)
___Test Local_ResNet_18 poisoned: False, epoch: 112: Average loss: 2.0560, Accuracy: 5497/10000 (54.9700%)
time spent on training: 263.02804923057556
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 112: Average loss: 1.7695, Accuracy: 6070/10000 (60.7000%)
___Test Target_ResNet_18 poisoned: True, epoch: 112: Average loss: 7.9249, Accuracy: 454/9900 (4.5859%)
Done in 293.8619055747986 sec.
Server Epoch:113 choose agents : [13, 36, 58, 71, 64, 88, 94, 66, 93, 23, 19, 51, 12, 40, 76, 18, 39, 8, 49, 14].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 113, local model 13, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4404/4885 (90.1535%), train_poison_data_count: 385
Global model norm: 43.9395322587438.
Norm before scaling: 43.93588579449463. Distance: 2.1124279393653245
Total norm for 4 adversaries is: 43.93588579449463. distance: 2.1124279393653245
___Test Local_ResNet_18 poisoned: True, epoch: 113: Average loss: 0.1690, Accuracy: 9471/9900 (95.6667%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 113, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4761/5305 (89.7455%), train_poison_data_count: 415
Global model norm: 43.9395322587438.
Norm before scaling: 43.93432848839917. Distance: 2.2118387171563096
Total norm for 4 adversaries is: 43.93432848839917. distance: 2.2118387171563096
___Test Local_ResNet_18 poisoned: True, epoch: 113: Average loss: 0.1282, Accuracy: 9563/9900 (96.5960%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 113, local model 58, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4227/4717 (89.6120%), train_poison_data_count: 370
Global model norm: 43.9395322587438.
Norm before scaling: 43.93761390899175. Distance: 2.0919413939631215
Total norm for 4 adversaries is: 43.93761390899175. distance: 2.0919413939631215
___Test Local_ResNet_18 poisoned: True, epoch: 113: Average loss: 0.1358, Accuracy: 9536/9900 (96.3232%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 113, local model 71, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4478/5066 (88.3932%), train_poison_data_count: 400
Global model norm: 43.9395322587438.
Norm before scaling: 43.9424492122758. Distance: 2.2792411215532775
Total norm for 4 adversaries is: 43.9424492122758. distance: 2.2792411215532775
___Test Local_ResNet_18 poisoned: True, epoch: 113: Average loss: 0.1918, Accuracy: 9398/9900 (94.9293%)
___Train Local_ResNet_18,  epoch 113, local model 64, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3996/4503 (88.7408%)
___Train Local_ResNet_18,  epoch 113, local model 64, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4053/4503 (90.0067%)
___Test Local_ResNet_18 poisoned: False, epoch: 113: Average loss: 1.9472, Accuracy: 5530/10000 (55.3000%)
___Train Local_ResNet_18,  epoch 113, local model 88, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4310/4934 (87.3531%)
___Train Local_ResNet_18,  epoch 113, local model 88, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4376/4934 (88.6907%)
___Test Local_ResNet_18 poisoned: False, epoch: 113: Average loss: 2.1840, Accuracy: 5132/10000 (51.3200%)
___Train Local_ResNet_18,  epoch 113, local model 94, internal_epoch   1,  Average loss: 0.0046, Accuracy: 4382/4804 (91.2157%)
___Train Local_ResNet_18,  epoch 113, local model 94, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4314/4804 (89.8002%)
___Test Local_ResNet_18 poisoned: False, epoch: 113: Average loss: 2.1885, Accuracy: 5268/10000 (52.6800%)
___Train Local_ResNet_18,  epoch 113, local model 66, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3972/4456 (89.1382%)
___Train Local_ResNet_18,  epoch 113, local model 66, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4091/4456 (91.8088%)
___Test Local_ResNet_18 poisoned: False, epoch: 113: Average loss: 1.8836, Accuracy: 5608/10000 (56.0800%)
___Train Local_ResNet_18,  epoch 113, local model 93, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4065/4651 (87.4006%)
___Train Local_ResNet_18,  epoch 113, local model 93, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4238/4651 (91.1202%)
___Test Local_ResNet_18 poisoned: False, epoch: 113: Average loss: 2.0220, Accuracy: 5518/10000 (55.1800%)
___Train Local_ResNet_18,  epoch 113, local model 23, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3685/4184 (88.0736%)
___Train Local_ResNet_18,  epoch 113, local model 23, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3786/4184 (90.4876%)
___Test Local_ResNet_18 poisoned: False, epoch: 113: Average loss: 1.9645, Accuracy: 5470/10000 (54.7000%)
___Train Local_ResNet_18,  epoch 113, local model 19, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4240/4928 (86.0390%)
___Train Local_ResNet_18,  epoch 113, local model 19, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4422/4928 (89.7321%)
___Test Local_ResNet_18 poisoned: False, epoch: 113: Average loss: 1.9727, Accuracy: 5570/10000 (55.7000%)
___Train Local_ResNet_18,  epoch 113, local model 51, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3386/3775 (89.6954%)
___Train Local_ResNet_18,  epoch 113, local model 51, internal_epoch   2,  Average loss: 0.0032, Accuracy: 3541/3775 (93.8013%)
___Test Local_ResNet_18 poisoned: False, epoch: 113: Average loss: 1.9502, Accuracy: 5601/10000 (56.0100%)
___Train Local_ResNet_18,  epoch 113, local model 12, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4474/5083 (88.0189%)
___Train Local_ResNet_18,  epoch 113, local model 12, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4548/5083 (89.4747%)
___Test Local_ResNet_18 poisoned: False, epoch: 113: Average loss: 2.0485, Accuracy: 5444/10000 (54.4400%)
___Train Local_ResNet_18,  epoch 113, local model 40, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4792/5455 (87.8460%)
___Train Local_ResNet_18,  epoch 113, local model 40, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4899/5455 (89.8075%)
___Test Local_ResNet_18 poisoned: False, epoch: 113: Average loss: 1.9812, Accuracy: 5397/10000 (53.9700%)
___Train Local_ResNet_18,  epoch 113, local model 76, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3183/3638 (87.4931%)
___Train Local_ResNet_18,  epoch 113, local model 76, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3333/3638 (91.6163%)
___Test Local_ResNet_18 poisoned: False, epoch: 113: Average loss: 1.8433, Accuracy: 5703/10000 (57.0300%)
___Train Local_ResNet_18,  epoch 113, local model 18, internal_epoch   1,  Average loss: 0.0051, Accuracy: 3510/3911 (89.7469%)
___Train Local_ResNet_18,  epoch 113, local model 18, internal_epoch   2,  Average loss: 0.0038, Accuracy: 3633/3911 (92.8918%)
___Test Local_ResNet_18 poisoned: False, epoch: 113: Average loss: 1.8573, Accuracy: 5734/10000 (57.3400%)
___Train Local_ResNet_18,  epoch 113, local model 39, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3382/3837 (88.1418%)
___Train Local_ResNet_18,  epoch 113, local model 39, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3512/3837 (91.5298%)
___Test Local_ResNet_18 poisoned: False, epoch: 113: Average loss: 1.8953, Accuracy: 5620/10000 (56.2000%)
___Train Local_ResNet_18,  epoch 113, local model 8, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3981/4501 (88.4470%)
___Train Local_ResNet_18,  epoch 113, local model 8, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4043/4501 (89.8245%)
___Test Local_ResNet_18 poisoned: False, epoch: 113: Average loss: 1.9786, Accuracy: 5471/10000 (54.7100%)
___Train Local_ResNet_18,  epoch 113, local model 49, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4617/5197 (88.8397%)
___Train Local_ResNet_18,  epoch 113, local model 49, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4663/5197 (89.7248%)
___Test Local_ResNet_18 poisoned: False, epoch: 113: Average loss: 2.0837, Accuracy: 5373/10000 (53.7300%)
___Train Local_ResNet_18,  epoch 113, local model 14, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3378/3861 (87.4903%)
___Train Local_ResNet_18,  epoch 113, local model 14, internal_epoch   2,  Average loss: 0.0055, Accuracy: 3432/3861 (88.8889%)
___Test Local_ResNet_18 poisoned: False, epoch: 113: Average loss: 2.0233, Accuracy: 5499/10000 (54.9900%)
time spent on training: 266.2554700374603
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 113: Average loss: 1.7405, Accuracy: 6097/10000 (60.9700%)
___Test Target_ResNet_18 poisoned: True, epoch: 113: Average loss: 8.1987, Accuracy: 359/9900 (3.6263%)
Done in 296.8728258609772 sec.
Server Epoch:114 choose agents : [13, 36, 58, 71, 83, 17, 76, 15, 66, 25, 74, 88, 5, 39, 85, 50, 60, 92, 84, 42].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 114, local model 13, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4428/4885 (90.6448%), train_poison_data_count: 385
Global model norm: 43.973702635069294.
Norm before scaling: 43.971766343320375. Distance: 2.1116677715937917
Total norm for 4 adversaries is: 43.971766343320375. distance: 2.1116677715937917
___Test Local_ResNet_18 poisoned: True, epoch: 114: Average loss: 0.2401, Accuracy: 9282/9900 (93.7576%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 114, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4772/5305 (89.9529%), train_poison_data_count: 415
Global model norm: 43.973702635069294.
Norm before scaling: 43.97144847796124. Distance: 2.2185967620801224
Total norm for 4 adversaries is: 43.97144847796124. distance: 2.2185967620801224
___Test Local_ResNet_18 poisoned: True, epoch: 114: Average loss: 0.1424, Accuracy: 9538/9900 (96.3434%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 114, local model 58, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4267/4717 (90.4600%), train_poison_data_count: 370
Global model norm: 43.973702635069294.
Norm before scaling: 43.96660803462456. Distance: 2.011641002745217
Total norm for 4 adversaries is: 43.96660803462456. distance: 2.011641002745217
___Test Local_ResNet_18 poisoned: True, epoch: 114: Average loss: 0.1483, Accuracy: 9509/9900 (96.0505%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 114, local model 71, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4494/5066 (88.7090%), train_poison_data_count: 400
Global model norm: 43.973702635069294.
Norm before scaling: 43.975080889724495. Distance: 2.267868194295691
Total norm for 4 adversaries is: 43.975080889724495. distance: 2.267868194295691
___Test Local_ResNet_18 poisoned: True, epoch: 114: Average loss: 0.1256, Accuracy: 9542/9900 (96.3838%)
___Train Local_ResNet_18,  epoch 114, local model 83, internal_epoch   1,  Average loss: 0.0063, Accuracy: 2854/3271 (87.2516%)
___Train Local_ResNet_18,  epoch 114, local model 83, internal_epoch   2,  Average loss: 0.0051, Accuracy: 2948/3271 (90.1253%)
___Test Local_ResNet_18 poisoned: False, epoch: 114: Average loss: 1.9030, Accuracy: 5641/10000 (56.4100%)
___Train Local_ResNet_18,  epoch 114, local model 17, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3907/4511 (86.6105%)
___Train Local_ResNet_18,  epoch 114, local model 17, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4053/4511 (89.8470%)
___Test Local_ResNet_18 poisoned: False, epoch: 114: Average loss: 1.9969, Accuracy: 5462/10000 (54.6200%)
___Train Local_ResNet_18,  epoch 114, local model 76, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3162/3638 (86.9159%)
___Train Local_ResNet_18,  epoch 114, local model 76, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3299/3638 (90.6817%)
___Test Local_ResNet_18 poisoned: False, epoch: 114: Average loss: 1.9459, Accuracy: 5579/10000 (55.7900%)
___Train Local_ResNet_18,  epoch 114, local model 15, internal_epoch   1,  Average loss: 0.0051, Accuracy: 5031/5582 (90.1290%)
___Train Local_ResNet_18,  epoch 114, local model 15, internal_epoch   2,  Average loss: 0.0046, Accuracy: 5096/5582 (91.2934%)
___Test Local_ResNet_18 poisoned: False, epoch: 114: Average loss: 2.1231, Accuracy: 5281/10000 (52.8100%)
___Train Local_ResNet_18,  epoch 114, local model 66, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3980/4456 (89.3178%)
___Train Local_ResNet_18,  epoch 114, local model 66, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4091/4456 (91.8088%)
___Test Local_ResNet_18 poisoned: False, epoch: 114: Average loss: 2.0051, Accuracy: 5558/10000 (55.5800%)
___Train Local_ResNet_18,  epoch 114, local model 25, internal_epoch   1,  Average loss: 0.0052, Accuracy: 5305/5902 (89.8848%)
___Train Local_ResNet_18,  epoch 114, local model 25, internal_epoch   2,  Average loss: 0.0055, Accuracy: 5273/5902 (89.3426%)
___Test Local_ResNet_18 poisoned: False, epoch: 114: Average loss: 2.0125, Accuracy: 5469/10000 (54.6900%)
___Train Local_ResNet_18,  epoch 114, local model 74, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3818/4416 (86.4583%)
___Train Local_ResNet_18,  epoch 114, local model 74, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3972/4416 (89.9457%)
___Test Local_ResNet_18 poisoned: False, epoch: 114: Average loss: 1.8783, Accuracy: 5617/10000 (56.1700%)
___Train Local_ResNet_18,  epoch 114, local model 88, internal_epoch   1,  Average loss: 0.0050, Accuracy: 4461/4934 (90.4135%)
___Train Local_ResNet_18,  epoch 114, local model 88, internal_epoch   2,  Average loss: 0.0063, Accuracy: 4345/4934 (88.0624%)
___Test Local_ResNet_18 poisoned: False, epoch: 114: Average loss: 2.3948, Accuracy: 4937/10000 (49.3700%)
___Train Local_ResNet_18,  epoch 114, local model 5, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4076/4596 (88.6858%)
___Train Local_ResNet_18,  epoch 114, local model 5, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4260/4596 (92.6893%)
___Test Local_ResNet_18 poisoned: False, epoch: 114: Average loss: 1.9979, Accuracy: 5512/10000 (55.1200%)
___Train Local_ResNet_18,  epoch 114, local model 39, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3380/3837 (88.0897%)
___Train Local_ResNet_18,  epoch 114, local model 39, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3519/3837 (91.7123%)
___Test Local_ResNet_18 poisoned: False, epoch: 114: Average loss: 1.8721, Accuracy: 5675/10000 (56.7500%)
___Train Local_ResNet_18,  epoch 114, local model 85, internal_epoch   1,  Average loss: 0.0046, Accuracy: 5828/6391 (91.1907%)
___Train Local_ResNet_18,  epoch 114, local model 85, internal_epoch   2,  Average loss: 0.0045, Accuracy: 5811/6391 (90.9247%)
___Test Local_ResNet_18 poisoned: False, epoch: 114: Average loss: 2.0774, Accuracy: 5356/10000 (53.5600%)
___Train Local_ResNet_18,  epoch 114, local model 50, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3831/4368 (87.7060%)
___Train Local_ResNet_18,  epoch 114, local model 50, internal_epoch   2,  Average loss: 0.0056, Accuracy: 3890/4368 (89.0568%)
___Test Local_ResNet_18 poisoned: False, epoch: 114: Average loss: 1.9702, Accuracy: 5497/10000 (54.9700%)
___Train Local_ResNet_18,  epoch 114, local model 60, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3363/3804 (88.4069%)
___Train Local_ResNet_18,  epoch 114, local model 60, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3482/3804 (91.5352%)
___Test Local_ResNet_18 poisoned: False, epoch: 114: Average loss: 1.9627, Accuracy: 5648/10000 (56.4800%)
___Train Local_ResNet_18,  epoch 114, local model 92, internal_epoch   1,  Average loss: 0.0061, Accuracy: 5519/6263 (88.1207%)
___Train Local_ResNet_18,  epoch 114, local model 92, internal_epoch   2,  Average loss: 0.0046, Accuracy: 5694/6263 (90.9149%)
___Test Local_ResNet_18 poisoned: False, epoch: 114: Average loss: 2.1619, Accuracy: 5252/10000 (52.5200%)
___Train Local_ResNet_18,  epoch 114, local model 84, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4210/4793 (87.8364%)
___Train Local_ResNet_18,  epoch 114, local model 84, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4386/4793 (91.5084%)
___Test Local_ResNet_18 poisoned: False, epoch: 114: Average loss: 1.9946, Accuracy: 5510/10000 (55.1000%)
___Train Local_ResNet_18,  epoch 114, local model 42, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4820/5424 (88.8643%)
___Train Local_ResNet_18,  epoch 114, local model 42, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4957/5424 (91.3901%)
___Test Local_ResNet_18 poisoned: False, epoch: 114: Average loss: 2.1986, Accuracy: 5260/10000 (52.6000%)
time spent on training: 270.131769657135
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 114: Average loss: 1.8220, Accuracy: 5993/10000 (59.9300%)
___Test Target_ResNet_18 poisoned: True, epoch: 114: Average loss: 8.3780, Accuracy: 271/9900 (2.7374%)
Done in 300.6663076877594 sec.
Server Epoch:115 choose agents : [13, 36, 58, 71, 65, 23, 14, 94, 30, 24, 56, 15, 84, 44, 88, 1, 33, 28, 5, 37].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 115, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4414/4885 (90.3582%), train_poison_data_count: 385
Global model norm: 44.00873548317567.
Norm before scaling: 44.003944913709155. Distance: 2.1111502629826817
Total norm for 4 adversaries is: 44.003944913709155. distance: 2.1111502629826817
___Test Local_ResNet_18 poisoned: True, epoch: 115: Average loss: 0.3169, Accuracy: 9085/9900 (91.7677%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 115, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4759/5305 (89.7078%), train_poison_data_count: 415
Global model norm: 44.00873548317567.
Norm before scaling: 44.00385198204599. Distance: 2.190908229220468
Total norm for 4 adversaries is: 44.00385198204599. distance: 2.190908229220468
___Test Local_ResNet_18 poisoned: True, epoch: 115: Average loss: 0.1734, Accuracy: 9465/9900 (95.6061%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 115, local model 58, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4225/4717 (89.5696%), train_poison_data_count: 370
Global model norm: 44.00873548317567.
Norm before scaling: 44.00219166239052. Distance: 2.0734876935642874
Total norm for 4 adversaries is: 44.00219166239052. distance: 2.0734876935642874
___Test Local_ResNet_18 poisoned: True, epoch: 115: Average loss: 0.1808, Accuracy: 9428/9900 (95.2323%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 115, local model 71, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4475/5066 (88.3340%), train_poison_data_count: 400
Global model norm: 44.00873548317567.
Norm before scaling: 44.009555125936146. Distance: 2.322370239673435
Total norm for 4 adversaries is: 44.009555125936146. distance: 2.322370239673435
___Test Local_ResNet_18 poisoned: True, epoch: 115: Average loss: 0.3032, Accuracy: 9140/9900 (92.3232%)
___Train Local_ResNet_18,  epoch 115, local model 65, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4469/5055 (88.4075%)
___Train Local_ResNet_18,  epoch 115, local model 65, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4599/5055 (90.9792%)
___Test Local_ResNet_18 poisoned: False, epoch: 115: Average loss: 1.9685, Accuracy: 5534/10000 (55.3400%)
___Train Local_ResNet_18,  epoch 115, local model 23, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3674/4184 (87.8107%)
___Train Local_ResNet_18,  epoch 115, local model 23, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3765/4184 (89.9857%)
___Test Local_ResNet_18 poisoned: False, epoch: 115: Average loss: 1.9119, Accuracy: 5575/10000 (55.7500%)
___Train Local_ResNet_18,  epoch 115, local model 14, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3420/3861 (88.5781%)
___Train Local_ResNet_18,  epoch 115, local model 14, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3509/3861 (90.8832%)
___Test Local_ResNet_18 poisoned: False, epoch: 115: Average loss: 1.8657, Accuracy: 5649/10000 (56.4900%)
___Train Local_ResNet_18,  epoch 115, local model 94, internal_epoch   1,  Average loss: 0.0053, Accuracy: 4330/4804 (90.1332%)
___Train Local_ResNet_18,  epoch 115, local model 94, internal_epoch   2,  Average loss: 0.0092, Accuracy: 3987/4804 (82.9933%)
___Test Local_ResNet_18 poisoned: False, epoch: 115: Average loss: 2.4444, Accuracy: 4941/10000 (49.4100%)
___Train Local_ResNet_18,  epoch 115, local model 30, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3087/3472 (88.9113%)
___Train Local_ResNet_18,  epoch 115, local model 30, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3183/3472 (91.6763%)
___Test Local_ResNet_18 poisoned: False, epoch: 115: Average loss: 1.9179, Accuracy: 5566/10000 (55.6600%)
___Train Local_ResNet_18,  epoch 115, local model 24, internal_epoch   1,  Average loss: 0.0072, Accuracy: 3480/3969 (87.6795%)
___Train Local_ResNet_18,  epoch 115, local model 24, internal_epoch   2,  Average loss: 0.0060, Accuracy: 3587/3969 (90.3754%)
___Test Local_ResNet_18 poisoned: False, epoch: 115: Average loss: 1.9545, Accuracy: 5580/10000 (55.8000%)
___Train Local_ResNet_18,  epoch 115, local model 56, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4331/4989 (86.8110%)
___Train Local_ResNet_18,  epoch 115, local model 56, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4399/4989 (88.1740%)
___Test Local_ResNet_18 poisoned: False, epoch: 115: Average loss: 2.0249, Accuracy: 5486/10000 (54.8600%)
___Train Local_ResNet_18,  epoch 115, local model 15, internal_epoch   1,  Average loss: 0.0052, Accuracy: 4991/5582 (89.4124%)
___Train Local_ResNet_18,  epoch 115, local model 15, internal_epoch   2,  Average loss: 0.0046, Accuracy: 5098/5582 (91.3293%)
___Test Local_ResNet_18 poisoned: False, epoch: 115: Average loss: 2.0616, Accuracy: 5367/10000 (53.6700%)
___Train Local_ResNet_18,  epoch 115, local model 84, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4219/4793 (88.0242%)
___Train Local_ResNet_18,  epoch 115, local model 84, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4345/4793 (90.6530%)
___Test Local_ResNet_18 poisoned: False, epoch: 115: Average loss: 2.0231, Accuracy: 5530/10000 (55.3000%)
___Train Local_ResNet_18,  epoch 115, local model 44, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4070/4662 (87.3016%)
___Train Local_ResNet_18,  epoch 115, local model 44, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4196/4662 (90.0043%)
___Test Local_ResNet_18 poisoned: False, epoch: 115: Average loss: 2.0790, Accuracy: 5372/10000 (53.7200%)
___Train Local_ResNet_18,  epoch 115, local model 88, internal_epoch   1,  Average loss: 0.0043, Accuracy: 4522/4934 (91.6498%)
___Train Local_ResNet_18,  epoch 115, local model 88, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4501/4934 (91.2242%)
___Test Local_ResNet_18 poisoned: False, epoch: 115: Average loss: 2.0823, Accuracy: 5335/10000 (53.3500%)
___Train Local_ResNet_18,  epoch 115, local model 1, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4385/4986 (87.9462%)
___Train Local_ResNet_18,  epoch 115, local model 1, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4508/4986 (90.4132%)
___Test Local_ResNet_18 poisoned: False, epoch: 115: Average loss: 1.9013, Accuracy: 5627/10000 (56.2700%)
___Train Local_ResNet_18,  epoch 115, local model 33, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3961/4433 (89.3526%)
___Train Local_ResNet_18,  epoch 115, local model 33, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4012/4433 (90.5030%)
___Test Local_ResNet_18 poisoned: False, epoch: 115: Average loss: 1.8407, Accuracy: 5794/10000 (57.9400%)
___Train Local_ResNet_18,  epoch 115, local model 28, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4115/4716 (87.2561%)
___Train Local_ResNet_18,  epoch 115, local model 28, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4217/4716 (89.4190%)
___Test Local_ResNet_18 poisoned: False, epoch: 115: Average loss: 1.9880, Accuracy: 5379/10000 (53.7900%)
___Train Local_ResNet_18,  epoch 115, local model 5, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4092/4596 (89.0339%)
___Train Local_ResNet_18,  epoch 115, local model 5, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4223/4596 (91.8842%)
___Test Local_ResNet_18 poisoned: False, epoch: 115: Average loss: 2.0286, Accuracy: 5506/10000 (55.0600%)
___Train Local_ResNet_18,  epoch 115, local model 37, internal_epoch   1,  Average loss: 0.0025, Accuracy: 4209/4354 (96.6697%)
___Train Local_ResNet_18,  epoch 115, local model 37, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4024/4354 (92.4208%)
___Test Local_ResNet_18 poisoned: False, epoch: 115: Average loss: 2.1247, Accuracy: 5411/10000 (54.1100%)
time spent on training: 265.4976713657379
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 115: Average loss: 1.9202, Accuracy: 5848/10000 (58.4800%)
___Test Target_ResNet_18 poisoned: True, epoch: 115: Average loss: 8.5957, Accuracy: 186/9900 (1.8788%)
Done in 295.8344249725342 sec.
Server Epoch:116 choose agents : [13, 36, 58, 71, 67, 44, 25, 62, 37, 54, 55, 75, 92, 17, 10, 41, 19, 59, 87, 89].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 116, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4371/4885 (89.4780%), train_poison_data_count: 385
Global model norm: 44.04785466939976.
Norm before scaling: 44.04406473830356. Distance: 2.139985483245098
Total norm for 4 adversaries is: 44.04406473830356. distance: 2.139985483245098
___Test Local_ResNet_18 poisoned: True, epoch: 116: Average loss: 0.0955, Accuracy: 9676/9900 (97.7374%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 116, local model 36, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4700/5305 (88.5957%), train_poison_data_count: 415
Global model norm: 44.04785466939976.
Norm before scaling: 44.043747394724626. Distance: 2.2648084550247645
Total norm for 4 adversaries is: 44.043747394724626. distance: 2.2648084550247645
___Test Local_ResNet_18 poisoned: True, epoch: 116: Average loss: 0.2059, Accuracy: 9385/9900 (94.7980%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 116, local model 58, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4213/4717 (89.3152%), train_poison_data_count: 370
Global model norm: 44.04785466939976.
Norm before scaling: 44.04362267391486. Distance: 2.09653060518102
Total norm for 4 adversaries is: 44.04362267391486. distance: 2.09653060518102
___Test Local_ResNet_18 poisoned: True, epoch: 116: Average loss: 0.2477, Accuracy: 9284/9900 (93.7778%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 116, local model 71, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4458/5066 (87.9984%), train_poison_data_count: 400
Global model norm: 44.04785466939976.
Norm before scaling: 44.049937260525695. Distance: 2.280892226499856
Total norm for 4 adversaries is: 44.049937260525695. distance: 2.280892226499856
___Test Local_ResNet_18 poisoned: True, epoch: 116: Average loss: 0.4474, Accuracy: 8868/9900 (89.5758%)
___Train Local_ResNet_18,  epoch 116, local model 67, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4485/5116 (87.6661%)
___Train Local_ResNet_18,  epoch 116, local model 67, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4580/5116 (89.5231%)
___Test Local_ResNet_18 poisoned: False, epoch: 116: Average loss: 2.0003, Accuracy: 5410/10000 (54.1000%)
___Train Local_ResNet_18,  epoch 116, local model 44, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4095/4662 (87.8378%)
___Train Local_ResNet_18,  epoch 116, local model 44, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4246/4662 (91.0768%)
___Test Local_ResNet_18 poisoned: False, epoch: 116: Average loss: 2.0690, Accuracy: 5389/10000 (53.8900%)
___Train Local_ResNet_18,  epoch 116, local model 25, internal_epoch   1,  Average loss: 0.0056, Accuracy: 5252/5902 (88.9868%)
___Train Local_ResNet_18,  epoch 116, local model 25, internal_epoch   2,  Average loss: 0.0049, Accuracy: 5336/5902 (90.4100%)
___Test Local_ResNet_18 poisoned: False, epoch: 116: Average loss: 2.3116, Accuracy: 5112/10000 (51.1200%)
___Train Local_ResNet_18,  epoch 116, local model 62, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4482/5063 (88.5246%)
___Train Local_ResNet_18,  epoch 116, local model 62, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4646/5063 (91.7638%)
___Test Local_ResNet_18 poisoned: False, epoch: 116: Average loss: 1.9650, Accuracy: 5554/10000 (55.5400%)
___Train Local_ResNet_18,  epoch 116, local model 37, internal_epoch   1,  Average loss: 0.0024, Accuracy: 4211/4354 (96.7157%)
___Train Local_ResNet_18,  epoch 116, local model 37, internal_epoch   2,  Average loss: 0.0105, Accuracy: 3562/4354 (81.8098%)
___Test Local_ResNet_18 poisoned: False, epoch: 116: Average loss: 2.4991, Accuracy: 4706/10000 (47.0600%)
___Train Local_ResNet_18,  epoch 116, local model 54, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4556/5195 (87.6997%)
___Train Local_ResNet_18,  epoch 116, local model 54, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4642/5195 (89.3551%)
___Test Local_ResNet_18 poisoned: False, epoch: 116: Average loss: 2.0076, Accuracy: 5473/10000 (54.7300%)
___Train Local_ResNet_18,  epoch 116, local model 55, internal_epoch   1,  Average loss: 0.0036, Accuracy: 4079/4356 (93.6410%)
___Train Local_ResNet_18,  epoch 116, local model 55, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3950/4356 (90.6795%)
___Test Local_ResNet_18 poisoned: False, epoch: 116: Average loss: 2.0779, Accuracy: 5367/10000 (53.6700%)
___Train Local_ResNet_18,  epoch 116, local model 75, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3814/4295 (88.8009%)
___Train Local_ResNet_18,  epoch 116, local model 75, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3852/4295 (89.6857%)
___Test Local_ResNet_18 poisoned: False, epoch: 116: Average loss: 2.1532, Accuracy: 5309/10000 (53.0900%)
___Train Local_ResNet_18,  epoch 116, local model 92, internal_epoch   1,  Average loss: 0.0057, Accuracy: 5550/6263 (88.6157%)
___Train Local_ResNet_18,  epoch 116, local model 92, internal_epoch   2,  Average loss: 0.0048, Accuracy: 5664/6263 (90.4359%)
___Test Local_ResNet_18 poisoned: False, epoch: 116: Average loss: 1.9737, Accuracy: 5581/10000 (55.8100%)
___Train Local_ResNet_18,  epoch 116, local model 17, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3964/4511 (87.8741%)
___Train Local_ResNet_18,  epoch 116, local model 17, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4066/4511 (90.1352%)
___Test Local_ResNet_18 poisoned: False, epoch: 116: Average loss: 1.9502, Accuracy: 5439/10000 (54.3900%)
___Train Local_ResNet_18,  epoch 116, local model 10, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4188/4663 (89.8134%)
___Train Local_ResNet_18,  epoch 116, local model 10, internal_epoch   2,  Average loss: 0.0037, Accuracy: 4338/4663 (93.0302%)
___Test Local_ResNet_18 poisoned: False, epoch: 116: Average loss: 1.9579, Accuracy: 5503/10000 (55.0300%)
___Train Local_ResNet_18,  epoch 116, local model 41, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3854/4336 (88.8838%)
___Train Local_ResNet_18,  epoch 116, local model 41, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3978/4336 (91.7435%)
___Test Local_ResNet_18 poisoned: False, epoch: 116: Average loss: 1.9527, Accuracy: 5549/10000 (55.4900%)
___Train Local_ResNet_18,  epoch 116, local model 19, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4245/4928 (86.1404%)
___Train Local_ResNet_18,  epoch 116, local model 19, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4386/4928 (89.0016%)
___Test Local_ResNet_18 poisoned: False, epoch: 116: Average loss: 2.0580, Accuracy: 5260/10000 (52.6000%)
___Train Local_ResNet_18,  epoch 116, local model 59, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3634/4046 (89.8171%)
___Train Local_ResNet_18,  epoch 116, local model 59, internal_epoch   2,  Average loss: 0.0038, Accuracy: 3763/4046 (93.0054%)
___Test Local_ResNet_18 poisoned: False, epoch: 116: Average loss: 1.9634, Accuracy: 5520/10000 (55.2000%)
___Train Local_ResNet_18,  epoch 116, local model 87, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3203/3672 (87.2277%)
___Train Local_ResNet_18,  epoch 116, local model 87, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3334/3672 (90.7952%)
___Test Local_ResNet_18 poisoned: False, epoch: 116: Average loss: 1.9242, Accuracy: 5624/10000 (56.2400%)
___Train Local_ResNet_18,  epoch 116, local model 89, internal_epoch   1,  Average loss: 0.0038, Accuracy: 4026/4356 (92.4242%)
___Train Local_ResNet_18,  epoch 116, local model 89, internal_epoch   2,  Average loss: 0.0028, Accuracy: 4133/4356 (94.8806%)
___Test Local_ResNet_18 poisoned: False, epoch: 116: Average loss: 1.8898, Accuracy: 5685/10000 (56.8500%)
time spent on training: 269.31914472579956
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 116: Average loss: 1.8966, Accuracy: 5886/10000 (58.8600%)
___Test Target_ResNet_18 poisoned: True, epoch: 116: Average loss: 8.5312, Accuracy: 223/9900 (2.2525%)
Done in 299.9142928123474 sec.
Server Epoch:117 choose agents : [13, 36, 58, 71, 45, 77, 10, 41, 26, 95, 90, 82, 72, 51, 44, 53, 17, 18, 32, 61].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 117, local model 13, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4378/4885 (89.6213%), train_poison_data_count: 385
Global model norm: 44.09475907996678.
Norm before scaling: 44.09668581872466. Distance: 2.185153029122023
Total norm for 4 adversaries is: 44.09668581872466. distance: 2.185153029122023
___Test Local_ResNet_18 poisoned: True, epoch: 117: Average loss: 0.0970, Accuracy: 9648/9900 (97.4545%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 117, local model 36, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4718/5305 (88.9350%), train_poison_data_count: 415
Global model norm: 44.09475907996678.
Norm before scaling: 44.093815057978226. Distance: 2.3225018483001616
Total norm for 4 adversaries is: 44.093815057978226. distance: 2.3225018483001616
___Test Local_ResNet_18 poisoned: True, epoch: 117: Average loss: 0.2123, Accuracy: 9362/9900 (94.5657%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 117, local model 58, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4181/4717 (88.6368%), train_poison_data_count: 370
Global model norm: 44.09475907996678.
Norm before scaling: 44.091824517225554. Distance: 2.1704031807923623
Total norm for 4 adversaries is: 44.091824517225554. distance: 2.1704031807923623
___Test Local_ResNet_18 poisoned: True, epoch: 117: Average loss: 0.1878, Accuracy: 9430/9900 (95.2525%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 117, local model 71, internal_epoch   1,  Average loss: 0.0075, Accuracy: 4432/5066 (87.4852%), train_poison_data_count: 400
Global model norm: 44.09475907996678.
Norm before scaling: 44.097690679242916. Distance: 2.3676952660990627
Total norm for 4 adversaries is: 44.097690679242916. distance: 2.3676952660990627
___Test Local_ResNet_18 poisoned: True, epoch: 117: Average loss: 0.2199, Accuracy: 9312/9900 (94.0606%)
___Train Local_ResNet_18,  epoch 117, local model 45, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4377/5037 (86.8970%)
___Train Local_ResNet_18,  epoch 117, local model 45, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4593/5037 (91.1852%)
___Test Local_ResNet_18 poisoned: False, epoch: 117: Average loss: 2.0532, Accuracy: 5433/10000 (54.3300%)
___Train Local_ResNet_18,  epoch 117, local model 77, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4085/4647 (87.9062%)
___Train Local_ResNet_18,  epoch 117, local model 77, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4169/4647 (89.7138%)
___Test Local_ResNet_18 poisoned: False, epoch: 117: Average loss: 1.9395, Accuracy: 5537/10000 (55.3700%)
___Train Local_ResNet_18,  epoch 117, local model 10, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4167/4663 (89.3631%)
___Train Local_ResNet_18,  epoch 117, local model 10, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4266/4663 (91.4862%)
___Test Local_ResNet_18 poisoned: False, epoch: 117: Average loss: 2.0026, Accuracy: 5352/10000 (53.5200%)
___Train Local_ResNet_18,  epoch 117, local model 41, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3835/4336 (88.4456%)
___Train Local_ResNet_18,  epoch 117, local model 41, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3992/4336 (92.0664%)
___Test Local_ResNet_18 poisoned: False, epoch: 117: Average loss: 1.9386, Accuracy: 5492/10000 (54.9200%)
___Train Local_ResNet_18,  epoch 117, local model 26, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3346/3756 (89.0841%)
___Train Local_ResNet_18,  epoch 117, local model 26, internal_epoch   2,  Average loss: 0.0036, Accuracy: 3528/3756 (93.9297%)
___Test Local_ResNet_18 poisoned: False, epoch: 117: Average loss: 1.9524, Accuracy: 5669/10000 (56.6900%)
___Train Local_ResNet_18,  epoch 117, local model 95, internal_epoch   1,  Average loss: 0.0075, Accuracy: 3967/4625 (85.7730%)
___Train Local_ResNet_18,  epoch 117, local model 95, internal_epoch   2,  Average loss: 0.0063, Accuracy: 4046/4625 (87.4811%)
___Test Local_ResNet_18 poisoned: False, epoch: 117: Average loss: 2.0499, Accuracy: 5412/10000 (54.1200%)
___Train Local_ResNet_18,  epoch 117, local model 90, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3854/4362 (88.3540%)
___Train Local_ResNet_18,  epoch 117, local model 90, internal_epoch   2,  Average loss: 0.0036, Accuracy: 4064/4362 (93.1683%)
___Test Local_ResNet_18 poisoned: False, epoch: 117: Average loss: 1.9155, Accuracy: 5652/10000 (56.5200%)
___Train Local_ResNet_18,  epoch 117, local model 82, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4335/4874 (88.9413%)
___Train Local_ResNet_18,  epoch 117, local model 82, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4434/4874 (90.9725%)
___Test Local_ResNet_18 poisoned: False, epoch: 117: Average loss: 1.9951, Accuracy: 5490/10000 (54.9000%)
___Train Local_ResNet_18,  epoch 117, local model 72, internal_epoch   1,  Average loss: 0.0075, Accuracy: 4053/4767 (85.0220%)
___Train Local_ResNet_18,  epoch 117, local model 72, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4259/4767 (89.3434%)
___Test Local_ResNet_18 poisoned: False, epoch: 117: Average loss: 2.1359, Accuracy: 5237/10000 (52.3700%)
___Train Local_ResNet_18,  epoch 117, local model 51, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3370/3775 (89.2715%)
___Train Local_ResNet_18,  epoch 117, local model 51, internal_epoch   2,  Average loss: 0.0033, Accuracy: 3528/3775 (93.4570%)
___Test Local_ResNet_18 poisoned: False, epoch: 117: Average loss: 1.7626, Accuracy: 5855/10000 (58.5500%)
___Train Local_ResNet_18,  epoch 117, local model 44, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4121/4662 (88.3955%)
___Train Local_ResNet_18,  epoch 117, local model 44, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4262/4662 (91.4200%)
___Test Local_ResNet_18 poisoned: False, epoch: 117: Average loss: 1.8515, Accuracy: 5663/10000 (56.6300%)
___Train Local_ResNet_18,  epoch 117, local model 53, internal_epoch   1,  Average loss: 0.0061, Accuracy: 5392/6124 (88.0470%)
___Train Local_ResNet_18,  epoch 117, local model 53, internal_epoch   2,  Average loss: 0.0053, Accuracy: 5465/6124 (89.2391%)
___Test Local_ResNet_18 poisoned: False, epoch: 117: Average loss: 2.0198, Accuracy: 5299/10000 (52.9900%)
___Train Local_ResNet_18,  epoch 117, local model 17, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3888/4511 (86.1893%)
___Train Local_ResNet_18,  epoch 117, local model 17, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4087/4511 (90.6008%)
___Test Local_ResNet_18 poisoned: False, epoch: 117: Average loss: 2.0011, Accuracy: 5384/10000 (53.8400%)
___Train Local_ResNet_18,  epoch 117, local model 18, internal_epoch   1,  Average loss: 0.0049, Accuracy: 3531/3911 (90.2838%)
___Train Local_ResNet_18,  epoch 117, local model 18, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3553/3911 (90.8463%)
___Test Local_ResNet_18 poisoned: False, epoch: 117: Average loss: 1.8784, Accuracy: 5708/10000 (57.0800%)
___Train Local_ResNet_18,  epoch 117, local model 32, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4858/5591 (86.8896%)
___Train Local_ResNet_18,  epoch 117, local model 32, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4930/5591 (88.1774%)
___Test Local_ResNet_18 poisoned: False, epoch: 117: Average loss: 2.1473, Accuracy: 5314/10000 (53.1400%)
___Train Local_ResNet_18,  epoch 117, local model 61, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3646/4126 (88.3665%)
___Train Local_ResNet_18,  epoch 117, local model 61, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3795/4126 (91.9777%)
___Test Local_ResNet_18 poisoned: False, epoch: 117: Average loss: 1.8615, Accuracy: 5681/10000 (56.8100%)
time spent on training: 267.9686155319214
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 117: Average loss: 1.7898, Accuracy: 6033/10000 (60.3300%)
___Test Target_ResNet_18 poisoned: True, epoch: 117: Average loss: 8.7671, Accuracy: 191/9900 (1.9293%)
Done in 299.1483645439148 sec.
Server Epoch:118 choose agents : [13, 36, 58, 71, 80, 67, 35, 57, 93, 41, 65, 51, 9, 78, 56, 84, 60, 52, 33, 47].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 118, local model 13, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4368/4885 (89.4166%), train_poison_data_count: 385
Global model norm: 44.12959071153037.
Norm before scaling: 44.127654344296246. Distance: 2.189121081639137
Total norm for 4 adversaries is: 44.127654344296246. distance: 2.189121081639137
___Test Local_ResNet_18 poisoned: True, epoch: 118: Average loss: 0.1485, Accuracy: 9545/9900 (96.4141%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 118, local model 36, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4698/5305 (88.5580%), train_poison_data_count: 415
Global model norm: 44.12959071153037.
Norm before scaling: 44.130019467070966. Distance: 2.3403240341409632
Total norm for 4 adversaries is: 44.130019467070966. distance: 2.3403240341409632
___Test Local_ResNet_18 poisoned: True, epoch: 118: Average loss: 0.2118, Accuracy: 9359/9900 (94.5354%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 118, local model 58, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4175/4717 (88.5096%), train_poison_data_count: 370
Global model norm: 44.12959071153037.
Norm before scaling: 44.12532090888972. Distance: 2.168156246291143
Total norm for 4 adversaries is: 44.12532090888972. distance: 2.168156246291143
___Test Local_ResNet_18 poisoned: True, epoch: 118: Average loss: 0.0630, Accuracy: 9705/9900 (98.0303%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 118, local model 71, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4484/5066 (88.5116%), train_poison_data_count: 400
Global model norm: 44.12959071153037.
Norm before scaling: 44.131085805529416. Distance: 2.2916474312639696
Total norm for 4 adversaries is: 44.131085805529416. distance: 2.2916474312639696
___Test Local_ResNet_18 poisoned: True, epoch: 118: Average loss: 0.1728, Accuracy: 9449/9900 (95.4444%)
___Train Local_ResNet_18,  epoch 118, local model 80, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4500/5025 (89.5522%)
___Train Local_ResNet_18,  epoch 118, local model 80, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4584/5025 (91.2239%)
___Test Local_ResNet_18 poisoned: False, epoch: 118: Average loss: 2.1358, Accuracy: 5217/10000 (52.1700%)
___Train Local_ResNet_18,  epoch 118, local model 67, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4440/5116 (86.7866%)
___Train Local_ResNet_18,  epoch 118, local model 67, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4566/5116 (89.2494%)
___Test Local_ResNet_18 poisoned: False, epoch: 118: Average loss: 2.0238, Accuracy: 5412/10000 (54.1200%)
___Train Local_ResNet_18,  epoch 118, local model 35, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4590/5167 (88.8330%)
___Train Local_ResNet_18,  epoch 118, local model 35, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4703/5167 (91.0199%)
___Test Local_ResNet_18 poisoned: False, epoch: 118: Average loss: 2.0664, Accuracy: 5382/10000 (53.8200%)
___Train Local_ResNet_18,  epoch 118, local model 57, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3985/4558 (87.4287%)
___Train Local_ResNet_18,  epoch 118, local model 57, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4052/4558 (88.8986%)
___Test Local_ResNet_18 poisoned: False, epoch: 118: Average loss: 1.9845, Accuracy: 5392/10000 (53.9200%)
___Train Local_ResNet_18,  epoch 118, local model 93, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4058/4651 (87.2501%)
___Train Local_ResNet_18,  epoch 118, local model 93, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4176/4651 (89.7871%)
___Test Local_ResNet_18 poisoned: False, epoch: 118: Average loss: 2.0107, Accuracy: 5427/10000 (54.2700%)
___Train Local_ResNet_18,  epoch 118, local model 41, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3853/4336 (88.8607%)
___Train Local_ResNet_18,  epoch 118, local model 41, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3937/4336 (90.7980%)
___Test Local_ResNet_18 poisoned: False, epoch: 118: Average loss: 2.0627, Accuracy: 5449/10000 (54.4900%)
___Train Local_ResNet_18,  epoch 118, local model 65, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4454/5055 (88.1108%)
___Train Local_ResNet_18,  epoch 118, local model 65, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4631/5055 (91.6123%)
___Test Local_ResNet_18 poisoned: False, epoch: 118: Average loss: 1.9764, Accuracy: 5547/10000 (55.4700%)
___Train Local_ResNet_18,  epoch 118, local model 51, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3361/3775 (89.0331%)
___Train Local_ResNet_18,  epoch 118, local model 51, internal_epoch   2,  Average loss: 0.0033, Accuracy: 3535/3775 (93.6424%)
___Test Local_ResNet_18 poisoned: False, epoch: 118: Average loss: 1.8204, Accuracy: 5804/10000 (58.0400%)
___Train Local_ResNet_18,  epoch 118, local model 9, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4652/5265 (88.3571%)
___Train Local_ResNet_18,  epoch 118, local model 9, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4800/5265 (91.1681%)
___Test Local_ResNet_18 poisoned: False, epoch: 118: Average loss: 1.9221, Accuracy: 5584/10000 (55.8400%)
___Train Local_ResNet_18,  epoch 118, local model 78, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3572/4025 (88.7453%)
___Train Local_ResNet_18,  epoch 118, local model 78, internal_epoch   2,  Average loss: 0.0037, Accuracy: 3750/4025 (93.1677%)
___Test Local_ResNet_18 poisoned: False, epoch: 118: Average loss: 1.9542, Accuracy: 5512/10000 (55.1200%)
___Train Local_ResNet_18,  epoch 118, local model 56, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4343/4989 (87.0515%)
___Train Local_ResNet_18,  epoch 118, local model 56, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4454/4989 (89.2764%)
___Test Local_ResNet_18 poisoned: False, epoch: 118: Average loss: 1.9368, Accuracy: 5639/10000 (56.3900%)
___Train Local_ResNet_18,  epoch 118, local model 84, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4195/4793 (87.5235%)
___Train Local_ResNet_18,  epoch 118, local model 84, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4344/4793 (90.6322%)
___Test Local_ResNet_18 poisoned: False, epoch: 118: Average loss: 1.9224, Accuracy: 5658/10000 (56.5800%)
___Train Local_ResNet_18,  epoch 118, local model 60, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3339/3804 (87.7760%)
___Train Local_ResNet_18,  epoch 118, local model 60, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3465/3804 (91.0883%)
___Test Local_ResNet_18 poisoned: False, epoch: 118: Average loss: 1.8267, Accuracy: 5789/10000 (57.8900%)
___Train Local_ResNet_18,  epoch 118, local model 52, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3346/3797 (88.1222%)
___Train Local_ResNet_18,  epoch 118, local model 52, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3418/3797 (90.0184%)
___Test Local_ResNet_18 poisoned: False, epoch: 118: Average loss: 2.0810, Accuracy: 5356/10000 (53.5600%)
___Train Local_ResNet_18,  epoch 118, local model 33, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3937/4433 (88.8112%)
___Train Local_ResNet_18,  epoch 118, local model 33, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4065/4433 (91.6986%)
___Test Local_ResNet_18 poisoned: False, epoch: 118: Average loss: 1.8140, Accuracy: 5735/10000 (57.3500%)
___Train Local_ResNet_18,  epoch 118, local model 47, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4127/4707 (87.6779%)
___Train Local_ResNet_18,  epoch 118, local model 47, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4282/4707 (90.9709%)
___Test Local_ResNet_18 poisoned: False, epoch: 118: Average loss: 1.9431, Accuracy: 5573/10000 (55.7300%)
time spent on training: 269.56856656074524
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 118: Average loss: 1.7848, Accuracy: 6009/10000 (60.0900%)
___Test Target_ResNet_18 poisoned: True, epoch: 118: Average loss: 8.5859, Accuracy: 214/9900 (2.1616%)
Done in 299.8562400341034 sec.
Server Epoch:119 choose agents : [13, 36, 58, 71, 70, 10, 52, 15, 35, 79, 24, 39, 25, 40, 45, 0, 1, 49, 97, 92].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 119, local model 13, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4405/4885 (90.1740%), train_poison_data_count: 385
Global model norm: 44.15902271460924.
Norm before scaling: 44.155124830852024. Distance: 2.1148574225523125
Total norm for 4 adversaries is: 44.155124830852024. distance: 2.1148574225523125
___Test Local_ResNet_18 poisoned: True, epoch: 119: Average loss: 0.2231, Accuracy: 9365/9900 (94.5960%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 119, local model 36, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4736/5305 (89.2743%), train_poison_data_count: 415
Global model norm: 44.15902271460924.
Norm before scaling: 44.15349784638033. Distance: 2.228826074933225
Total norm for 4 adversaries is: 44.15349784638033. distance: 2.228826074933225
___Test Local_ResNet_18 poisoned: True, epoch: 119: Average loss: 0.1122, Accuracy: 9643/9900 (97.4040%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 119, local model 58, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4234/4717 (89.7604%), train_poison_data_count: 370
Global model norm: 44.15902271460924.
Norm before scaling: 44.152826023918756. Distance: 2.023985328304505
Total norm for 4 adversaries is: 44.152826023918756. distance: 2.023985328304505
___Test Local_ResNet_18 poisoned: True, epoch: 119: Average loss: 0.2606, Accuracy: 9264/9900 (93.5758%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 119, local model 71, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4456/5066 (87.9589%), train_poison_data_count: 400
Global model norm: 44.15902271460924.
Norm before scaling: 44.16148290383403. Distance: 2.3196315601073367
Total norm for 4 adversaries is: 44.16148290383403. distance: 2.3196315601073367
___Test Local_ResNet_18 poisoned: True, epoch: 119: Average loss: 0.1322, Accuracy: 9551/9900 (96.4747%)
___Train Local_ResNet_18,  epoch 119, local model 70, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4757/5392 (88.2233%)
___Train Local_ResNet_18,  epoch 119, local model 70, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4819/5392 (89.3731%)
___Test Local_ResNet_18 poisoned: False, epoch: 119: Average loss: 2.0036, Accuracy: 5492/10000 (54.9200%)
___Train Local_ResNet_18,  epoch 119, local model 10, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4108/4663 (88.0978%)
___Train Local_ResNet_18,  epoch 119, local model 10, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4300/4663 (92.2153%)
___Test Local_ResNet_18 poisoned: False, epoch: 119: Average loss: 1.9893, Accuracy: 5429/10000 (54.2900%)
___Train Local_ResNet_18,  epoch 119, local model 52, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3329/3797 (87.6745%)
___Train Local_ResNet_18,  epoch 119, local model 52, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3444/3797 (90.7032%)
___Test Local_ResNet_18 poisoned: False, epoch: 119: Average loss: 1.9922, Accuracy: 5486/10000 (54.8600%)
___Train Local_ResNet_18,  epoch 119, local model 15, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4999/5582 (89.5557%)
___Train Local_ResNet_18,  epoch 119, local model 15, internal_epoch   2,  Average loss: 0.0047, Accuracy: 5099/5582 (91.3472%)
___Test Local_ResNet_18 poisoned: False, epoch: 119: Average loss: 2.0334, Accuracy: 5365/10000 (53.6500%)
___Train Local_ResNet_18,  epoch 119, local model 35, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4559/5167 (88.2330%)
___Train Local_ResNet_18,  epoch 119, local model 35, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4692/5167 (90.8070%)
___Test Local_ResNet_18 poisoned: False, epoch: 119: Average loss: 1.9584, Accuracy: 5572/10000 (55.7200%)
___Train Local_ResNet_18,  epoch 119, local model 79, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3330/3781 (88.0719%)
___Train Local_ResNet_18,  epoch 119, local model 79, internal_epoch   2,  Average loss: 0.0061, Accuracy: 3334/3781 (88.1777%)
___Test Local_ResNet_18 poisoned: False, epoch: 119: Average loss: 2.0885, Accuracy: 5334/10000 (53.3400%)
___Train Local_ResNet_18,  epoch 119, local model 24, internal_epoch   1,  Average loss: 0.0072, Accuracy: 3465/3969 (87.3016%)
___Train Local_ResNet_18,  epoch 119, local model 24, internal_epoch   2,  Average loss: 0.0059, Accuracy: 3606/3969 (90.8541%)
___Test Local_ResNet_18 poisoned: False, epoch: 119: Average loss: 2.0295, Accuracy: 5499/10000 (54.9900%)
___Train Local_ResNet_18,  epoch 119, local model 39, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3328/3837 (86.7344%)
___Train Local_ResNet_18,  epoch 119, local model 39, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3515/3837 (91.6080%)
___Test Local_ResNet_18 poisoned: False, epoch: 119: Average loss: 1.9829, Accuracy: 5541/10000 (55.4100%)
___Train Local_ResNet_18,  epoch 119, local model 25, internal_epoch   1,  Average loss: 0.0059, Accuracy: 5220/5902 (88.4446%)
___Train Local_ResNet_18,  epoch 119, local model 25, internal_epoch   2,  Average loss: 0.0052, Accuracy: 5285/5902 (89.5459%)
___Test Local_ResNet_18 poisoned: False, epoch: 119: Average loss: 2.1306, Accuracy: 5390/10000 (53.9000%)
___Train Local_ResNet_18,  epoch 119, local model 40, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4773/5455 (87.4977%)
___Train Local_ResNet_18,  epoch 119, local model 40, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4936/5455 (90.4858%)
___Test Local_ResNet_18 poisoned: False, epoch: 119: Average loss: 1.9739, Accuracy: 5466/10000 (54.6600%)
___Train Local_ResNet_18,  epoch 119, local model 45, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4356/5037 (86.4800%)
___Train Local_ResNet_18,  epoch 119, local model 45, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4497/5037 (89.2793%)
___Test Local_ResNet_18 poisoned: False, epoch: 119: Average loss: 1.9447, Accuracy: 5441/10000 (54.4100%)
___Train Local_ResNet_18,  epoch 119, local model 0, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4453/5017 (88.7582%)
___Train Local_ResNet_18,  epoch 119, local model 0, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4605/5017 (91.7879%)
___Test Local_ResNet_18 poisoned: False, epoch: 119: Average loss: 1.8427, Accuracy: 5739/10000 (57.3900%)
___Train Local_ResNet_18,  epoch 119, local model 1, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4390/4986 (88.0465%)
___Train Local_ResNet_18,  epoch 119, local model 1, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4485/4986 (89.9519%)
___Test Local_ResNet_18 poisoned: False, epoch: 119: Average loss: 1.9713, Accuracy: 5520/10000 (55.2000%)
___Train Local_ResNet_18,  epoch 119, local model 49, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4575/5197 (88.0316%)
___Train Local_ResNet_18,  epoch 119, local model 49, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4641/5197 (89.3015%)
___Test Local_ResNet_18 poisoned: False, epoch: 119: Average loss: 2.0483, Accuracy: 5470/10000 (54.7000%)
___Train Local_ResNet_18,  epoch 119, local model 97, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3885/4361 (89.0851%)
___Train Local_ResNet_18,  epoch 119, local model 97, internal_epoch   2,  Average loss: 0.0055, Accuracy: 3919/4361 (89.8647%)
___Test Local_ResNet_18 poisoned: False, epoch: 119: Average loss: 2.0791, Accuracy: 5317/10000 (53.1700%)
___Train Local_ResNet_18,  epoch 119, local model 92, internal_epoch   1,  Average loss: 0.0056, Accuracy: 5581/6263 (89.1106%)
___Train Local_ResNet_18,  epoch 119, local model 92, internal_epoch   2,  Average loss: 0.0044, Accuracy: 5690/6263 (90.8510%)
___Test Local_ResNet_18 poisoned: False, epoch: 119: Average loss: 2.0277, Accuracy: 5477/10000 (54.7700%)
time spent on training: 273.31018829345703
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 119: Average loss: 1.7611, Accuracy: 6051/10000 (60.5100%)
___Test Target_ResNet_18 poisoned: True, epoch: 119: Average loss: 9.0649, Accuracy: 154/9900 (1.5556%)
Done in 304.5380606651306 sec.
Server Epoch:120 choose agents : [13, 36, 58, 71, 0, 19, 23, 84, 38, 26, 73, 27, 62, 56, 16, 25, 66, 53, 98, 86].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 120, local model 13, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4392/4885 (89.9079%), train_poison_data_count: 385
Global model norm: 44.184613037763214.
Norm before scaling: 44.178122900014095. Distance: 2.1026378277067055
Total norm for 4 adversaries is: 44.178122900014095. distance: 2.1026378277067055
___Test Local_ResNet_18 poisoned: True, epoch: 120: Average loss: 0.1038, Accuracy: 9657/9900 (97.5455%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 120, local model 36, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4755/5305 (89.6324%), train_poison_data_count: 415
Global model norm: 44.184613037763214.
Norm before scaling: 44.178708681685684. Distance: 2.236171293798017
Total norm for 4 adversaries is: 44.178708681685684. distance: 2.236171293798017
___Test Local_ResNet_18 poisoned: True, epoch: 120: Average loss: 0.1271, Accuracy: 9561/9900 (96.5758%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 120, local model 58, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4251/4717 (90.1208%), train_poison_data_count: 370
Global model norm: 44.184613037763214.
Norm before scaling: 44.1768587456466. Distance: 2.0223090954286915
Total norm for 4 adversaries is: 44.1768587456466. distance: 2.0223090954286915
___Test Local_ResNet_18 poisoned: True, epoch: 120: Average loss: 0.1804, Accuracy: 9426/9900 (95.2121%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 120, local model 71, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4497/5066 (88.7683%), train_poison_data_count: 400
Global model norm: 44.184613037763214.
Norm before scaling: 44.18097851230422. Distance: 2.255876919236431
Total norm for 4 adversaries is: 44.18097851230422. distance: 2.255876919236431
___Test Local_ResNet_18 poisoned: True, epoch: 120: Average loss: 0.2629, Accuracy: 9251/9900 (93.4444%)
___Train Local_ResNet_18,  epoch 120, local model 0, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4463/5017 (88.9575%)
___Train Local_ResNet_18,  epoch 120, local model 0, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4614/5017 (91.9673%)
___Test Local_ResNet_18 poisoned: False, epoch: 120: Average loss: 1.7651, Accuracy: 5809/10000 (58.0900%)
___Train Local_ResNet_18,  epoch 120, local model 19, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4295/4928 (87.1550%)
___Train Local_ResNet_18,  epoch 120, local model 19, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4438/4928 (90.0568%)
___Test Local_ResNet_18 poisoned: False, epoch: 120: Average loss: 1.9285, Accuracy: 5517/10000 (55.1700%)
___Train Local_ResNet_18,  epoch 120, local model 23, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3708/4184 (88.6233%)
___Train Local_ResNet_18,  epoch 120, local model 23, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3792/4184 (90.6310%)
___Test Local_ResNet_18 poisoned: False, epoch: 120: Average loss: 1.9243, Accuracy: 5623/10000 (56.2300%)
___Train Local_ResNet_18,  epoch 120, local model 84, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4169/4793 (86.9810%)
___Train Local_ResNet_18,  epoch 120, local model 84, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4316/4793 (90.0480%)
___Test Local_ResNet_18 poisoned: False, epoch: 120: Average loss: 2.1347, Accuracy: 5371/10000 (53.7100%)
___Train Local_ResNet_18,  epoch 120, local model 38, internal_epoch   1,  Average loss: 0.0059, Accuracy: 5062/5740 (88.1882%)
___Train Local_ResNet_18,  epoch 120, local model 38, internal_epoch   2,  Average loss: 0.0050, Accuracy: 5189/5740 (90.4007%)
___Test Local_ResNet_18 poisoned: False, epoch: 120: Average loss: 2.0528, Accuracy: 5342/10000 (53.4200%)
___Train Local_ResNet_18,  epoch 120, local model 26, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3369/3756 (89.6965%)
___Train Local_ResNet_18,  epoch 120, local model 26, internal_epoch   2,  Average loss: 0.0036, Accuracy: 3501/3756 (93.2109%)
___Test Local_ResNet_18 poisoned: False, epoch: 120: Average loss: 1.9155, Accuracy: 5727/10000 (57.2700%)
___Train Local_ResNet_18,  epoch 120, local model 73, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3739/4235 (88.2881%)
___Train Local_ResNet_18,  epoch 120, local model 73, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3848/4235 (90.8619%)
___Test Local_ResNet_18 poisoned: False, epoch: 120: Average loss: 2.0003, Accuracy: 5531/10000 (55.3100%)
___Train Local_ResNet_18,  epoch 120, local model 27, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3699/4223 (87.5918%)
___Train Local_ResNet_18,  epoch 120, local model 27, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3836/4223 (90.8359%)
___Test Local_ResNet_18 poisoned: False, epoch: 120: Average loss: 1.7746, Accuracy: 5736/10000 (57.3600%)
___Train Local_ResNet_18,  epoch 120, local model 62, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4457/5063 (88.0308%)
___Train Local_ResNet_18,  epoch 120, local model 62, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4496/5063 (88.8011%)
___Test Local_ResNet_18 poisoned: False, epoch: 120: Average loss: 2.0186, Accuracy: 5403/10000 (54.0300%)
___Train Local_ResNet_18,  epoch 120, local model 56, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4340/4989 (86.9914%)
___Train Local_ResNet_18,  epoch 120, local model 56, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4385/4989 (87.8934%)
___Test Local_ResNet_18 poisoned: False, epoch: 120: Average loss: 2.0865, Accuracy: 5334/10000 (53.3400%)
___Train Local_ResNet_18,  epoch 120, local model 16, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4345/4928 (88.1696%)
___Train Local_ResNet_18,  epoch 120, local model 16, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4463/4928 (90.5641%)
___Test Local_ResNet_18 poisoned: False, epoch: 120: Average loss: 1.7977, Accuracy: 5783/10000 (57.8300%)
___Train Local_ResNet_18,  epoch 120, local model 25, internal_epoch   1,  Average loss: 0.0056, Accuracy: 5234/5902 (88.6818%)
___Train Local_ResNet_18,  epoch 120, local model 25, internal_epoch   2,  Average loss: 0.0058, Accuracy: 5234/5902 (88.6818%)
___Test Local_ResNet_18 poisoned: False, epoch: 120: Average loss: 2.2761, Accuracy: 5170/10000 (51.7000%)
___Train Local_ResNet_18,  epoch 120, local model 66, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4012/4456 (90.0359%)
___Train Local_ResNet_18,  epoch 120, local model 66, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4143/4456 (92.9758%)
___Test Local_ResNet_18 poisoned: False, epoch: 120: Average loss: 1.8055, Accuracy: 5844/10000 (58.4400%)
___Train Local_ResNet_18,  epoch 120, local model 53, internal_epoch   1,  Average loss: 0.0061, Accuracy: 5375/6124 (87.7694%)
___Train Local_ResNet_18,  epoch 120, local model 53, internal_epoch   2,  Average loss: 0.0053, Accuracy: 5457/6124 (89.1084%)
___Test Local_ResNet_18 poisoned: False, epoch: 120: Average loss: 2.0382, Accuracy: 5427/10000 (54.2700%)
___Train Local_ResNet_18,  epoch 120, local model 98, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3376/3828 (88.1923%)
___Train Local_ResNet_18,  epoch 120, local model 98, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3519/3828 (91.9279%)
___Test Local_ResNet_18 poisoned: False, epoch: 120: Average loss: 1.8823, Accuracy: 5677/10000 (56.7700%)
___Train Local_ResNet_18,  epoch 120, local model 86, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3169/3616 (87.6383%)
___Train Local_ResNet_18,  epoch 120, local model 86, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3288/3616 (90.9292%)
___Test Local_ResNet_18 poisoned: False, epoch: 120: Average loss: 1.7847, Accuracy: 5822/10000 (58.2200%)
time spent on training: 272.0121841430664
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 120: Average loss: 1.7283, Accuracy: 6092/10000 (60.9200%)
___Test Target_ResNet_18 poisoned: True, epoch: 120: Average loss: 8.4899, Accuracy: 249/9900 (2.5152%)
Done in 302.6926612854004 sec.
Server Epoch:121 choose agents : [13, 36, 58, 71, 27, 90, 85, 84, 26, 81, 78, 76, 20, 75, 16, 1, 61, 3, 54, 38].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 121, local model 13, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4389/4885 (89.8465%), train_poison_data_count: 385
Global model norm: 44.22525487710967.
Norm before scaling: 44.22233173435609. Distance: 2.1323912487496615
Total norm for 4 adversaries is: 44.22233173435609. distance: 2.1323912487496615
___Test Local_ResNet_18 poisoned: True, epoch: 121: Average loss: 0.1817, Accuracy: 9489/9900 (95.8485%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 121, local model 36, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4742/5305 (89.3874%), train_poison_data_count: 415
Global model norm: 44.22525487710967.
Norm before scaling: 44.21978245261107. Distance: 2.254409178582344
Total norm for 4 adversaries is: 44.21978245261107. distance: 2.254409178582344
___Test Local_ResNet_18 poisoned: True, epoch: 121: Average loss: 0.2027, Accuracy: 9385/9900 (94.7980%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 121, local model 58, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4247/4717 (90.0360%), train_poison_data_count: 370
Global model norm: 44.22525487710967.
Norm before scaling: 44.218076408297094. Distance: 2.0317802324023044
Total norm for 4 adversaries is: 44.218076408297094. distance: 2.0317802324023044
___Test Local_ResNet_18 poisoned: True, epoch: 121: Average loss: 0.1094, Accuracy: 9623/9900 (97.2020%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 121, local model 71, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4514/5066 (89.1038%), train_poison_data_count: 400
Global model norm: 44.22525487710967.
Norm before scaling: 44.2250630431645. Distance: 2.236612440135068
Total norm for 4 adversaries is: 44.2250630431645. distance: 2.236612440135068
___Test Local_ResNet_18 poisoned: True, epoch: 121: Average loss: 0.1866, Accuracy: 9418/9900 (95.1313%)
___Train Local_ResNet_18,  epoch 121, local model 27, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3712/4223 (87.8996%)
___Train Local_ResNet_18,  epoch 121, local model 27, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3863/4223 (91.4753%)
___Test Local_ResNet_18 poisoned: False, epoch: 121: Average loss: 1.8612, Accuracy: 5746/10000 (57.4600%)
___Train Local_ResNet_18,  epoch 121, local model 90, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3920/4362 (89.8670%)
___Train Local_ResNet_18,  epoch 121, local model 90, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3987/4362 (91.4030%)
___Test Local_ResNet_18 poisoned: False, epoch: 121: Average loss: 2.0073, Accuracy: 5380/10000 (53.8000%)
___Train Local_ResNet_18,  epoch 121, local model 85, internal_epoch   1,  Average loss: 0.0047, Accuracy: 5799/6391 (90.7370%)
___Train Local_ResNet_18,  epoch 121, local model 85, internal_epoch   2,  Average loss: 0.0048, Accuracy: 5789/6391 (90.5805%)
___Test Local_ResNet_18 poisoned: False, epoch: 121: Average loss: 1.9969, Accuracy: 5420/10000 (54.2000%)
___Train Local_ResNet_18,  epoch 121, local model 84, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4137/4793 (86.3134%)
___Train Local_ResNet_18,  epoch 121, local model 84, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4356/4793 (90.8825%)
___Test Local_ResNet_18 poisoned: False, epoch: 121: Average loss: 2.1182, Accuracy: 5408/10000 (54.0800%)
___Train Local_ResNet_18,  epoch 121, local model 26, internal_epoch   1,  Average loss: 0.0052, Accuracy: 3384/3756 (90.0958%)
___Train Local_ResNet_18,  epoch 121, local model 26, internal_epoch   2,  Average loss: 0.0034, Accuracy: 3526/3756 (93.8765%)
___Test Local_ResNet_18 poisoned: False, epoch: 121: Average loss: 1.9314, Accuracy: 5630/10000 (56.3000%)
___Train Local_ResNet_18,  epoch 121, local model 81, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4119/4618 (89.1945%)
___Train Local_ResNet_18,  epoch 121, local model 81, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4139/4618 (89.6275%)
___Test Local_ResNet_18 poisoned: False, epoch: 121: Average loss: 1.9388, Accuracy: 5545/10000 (55.4500%)
___Train Local_ResNet_18,  epoch 121, local model 78, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3577/4025 (88.8696%)
___Train Local_ResNet_18,  epoch 121, local model 78, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3702/4025 (91.9752%)
___Test Local_ResNet_18 poisoned: False, epoch: 121: Average loss: 1.7945, Accuracy: 5709/10000 (57.0900%)
___Train Local_ResNet_18,  epoch 121, local model 76, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3163/3638 (86.9434%)
___Train Local_ResNet_18,  epoch 121, local model 76, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3319/3638 (91.2314%)
___Test Local_ResNet_18 poisoned: False, epoch: 121: Average loss: 1.7911, Accuracy: 5701/10000 (57.0100%)
___Train Local_ResNet_18,  epoch 121, local model 20, internal_epoch   1,  Average loss: 0.0051, Accuracy: 3904/4315 (90.4751%)
___Train Local_ResNet_18,  epoch 121, local model 20, internal_epoch   2,  Average loss: 0.0038, Accuracy: 3983/4315 (92.3059%)
___Test Local_ResNet_18 poisoned: False, epoch: 121: Average loss: 1.8311, Accuracy: 5677/10000 (56.7700%)
___Train Local_ResNet_18,  epoch 121, local model 75, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3837/4295 (89.3364%)
___Train Local_ResNet_18,  epoch 121, local model 75, internal_epoch   2,  Average loss: 0.0070, Accuracy: 3707/4295 (86.3097%)
___Test Local_ResNet_18 poisoned: False, epoch: 121: Average loss: 2.0439, Accuracy: 5341/10000 (53.4100%)
___Train Local_ResNet_18,  epoch 121, local model 16, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4347/4928 (88.2102%)
___Train Local_ResNet_18,  epoch 121, local model 16, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4507/4928 (91.4570%)
___Test Local_ResNet_18 poisoned: False, epoch: 121: Average loss: 1.7901, Accuracy: 5796/10000 (57.9600%)
___Train Local_ResNet_18,  epoch 121, local model 1, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4356/4986 (87.3646%)
___Train Local_ResNet_18,  epoch 121, local model 1, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4512/4986 (90.4934%)
___Test Local_ResNet_18 poisoned: False, epoch: 121: Average loss: 1.9561, Accuracy: 5572/10000 (55.7200%)
___Train Local_ResNet_18,  epoch 121, local model 61, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3676/4126 (89.0936%)
___Train Local_ResNet_18,  epoch 121, local model 61, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3747/4126 (90.8143%)
___Test Local_ResNet_18 poisoned: False, epoch: 121: Average loss: 1.8543, Accuracy: 5732/10000 (57.3200%)
___Train Local_ResNet_18,  epoch 121, local model 3, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4365/4918 (88.7556%)
___Train Local_ResNet_18,  epoch 121, local model 3, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4434/4918 (90.1586%)
___Test Local_ResNet_18 poisoned: False, epoch: 121: Average loss: 2.1762, Accuracy: 5186/10000 (51.8600%)
___Train Local_ResNet_18,  epoch 121, local model 54, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4537/5195 (87.3340%)
___Train Local_ResNet_18,  epoch 121, local model 54, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4571/5195 (87.9885%)
___Test Local_ResNet_18 poisoned: False, epoch: 121: Average loss: 1.9643, Accuracy: 5452/10000 (54.5200%)
___Train Local_ResNet_18,  epoch 121, local model 38, internal_epoch   1,  Average loss: 0.0059, Accuracy: 5105/5740 (88.9373%)
___Train Local_ResNet_18,  epoch 121, local model 38, internal_epoch   2,  Average loss: 0.0046, Accuracy: 5228/5740 (91.0801%)
___Test Local_ResNet_18 poisoned: False, epoch: 121: Average loss: 2.0572, Accuracy: 5458/10000 (54.5800%)
time spent on training: 270.8670039176941
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 121: Average loss: 1.6950, Accuracy: 6161/10000 (61.6100%)
___Test Target_ResNet_18 poisoned: True, epoch: 121: Average loss: 8.7478, Accuracy: 189/9900 (1.9091%)
Done in 301.8474235534668 sec.
Server Epoch:122 choose agents : [13, 36, 58, 71, 68, 98, 62, 8, 84, 27, 26, 76, 2, 82, 92, 45, 90, 55, 67, 29].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 122, local model 13, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4405/4885 (90.1740%), train_poison_data_count: 385
Global model norm: 44.25523009345901.
Norm before scaling: 44.247852337977235. Distance: 2.1023750861365382
Total norm for 4 adversaries is: 44.247852337977235. distance: 2.1023750861365382
___Test Local_ResNet_18 poisoned: True, epoch: 122: Average loss: 0.0998, Accuracy: 9636/9900 (97.3333%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 122, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4766/5305 (89.8398%), train_poison_data_count: 415
Global model norm: 44.25523009345901.
Norm before scaling: 44.24895307951152. Distance: 2.2130598793047667
Total norm for 4 adversaries is: 44.24895307951152. distance: 2.2130598793047667
___Test Local_ResNet_18 poisoned: True, epoch: 122: Average loss: 0.1317, Accuracy: 9568/9900 (96.6465%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 122, local model 58, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4246/4717 (90.0148%), train_poison_data_count: 370
Global model norm: 44.25523009345901.
Norm before scaling: 44.24729092166265. Distance: 2.0414939210433576
Total norm for 4 adversaries is: 44.24729092166265. distance: 2.0414939210433576
___Test Local_ResNet_18 poisoned: True, epoch: 122: Average loss: 0.3755, Accuracy: 8970/9900 (90.6061%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 122, local model 71, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4514/5066 (89.1038%), train_poison_data_count: 400
Global model norm: 44.25523009345901.
Norm before scaling: 44.25484806378209. Distance: 2.2473373552820335
Total norm for 4 adversaries is: 44.25484806378209. distance: 2.2473373552820335
___Test Local_ResNet_18 poisoned: True, epoch: 122: Average loss: 0.1922, Accuracy: 9408/9900 (95.0303%)
___Train Local_ResNet_18,  epoch 122, local model 68, internal_epoch   1,  Average loss: 0.0058, Accuracy: 2922/3297 (88.6260%)
___Train Local_ResNet_18,  epoch 122, local model 68, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3053/3297 (92.5993%)
___Test Local_ResNet_18 poisoned: False, epoch: 122: Average loss: 1.7762, Accuracy: 5784/10000 (57.8400%)
___Train Local_ResNet_18,  epoch 122, local model 98, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3383/3828 (88.3751%)
___Train Local_ResNet_18,  epoch 122, local model 98, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3486/3828 (91.0658%)
___Test Local_ResNet_18 poisoned: False, epoch: 122: Average loss: 1.8244, Accuracy: 5763/10000 (57.6300%)
___Train Local_ResNet_18,  epoch 122, local model 62, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4484/5063 (88.5641%)
___Train Local_ResNet_18,  epoch 122, local model 62, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4473/5063 (88.3468%)
___Test Local_ResNet_18 poisoned: False, epoch: 122: Average loss: 1.8917, Accuracy: 5627/10000 (56.2700%)
___Train Local_ResNet_18,  epoch 122, local model 8, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3971/4501 (88.2248%)
___Train Local_ResNet_18,  epoch 122, local model 8, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4100/4501 (91.0909%)
___Test Local_ResNet_18 poisoned: False, epoch: 122: Average loss: 1.8656, Accuracy: 5661/10000 (56.6100%)
___Train Local_ResNet_18,  epoch 122, local model 84, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4198/4793 (87.5861%)
___Train Local_ResNet_18,  epoch 122, local model 84, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4365/4793 (91.0703%)
___Test Local_ResNet_18 poisoned: False, epoch: 122: Average loss: 1.9150, Accuracy: 5609/10000 (56.0900%)
___Train Local_ResNet_18,  epoch 122, local model 27, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3747/4223 (88.7284%)
___Train Local_ResNet_18,  epoch 122, local model 27, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3889/4223 (92.0909%)
___Test Local_ResNet_18 poisoned: False, epoch: 122: Average loss: 1.8415, Accuracy: 5735/10000 (57.3500%)
___Train Local_ResNet_18,  epoch 122, local model 26, internal_epoch   1,  Average loss: 0.0045, Accuracy: 3446/3756 (91.7465%)
___Train Local_ResNet_18,  epoch 122, local model 26, internal_epoch   2,  Average loss: 0.0031, Accuracy: 3531/3756 (94.0096%)
___Test Local_ResNet_18 poisoned: False, epoch: 122: Average loss: 1.7609, Accuracy: 5892/10000 (58.9200%)
___Train Local_ResNet_18,  epoch 122, local model 76, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3145/3638 (86.4486%)
___Train Local_ResNet_18,  epoch 122, local model 76, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3329/3638 (91.5063%)
___Test Local_ResNet_18 poisoned: False, epoch: 122: Average loss: 1.8979, Accuracy: 5581/10000 (55.8100%)
___Train Local_ResNet_18,  epoch 122, local model 2, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3180/3646 (87.2189%)
___Train Local_ResNet_18,  epoch 122, local model 2, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3337/3646 (91.5250%)
___Test Local_ResNet_18 poisoned: False, epoch: 122: Average loss: 1.8669, Accuracy: 5725/10000 (57.2500%)
___Train Local_ResNet_18,  epoch 122, local model 82, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4374/4874 (89.7415%)
___Train Local_ResNet_18,  epoch 122, local model 82, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4355/4874 (89.3517%)
___Test Local_ResNet_18 poisoned: False, epoch: 122: Average loss: 2.0900, Accuracy: 5301/10000 (53.0100%)
___Train Local_ResNet_18,  epoch 122, local model 92, internal_epoch   1,  Average loss: 0.0052, Accuracy: 5620/6263 (89.7334%)
___Train Local_ResNet_18,  epoch 122, local model 92, internal_epoch   2,  Average loss: 0.0044, Accuracy: 5706/6263 (91.1065%)
___Test Local_ResNet_18 poisoned: False, epoch: 122: Average loss: 2.0189, Accuracy: 5531/10000 (55.3100%)
___Train Local_ResNet_18,  epoch 122, local model 45, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4401/5037 (87.3734%)
___Train Local_ResNet_18,  epoch 122, local model 45, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4523/5037 (89.7955%)
___Test Local_ResNet_18 poisoned: False, epoch: 122: Average loss: 1.9133, Accuracy: 5523/10000 (55.2300%)
___Train Local_ResNet_18,  epoch 122, local model 90, internal_epoch   1,  Average loss: 0.0051, Accuracy: 3943/4362 (90.3943%)
___Train Local_ResNet_18,  epoch 122, local model 90, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4014/4362 (92.0220%)
___Test Local_ResNet_18 poisoned: False, epoch: 122: Average loss: 1.9123, Accuracy: 5514/10000 (55.1400%)
___Train Local_ResNet_18,  epoch 122, local model 55, internal_epoch   1,  Average loss: 0.0036, Accuracy: 4067/4356 (93.3655%)
___Train Local_ResNet_18,  epoch 122, local model 55, internal_epoch   2,  Average loss: 0.0032, Accuracy: 4126/4356 (94.7199%)
___Test Local_ResNet_18 poisoned: False, epoch: 122: Average loss: 1.8039, Accuracy: 5836/10000 (58.3600%)
___Train Local_ResNet_18,  epoch 122, local model 67, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4519/5116 (88.3307%)
___Train Local_ResNet_18,  epoch 122, local model 67, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4555/5116 (89.0344%)
___Test Local_ResNet_18 poisoned: False, epoch: 122: Average loss: 2.0401, Accuracy: 5405/10000 (54.0500%)
___Train Local_ResNet_18,  epoch 122, local model 29, internal_epoch   1,  Average loss: 0.0049, Accuracy: 3941/4346 (90.6811%)
___Train Local_ResNet_18,  epoch 122, local model 29, internal_epoch   2,  Average loss: 0.0033, Accuracy: 4080/4346 (93.8794%)
___Test Local_ResNet_18 poisoned: False, epoch: 122: Average loss: 1.8075, Accuracy: 5796/10000 (57.9600%)
time spent on training: 260.0289463996887
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 122: Average loss: 1.7000, Accuracy: 6187/10000 (61.8700%)
___Test Target_ResNet_18 poisoned: True, epoch: 122: Average loss: 8.6855, Accuracy: 214/9900 (2.1616%)
Done in 290.35582304000854 sec.
Server Epoch:123 choose agents : [13, 36, 58, 71, 34, 57, 60, 51, 12, 16, 11, 56, 1, 31, 22, 62, 48, 2, 35, 6].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 123, local model 13, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4405/4885 (90.1740%), train_poison_data_count: 385
Global model norm: 44.28830797888775.
Norm before scaling: 44.28366342885023. Distance: 2.1528794855955806
Total norm for 4 adversaries is: 44.28366342885023. distance: 2.1528794855955806
___Test Local_ResNet_18 poisoned: True, epoch: 123: Average loss: 0.1256, Accuracy: 9587/9900 (96.8384%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 123, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4766/5305 (89.8398%), train_poison_data_count: 415
Global model norm: 44.28830797888775.
Norm before scaling: 44.28270827256532. Distance: 2.183739072164216
Total norm for 4 adversaries is: 44.28270827256532. distance: 2.183739072164216
___Test Local_ResNet_18 poisoned: True, epoch: 123: Average loss: 0.2008, Accuracy: 9423/9900 (95.1818%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 123, local model 58, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4270/4717 (90.5236%), train_poison_data_count: 370
Global model norm: 44.28830797888775.
Norm before scaling: 44.28093986967968. Distance: 2.015802893070386
Total norm for 4 adversaries is: 44.28093986967968. distance: 2.015802893070386
___Test Local_ResNet_18 poisoned: True, epoch: 123: Average loss: 0.2609, Accuracy: 9231/9900 (93.2424%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 123, local model 71, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4519/5066 (89.2025%), train_poison_data_count: 400
Global model norm: 44.28830797888775.
Norm before scaling: 44.28572528329177. Distance: 2.2143756566920154
Total norm for 4 adversaries is: 44.28572528329177. distance: 2.2143756566920154
___Test Local_ResNet_18 poisoned: True, epoch: 123: Average loss: 0.2552, Accuracy: 9233/9900 (93.2626%)
___Train Local_ResNet_18,  epoch 123, local model 34, internal_epoch   1,  Average loss: 0.0050, Accuracy: 4082/4518 (90.3497%)
___Train Local_ResNet_18,  epoch 123, local model 34, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4149/4518 (91.8327%)
___Test Local_ResNet_18 poisoned: False, epoch: 123: Average loss: 2.0099, Accuracy: 5436/10000 (54.3600%)
___Train Local_ResNet_18,  epoch 123, local model 57, internal_epoch   1,  Average loss: 0.0053, Accuracy: 4077/4558 (89.4471%)
___Train Local_ResNet_18,  epoch 123, local model 57, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4161/4558 (91.2900%)
___Test Local_ResNet_18 poisoned: False, epoch: 123: Average loss: 1.9267, Accuracy: 5573/10000 (55.7300%)
___Train Local_ResNet_18,  epoch 123, local model 60, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3388/3804 (89.0641%)
___Train Local_ResNet_18,  epoch 123, local model 60, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3514/3804 (92.3764%)
___Test Local_ResNet_18 poisoned: False, epoch: 123: Average loss: 1.9455, Accuracy: 5636/10000 (56.3600%)
___Train Local_ResNet_18,  epoch 123, local model 51, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3377/3775 (89.4570%)
___Train Local_ResNet_18,  epoch 123, local model 51, internal_epoch   2,  Average loss: 0.0032, Accuracy: 3551/3775 (94.0662%)
___Test Local_ResNet_18 poisoned: False, epoch: 123: Average loss: 1.7245, Accuracy: 5940/10000 (59.4000%)
___Train Local_ResNet_18,  epoch 123, local model 12, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4470/5083 (87.9402%)
___Train Local_ResNet_18,  epoch 123, local model 12, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4572/5083 (89.9469%)
___Test Local_ResNet_18 poisoned: False, epoch: 123: Average loss: 2.0288, Accuracy: 5477/10000 (54.7700%)
___Train Local_ResNet_18,  epoch 123, local model 16, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4386/4928 (89.0016%)
___Train Local_ResNet_18,  epoch 123, local model 16, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4483/4928 (90.9700%)
___Test Local_ResNet_18 poisoned: False, epoch: 123: Average loss: 1.8429, Accuracy: 5698/10000 (56.9800%)
___Train Local_ResNet_18,  epoch 123, local model 11, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4501/5244 (85.8314%)
___Train Local_ResNet_18,  epoch 123, local model 11, internal_epoch   2,  Average loss: 0.0065, Accuracy: 4554/5244 (86.8421%)
___Test Local_ResNet_18 poisoned: False, epoch: 123: Average loss: 2.0833, Accuracy: 5387/10000 (53.8700%)
___Train Local_ResNet_18,  epoch 123, local model 56, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4378/4989 (87.7531%)
___Train Local_ResNet_18,  epoch 123, local model 56, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4528/4989 (90.7597%)
___Test Local_ResNet_18 poisoned: False, epoch: 123: Average loss: 1.9001, Accuracy: 5706/10000 (57.0600%)
___Train Local_ResNet_18,  epoch 123, local model 1, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4428/4986 (88.8087%)
___Train Local_ResNet_18,  epoch 123, local model 1, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4528/4986 (90.8143%)
___Test Local_ResNet_18 poisoned: False, epoch: 123: Average loss: 1.9521, Accuracy: 5585/10000 (55.8500%)
___Train Local_ResNet_18,  epoch 123, local model 31, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3691/4175 (88.4072%)
___Train Local_ResNet_18,  epoch 123, local model 31, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3747/4175 (89.7485%)
___Test Local_ResNet_18 poisoned: False, epoch: 123: Average loss: 2.0035, Accuracy: 5460/10000 (54.6000%)
___Train Local_ResNet_18,  epoch 123, local model 22, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4586/5232 (87.6529%)
___Train Local_ResNet_18,  epoch 123, local model 22, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4679/5232 (89.4304%)
___Test Local_ResNet_18 poisoned: False, epoch: 123: Average loss: 1.9929, Accuracy: 5470/10000 (54.7000%)
___Train Local_ResNet_18,  epoch 123, local model 62, internal_epoch   1,  Average loss: 0.0048, Accuracy: 4587/5063 (90.5985%)
___Train Local_ResNet_18,  epoch 123, local model 62, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4497/5063 (88.8209%)
___Test Local_ResNet_18 poisoned: False, epoch: 123: Average loss: 2.1153, Accuracy: 5248/10000 (52.4800%)
___Train Local_ResNet_18,  epoch 123, local model 48, internal_epoch   1,  Average loss: 0.0050, Accuracy: 4000/4441 (90.0698%)
___Train Local_ResNet_18,  epoch 123, local model 48, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4107/4441 (92.4792%)
___Test Local_ResNet_18 poisoned: False, epoch: 123: Average loss: 1.9529, Accuracy: 5618/10000 (56.1800%)
___Train Local_ResNet_18,  epoch 123, local model 2, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3223/3646 (88.3982%)
___Train Local_ResNet_18,  epoch 123, local model 2, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3355/3646 (92.0187%)
___Test Local_ResNet_18 poisoned: False, epoch: 123: Average loss: 1.7816, Accuracy: 5826/10000 (58.2600%)
___Train Local_ResNet_18,  epoch 123, local model 35, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4590/5167 (88.8330%)
___Train Local_ResNet_18,  epoch 123, local model 35, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4707/5167 (91.0973%)
___Test Local_ResNet_18 poisoned: False, epoch: 123: Average loss: 2.1004, Accuracy: 5300/10000 (53.0000%)
___Train Local_ResNet_18,  epoch 123, local model 6, internal_epoch   1,  Average loss: 0.0052, Accuracy: 4089/4538 (90.1058%)
___Train Local_ResNet_18,  epoch 123, local model 6, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4181/4538 (92.1331%)
___Test Local_ResNet_18 poisoned: False, epoch: 123: Average loss: 1.8393, Accuracy: 5706/10000 (57.0600%)
time spent on training: 270.51447105407715
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 123: Average loss: 1.6942, Accuracy: 6168/10000 (61.6800%)
___Test Target_ResNet_18 poisoned: True, epoch: 123: Average loss: 8.9670, Accuracy: 160/9900 (1.6162%)
Done in 306.9575951099396 sec.
Server Epoch:124 choose agents : [13, 36, 58, 71, 55, 19, 45, 94, 51, 35, 73, 46, 38, 96, 4, 30, 93, 21, 25, 39].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 124, local model 13, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4406/4885 (90.1945%), train_poison_data_count: 385
Global model norm: 44.32507231954408.
Norm before scaling: 44.319810530605274. Distance: 2.113138980272019
Total norm for 4 adversaries is: 44.319810530605274. distance: 2.113138980272019
___Test Local_ResNet_18 poisoned: True, epoch: 124: Average loss: 0.1670, Accuracy: 9495/9900 (95.9091%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 124, local model 36, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4785/5305 (90.1979%), train_poison_data_count: 415
Global model norm: 44.32507231954408.
Norm before scaling: 44.31537725364428. Distance: 2.148494428400597
Total norm for 4 adversaries is: 44.31537725364428. distance: 2.148494428400597
___Test Local_ResNet_18 poisoned: True, epoch: 124: Average loss: 0.1300, Accuracy: 9586/9900 (96.8283%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 124, local model 58, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4207/4717 (89.1880%), train_poison_data_count: 370
Global model norm: 44.32507231954408.
Norm before scaling: 44.31880657475941. Distance: 2.0926307989187904
Total norm for 4 adversaries is: 44.31880657475941. distance: 2.0926307989187904
___Test Local_ResNet_18 poisoned: True, epoch: 124: Average loss: 0.1373, Accuracy: 9546/9900 (96.4242%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 124, local model 71, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4503/5066 (88.8867%), train_poison_data_count: 400
Global model norm: 44.32507231954408.
Norm before scaling: 44.32100312898361. Distance: 2.218348722034313
Total norm for 4 adversaries is: 44.32100312898361. distance: 2.218348722034313
___Test Local_ResNet_18 poisoned: True, epoch: 124: Average loss: 0.1455, Accuracy: 9523/9900 (96.1919%)
___Train Local_ResNet_18,  epoch 124, local model 55, internal_epoch   1,  Average loss: 0.0032, Accuracy: 4109/4356 (94.3297%)
___Train Local_ResNet_18,  epoch 124, local model 55, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3996/4356 (91.7355%)
___Test Local_ResNet_18 poisoned: False, epoch: 124: Average loss: 2.0415, Accuracy: 5467/10000 (54.6700%)
___Train Local_ResNet_18,  epoch 124, local model 19, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4368/4928 (88.6364%)
___Train Local_ResNet_18,  epoch 124, local model 19, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4387/4928 (89.0219%)
___Test Local_ResNet_18 poisoned: False, epoch: 124: Average loss: 2.3408, Accuracy: 5014/10000 (50.1400%)
___Train Local_ResNet_18,  epoch 124, local model 45, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4480/5037 (88.9418%)
___Train Local_ResNet_18,  epoch 124, local model 45, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4601/5037 (91.3441%)
___Test Local_ResNet_18 poisoned: False, epoch: 124: Average loss: 1.8233, Accuracy: 5672/10000 (56.7200%)
___Train Local_ResNet_18,  epoch 124, local model 94, internal_epoch   1,  Average loss: 0.0041, Accuracy: 4450/4804 (92.6311%)
___Train Local_ResNet_18,  epoch 124, local model 94, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4362/4804 (90.7993%)
___Test Local_ResNet_18 poisoned: False, epoch: 124: Average loss: 2.1068, Accuracy: 5417/10000 (54.1700%)
___Train Local_ResNet_18,  epoch 124, local model 51, internal_epoch   1,  Average loss: 0.0048, Accuracy: 3457/3775 (91.5762%)
___Train Local_ResNet_18,  epoch 124, local model 51, internal_epoch   2,  Average loss: 0.0031, Accuracy: 3558/3775 (94.2517%)
___Test Local_ResNet_18 poisoned: False, epoch: 124: Average loss: 1.7327, Accuracy: 6001/10000 (60.0100%)
___Train Local_ResNet_18,  epoch 124, local model 35, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4573/5167 (88.5040%)
___Train Local_ResNet_18,  epoch 124, local model 35, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4710/5167 (91.1554%)
___Test Local_ResNet_18 poisoned: False, epoch: 124: Average loss: 2.0556, Accuracy: 5445/10000 (54.4500%)
___Train Local_ResNet_18,  epoch 124, local model 73, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3773/4235 (89.0909%)
___Train Local_ResNet_18,  epoch 124, local model 73, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3919/4235 (92.5384%)
___Test Local_ResNet_18 poisoned: False, epoch: 124: Average loss: 1.8599, Accuracy: 5795/10000 (57.9500%)
___Train Local_ResNet_18,  epoch 124, local model 46, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4356/4956 (87.8935%)
___Train Local_ResNet_18,  epoch 124, local model 46, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4437/4956 (89.5278%)
___Test Local_ResNet_18 poisoned: False, epoch: 124: Average loss: 1.9086, Accuracy: 5642/10000 (56.4200%)
___Train Local_ResNet_18,  epoch 124, local model 38, internal_epoch   1,  Average loss: 0.0055, Accuracy: 5146/5740 (89.6516%)
___Train Local_ResNet_18,  epoch 124, local model 38, internal_epoch   2,  Average loss: 0.0046, Accuracy: 5229/5740 (91.0976%)
___Test Local_ResNet_18 poisoned: False, epoch: 124: Average loss: 1.9969, Accuracy: 5402/10000 (54.0200%)
___Train Local_ResNet_18,  epoch 124, local model 96, internal_epoch   1,  Average loss: 0.0040, Accuracy: 4299/4679 (91.8786%)
___Train Local_ResNet_18,  epoch 124, local model 96, internal_epoch   2,  Average loss: 0.0037, Accuracy: 4352/4679 (93.0113%)
___Test Local_ResNet_18 poisoned: False, epoch: 124: Average loss: 2.0441, Accuracy: 5470/10000 (54.7000%)
___Train Local_ResNet_18,  epoch 124, local model 4, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3289/3704 (88.7959%)
___Train Local_ResNet_18,  epoch 124, local model 4, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3381/3704 (91.2797%)
___Test Local_ResNet_18 poisoned: False, epoch: 124: Average loss: 1.8168, Accuracy: 5842/10000 (58.4200%)
___Train Local_ResNet_18,  epoch 124, local model 30, internal_epoch   1,  Average loss: 0.0051, Accuracy: 3116/3472 (89.7465%)
___Train Local_ResNet_18,  epoch 124, local model 30, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3222/3472 (92.7995%)
___Test Local_ResNet_18 poisoned: False, epoch: 124: Average loss: 1.8822, Accuracy: 5708/10000 (57.0800%)
___Train Local_ResNet_18,  epoch 124, local model 93, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4126/4651 (88.7121%)
___Train Local_ResNet_18,  epoch 124, local model 93, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4221/4651 (90.7547%)
___Test Local_ResNet_18 poisoned: False, epoch: 124: Average loss: 2.0961, Accuracy: 5326/10000 (53.2600%)
___Train Local_ResNet_18,  epoch 124, local model 21, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4096/4634 (88.3902%)
___Train Local_ResNet_18,  epoch 124, local model 21, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4220/4634 (91.0660%)
___Test Local_ResNet_18 poisoned: False, epoch: 124: Average loss: 1.8919, Accuracy: 5697/10000 (56.9700%)
___Train Local_ResNet_18,  epoch 124, local model 25, internal_epoch   1,  Average loss: 0.0045, Accuracy: 5395/5902 (91.4097%)
___Train Local_ResNet_18,  epoch 124, local model 25, internal_epoch   2,  Average loss: 0.0052, Accuracy: 5299/5902 (89.7831%)
___Test Local_ResNet_18 poisoned: False, epoch: 124: Average loss: 2.0046, Accuracy: 5539/10000 (55.3900%)
___Train Local_ResNet_18,  epoch 124, local model 39, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3388/3837 (88.2981%)
___Train Local_ResNet_18,  epoch 124, local model 39, internal_epoch   2,  Average loss: 0.0038, Accuracy: 3544/3837 (92.3638%)
___Test Local_ResNet_18 poisoned: False, epoch: 124: Average loss: 1.7920, Accuracy: 5827/10000 (58.2700%)
time spent on training: 268.03734397888184
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 124: Average loss: 1.7968, Accuracy: 6005/10000 (60.0500%)
___Test Target_ResNet_18 poisoned: True, epoch: 124: Average loss: 8.4828, Accuracy: 209/9900 (2.1111%)
Done in 299.4855864048004 sec.
Server Epoch:125 choose agents : [13, 36, 58, 71, 24, 47, 14, 5, 64, 16, 80, 43, 3, 20, 63, 66, 37, 8, 18, 57].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 125, local model 13, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4415/4885 (90.3787%), train_poison_data_count: 385
Global model norm: 44.35329574845594.
Norm before scaling: 44.348008406346445. Distance: 2.090238901018273
Total norm for 4 adversaries is: 44.348008406346445. distance: 2.090238901018273
___Test Local_ResNet_18 poisoned: True, epoch: 125: Average loss: 0.2565, Accuracy: 9287/9900 (93.8081%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 125, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4756/5305 (89.6513%), train_poison_data_count: 415
Global model norm: 44.35329574845594.
Norm before scaling: 44.34780058799069. Distance: 2.2102471342039087
Total norm for 4 adversaries is: 44.34780058799069. distance: 2.2102471342039087
___Test Local_ResNet_18 poisoned: True, epoch: 125: Average loss: 0.1099, Accuracy: 9636/9900 (97.3333%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 125, local model 58, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4258/4717 (90.2692%), train_poison_data_count: 370
Global model norm: 44.35329574845594.
Norm before scaling: 44.34329302971025. Distance: 2.016600616676534
Total norm for 4 adversaries is: 44.34329302971025. distance: 2.016600616676534
___Test Local_ResNet_18 poisoned: True, epoch: 125: Average loss: 0.2669, Accuracy: 9244/9900 (93.3737%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 125, local model 71, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4489/5066 (88.6103%), train_poison_data_count: 400
Global model norm: 44.35329574845594.
Norm before scaling: 44.35283612426183. Distance: 2.290091950348773
Total norm for 4 adversaries is: 44.35283612426183. distance: 2.290091950348773
___Test Local_ResNet_18 poisoned: True, epoch: 125: Average loss: 0.0941, Accuracy: 9644/9900 (97.4141%)
___Train Local_ResNet_18,  epoch 125, local model 24, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3535/3969 (89.0653%)
___Train Local_ResNet_18,  epoch 125, local model 24, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3618/3969 (91.1565%)
___Test Local_ResNet_18 poisoned: False, epoch: 125: Average loss: 1.8375, Accuracy: 5868/10000 (58.6800%)
___Train Local_ResNet_18,  epoch 125, local model 47, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4173/4707 (88.6552%)
___Train Local_ResNet_18,  epoch 125, local model 47, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4283/4707 (90.9921%)
___Test Local_ResNet_18 poisoned: False, epoch: 125: Average loss: 1.8355, Accuracy: 5749/10000 (57.4900%)
___Train Local_ResNet_18,  epoch 125, local model 14, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3421/3861 (88.6040%)
___Train Local_ResNet_18,  epoch 125, local model 14, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3514/3861 (91.0127%)
___Test Local_ResNet_18 poisoned: False, epoch: 125: Average loss: 1.8795, Accuracy: 5623/10000 (56.2300%)
___Train Local_ResNet_18,  epoch 125, local model 5, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4123/4596 (89.7084%)
___Train Local_ResNet_18,  epoch 125, local model 5, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4238/4596 (92.2106%)
___Test Local_ResNet_18 poisoned: False, epoch: 125: Average loss: 1.9861, Accuracy: 5527/10000 (55.2700%)
___Train Local_ResNet_18,  epoch 125, local model 64, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4025/4503 (89.3849%)
___Train Local_ResNet_18,  epoch 125, local model 64, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4116/4503 (91.4057%)
___Test Local_ResNet_18 poisoned: False, epoch: 125: Average loss: 2.0048, Accuracy: 5534/10000 (55.3400%)
___Train Local_ResNet_18,  epoch 125, local model 16, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4391/4928 (89.1031%)
___Train Local_ResNet_18,  epoch 125, local model 16, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4504/4928 (91.3961%)
___Test Local_ResNet_18 poisoned: False, epoch: 125: Average loss: 1.8022, Accuracy: 5877/10000 (58.7700%)
___Train Local_ResNet_18,  epoch 125, local model 80, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4456/5025 (88.6766%)
___Train Local_ResNet_18,  epoch 125, local model 80, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4545/5025 (90.4478%)
___Test Local_ResNet_18 poisoned: False, epoch: 125: Average loss: 1.9834, Accuracy: 5617/10000 (56.1700%)
___Train Local_ResNet_18,  epoch 125, local model 43, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4070/4576 (88.9423%)
___Train Local_ResNet_18,  epoch 125, local model 43, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4216/4576 (92.1329%)
___Test Local_ResNet_18 poisoned: False, epoch: 125: Average loss: 1.9915, Accuracy: 5536/10000 (55.3600%)
___Train Local_ResNet_18,  epoch 125, local model 3, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4331/4918 (88.0643%)
___Train Local_ResNet_18,  epoch 125, local model 3, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4509/4918 (91.6836%)
___Test Local_ResNet_18 poisoned: False, epoch: 125: Average loss: 1.8360, Accuracy: 5659/10000 (56.5900%)
___Train Local_ResNet_18,  epoch 125, local model 20, internal_epoch   1,  Average loss: 0.0048, Accuracy: 3912/4315 (90.6605%)
___Train Local_ResNet_18,  epoch 125, local model 20, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3998/4315 (92.6535%)
___Test Local_ResNet_18 poisoned: False, epoch: 125: Average loss: 1.8410, Accuracy: 5774/10000 (57.7400%)
___Train Local_ResNet_18,  epoch 125, local model 63, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3238/3590 (90.1950%)
___Train Local_ResNet_18,  epoch 125, local model 63, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3281/3590 (91.3928%)
___Test Local_ResNet_18 poisoned: False, epoch: 125: Average loss: 1.9236, Accuracy: 5705/10000 (57.0500%)
___Train Local_ResNet_18,  epoch 125, local model 66, internal_epoch   1,  Average loss: 0.0052, Accuracy: 3998/4456 (89.7217%)
___Train Local_ResNet_18,  epoch 125, local model 66, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4138/4456 (92.8636%)
___Test Local_ResNet_18 poisoned: False, epoch: 125: Average loss: 1.8043, Accuracy: 5762/10000 (57.6200%)
___Train Local_ResNet_18,  epoch 125, local model 37, internal_epoch   1,  Average loss: 0.0025, Accuracy: 4199/4354 (96.4401%)
___Train Local_ResNet_18,  epoch 125, local model 37, internal_epoch   2,  Average loss: 0.0065, Accuracy: 3868/4354 (88.8379%)
___Test Local_ResNet_18 poisoned: False, epoch: 125: Average loss: 2.1502, Accuracy: 5309/10000 (53.0900%)
___Train Local_ResNet_18,  epoch 125, local model 8, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3977/4501 (88.3581%)
___Train Local_ResNet_18,  epoch 125, local model 8, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4044/4501 (89.8467%)
___Test Local_ResNet_18 poisoned: False, epoch: 125: Average loss: 1.8981, Accuracy: 5607/10000 (56.0700%)
___Train Local_ResNet_18,  epoch 125, local model 18, internal_epoch   1,  Average loss: 0.0047, Accuracy: 3579/3911 (91.5111%)
___Train Local_ResNet_18,  epoch 125, local model 18, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3592/3911 (91.8435%)
___Test Local_ResNet_18 poisoned: False, epoch: 125: Average loss: 1.9097, Accuracy: 5704/10000 (57.0400%)
___Train Local_ResNet_18,  epoch 125, local model 57, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4089/4558 (89.7104%)
___Train Local_ResNet_18,  epoch 125, local model 57, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4175/4558 (91.5972%)
___Test Local_ResNet_18 poisoned: False, epoch: 125: Average loss: 2.0115, Accuracy: 5440/10000 (54.4000%)
time spent on training: 266.07759165763855
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 125: Average loss: 1.8182, Accuracy: 5990/10000 (59.9000%)
___Test Target_ResNet_18 poisoned: True, epoch: 125: Average loss: 8.5522, Accuracy: 231/9900 (2.3333%)
Done in 297.17311811447144 sec.
Server Epoch:126 choose agents : [13, 36, 58, 71, 67, 70, 72, 81, 59, 95, 76, 74, 82, 2, 62, 61, 88, 17, 34, 68].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 126, local model 13, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4420/4885 (90.4811%), train_poison_data_count: 385
Global model norm: 44.3839697140547.
Norm before scaling: 44.37686230687254. Distance: 2.0442718959408728
Total norm for 4 adversaries is: 44.37686230687254. distance: 2.0442718959408728
___Test Local_ResNet_18 poisoned: True, epoch: 126: Average loss: 0.2632, Accuracy: 9238/9900 (93.3131%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 126, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4749/5305 (89.5193%), train_poison_data_count: 415
Global model norm: 44.3839697140547.
Norm before scaling: 44.378476976457854. Distance: 2.209063595161593
Total norm for 4 adversaries is: 44.378476976457854. distance: 2.209063595161593
___Test Local_ResNet_18 poisoned: True, epoch: 126: Average loss: 0.1207, Accuracy: 9601/9900 (96.9798%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 126, local model 58, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4264/4717 (90.3964%), train_poison_data_count: 370
Global model norm: 44.3839697140547.
Norm before scaling: 44.37632727988609. Distance: 2.0389494298226887
Total norm for 4 adversaries is: 44.37632727988609. distance: 2.0389494298226887
___Test Local_ResNet_18 poisoned: True, epoch: 126: Average loss: 0.1805, Accuracy: 9431/9900 (95.2626%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 126, local model 71, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4495/5066 (88.7288%), train_poison_data_count: 400
Global model norm: 44.3839697140547.
Norm before scaling: 44.38245013384021. Distance: 2.251786264687645
Total norm for 4 adversaries is: 44.38245013384021. distance: 2.251786264687645
___Test Local_ResNet_18 poisoned: True, epoch: 126: Average loss: 0.1845, Accuracy: 9384/9900 (94.7879%)
___Train Local_ResNet_18,  epoch 126, local model 67, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4470/5116 (87.3729%)
___Train Local_ResNet_18,  epoch 126, local model 67, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4624/5116 (90.3831%)
___Test Local_ResNet_18 poisoned: False, epoch: 126: Average loss: 2.0294, Accuracy: 5420/10000 (54.2000%)
___Train Local_ResNet_18,  epoch 126, local model 70, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4813/5392 (89.2619%)
___Train Local_ResNet_18,  epoch 126, local model 70, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4790/5392 (88.8353%)
___Test Local_ResNet_18 poisoned: False, epoch: 126: Average loss: 2.0265, Accuracy: 5439/10000 (54.3900%)
___Train Local_ResNet_18,  epoch 126, local model 72, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4126/4767 (86.5534%)
___Train Local_ResNet_18,  epoch 126, local model 72, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4268/4767 (89.5322%)
___Test Local_ResNet_18 poisoned: False, epoch: 126: Average loss: 2.0900, Accuracy: 5374/10000 (53.7400%)
___Train Local_ResNet_18,  epoch 126, local model 81, internal_epoch   1,  Average loss: 0.0053, Accuracy: 4151/4618 (89.8874%)
___Train Local_ResNet_18,  epoch 126, local model 81, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4154/4618 (89.9524%)
___Test Local_ResNet_18 poisoned: False, epoch: 126: Average loss: 1.9165, Accuracy: 5631/10000 (56.3100%)
___Train Local_ResNet_18,  epoch 126, local model 59, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3646/4046 (90.1137%)
___Train Local_ResNet_18,  epoch 126, local model 59, internal_epoch   2,  Average loss: 0.0038, Accuracy: 3753/4046 (92.7583%)
___Test Local_ResNet_18 poisoned: False, epoch: 126: Average loss: 1.9243, Accuracy: 5567/10000 (55.6700%)
___Train Local_ResNet_18,  epoch 126, local model 95, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3971/4625 (85.8595%)
___Train Local_ResNet_18,  epoch 126, local model 95, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4102/4625 (88.6919%)
___Test Local_ResNet_18 poisoned: False, epoch: 126: Average loss: 1.9387, Accuracy: 5484/10000 (54.8400%)
___Train Local_ResNet_18,  epoch 126, local model 76, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3183/3638 (87.4931%)
___Train Local_ResNet_18,  epoch 126, local model 76, internal_epoch   2,  Average loss: 0.0037, Accuracy: 3372/3638 (92.6883%)
___Test Local_ResNet_18 poisoned: False, epoch: 126: Average loss: 1.8638, Accuracy: 5691/10000 (56.9100%)
___Train Local_ResNet_18,  epoch 126, local model 74, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3857/4416 (87.3415%)
___Train Local_ResNet_18,  epoch 126, local model 74, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3986/4416 (90.2627%)
___Test Local_ResNet_18 poisoned: False, epoch: 126: Average loss: 1.9255, Accuracy: 5613/10000 (56.1300%)
___Train Local_ResNet_18,  epoch 126, local model 82, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4322/4874 (88.6746%)
___Train Local_ResNet_18,  epoch 126, local model 82, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4425/4874 (90.7879%)
___Test Local_ResNet_18 poisoned: False, epoch: 126: Average loss: 2.0434, Accuracy: 5441/10000 (54.4100%)
___Train Local_ResNet_18,  epoch 126, local model 2, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3220/3646 (88.3160%)
___Train Local_ResNet_18,  epoch 126, local model 2, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3327/3646 (91.2507%)
___Test Local_ResNet_18 poisoned: False, epoch: 126: Average loss: 1.8089, Accuracy: 5756/10000 (57.5600%)
___Train Local_ResNet_18,  epoch 126, local model 62, internal_epoch   1,  Average loss: 0.0047, Accuracy: 4597/5063 (90.7960%)
___Train Local_ResNet_18,  epoch 126, local model 62, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4572/5063 (90.3022%)
___Test Local_ResNet_18 poisoned: False, epoch: 126: Average loss: 2.0949, Accuracy: 5436/10000 (54.3600%)
___Train Local_ResNet_18,  epoch 126, local model 61, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3680/4126 (89.1905%)
___Train Local_ResNet_18,  epoch 126, local model 61, internal_epoch   2,  Average loss: 0.0036, Accuracy: 3831/4126 (92.8502%)
___Test Local_ResNet_18 poisoned: False, epoch: 126: Average loss: 1.9574, Accuracy: 5608/10000 (56.0800%)
___Train Local_ResNet_18,  epoch 126, local model 88, internal_epoch   1,  Average loss: 0.0044, Accuracy: 4514/4934 (91.4876%)
___Train Local_ResNet_18,  epoch 126, local model 88, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4563/4934 (92.4807%)
___Test Local_ResNet_18 poisoned: False, epoch: 126: Average loss: 2.0265, Accuracy: 5575/10000 (55.7500%)
___Train Local_ResNet_18,  epoch 126, local model 17, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4004/4511 (88.7608%)
___Train Local_ResNet_18,  epoch 126, local model 17, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4109/4511 (91.0885%)
___Test Local_ResNet_18 poisoned: False, epoch: 126: Average loss: 1.9586, Accuracy: 5462/10000 (54.6200%)
___Train Local_ResNet_18,  epoch 126, local model 34, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4037/4518 (89.3537%)
___Train Local_ResNet_18,  epoch 126, local model 34, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4157/4518 (92.0097%)
___Test Local_ResNet_18 poisoned: False, epoch: 126: Average loss: 1.8385, Accuracy: 5665/10000 (56.6500%)
___Train Local_ResNet_18,  epoch 126, local model 68, internal_epoch   1,  Average loss: 0.0053, Accuracy: 2962/3297 (89.8392%)
___Train Local_ResNet_18,  epoch 126, local model 68, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3023/3297 (91.6894%)
___Test Local_ResNet_18 poisoned: False, epoch: 126: Average loss: 1.7542, Accuracy: 5857/10000 (58.5700%)
time spent on training: 265.9906601905823
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 126: Average loss: 1.7877, Accuracy: 5999/10000 (59.9900%)
___Test Target_ResNet_18 poisoned: True, epoch: 126: Average loss: 8.9226, Accuracy: 171/9900 (1.7273%)
Done in 296.88689732551575 sec.
Server Epoch:127 choose agents : [13, 36, 58, 71, 53, 80, 30, 45, 15, 67, 34, 19, 57, 68, 26, 93, 48, 76, 5, 83].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 127, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4400/4885 (90.0716%), train_poison_data_count: 385
Global model norm: 44.41954465396539.
Norm before scaling: 44.41466921859123. Distance: 2.1295071095161857
Total norm for 4 adversaries is: 44.41466921859123. distance: 2.1295071095161857
___Test Local_ResNet_18 poisoned: True, epoch: 127: Average loss: 0.0984, Accuracy: 9634/9900 (97.3131%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 127, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4754/5305 (89.6136%), train_poison_data_count: 415
Global model norm: 44.41954465396539.
Norm before scaling: 44.41151666516243. Distance: 2.2033889287762745
Total norm for 4 adversaries is: 44.41151666516243. distance: 2.2033889287762745
___Test Local_ResNet_18 poisoned: True, epoch: 127: Average loss: 0.0887, Accuracy: 9693/9900 (97.9091%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 127, local model 58, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4249/4717 (90.0784%), train_poison_data_count: 370
Global model norm: 44.41954465396539.
Norm before scaling: 44.409518374619026. Distance: 2.0321160450937685
Total norm for 4 adversaries is: 44.409518374619026. distance: 2.0321160450937685
___Test Local_ResNet_18 poisoned: True, epoch: 127: Average loss: 0.3055, Accuracy: 9116/9900 (92.0808%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 127, local model 71, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4526/5066 (89.3407%), train_poison_data_count: 400
Global model norm: 44.41954465396539.
Norm before scaling: 44.415382428715645. Distance: 2.2328357863496615
Total norm for 4 adversaries is: 44.415382428715645. distance: 2.2328357863496615
___Test Local_ResNet_18 poisoned: True, epoch: 127: Average loss: 0.2143, Accuracy: 9362/9900 (94.5657%)
___Train Local_ResNet_18,  epoch 127, local model 53, internal_epoch   1,  Average loss: 0.0054, Accuracy: 5492/6124 (89.6799%)
___Train Local_ResNet_18,  epoch 127, local model 53, internal_epoch   2,  Average loss: 0.0052, Accuracy: 5505/6124 (89.8922%)
___Test Local_ResNet_18 poisoned: False, epoch: 127: Average loss: 1.9815, Accuracy: 5390/10000 (53.9000%)
___Train Local_ResNet_18,  epoch 127, local model 80, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4450/5025 (88.5572%)
___Train Local_ResNet_18,  epoch 127, local model 80, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4584/5025 (91.2239%)
___Test Local_ResNet_18 poisoned: False, epoch: 127: Average loss: 2.0714, Accuracy: 5472/10000 (54.7200%)
___Train Local_ResNet_18,  epoch 127, local model 30, internal_epoch   1,  Average loss: 0.0049, Accuracy: 3134/3472 (90.2650%)
___Train Local_ResNet_18,  epoch 127, local model 30, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3155/3472 (90.8698%)
___Test Local_ResNet_18 poisoned: False, epoch: 127: Average loss: 1.9624, Accuracy: 5547/10000 (55.4700%)
___Train Local_ResNet_18,  epoch 127, local model 45, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4442/5037 (88.1874%)
___Train Local_ResNet_18,  epoch 127, local model 45, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4581/5037 (90.9470%)
___Test Local_ResNet_18 poisoned: False, epoch: 127: Average loss: 1.9026, Accuracy: 5583/10000 (55.8300%)
___Train Local_ResNet_18,  epoch 127, local model 15, internal_epoch   1,  Average loss: 0.0050, Accuracy: 5058/5582 (90.6127%)
___Train Local_ResNet_18,  epoch 127, local model 15, internal_epoch   2,  Average loss: 0.0045, Accuracy: 5099/5582 (91.3472%)
___Test Local_ResNet_18 poisoned: False, epoch: 127: Average loss: 2.1668, Accuracy: 5247/10000 (52.4700%)
___Train Local_ResNet_18,  epoch 127, local model 67, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4523/5116 (88.4089%)
___Train Local_ResNet_18,  epoch 127, local model 67, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4596/5116 (89.8358%)
___Test Local_ResNet_18 poisoned: False, epoch: 127: Average loss: 2.0593, Accuracy: 5321/10000 (53.2100%)
___Train Local_ResNet_18,  epoch 127, local model 34, internal_epoch   1,  Average loss: 0.0053, Accuracy: 4038/4518 (89.3758%)
___Train Local_ResNet_18,  epoch 127, local model 34, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4166/4518 (92.2089%)
___Test Local_ResNet_18 poisoned: False, epoch: 127: Average loss: 1.9256, Accuracy: 5597/10000 (55.9700%)
___Train Local_ResNet_18,  epoch 127, local model 19, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4342/4928 (88.1088%)
___Train Local_ResNet_18,  epoch 127, local model 19, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4454/4928 (90.3815%)
___Test Local_ResNet_18 poisoned: False, epoch: 127: Average loss: 1.7971, Accuracy: 5720/10000 (57.2000%)
___Train Local_ResNet_18,  epoch 127, local model 57, internal_epoch   1,  Average loss: 0.0052, Accuracy: 4091/4558 (89.7543%)
___Train Local_ResNet_18,  epoch 127, local model 57, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4116/4558 (90.3028%)
___Test Local_ResNet_18 poisoned: False, epoch: 127: Average loss: 1.9022, Accuracy: 5631/10000 (56.3100%)
___Train Local_ResNet_18,  epoch 127, local model 68, internal_epoch   1,  Average loss: 0.0056, Accuracy: 2940/3297 (89.1720%)
___Train Local_ResNet_18,  epoch 127, local model 68, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3019/3297 (91.5681%)
___Test Local_ResNet_18 poisoned: False, epoch: 127: Average loss: 1.8450, Accuracy: 5722/10000 (57.2200%)
___Train Local_ResNet_18,  epoch 127, local model 26, internal_epoch   1,  Average loss: 0.0047, Accuracy: 3409/3756 (90.7614%)
___Train Local_ResNet_18,  epoch 127, local model 26, internal_epoch   2,  Average loss: 0.0036, Accuracy: 3496/3756 (93.0777%)
___Test Local_ResNet_18 poisoned: False, epoch: 127: Average loss: 1.9876, Accuracy: 5614/10000 (56.1400%)
___Train Local_ResNet_18,  epoch 127, local model 93, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4182/4651 (89.9161%)
___Train Local_ResNet_18,  epoch 127, local model 93, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4250/4651 (91.3782%)
___Test Local_ResNet_18 poisoned: False, epoch: 127: Average loss: 2.0422, Accuracy: 5524/10000 (55.2400%)
___Train Local_ResNet_18,  epoch 127, local model 48, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3957/4441 (89.1016%)
___Train Local_ResNet_18,  epoch 127, local model 48, internal_epoch   2,  Average loss: 0.0037, Accuracy: 4127/4441 (92.9295%)
___Test Local_ResNet_18 poisoned: False, epoch: 127: Average loss: 2.0863, Accuracy: 5444/10000 (54.4400%)
___Train Local_ResNet_18,  epoch 127, local model 76, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3182/3638 (87.4656%)
___Train Local_ResNet_18,  epoch 127, local model 76, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3330/3638 (91.5338%)
___Test Local_ResNet_18 poisoned: False, epoch: 127: Average loss: 1.8500, Accuracy: 5670/10000 (56.7000%)
___Train Local_ResNet_18,  epoch 127, local model 5, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4116/4596 (89.5561%)
___Train Local_ResNet_18,  epoch 127, local model 5, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4213/4596 (91.6667%)
___Test Local_ResNet_18 poisoned: False, epoch: 127: Average loss: 2.0241, Accuracy: 5502/10000 (55.0200%)
___Train Local_ResNet_18,  epoch 127, local model 83, internal_epoch   1,  Average loss: 0.0056, Accuracy: 2903/3271 (88.7496%)
___Train Local_ResNet_18,  epoch 127, local model 83, internal_epoch   2,  Average loss: 0.0051, Accuracy: 2953/3271 (90.2782%)
___Test Local_ResNet_18 poisoned: False, epoch: 127: Average loss: 1.8281, Accuracy: 5734/10000 (57.3400%)
time spent on training: 266.4666130542755
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 127: Average loss: 1.7817, Accuracy: 5999/10000 (59.9900%)
___Test Target_ResNet_18 poisoned: True, epoch: 127: Average loss: 9.2882, Accuracy: 124/9900 (1.2525%)
Done in 297.3630895614624 sec.
Server Epoch:128 choose agents : [13, 36, 58, 71, 56, 99, 20, 72, 85, 87, 24, 63, 25, 69, 94, 31, 86, 97, 42, 39].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 128, local model 13, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4412/4885 (90.3173%), train_poison_data_count: 385
Global model norm: 44.45646132031878.
Norm before scaling: 44.4501852608801. Distance: 2.1100493306906354
Total norm for 4 adversaries is: 44.4501852608801. distance: 2.1100493306906354
___Test Local_ResNet_18 poisoned: True, epoch: 128: Average loss: 0.2258, Accuracy: 9321/9900 (94.1515%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 128, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4767/5305 (89.8586%), train_poison_data_count: 415
Global model norm: 44.45646132031878.
Norm before scaling: 44.44922544407411. Distance: 2.220984180282458
Total norm for 4 adversaries is: 44.44922544407411. distance: 2.220984180282458
___Test Local_ResNet_18 poisoned: True, epoch: 128: Average loss: 0.0801, Accuracy: 9675/9900 (97.7273%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 128, local model 58, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4228/4717 (89.6332%), train_poison_data_count: 370
Global model norm: 44.45646132031878.
Norm before scaling: 44.4464639671109. Distance: 2.032022886688023
Total norm for 4 adversaries is: 44.4464639671109. distance: 2.032022886688023
___Test Local_ResNet_18 poisoned: True, epoch: 128: Average loss: 0.1734, Accuracy: 9416/9900 (95.1111%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 128, local model 71, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4558/5066 (89.9724%), train_poison_data_count: 400
Global model norm: 44.45646132031878.
Norm before scaling: 44.44803903242667. Distance: 2.1899504968630996
Total norm for 4 adversaries is: 44.44803903242667. distance: 2.1899504968630996
___Test Local_ResNet_18 poisoned: True, epoch: 128: Average loss: 0.3087, Accuracy: 9100/9900 (91.9192%)
___Train Local_ResNet_18,  epoch 128, local model 56, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4444/4989 (89.0760%)
___Train Local_ResNet_18,  epoch 128, local model 56, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4532/4989 (90.8398%)
___Test Local_ResNet_18 poisoned: False, epoch: 128: Average loss: 1.9302, Accuracy: 5576/10000 (55.7600%)
___Train Local_ResNet_18,  epoch 128, local model 99, internal_epoch   1,  Average loss: 0.0050, Accuracy: 4018/4465 (89.9888%)
___Train Local_ResNet_18,  epoch 128, local model 99, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4145/4465 (92.8331%)
___Test Local_ResNet_18 poisoned: False, epoch: 128: Average loss: 1.8270, Accuracy: 5808/10000 (58.0800%)
___Train Local_ResNet_18,  epoch 128, local model 20, internal_epoch   1,  Average loss: 0.0048, Accuracy: 3901/4315 (90.4056%)
___Train Local_ResNet_18,  epoch 128, local model 20, internal_epoch   2,  Average loss: 0.0036, Accuracy: 4018/4315 (93.1170%)
___Test Local_ResNet_18 poisoned: False, epoch: 128: Average loss: 1.7871, Accuracy: 5818/10000 (58.1800%)
___Train Local_ResNet_18,  epoch 128, local model 72, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4133/4767 (86.7002%)
___Train Local_ResNet_18,  epoch 128, local model 72, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4256/4767 (89.2805%)
___Test Local_ResNet_18 poisoned: False, epoch: 128: Average loss: 2.2685, Accuracy: 5129/10000 (51.2900%)
___Train Local_ResNet_18,  epoch 128, local model 85, internal_epoch   1,  Average loss: 0.0046, Accuracy: 5820/6391 (91.0656%)
___Train Local_ResNet_18,  epoch 128, local model 85, internal_epoch   2,  Average loss: 0.0045, Accuracy: 5837/6391 (91.3316%)
___Test Local_ResNet_18 poisoned: False, epoch: 128: Average loss: 1.9021, Accuracy: 5606/10000 (56.0600%)
___Train Local_ResNet_18,  epoch 128, local model 87, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3241/3672 (88.2625%)
___Train Local_ResNet_18,  epoch 128, local model 87, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3296/3672 (89.7603%)
___Test Local_ResNet_18 poisoned: False, epoch: 128: Average loss: 1.8309, Accuracy: 5698/10000 (56.9800%)
___Train Local_ResNet_18,  epoch 128, local model 24, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3567/3969 (89.8715%)
___Train Local_ResNet_18,  epoch 128, local model 24, internal_epoch   2,  Average loss: 0.0056, Accuracy: 3628/3969 (91.4084%)
___Test Local_ResNet_18 poisoned: False, epoch: 128: Average loss: 1.8183, Accuracy: 5804/10000 (58.0400%)
___Train Local_ResNet_18,  epoch 128, local model 63, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3204/3590 (89.2479%)
___Train Local_ResNet_18,  epoch 128, local model 63, internal_epoch   2,  Average loss: 0.0069, Accuracy: 3146/3590 (87.6323%)
___Test Local_ResNet_18 poisoned: False, epoch: 128: Average loss: 2.1798, Accuracy: 5289/10000 (52.8900%)
___Train Local_ResNet_18,  epoch 128, local model 25, internal_epoch   1,  Average loss: 0.0042, Accuracy: 5403/5902 (91.5452%)
___Train Local_ResNet_18,  epoch 128, local model 25, internal_epoch   2,  Average loss: 0.0051, Accuracy: 5321/5902 (90.1559%)
___Test Local_ResNet_18 poisoned: False, epoch: 128: Average loss: 2.1671, Accuracy: 5287/10000 (52.8700%)
___Train Local_ResNet_18,  epoch 128, local model 69, internal_epoch   1,  Average loss: 0.0049, Accuracy: 3641/4013 (90.7301%)
___Train Local_ResNet_18,  epoch 128, local model 69, internal_epoch   2,  Average loss: 0.0036, Accuracy: 3740/4013 (93.1971%)
___Test Local_ResNet_18 poisoned: False, epoch: 128: Average loss: 1.7250, Accuracy: 5932/10000 (59.3200%)
___Train Local_ResNet_18,  epoch 128, local model 94, internal_epoch   1,  Average loss: 0.0036, Accuracy: 4497/4804 (93.6095%)
___Train Local_ResNet_18,  epoch 128, local model 94, internal_epoch   2,  Average loss: 0.0081, Accuracy: 4097/4804 (85.2831%)
___Test Local_ResNet_18 poisoned: False, epoch: 128: Average loss: 2.2813, Accuracy: 4997/10000 (49.9700%)
___Train Local_ResNet_18,  epoch 128, local model 31, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3666/4175 (87.8084%)
___Train Local_ResNet_18,  epoch 128, local model 31, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3812/4175 (91.3054%)
___Test Local_ResNet_18 poisoned: False, epoch: 128: Average loss: 1.8590, Accuracy: 5680/10000 (56.8000%)
___Train Local_ResNet_18,  epoch 128, local model 86, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3188/3616 (88.1637%)
___Train Local_ResNet_18,  epoch 128, local model 86, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3315/3616 (91.6759%)
___Test Local_ResNet_18 poisoned: False, epoch: 128: Average loss: 1.9229, Accuracy: 5664/10000 (56.6400%)
___Train Local_ResNet_18,  epoch 128, local model 97, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3909/4361 (89.6354%)
___Train Local_ResNet_18,  epoch 128, local model 97, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4011/4361 (91.9743%)
___Test Local_ResNet_18 poisoned: False, epoch: 128: Average loss: 1.9649, Accuracy: 5596/10000 (55.9600%)
___Train Local_ResNet_18,  epoch 128, local model 42, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4860/5424 (89.6018%)
___Train Local_ResNet_18,  epoch 128, local model 42, internal_epoch   2,  Average loss: 0.0038, Accuracy: 5007/5424 (92.3119%)
___Test Local_ResNet_18 poisoned: False, epoch: 128: Average loss: 2.1798, Accuracy: 5302/10000 (53.0200%)
___Train Local_ResNet_18,  epoch 128, local model 39, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3422/3837 (89.1843%)
___Train Local_ResNet_18,  epoch 128, local model 39, internal_epoch   2,  Average loss: 0.0036, Accuracy: 3568/3837 (92.9893%)
___Test Local_ResNet_18 poisoned: False, epoch: 128: Average loss: 1.8818, Accuracy: 5736/10000 (57.3600%)
time spent on training: 267.1665213108063
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 128: Average loss: 2.0414, Accuracy: 5644/10000 (56.4400%)
___Test Target_ResNet_18 poisoned: True, epoch: 128: Average loss: 10.5757, Accuracy: 42/9900 (0.4242%)
Done in 297.7817134857178 sec.
Server Epoch:129 choose agents : [13, 36, 58, 71, 74, 38, 45, 67, 3, 39, 93, 14, 27, 44, 92, 79, 60, 98, 20, 46].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 129, local model 13, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4455/4885 (91.1975%), train_poison_data_count: 385
Global model norm: 44.49015236236624.
Norm before scaling: 44.48107782169501. Distance: 2.0862467675843974
Total norm for 4 adversaries is: 44.48107782169501. distance: 2.0862467675843974
___Test Local_ResNet_18 poisoned: True, epoch: 129: Average loss: 0.1721, Accuracy: 9468/9900 (95.6364%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 129, local model 36, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4759/5305 (89.7078%), train_poison_data_count: 415
Global model norm: 44.49015236236624.
Norm before scaling: 44.48580191775377. Distance: 2.2832466689135313
Total norm for 4 adversaries is: 44.48580191775377. distance: 2.2832466689135313
___Test Local_ResNet_18 poisoned: True, epoch: 129: Average loss: 0.2843, Accuracy: 9225/9900 (93.1818%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 129, local model 58, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4261/4717 (90.3328%), train_poison_data_count: 370
Global model norm: 44.49015236236624.
Norm before scaling: 44.48078692282138. Distance: 2.0193908760676966
Total norm for 4 adversaries is: 44.48078692282138. distance: 2.0193908760676966
___Test Local_ResNet_18 poisoned: True, epoch: 129: Average loss: 0.3712, Accuracy: 8967/9900 (90.5758%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 129, local model 71, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4501/5066 (88.8472%), train_poison_data_count: 400
Global model norm: 44.49015236236624.
Norm before scaling: 44.4858252419907. Distance: 2.2482197394305428
Total norm for 4 adversaries is: 44.4858252419907. distance: 2.2482197394305428
___Test Local_ResNet_18 poisoned: True, epoch: 129: Average loss: 0.1823, Accuracy: 9393/9900 (94.8788%)
___Train Local_ResNet_18,  epoch 129, local model 74, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3812/4416 (86.3225%)
___Train Local_ResNet_18,  epoch 129, local model 74, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4006/4416 (90.7156%)
___Test Local_ResNet_18 poisoned: False, epoch: 129: Average loss: 1.9354, Accuracy: 5602/10000 (56.0200%)
___Train Local_ResNet_18,  epoch 129, local model 38, internal_epoch   1,  Average loss: 0.0058, Accuracy: 5090/5740 (88.6760%)
___Train Local_ResNet_18,  epoch 129, local model 38, internal_epoch   2,  Average loss: 0.0045, Accuracy: 5221/5740 (90.9582%)
___Test Local_ResNet_18 poisoned: False, epoch: 129: Average loss: 2.1181, Accuracy: 5354/10000 (53.5400%)
___Train Local_ResNet_18,  epoch 129, local model 45, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4406/5037 (87.4727%)
___Train Local_ResNet_18,  epoch 129, local model 45, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4617/5037 (91.6617%)
___Test Local_ResNet_18 poisoned: False, epoch: 129: Average loss: 1.9214, Accuracy: 5605/10000 (56.0500%)
___Train Local_ResNet_18,  epoch 129, local model 67, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4536/5116 (88.6630%)
___Train Local_ResNet_18,  epoch 129, local model 67, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4626/5116 (90.4222%)
___Test Local_ResNet_18 poisoned: False, epoch: 129: Average loss: 1.9078, Accuracy: 5626/10000 (56.2600%)
___Train Local_ResNet_18,  epoch 129, local model 3, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4389/4918 (89.2436%)
___Train Local_ResNet_18,  epoch 129, local model 3, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4450/4918 (90.4839%)
___Test Local_ResNet_18 poisoned: False, epoch: 129: Average loss: 1.9116, Accuracy: 5512/10000 (55.1200%)
___Train Local_ResNet_18,  epoch 129, local model 39, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3401/3837 (88.6370%)
___Train Local_ResNet_18,  epoch 129, local model 39, internal_epoch   2,  Average loss: 0.0036, Accuracy: 3581/3837 (93.3281%)
___Test Local_ResNet_18 poisoned: False, epoch: 129: Average loss: 1.9342, Accuracy: 5612/10000 (56.1200%)
___Train Local_ResNet_18,  epoch 129, local model 93, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4151/4651 (89.2496%)
___Train Local_ResNet_18,  epoch 129, local model 93, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4293/4651 (92.3027%)
___Test Local_ResNet_18 poisoned: False, epoch: 129: Average loss: 1.9959, Accuracy: 5436/10000 (54.3600%)
___Train Local_ResNet_18,  epoch 129, local model 14, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3430/3861 (88.8371%)
___Train Local_ResNet_18,  epoch 129, local model 14, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3506/3861 (90.8055%)
___Test Local_ResNet_18 poisoned: False, epoch: 129: Average loss: 1.8939, Accuracy: 5675/10000 (56.7500%)
___Train Local_ResNet_18,  epoch 129, local model 27, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3719/4223 (88.0654%)
___Train Local_ResNet_18,  epoch 129, local model 27, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3922/4223 (92.8724%)
___Test Local_ResNet_18 poisoned: False, epoch: 129: Average loss: 1.8783, Accuracy: 5659/10000 (56.5900%)
___Train Local_ResNet_18,  epoch 129, local model 44, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4202/4662 (90.1330%)
___Train Local_ResNet_18,  epoch 129, local model 44, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4294/4662 (92.1064%)
___Test Local_ResNet_18 poisoned: False, epoch: 129: Average loss: 1.8533, Accuracy: 5703/10000 (57.0300%)
___Train Local_ResNet_18,  epoch 129, local model 92, internal_epoch   1,  Average loss: 0.0048, Accuracy: 5696/6263 (90.9468%)
___Train Local_ResNet_18,  epoch 129, local model 92, internal_epoch   2,  Average loss: 0.0041, Accuracy: 5761/6263 (91.9847%)
___Test Local_ResNet_18 poisoned: False, epoch: 129: Average loss: 2.0531, Accuracy: 5444/10000 (54.4400%)
___Train Local_ResNet_18,  epoch 129, local model 79, internal_epoch   1,  Average loss: 0.0051, Accuracy: 3456/3781 (91.4044%)
___Train Local_ResNet_18,  epoch 129, local model 79, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3405/3781 (90.0555%)
___Test Local_ResNet_18 poisoned: False, epoch: 129: Average loss: 1.9493, Accuracy: 5569/10000 (55.6900%)
___Train Local_ResNet_18,  epoch 129, local model 60, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3387/3804 (89.0379%)
___Train Local_ResNet_18,  epoch 129, local model 60, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3456/3804 (90.8517%)
___Test Local_ResNet_18 poisoned: False, epoch: 129: Average loss: 2.0440, Accuracy: 5423/10000 (54.2300%)
___Train Local_ResNet_18,  epoch 129, local model 98, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3427/3828 (89.5246%)
___Train Local_ResNet_18,  epoch 129, local model 98, internal_epoch   2,  Average loss: 0.0037, Accuracy: 3557/3828 (92.9206%)
___Test Local_ResNet_18 poisoned: False, epoch: 129: Average loss: 1.8002, Accuracy: 5797/10000 (57.9700%)
___Train Local_ResNet_18,  epoch 129, local model 20, internal_epoch   1,  Average loss: 0.0049, Accuracy: 3899/4315 (90.3592%)
___Train Local_ResNet_18,  epoch 129, local model 20, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3983/4315 (92.3059%)
___Test Local_ResNet_18 poisoned: False, epoch: 129: Average loss: 1.9606, Accuracy: 5553/10000 (55.5300%)
___Train Local_ResNet_18,  epoch 129, local model 46, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4344/4956 (87.6513%)
___Train Local_ResNet_18,  epoch 129, local model 46, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4474/4956 (90.2744%)
___Test Local_ResNet_18 poisoned: False, epoch: 129: Average loss: 2.0609, Accuracy: 5455/10000 (54.5500%)
time spent on training: 267.3237590789795
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 129: Average loss: 2.0495, Accuracy: 5620/10000 (56.2000%)
___Test Target_ResNet_18 poisoned: True, epoch: 129: Average loss: 10.7422, Accuracy: 27/9900 (0.2727%)
Done in 297.5871057510376 sec.
Server Epoch:130 choose agents : [13, 36, 58, 71, 44, 86, 98, 68, 97, 43, 75, 12, 67, 59, 25, 49, 99, 4, 14, 61].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 130, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4446/4885 (91.0133%), train_poison_data_count: 385
Global model norm: 44.52332440435715.
Norm before scaling: 44.51338594535707. Distance: 2.091808158779965
Total norm for 4 adversaries is: 44.51338594535707. distance: 2.091808158779965
___Test Local_ResNet_18 poisoned: True, epoch: 130: Average loss: 0.1327, Accuracy: 9572/9900 (96.6869%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 130, local model 36, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4785/5305 (90.1979%), train_poison_data_count: 415
Global model norm: 44.52332440435715.
Norm before scaling: 44.51588824948487. Distance: 2.2123581059532498
Total norm for 4 adversaries is: 44.51588824948487. distance: 2.2123581059532498
___Test Local_ResNet_18 poisoned: True, epoch: 130: Average loss: 0.0690, Accuracy: 9725/9900 (98.2323%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 130, local model 58, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4258/4717 (90.2692%), train_poison_data_count: 370
Global model norm: 44.52332440435715.
Norm before scaling: 44.51439648181951. Distance: 2.0364296237128365
Total norm for 4 adversaries is: 44.51439648181951. distance: 2.0364296237128365
___Test Local_ResNet_18 poisoned: True, epoch: 130: Average loss: 0.1346, Accuracy: 9573/9900 (96.6970%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 130, local model 71, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4552/5066 (89.8539%), train_poison_data_count: 400
Global model norm: 44.52332440435715.
Norm before scaling: 44.51739779069176. Distance: 2.186689281094697
Total norm for 4 adversaries is: 44.51739779069176. distance: 2.186689281094697
___Test Local_ResNet_18 poisoned: True, epoch: 130: Average loss: 0.2286, Accuracy: 9348/9900 (94.4242%)
___Train Local_ResNet_18,  epoch 130, local model 44, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4150/4662 (89.0176%)
___Train Local_ResNet_18,  epoch 130, local model 44, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4326/4662 (92.7928%)
___Test Local_ResNet_18 poisoned: False, epoch: 130: Average loss: 1.8693, Accuracy: 5651/10000 (56.5100%)
___Train Local_ResNet_18,  epoch 130, local model 86, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3198/3616 (88.4403%)
___Train Local_ResNet_18,  epoch 130, local model 86, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3299/3616 (91.2334%)
___Test Local_ResNet_18 poisoned: False, epoch: 130: Average loss: 1.9125, Accuracy: 5688/10000 (56.8800%)
___Train Local_ResNet_18,  epoch 130, local model 98, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3409/3828 (89.0543%)
___Train Local_ResNet_18,  epoch 130, local model 98, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3553/3828 (92.8161%)
___Test Local_ResNet_18 poisoned: False, epoch: 130: Average loss: 1.8437, Accuracy: 5762/10000 (57.6200%)
___Train Local_ResNet_18,  epoch 130, local model 68, internal_epoch   1,  Average loss: 0.0056, Accuracy: 2944/3297 (89.2933%)
___Train Local_ResNet_18,  epoch 130, local model 68, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3028/3297 (91.8411%)
___Test Local_ResNet_18 poisoned: False, epoch: 130: Average loss: 1.7403, Accuracy: 5998/10000 (59.9800%)
___Train Local_ResNet_18,  epoch 130, local model 97, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3911/4361 (89.6813%)
___Train Local_ResNet_18,  epoch 130, local model 97, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3871/4361 (88.7640%)
___Test Local_ResNet_18 poisoned: False, epoch: 130: Average loss: 2.0172, Accuracy: 5534/10000 (55.3400%)
___Train Local_ResNet_18,  epoch 130, local model 43, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4082/4576 (89.2045%)
___Train Local_ResNet_18,  epoch 130, local model 43, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4220/4576 (92.2203%)
___Test Local_ResNet_18 poisoned: False, epoch: 130: Average loss: 1.9641, Accuracy: 5579/10000 (55.7900%)
___Train Local_ResNet_18,  epoch 130, local model 75, internal_epoch   1,  Average loss: 0.0051, Accuracy: 3861/4295 (89.8952%)
___Train Local_ResNet_18,  epoch 130, local model 75, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3912/4295 (91.0827%)
___Test Local_ResNet_18 poisoned: False, epoch: 130: Average loss: 1.9582, Accuracy: 5579/10000 (55.7900%)
___Train Local_ResNet_18,  epoch 130, local model 12, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4508/5083 (88.6878%)
___Train Local_ResNet_18,  epoch 130, local model 12, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4556/5083 (89.6321%)
___Test Local_ResNet_18 poisoned: False, epoch: 130: Average loss: 2.0381, Accuracy: 5389/10000 (53.8900%)
___Train Local_ResNet_18,  epoch 130, local model 67, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4533/5116 (88.6044%)
___Train Local_ResNet_18,  epoch 130, local model 67, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4630/5116 (90.5004%)
___Test Local_ResNet_18 poisoned: False, epoch: 130: Average loss: 1.8981, Accuracy: 5592/10000 (55.9200%)
___Train Local_ResNet_18,  epoch 130, local model 59, internal_epoch   1,  Average loss: 0.0050, Accuracy: 3657/4046 (90.3856%)
___Train Local_ResNet_18,  epoch 130, local model 59, internal_epoch   2,  Average loss: 0.0038, Accuracy: 3739/4046 (92.4123%)
___Test Local_ResNet_18 poisoned: False, epoch: 130: Average loss: 1.9024, Accuracy: 5691/10000 (56.9100%)
___Train Local_ResNet_18,  epoch 130, local model 25, internal_epoch   1,  Average loss: 0.0046, Accuracy: 5376/5902 (91.0878%)
___Train Local_ResNet_18,  epoch 130, local model 25, internal_epoch   2,  Average loss: 0.0057, Accuracy: 5232/5902 (88.6479%)
___Test Local_ResNet_18 poisoned: False, epoch: 130: Average loss: 2.0569, Accuracy: 5458/10000 (54.5800%)
___Train Local_ResNet_18,  epoch 130, local model 49, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4697/5197 (90.3791%)
___Train Local_ResNet_18,  epoch 130, local model 49, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4733/5197 (91.0718%)
___Test Local_ResNet_18 poisoned: False, epoch: 130: Average loss: 2.0467, Accuracy: 5500/10000 (55.0000%)
___Train Local_ResNet_18,  epoch 130, local model 99, internal_epoch   1,  Average loss: 0.0048, Accuracy: 4043/4465 (90.5487%)
___Train Local_ResNet_18,  epoch 130, local model 99, internal_epoch   2,  Average loss: 0.0037, Accuracy: 4149/4465 (92.9227%)
___Test Local_ResNet_18 poisoned: False, epoch: 130: Average loss: 1.8108, Accuracy: 5768/10000 (57.6800%)
___Train Local_ResNet_18,  epoch 130, local model 4, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3252/3704 (87.7970%)
___Train Local_ResNet_18,  epoch 130, local model 4, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3402/3704 (91.8467%)
___Test Local_ResNet_18 poisoned: False, epoch: 130: Average loss: 1.8024, Accuracy: 5806/10000 (58.0600%)
___Train Local_ResNet_18,  epoch 130, local model 14, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3438/3861 (89.0443%)
___Train Local_ResNet_18,  epoch 130, local model 14, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3554/3861 (92.0487%)
___Test Local_ResNet_18 poisoned: False, epoch: 130: Average loss: 1.8863, Accuracy: 5676/10000 (56.7600%)
___Train Local_ResNet_18,  epoch 130, local model 61, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3681/4126 (89.2147%)
___Train Local_ResNet_18,  epoch 130, local model 61, internal_epoch   2,  Average loss: 0.0038, Accuracy: 3837/4126 (92.9956%)
___Test Local_ResNet_18 poisoned: False, epoch: 130: Average loss: 1.7427, Accuracy: 5915/10000 (59.1500%)
time spent on training: 263.5712924003601
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 130: Average loss: 1.9794, Accuracy: 5743/10000 (57.4300%)
___Test Target_ResNet_18 poisoned: True, epoch: 130: Average loss: 10.2586, Accuracy: 49/9900 (0.4949%)
Done in 294.37049865722656 sec.
Server Epoch:131 choose agents : [13, 36, 58, 71, 17, 38, 44, 73, 9, 33, 5, 65, 45, 6, 26, 78, 11, 10, 39, 7].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 131, local model 13, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4416/4885 (90.3992%), train_poison_data_count: 385
Global model norm: 44.56206170892455.
Norm before scaling: 44.55077148865522. Distance: 2.080841583410776
Total norm for 4 adversaries is: 44.55077148865522. distance: 2.080841583410776
___Test Local_ResNet_18 poisoned: True, epoch: 131: Average loss: 0.1959, Accuracy: 9392/9900 (94.8687%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 131, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4760/5305 (89.7267%), train_poison_data_count: 415
Global model norm: 44.56206170892455.
Norm before scaling: 44.55136333053541. Distance: 2.204655217313533
Total norm for 4 adversaries is: 44.55136333053541. distance: 2.204655217313533
___Test Local_ResNet_18 poisoned: True, epoch: 131: Average loss: 0.2265, Accuracy: 9344/9900 (94.3838%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 131, local model 58, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4250/4717 (90.0996%), train_poison_data_count: 370
Global model norm: 44.56206170892455.
Norm before scaling: 44.55432927153025. Distance: 2.0343756469163
Total norm for 4 adversaries is: 44.55432927153025. distance: 2.0343756469163
___Test Local_ResNet_18 poisoned: True, epoch: 131: Average loss: 0.3006, Accuracy: 9149/9900 (92.4141%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 131, local model 71, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4524/5066 (89.3012%), train_poison_data_count: 400
Global model norm: 44.56206170892455.
Norm before scaling: 44.55742377732217. Distance: 2.223448278705262
Total norm for 4 adversaries is: 44.55742377732217. distance: 2.223448278705262
___Test Local_ResNet_18 poisoned: True, epoch: 131: Average loss: 0.2949, Accuracy: 9205/9900 (92.9798%)
___Train Local_ResNet_18,  epoch 131, local model 17, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3994/4511 (88.5391%)
___Train Local_ResNet_18,  epoch 131, local model 17, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4109/4511 (91.0885%)
___Test Local_ResNet_18 poisoned: False, epoch: 131: Average loss: 1.9961, Accuracy: 5487/10000 (54.8700%)
___Train Local_ResNet_18,  epoch 131, local model 38, internal_epoch   1,  Average loss: 0.0048, Accuracy: 5184/5740 (90.3136%)
___Train Local_ResNet_18,  epoch 131, local model 38, internal_epoch   2,  Average loss: 0.0040, Accuracy: 5281/5740 (92.0035%)
___Test Local_ResNet_18 poisoned: False, epoch: 131: Average loss: 2.1207, Accuracy: 5501/10000 (55.0100%)
___Train Local_ResNet_18,  epoch 131, local model 44, internal_epoch   1,  Average loss: 0.0053, Accuracy: 4197/4662 (90.0257%)
___Train Local_ResNet_18,  epoch 131, local model 44, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4281/4662 (91.8275%)
___Test Local_ResNet_18 poisoned: False, epoch: 131: Average loss: 1.9371, Accuracy: 5606/10000 (56.0600%)
___Train Local_ResNet_18,  epoch 131, local model 73, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3786/4235 (89.3979%)
___Train Local_ResNet_18,  epoch 131, local model 73, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3887/4235 (91.7828%)
___Test Local_ResNet_18 poisoned: False, epoch: 131: Average loss: 1.8695, Accuracy: 5761/10000 (57.6100%)
___Train Local_ResNet_18,  epoch 131, local model 9, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4727/5265 (89.7816%)
___Train Local_ResNet_18,  epoch 131, local model 9, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4812/5265 (91.3960%)
___Test Local_ResNet_18 poisoned: False, epoch: 131: Average loss: 1.9419, Accuracy: 5564/10000 (55.6400%)
___Train Local_ResNet_18,  epoch 131, local model 33, internal_epoch   1,  Average loss: 0.0050, Accuracy: 4024/4433 (90.7737%)
___Train Local_ResNet_18,  epoch 131, local model 33, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4062/4433 (91.6309%)
___Test Local_ResNet_18 poisoned: False, epoch: 131: Average loss: 1.8100, Accuracy: 5783/10000 (57.8300%)
___Train Local_ResNet_18,  epoch 131, local model 5, internal_epoch   1,  Average loss: 0.0050, Accuracy: 4138/4596 (90.0348%)
___Train Local_ResNet_18,  epoch 131, local model 5, internal_epoch   2,  Average loss: 0.0036, Accuracy: 4286/4596 (93.2550%)
___Test Local_ResNet_18 poisoned: False, epoch: 131: Average loss: 1.9567, Accuracy: 5628/10000 (56.2800%)
___Train Local_ResNet_18,  epoch 131, local model 65, internal_epoch   1,  Average loss: 0.0048, Accuracy: 4579/5055 (90.5836%)
___Train Local_ResNet_18,  epoch 131, local model 65, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4661/5055 (92.2057%)
___Test Local_ResNet_18 poisoned: False, epoch: 131: Average loss: 1.8454, Accuracy: 5698/10000 (56.9800%)
___Train Local_ResNet_18,  epoch 131, local model 45, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4437/5037 (88.0881%)
___Train Local_ResNet_18,  epoch 131, local model 45, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4558/5037 (90.4904%)
___Test Local_ResNet_18 poisoned: False, epoch: 131: Average loss: 2.0732, Accuracy: 5295/10000 (52.9500%)
___Train Local_ResNet_18,  epoch 131, local model 6, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4099/4538 (90.3261%)
___Train Local_ResNet_18,  epoch 131, local model 6, internal_epoch   2,  Average loss: 0.0035, Accuracy: 4236/4538 (93.3451%)
___Test Local_ResNet_18 poisoned: False, epoch: 131: Average loss: 1.7495, Accuracy: 5856/10000 (58.5600%)
___Train Local_ResNet_18,  epoch 131, local model 26, internal_epoch   1,  Average loss: 0.0047, Accuracy: 3409/3756 (90.7614%)
___Train Local_ResNet_18,  epoch 131, local model 26, internal_epoch   2,  Average loss: 0.0036, Accuracy: 3504/3756 (93.2907%)
___Test Local_ResNet_18 poisoned: False, epoch: 131: Average loss: 1.9404, Accuracy: 5644/10000 (56.4400%)
___Train Local_ResNet_18,  epoch 131, local model 78, internal_epoch   1,  Average loss: 0.0047, Accuracy: 3665/4025 (91.0559%)
___Train Local_ResNet_18,  epoch 131, local model 78, internal_epoch   2,  Average loss: 0.0036, Accuracy: 3742/4025 (92.9689%)
___Test Local_ResNet_18 poisoned: False, epoch: 131: Average loss: 1.8677, Accuracy: 5765/10000 (57.6500%)
___Train Local_ResNet_18,  epoch 131, local model 11, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4616/5244 (88.0244%)
___Train Local_ResNet_18,  epoch 131, local model 11, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4664/5244 (88.9397%)
___Test Local_ResNet_18 poisoned: False, epoch: 131: Average loss: 2.0084, Accuracy: 5373/10000 (53.7300%)
___Train Local_ResNet_18,  epoch 131, local model 10, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4212/4663 (90.3281%)
___Train Local_ResNet_18,  epoch 131, local model 10, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4301/4663 (92.2368%)
___Test Local_ResNet_18 poisoned: False, epoch: 131: Average loss: 1.9189, Accuracy: 5612/10000 (56.1200%)
___Train Local_ResNet_18,  epoch 131, local model 39, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3418/3837 (89.0800%)
___Train Local_ResNet_18,  epoch 131, local model 39, internal_epoch   2,  Average loss: 0.0037, Accuracy: 3566/3837 (92.9372%)
___Test Local_ResNet_18 poisoned: False, epoch: 131: Average loss: 1.8502, Accuracy: 5734/10000 (57.3400%)
___Train Local_ResNet_18,  epoch 131, local model 7, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4014/4481 (89.5782%)
___Train Local_ResNet_18,  epoch 131, local model 7, internal_epoch   2,  Average loss: 0.0063, Accuracy: 4022/4481 (89.7568%)
___Test Local_ResNet_18 poisoned: False, epoch: 131: Average loss: 2.0026, Accuracy: 5567/10000 (55.6700%)
time spent on training: 269.6053822040558
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 131: Average loss: 1.8501, Accuracy: 5886/10000 (58.8600%)
___Test Target_ResNet_18 poisoned: True, epoch: 131: Average loss: 9.9763, Accuracy: 62/9900 (0.6263%)
Done in 300.48156452178955 sec.
Server Epoch:132 choose agents : [13, 36, 58, 71, 90, 32, 20, 79, 91, 17, 84, 42, 81, 50, 88, 22, 25, 70, 0, 54].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 132, local model 13, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4390/4885 (89.8669%), train_poison_data_count: 385
Global model norm: 44.59164763789851.
Norm before scaling: 44.58761235793244. Distance: 2.185436147112674
Total norm for 4 adversaries is: 44.58761235793244. distance: 2.185436147112674
___Test Local_ResNet_18 poisoned: True, epoch: 132: Average loss: 0.2243, Accuracy: 9378/9900 (94.7273%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 132, local model 36, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4798/5305 (90.4430%), train_poison_data_count: 415
Global model norm: 44.59164763789851.
Norm before scaling: 44.57948730612054. Distance: 2.1652936497529947
Total norm for 4 adversaries is: 44.57948730612054. distance: 2.1652936497529947
___Test Local_ResNet_18 poisoned: True, epoch: 132: Average loss: 0.2353, Accuracy: 9283/9900 (93.7677%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 132, local model 58, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4234/4717 (89.7604%), train_poison_data_count: 370
Global model norm: 44.59164763789851.
Norm before scaling: 44.58381902602459. Distance: 2.0808066368401974
Total norm for 4 adversaries is: 44.58381902602459. distance: 2.0808066368401974
___Test Local_ResNet_18 poisoned: True, epoch: 132: Average loss: 0.1201, Accuracy: 9587/9900 (96.8384%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 132, local model 71, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4524/5066 (89.3012%), train_poison_data_count: 400
Global model norm: 44.59164763789851.
Norm before scaling: 44.58532489832347. Distance: 2.25750054444975
Total norm for 4 adversaries is: 44.58532489832347. distance: 2.25750054444975
___Test Local_ResNet_18 poisoned: True, epoch: 132: Average loss: 0.1650, Accuracy: 9460/9900 (95.5556%)
___Train Local_ResNet_18,  epoch 132, local model 90, internal_epoch   1,  Average loss: 0.0047, Accuracy: 3986/4362 (91.3801%)
___Train Local_ResNet_18,  epoch 132, local model 90, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3950/4362 (90.5548%)
___Test Local_ResNet_18 poisoned: False, epoch: 132: Average loss: 2.0365, Accuracy: 5368/10000 (53.6800%)
___Train Local_ResNet_18,  epoch 132, local model 32, internal_epoch   1,  Average loss: 0.0052, Accuracy: 4999/5591 (89.4116%)
___Train Local_ResNet_18,  epoch 132, local model 32, internal_epoch   2,  Average loss: 0.0051, Accuracy: 5041/5591 (90.1628%)
___Test Local_ResNet_18 poisoned: False, epoch: 132: Average loss: 2.1100, Accuracy: 5269/10000 (52.6900%)
___Train Local_ResNet_18,  epoch 132, local model 20, internal_epoch   1,  Average loss: 0.0046, Accuracy: 3933/4315 (91.1472%)
___Train Local_ResNet_18,  epoch 132, local model 20, internal_epoch   2,  Average loss: 0.0035, Accuracy: 4041/4315 (93.6501%)
___Test Local_ResNet_18 poisoned: False, epoch: 132: Average loss: 1.8580, Accuracy: 5759/10000 (57.5900%)
___Train Local_ResNet_18,  epoch 132, local model 79, internal_epoch   1,  Average loss: 0.0048, Accuracy: 3440/3781 (90.9812%)
___Train Local_ResNet_18,  epoch 132, local model 79, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3475/3781 (91.9069%)
___Test Local_ResNet_18 poisoned: False, epoch: 132: Average loss: 1.8983, Accuracy: 5655/10000 (56.5500%)
___Train Local_ResNet_18,  epoch 132, local model 91, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3623/4158 (87.1332%)
___Train Local_ResNet_18,  epoch 132, local model 91, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3745/4158 (90.0673%)
___Test Local_ResNet_18 poisoned: False, epoch: 132: Average loss: 1.9444, Accuracy: 5541/10000 (55.4100%)
___Train Local_ResNet_18,  epoch 132, local model 17, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4005/4511 (88.7830%)
___Train Local_ResNet_18,  epoch 132, local model 17, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4053/4511 (89.8470%)
___Test Local_ResNet_18 poisoned: False, epoch: 132: Average loss: 1.8998, Accuracy: 5625/10000 (56.2500%)
___Train Local_ResNet_18,  epoch 132, local model 84, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4224/4793 (88.1285%)
___Train Local_ResNet_18,  epoch 132, local model 84, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4353/4793 (90.8199%)
___Test Local_ResNet_18 poisoned: False, epoch: 132: Average loss: 1.8814, Accuracy: 5614/10000 (56.1400%)
___Train Local_ResNet_18,  epoch 132, local model 42, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4895/5424 (90.2471%)
___Train Local_ResNet_18,  epoch 132, local model 42, internal_epoch   2,  Average loss: 0.0038, Accuracy: 5011/5424 (92.3857%)
___Test Local_ResNet_18 poisoned: False, epoch: 132: Average loss: 2.2214, Accuracy: 5316/10000 (53.1600%)
___Train Local_ResNet_18,  epoch 132, local model 81, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4158/4618 (90.0390%)
___Train Local_ResNet_18,  epoch 132, local model 81, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4226/4618 (91.5115%)
___Test Local_ResNet_18 poisoned: False, epoch: 132: Average loss: 1.9220, Accuracy: 5587/10000 (55.8700%)
___Train Local_ResNet_18,  epoch 132, local model 50, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3883/4368 (88.8965%)
___Train Local_ResNet_18,  epoch 132, local model 50, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3940/4368 (90.2015%)
___Test Local_ResNet_18 poisoned: False, epoch: 132: Average loss: 2.1900, Accuracy: 5306/10000 (53.0600%)
___Train Local_ResNet_18,  epoch 132, local model 88, internal_epoch   1,  Average loss: 0.0047, Accuracy: 4524/4934 (91.6903%)
___Train Local_ResNet_18,  epoch 132, local model 88, internal_epoch   2,  Average loss: 0.0092, Accuracy: 4101/4934 (83.1171%)
___Test Local_ResNet_18 poisoned: False, epoch: 132: Average loss: 2.3469, Accuracy: 4970/10000 (49.7000%)
___Train Local_ResNet_18,  epoch 132, local model 22, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4622/5232 (88.3410%)
___Train Local_ResNet_18,  epoch 132, local model 22, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4674/5232 (89.3349%)
___Test Local_ResNet_18 poisoned: False, epoch: 132: Average loss: 2.0594, Accuracy: 5445/10000 (54.4500%)
___Train Local_ResNet_18,  epoch 132, local model 25, internal_epoch   1,  Average loss: 0.0036, Accuracy: 5504/5902 (93.2565%)
___Train Local_ResNet_18,  epoch 132, local model 25, internal_epoch   2,  Average loss: 0.0036, Accuracy: 5518/5902 (93.4937%)
___Test Local_ResNet_18 poisoned: False, epoch: 132: Average loss: 1.9971, Accuracy: 5646/10000 (56.4600%)
___Train Local_ResNet_18,  epoch 132, local model 70, internal_epoch   1,  Average loss: 0.0050, Accuracy: 4873/5392 (90.3746%)
___Train Local_ResNet_18,  epoch 132, local model 70, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4955/5392 (91.8954%)
___Test Local_ResNet_18 poisoned: False, epoch: 132: Average loss: 2.0389, Accuracy: 5483/10000 (54.8300%)
___Train Local_ResNet_18,  epoch 132, local model 0, internal_epoch   1,  Average loss: 0.0053, Accuracy: 4499/5017 (89.6751%)
___Train Local_ResNet_18,  epoch 132, local model 0, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4533/5017 (90.3528%)
___Test Local_ResNet_18 poisoned: False, epoch: 132: Average loss: 1.8392, Accuracy: 5741/10000 (57.4100%)
___Train Local_ResNet_18,  epoch 132, local model 54, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4565/5195 (87.8730%)
___Train Local_ResNet_18,  epoch 132, local model 54, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4648/5195 (89.4706%)
___Test Local_ResNet_18 poisoned: False, epoch: 132: Average loss: 1.9898, Accuracy: 5517/10000 (55.1700%)
time spent on training: 273.06041407585144
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 132: Average loss: 1.9364, Accuracy: 5823/10000 (58.2300%)
___Test Target_ResNet_18 poisoned: True, epoch: 132: Average loss: 9.7407, Accuracy: 78/9900 (0.7879%)
Done in 304.3329689502716 sec.
Server Epoch:133 choose agents : [13, 36, 58, 71, 9, 61, 8, 53, 83, 10, 78, 93, 94, 86, 18, 49, 6, 85, 4, 73].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 133, local model 13, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4433/4885 (90.7472%), train_poison_data_count: 385
Global model norm: 44.63166994314757.
Norm before scaling: 44.62196899720473. Distance: 2.097834233240036
Total norm for 4 adversaries is: 44.62196899720473. distance: 2.097834233240036
___Test Local_ResNet_18 poisoned: True, epoch: 133: Average loss: 0.3362, Accuracy: 9099/9900 (91.9091%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 133, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4755/5305 (89.6324%), train_poison_data_count: 415
Global model norm: 44.63166994314757.
Norm before scaling: 44.62319865718321. Distance: 2.2263709270313035
Total norm for 4 adversaries is: 44.62319865718321. distance: 2.2263709270313035
___Test Local_ResNet_18 poisoned: True, epoch: 133: Average loss: 0.2874, Accuracy: 9200/9900 (92.9293%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 133, local model 58, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4261/4717 (90.3328%), train_poison_data_count: 370
Global model norm: 44.63166994314757.
Norm before scaling: 44.61753291211945. Distance: 2.0291850230844295
Total norm for 4 adversaries is: 44.61753291211945. distance: 2.0291850230844295
___Test Local_ResNet_18 poisoned: True, epoch: 133: Average loss: 0.3064, Accuracy: 9160/9900 (92.5253%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 133, local model 71, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4551/5066 (89.8342%), train_poison_data_count: 400
Global model norm: 44.63166994314757.
Norm before scaling: 44.625240720639255. Distance: 2.2042105955807423
Total norm for 4 adversaries is: 44.625240720639255. distance: 2.2042105955807423
___Test Local_ResNet_18 poisoned: True, epoch: 133: Average loss: 0.2884, Accuracy: 9164/9900 (92.5657%)
___Train Local_ResNet_18,  epoch 133, local model 9, internal_epoch   1,  Average loss: 0.0052, Accuracy: 4738/5265 (89.9905%)
___Train Local_ResNet_18,  epoch 133, local model 9, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4775/5265 (90.6933%)
___Test Local_ResNet_18 poisoned: False, epoch: 133: Average loss: 1.8665, Accuracy: 5729/10000 (57.2900%)
___Train Local_ResNet_18,  epoch 133, local model 61, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3693/4126 (89.5056%)
___Train Local_ResNet_18,  epoch 133, local model 61, internal_epoch   2,  Average loss: 0.0037, Accuracy: 3832/4126 (92.8745%)
___Test Local_ResNet_18 poisoned: False, epoch: 133: Average loss: 1.7694, Accuracy: 5891/10000 (58.9100%)
___Train Local_ResNet_18,  epoch 133, local model 8, internal_epoch   1,  Average loss: 0.0052, Accuracy: 4057/4501 (90.1355%)
___Train Local_ResNet_18,  epoch 133, local model 8, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4082/4501 (90.6910%)
___Test Local_ResNet_18 poisoned: False, epoch: 133: Average loss: 1.9306, Accuracy: 5626/10000 (56.2600%)
___Train Local_ResNet_18,  epoch 133, local model 53, internal_epoch   1,  Average loss: 0.0049, Accuracy: 5536/6124 (90.3984%)
___Train Local_ResNet_18,  epoch 133, local model 53, internal_epoch   2,  Average loss: 0.0050, Accuracy: 5508/6124 (89.9412%)
___Test Local_ResNet_18 poisoned: False, epoch: 133: Average loss: 1.9969, Accuracy: 5531/10000 (55.3100%)
___Train Local_ResNet_18,  epoch 133, local model 83, internal_epoch   1,  Average loss: 0.0056, Accuracy: 2908/3271 (88.9025%)
___Train Local_ResNet_18,  epoch 133, local model 83, internal_epoch   2,  Average loss: 0.0054, Accuracy: 2930/3271 (89.5751%)
___Test Local_ResNet_18 poisoned: False, epoch: 133: Average loss: 1.9020, Accuracy: 5592/10000 (55.9200%)
___Train Local_ResNet_18,  epoch 133, local model 10, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4169/4663 (89.4060%)
___Train Local_ResNet_18,  epoch 133, local model 10, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4324/4663 (92.7300%)
___Test Local_ResNet_18 poisoned: False, epoch: 133: Average loss: 1.9168, Accuracy: 5632/10000 (56.3200%)
___Train Local_ResNet_18,  epoch 133, local model 78, internal_epoch   1,  Average loss: 0.0050, Accuracy: 3630/4025 (90.1863%)
___Train Local_ResNet_18,  epoch 133, local model 78, internal_epoch   2,  Average loss: 0.0033, Accuracy: 3757/4025 (93.3416%)
___Test Local_ResNet_18 poisoned: False, epoch: 133: Average loss: 1.7932, Accuracy: 5776/10000 (57.7600%)
___Train Local_ResNet_18,  epoch 133, local model 93, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4138/4651 (88.9701%)
___Train Local_ResNet_18,  epoch 133, local model 93, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4266/4651 (91.7222%)
___Test Local_ResNet_18 poisoned: False, epoch: 133: Average loss: 1.9411, Accuracy: 5586/10000 (55.8600%)
___Train Local_ResNet_18,  epoch 133, local model 94, internal_epoch   1,  Average loss: 0.0030, Accuracy: 4555/4804 (94.8168%)
___Train Local_ResNet_18,  epoch 133, local model 94, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4442/4804 (92.4646%)
___Test Local_ResNet_18 poisoned: False, epoch: 133: Average loss: 1.9320, Accuracy: 5687/10000 (56.8700%)
___Train Local_ResNet_18,  epoch 133, local model 86, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3225/3616 (89.1869%)
___Train Local_ResNet_18,  epoch 133, local model 86, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3336/3616 (92.2566%)
___Test Local_ResNet_18 poisoned: False, epoch: 133: Average loss: 1.7407, Accuracy: 5964/10000 (59.6400%)
___Train Local_ResNet_18,  epoch 133, local model 18, internal_epoch   1,  Average loss: 0.0044, Accuracy: 3589/3911 (91.7668%)
___Train Local_ResNet_18,  epoch 133, local model 18, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3537/3911 (90.4372%)
___Test Local_ResNet_18 poisoned: False, epoch: 133: Average loss: 2.1470, Accuracy: 5473/10000 (54.7300%)
___Train Local_ResNet_18,  epoch 133, local model 49, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4651/5197 (89.4939%)
___Train Local_ResNet_18,  epoch 133, local model 49, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4718/5197 (90.7831%)
___Test Local_ResNet_18 poisoned: False, epoch: 133: Average loss: 2.1933, Accuracy: 5295/10000 (52.9500%)
___Train Local_ResNet_18,  epoch 133, local model 6, internal_epoch   1,  Average loss: 0.0049, Accuracy: 4099/4538 (90.3261%)
___Train Local_ResNet_18,  epoch 133, local model 6, internal_epoch   2,  Average loss: 0.0033, Accuracy: 4257/4538 (93.8078%)
___Test Local_ResNet_18 poisoned: False, epoch: 133: Average loss: 1.7346, Accuracy: 5972/10000 (59.7200%)
___Train Local_ResNet_18,  epoch 133, local model 85, internal_epoch   1,  Average loss: 0.0049, Accuracy: 5768/6391 (90.2519%)
___Train Local_ResNet_18,  epoch 133, local model 85, internal_epoch   2,  Average loss: 0.0044, Accuracy: 5834/6391 (91.2846%)
___Test Local_ResNet_18 poisoned: False, epoch: 133: Average loss: 1.9853, Accuracy: 5472/10000 (54.7200%)
___Train Local_ResNet_18,  epoch 133, local model 4, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3285/3704 (88.6879%)
___Train Local_ResNet_18,  epoch 133, local model 4, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3415/3704 (92.1976%)
___Test Local_ResNet_18 poisoned: False, epoch: 133: Average loss: 1.8035, Accuracy: 5873/10000 (58.7300%)
___Train Local_ResNet_18,  epoch 133, local model 73, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3775/4235 (89.1381%)
___Train Local_ResNet_18,  epoch 133, local model 73, internal_epoch   2,  Average loss: 0.0063, Accuracy: 3739/4235 (88.2881%)
___Test Local_ResNet_18 poisoned: False, epoch: 133: Average loss: 2.2131, Accuracy: 5160/10000 (51.6000%)
time spent on training: 267.46734857559204
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 133: Average loss: 1.9617, Accuracy: 5741/10000 (57.4100%)
___Test Target_ResNet_18 poisoned: True, epoch: 133: Average loss: 10.0631, Accuracy: 44/9900 (0.4444%)
Done in 298.6767568588257 sec.
Server Epoch:134 choose agents : [13, 36, 58, 71, 67, 15, 73, 95, 7, 22, 44, 48, 34, 16, 21, 88, 14, 86, 74, 52].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 134, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4399/4885 (90.0512%), train_poison_data_count: 385
Global model norm: 44.657080992967956.
Norm before scaling: 44.65227386733443. Distance: 2.1995618427216987
Total norm for 4 adversaries is: 44.65227386733443. distance: 2.1995618427216987
___Test Local_ResNet_18 poisoned: True, epoch: 134: Average loss: 0.0970, Accuracy: 9642/9900 (97.3939%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 134, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4784/5305 (90.1791%), train_poison_data_count: 415
Global model norm: 44.657080992967956.
Norm before scaling: 44.64748809686134. Distance: 2.2219644820896596
Total norm for 4 adversaries is: 44.64748809686134. distance: 2.2219644820896596
___Test Local_ResNet_18 poisoned: True, epoch: 134: Average loss: 0.1240, Accuracy: 9567/9900 (96.6364%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 134, local model 58, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4231/4717 (89.6968%), train_poison_data_count: 370
Global model norm: 44.657080992967956.
Norm before scaling: 44.648812744486136. Distance: 2.0817064672513026
Total norm for 4 adversaries is: 44.648812744486136. distance: 2.0817064672513026
___Test Local_ResNet_18 poisoned: True, epoch: 134: Average loss: 0.3479, Accuracy: 9080/9900 (91.7172%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 134, local model 71, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4506/5066 (88.9459%), train_poison_data_count: 400
Global model norm: 44.657080992967956.
Norm before scaling: 44.650607586151615. Distance: 2.2535725946576672
Total norm for 4 adversaries is: 44.650607586151615. distance: 2.2535725946576672
___Test Local_ResNet_18 poisoned: True, epoch: 134: Average loss: 0.2220, Accuracy: 9345/9900 (94.3939%)
___Train Local_ResNet_18,  epoch 134, local model 67, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4524/5116 (88.4285%)
___Train Local_ResNet_18,  epoch 134, local model 67, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4630/5116 (90.5004%)
___Test Local_ResNet_18 poisoned: False, epoch: 134: Average loss: 1.9145, Accuracy: 5567/10000 (55.6700%)
___Train Local_ResNet_18,  epoch 134, local model 15, internal_epoch   1,  Average loss: 0.0048, Accuracy: 5055/5582 (90.5589%)
___Train Local_ResNet_18,  epoch 134, local model 15, internal_epoch   2,  Average loss: 0.0037, Accuracy: 5194/5582 (93.0491%)
___Test Local_ResNet_18 poisoned: False, epoch: 134: Average loss: 1.9610, Accuracy: 5550/10000 (55.5000%)
___Train Local_ResNet_18,  epoch 134, local model 73, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3801/4235 (89.7521%)
___Train Local_ResNet_18,  epoch 134, local model 73, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3807/4235 (89.8937%)
___Test Local_ResNet_18 poisoned: False, epoch: 134: Average loss: 1.9758, Accuracy: 5578/10000 (55.7800%)
___Train Local_ResNet_18,  epoch 134, local model 95, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4043/4625 (87.4162%)
___Train Local_ResNet_18,  epoch 134, local model 95, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4060/4625 (87.7838%)
___Test Local_ResNet_18 poisoned: False, epoch: 134: Average loss: 2.2385, Accuracy: 5122/10000 (51.2200%)
___Train Local_ResNet_18,  epoch 134, local model 7, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4078/4481 (91.0065%)
___Train Local_ResNet_18,  epoch 134, local model 7, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4076/4481 (90.9618%)
___Test Local_ResNet_18 poisoned: False, epoch: 134: Average loss: 1.8799, Accuracy: 5776/10000 (57.7600%)
___Train Local_ResNet_18,  epoch 134, local model 22, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4648/5232 (88.8379%)
___Train Local_ResNet_18,  epoch 134, local model 22, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4713/5232 (90.0803%)
___Test Local_ResNet_18 poisoned: False, epoch: 134: Average loss: 1.9235, Accuracy: 5596/10000 (55.9600%)
___Train Local_ResNet_18,  epoch 134, local model 44, internal_epoch   1,  Average loss: 0.0053, Accuracy: 4205/4662 (90.1973%)
___Train Local_ResNet_18,  epoch 134, local model 44, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4303/4662 (92.2994%)
___Test Local_ResNet_18 poisoned: False, epoch: 134: Average loss: 1.9866, Accuracy: 5527/10000 (55.2700%)
___Train Local_ResNet_18,  epoch 134, local model 48, internal_epoch   1,  Average loss: 0.0047, Accuracy: 4053/4441 (91.2632%)
___Train Local_ResNet_18,  epoch 134, local model 48, internal_epoch   2,  Average loss: 0.0036, Accuracy: 4129/4441 (92.9746%)
___Test Local_ResNet_18 poisoned: False, epoch: 134: Average loss: 2.0586, Accuracy: 5496/10000 (54.9600%)
___Train Local_ResNet_18,  epoch 134, local model 34, internal_epoch   1,  Average loss: 0.0052, Accuracy: 4042/4518 (89.4644%)
___Train Local_ResNet_18,  epoch 134, local model 34, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4152/4518 (91.8991%)
___Test Local_ResNet_18 poisoned: False, epoch: 134: Average loss: 1.9802, Accuracy: 5464/10000 (54.6400%)
___Train Local_ResNet_18,  epoch 134, local model 16, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4382/4928 (88.9205%)
___Train Local_ResNet_18,  epoch 134, local model 16, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4502/4928 (91.3555%)
___Test Local_ResNet_18 poisoned: False, epoch: 134: Average loss: 1.8646, Accuracy: 5664/10000 (56.6400%)
___Train Local_ResNet_18,  epoch 134, local model 21, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4088/4634 (88.2175%)
___Train Local_ResNet_18,  epoch 134, local model 21, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4268/4634 (92.1019%)
___Test Local_ResNet_18 poisoned: False, epoch: 134: Average loss: 2.0103, Accuracy: 5501/10000 (55.0100%)
___Train Local_ResNet_18,  epoch 134, local model 88, internal_epoch   1,  Average loss: 0.0037, Accuracy: 4594/4934 (93.1090%)
___Train Local_ResNet_18,  epoch 134, local model 88, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4594/4934 (93.1090%)
___Test Local_ResNet_18 poisoned: False, epoch: 134: Average loss: 1.9630, Accuracy: 5616/10000 (56.1600%)
___Train Local_ResNet_18,  epoch 134, local model 14, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3443/3861 (89.1738%)
___Train Local_ResNet_18,  epoch 134, local model 14, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3507/3861 (90.8314%)
___Test Local_ResNet_18 poisoned: False, epoch: 134: Average loss: 1.9185, Accuracy: 5665/10000 (56.6500%)
___Train Local_ResNet_18,  epoch 134, local model 86, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3175/3616 (87.8042%)
___Train Local_ResNet_18,  epoch 134, local model 86, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3308/3616 (91.4823%)
___Test Local_ResNet_18 poisoned: False, epoch: 134: Average loss: 1.7943, Accuracy: 5890/10000 (58.9000%)
___Train Local_ResNet_18,  epoch 134, local model 74, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3850/4416 (87.1830%)
___Train Local_ResNet_18,  epoch 134, local model 74, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3993/4416 (90.4212%)
___Test Local_ResNet_18 poisoned: False, epoch: 134: Average loss: 1.9690, Accuracy: 5482/10000 (54.8200%)
___Train Local_ResNet_18,  epoch 134, local model 52, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3377/3797 (88.9386%)
___Train Local_ResNet_18,  epoch 134, local model 52, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3465/3797 (91.2563%)
___Test Local_ResNet_18 poisoned: False, epoch: 134: Average loss: 1.9760, Accuracy: 5610/10000 (56.1000%)
time spent on training: 267.6518614292145
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 134: Average loss: 1.9036, Accuracy: 5809/10000 (58.0900%)
___Test Target_ResNet_18 poisoned: True, epoch: 134: Average loss: 9.6808, Accuracy: 95/9900 (0.9596%)
Done in 298.5286364555359 sec.
Server Epoch:135 choose agents : [13, 36, 58, 71, 92, 75, 56, 27, 53, 7, 81, 48, 69, 17, 74, 46, 6, 9, 49, 28].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 135, local model 13, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4415/4885 (90.3787%), train_poison_data_count: 385
Global model norm: 44.68785101479274.
Norm before scaling: 44.685776299798405. Distance: 2.1868527135942624
Total norm for 4 adversaries is: 44.685776299798405. distance: 2.1868527135942624
___Test Local_ResNet_18 poisoned: True, epoch: 135: Average loss: 0.1240, Accuracy: 9594/9900 (96.9091%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 135, local model 36, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4767/5305 (89.8586%), train_poison_data_count: 415
Global model norm: 44.68785101479274.
Norm before scaling: 44.67983844943027. Distance: 2.2032233682951454
Total norm for 4 adversaries is: 44.67983844943027. distance: 2.2032233682951454
___Test Local_ResNet_18 poisoned: True, epoch: 135: Average loss: 0.1143, Accuracy: 9601/9900 (96.9798%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 135, local model 58, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4256/4717 (90.2268%), train_poison_data_count: 370
Global model norm: 44.68785101479274.
Norm before scaling: 44.67656389347915. Distance: 2.042435468870616
Total norm for 4 adversaries is: 44.67656389347915. distance: 2.042435468870616
___Test Local_ResNet_18 poisoned: True, epoch: 135: Average loss: 0.3222, Accuracy: 9096/9900 (91.8788%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 135, local model 71, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4551/5066 (89.8342%), train_poison_data_count: 400
Global model norm: 44.68785101479274.
Norm before scaling: 44.67918683602159. Distance: 2.1883202241193573
Total norm for 4 adversaries is: 44.67918683602159. distance: 2.1883202241193573
___Test Local_ResNet_18 poisoned: True, epoch: 135: Average loss: 0.3629, Accuracy: 9025/9900 (91.1616%)
___Train Local_ResNet_18,  epoch 135, local model 92, internal_epoch   1,  Average loss: 0.0051, Accuracy: 5625/6263 (89.8132%)
___Train Local_ResNet_18,  epoch 135, local model 92, internal_epoch   2,  Average loss: 0.0041, Accuracy: 5745/6263 (91.7292%)
___Test Local_ResNet_18 poisoned: False, epoch: 135: Average loss: 1.9641, Accuracy: 5609/10000 (56.0900%)
___Train Local_ResNet_18,  epoch 135, local model 75, internal_epoch   1,  Average loss: 0.0047, Accuracy: 3919/4295 (91.2456%)
___Train Local_ResNet_18,  epoch 135, local model 75, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3888/4295 (90.5239%)
___Test Local_ResNet_18 poisoned: False, epoch: 135: Average loss: 1.9109, Accuracy: 5619/10000 (56.1900%)
___Train Local_ResNet_18,  epoch 135, local model 56, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4361/4989 (87.4123%)
___Train Local_ResNet_18,  epoch 135, local model 56, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4518/4989 (90.5592%)
___Test Local_ResNet_18 poisoned: False, epoch: 135: Average loss: 1.9267, Accuracy: 5630/10000 (56.3000%)
___Train Local_ResNet_18,  epoch 135, local model 27, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3761/4223 (89.0599%)
___Train Local_ResNet_18,  epoch 135, local model 27, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3872/4223 (91.6884%)
___Test Local_ResNet_18 poisoned: False, epoch: 135: Average loss: 1.7959, Accuracy: 5758/10000 (57.5800%)
___Train Local_ResNet_18,  epoch 135, local model 53, internal_epoch   1,  Average loss: 0.0046, Accuracy: 5560/6124 (90.7903%)
___Train Local_ResNet_18,  epoch 135, local model 53, internal_epoch   2,  Average loss: 0.0045, Accuracy: 5600/6124 (91.4435%)
___Test Local_ResNet_18 poisoned: False, epoch: 135: Average loss: 1.9491, Accuracy: 5551/10000 (55.5100%)
___Train Local_ResNet_18,  epoch 135, local model 7, internal_epoch   1,  Average loss: 0.0052, Accuracy: 4116/4481 (91.8545%)
___Train Local_ResNet_18,  epoch 135, local model 7, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4088/4481 (91.2296%)
___Test Local_ResNet_18 poisoned: False, epoch: 135: Average loss: 1.9847, Accuracy: 5562/10000 (55.6200%)
___Train Local_ResNet_18,  epoch 135, local model 81, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4154/4618 (89.9524%)
___Train Local_ResNet_18,  epoch 135, local model 81, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4186/4618 (90.6453%)
___Test Local_ResNet_18 poisoned: False, epoch: 135: Average loss: 2.1056, Accuracy: 5303/10000 (53.0300%)
___Train Local_ResNet_18,  epoch 135, local model 48, internal_epoch   1,  Average loss: 0.0043, Accuracy: 4097/4441 (92.2540%)
___Train Local_ResNet_18,  epoch 135, local model 48, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4128/4441 (92.9520%)
___Test Local_ResNet_18 poisoned: False, epoch: 135: Average loss: 2.0076, Accuracy: 5563/10000 (55.6300%)
___Train Local_ResNet_18,  epoch 135, local model 69, internal_epoch   1,  Average loss: 0.0052, Accuracy: 3609/4013 (89.9327%)
___Train Local_ResNet_18,  epoch 135, local model 69, internal_epoch   2,  Average loss: 0.0038, Accuracy: 3719/4013 (92.6738%)
___Test Local_ResNet_18 poisoned: False, epoch: 135: Average loss: 1.7599, Accuracy: 5825/10000 (58.2500%)
___Train Local_ResNet_18,  epoch 135, local model 17, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3969/4511 (87.9849%)
___Train Local_ResNet_18,  epoch 135, local model 17, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4091/4511 (90.6894%)
___Test Local_ResNet_18 poisoned: False, epoch: 135: Average loss: 1.9003, Accuracy: 5558/10000 (55.5800%)
___Train Local_ResNet_18,  epoch 135, local model 74, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3867/4416 (87.5679%)
___Train Local_ResNet_18,  epoch 135, local model 74, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3993/4416 (90.4212%)
___Test Local_ResNet_18 poisoned: False, epoch: 135: Average loss: 1.8211, Accuracy: 5682/10000 (56.8200%)
___Train Local_ResNet_18,  epoch 135, local model 46, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4320/4956 (87.1671%)
___Train Local_ResNet_18,  epoch 135, local model 46, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4383/4956 (88.4383%)
___Test Local_ResNet_18 poisoned: False, epoch: 135: Average loss: 2.0174, Accuracy: 5501/10000 (55.0100%)
___Train Local_ResNet_18,  epoch 135, local model 6, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4075/4538 (89.7973%)
___Train Local_ResNet_18,  epoch 135, local model 6, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4199/4538 (92.5297%)
___Test Local_ResNet_18 poisoned: False, epoch: 135: Average loss: 1.9161, Accuracy: 5627/10000 (56.2700%)
___Train Local_ResNet_18,  epoch 135, local model 9, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4655/5265 (88.4141%)
___Train Local_ResNet_18,  epoch 135, local model 9, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4783/5265 (90.8452%)
___Test Local_ResNet_18 poisoned: False, epoch: 135: Average loss: 1.9583, Accuracy: 5637/10000 (56.3700%)
___Train Local_ResNet_18,  epoch 135, local model 49, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4616/5197 (88.8205%)
___Train Local_ResNet_18,  epoch 135, local model 49, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4691/5197 (90.2636%)
___Test Local_ResNet_18 poisoned: False, epoch: 135: Average loss: 2.1278, Accuracy: 5365/10000 (53.6500%)
___Train Local_ResNet_18,  epoch 135, local model 28, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4208/4716 (89.2282%)
___Train Local_ResNet_18,  epoch 135, local model 28, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4303/4716 (91.2426%)
___Test Local_ResNet_18 poisoned: False, epoch: 135: Average loss: 2.0518, Accuracy: 5448/10000 (54.4800%)
time spent on training: 271.02667713165283
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 135: Average loss: 1.9235, Accuracy: 5770/10000 (57.7000%)
___Test Target_ResNet_18 poisoned: True, epoch: 135: Average loss: 9.4593, Accuracy: 128/9900 (1.2929%)
Done in 301.68878984451294 sec.
Server Epoch:136 choose agents : [13, 36, 58, 71, 86, 20, 40, 94, 90, 92, 6, 21, 67, 28, 59, 34, 62, 38, 15, 33].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 136, local model 13, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4403/4885 (90.1331%), train_poison_data_count: 385
Global model norm: 44.71961941197132.
Norm before scaling: 44.71033889713737. Distance: 2.130993860687907
Total norm for 4 adversaries is: 44.71033889713737. distance: 2.130993860687907
___Test Local_ResNet_18 poisoned: True, epoch: 136: Average loss: 0.2191, Accuracy: 9348/9900 (94.4242%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 136, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4748/5305 (89.5005%), train_poison_data_count: 415
Global model norm: 44.71961941197132.
Norm before scaling: 44.71411057563722. Distance: 2.281192935595677
Total norm for 4 adversaries is: 44.71411057563722. distance: 2.281192935595677
___Test Local_ResNet_18 poisoned: True, epoch: 136: Average loss: 0.2425, Accuracy: 9302/9900 (93.9596%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 136, local model 58, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4256/4717 (90.2268%), train_poison_data_count: 370
Global model norm: 44.71961941197132.
Norm before scaling: 44.71114840833533. Distance: 2.050250582382925
Total norm for 4 adversaries is: 44.71114840833533. distance: 2.050250582382925
___Test Local_ResNet_18 poisoned: True, epoch: 136: Average loss: 0.1048, Accuracy: 9624/9900 (97.2121%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 136, local model 71, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4539/5066 (89.5973%), train_poison_data_count: 400
Global model norm: 44.71961941197132.
Norm before scaling: 44.71127536238762. Distance: 2.206341607026381
Total norm for 4 adversaries is: 44.71127536238762. distance: 2.206341607026381
___Test Local_ResNet_18 poisoned: True, epoch: 136: Average loss: 0.2964, Accuracy: 9140/9900 (92.3232%)
___Train Local_ResNet_18,  epoch 136, local model 86, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3224/3616 (89.1593%)
___Train Local_ResNet_18,  epoch 136, local model 86, internal_epoch   2,  Average loss: 0.0037, Accuracy: 3362/3616 (92.9757%)
___Test Local_ResNet_18 poisoned: False, epoch: 136: Average loss: 1.7600, Accuracy: 5931/10000 (59.3100%)
___Train Local_ResNet_18,  epoch 136, local model 20, internal_epoch   1,  Average loss: 0.0046, Accuracy: 3936/4315 (91.2167%)
___Train Local_ResNet_18,  epoch 136, local model 20, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3977/4315 (92.1669%)
___Test Local_ResNet_18 poisoned: False, epoch: 136: Average loss: 1.9454, Accuracy: 5600/10000 (56.0000%)
___Train Local_ResNet_18,  epoch 136, local model 40, internal_epoch   1,  Average loss: 0.0052, Accuracy: 4894/5455 (89.7159%)
___Train Local_ResNet_18,  epoch 136, local model 40, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4912/5455 (90.0458%)
___Test Local_ResNet_18 poisoned: False, epoch: 136: Average loss: 2.0061, Accuracy: 5501/10000 (55.0100%)
___Train Local_ResNet_18,  epoch 136, local model 94, internal_epoch   1,  Average loss: 0.0025, Accuracy: 4597/4804 (95.6911%)
___Train Local_ResNet_18,  epoch 136, local model 94, internal_epoch   2,  Average loss: 0.0028, Accuracy: 4558/4804 (94.8793%)
___Test Local_ResNet_18 poisoned: False, epoch: 136: Average loss: 1.9106, Accuracy: 5741/10000 (57.4100%)
___Train Local_ResNet_18,  epoch 136, local model 90, internal_epoch   1,  Average loss: 0.0051, Accuracy: 3975/4362 (91.1279%)
___Train Local_ResNet_18,  epoch 136, local model 90, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3974/4362 (91.1050%)
___Test Local_ResNet_18 poisoned: False, epoch: 136: Average loss: 1.9717, Accuracy: 5454/10000 (54.5400%)
___Train Local_ResNet_18,  epoch 136, local model 92, internal_epoch   1,  Average loss: 0.0050, Accuracy: 5648/6263 (90.1804%)
___Train Local_ResNet_18,  epoch 136, local model 92, internal_epoch   2,  Average loss: 0.0044, Accuracy: 5723/6263 (91.3779%)
___Test Local_ResNet_18 poisoned: False, epoch: 136: Average loss: 2.0546, Accuracy: 5362/10000 (53.6200%)
___Train Local_ResNet_18,  epoch 136, local model 6, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4089/4538 (90.1058%)
___Train Local_ResNet_18,  epoch 136, local model 6, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4183/4538 (92.1772%)
___Test Local_ResNet_18 poisoned: False, epoch: 136: Average loss: 1.8015, Accuracy: 5849/10000 (58.4900%)
___Train Local_ResNet_18,  epoch 136, local model 21, internal_epoch   1,  Average loss: 0.0053, Accuracy: 4177/4634 (90.1381%)
___Train Local_ResNet_18,  epoch 136, local model 21, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4257/4634 (91.8645%)
___Test Local_ResNet_18 poisoned: False, epoch: 136: Average loss: 1.8761, Accuracy: 5780/10000 (57.8000%)
___Train Local_ResNet_18,  epoch 136, local model 67, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4546/5116 (88.8585%)
___Train Local_ResNet_18,  epoch 136, local model 67, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4630/5116 (90.5004%)
___Test Local_ResNet_18 poisoned: False, epoch: 136: Average loss: 1.8814, Accuracy: 5597/10000 (55.9700%)
___Train Local_ResNet_18,  epoch 136, local model 28, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4145/4716 (87.8923%)
___Train Local_ResNet_18,  epoch 136, local model 28, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4248/4716 (90.0763%)
___Test Local_ResNet_18 poisoned: False, epoch: 136: Average loss: 2.0592, Accuracy: 5373/10000 (53.7300%)
___Train Local_ResNet_18,  epoch 136, local model 59, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3630/4046 (89.7182%)
___Train Local_ResNet_18,  epoch 136, local model 59, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3737/4046 (92.3628%)
___Test Local_ResNet_18 poisoned: False, epoch: 136: Average loss: 1.9943, Accuracy: 5537/10000 (55.3700%)
___Train Local_ResNet_18,  epoch 136, local model 34, internal_epoch   1,  Average loss: 0.0052, Accuracy: 4065/4518 (89.9734%)
___Train Local_ResNet_18,  epoch 136, local model 34, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4157/4518 (92.0097%)
___Test Local_ResNet_18 poisoned: False, epoch: 136: Average loss: 1.7613, Accuracy: 5843/10000 (58.4300%)
___Train Local_ResNet_18,  epoch 136, local model 62, internal_epoch   1,  Average loss: 0.0048, Accuracy: 4570/5063 (90.2627%)
___Train Local_ResNet_18,  epoch 136, local model 62, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4540/5063 (89.6702%)
___Test Local_ResNet_18 poisoned: False, epoch: 136: Average loss: 2.0891, Accuracy: 5454/10000 (54.5400%)
___Train Local_ResNet_18,  epoch 136, local model 38, internal_epoch   1,  Average loss: 0.0046, Accuracy: 5240/5740 (91.2892%)
___Train Local_ResNet_18,  epoch 136, local model 38, internal_epoch   2,  Average loss: 0.0040, Accuracy: 5299/5740 (92.3171%)
___Test Local_ResNet_18 poisoned: False, epoch: 136: Average loss: 1.9086, Accuracy: 5616/10000 (56.1600%)
___Train Local_ResNet_18,  epoch 136, local model 15, internal_epoch   1,  Average loss: 0.0047, Accuracy: 5085/5582 (91.0964%)
___Train Local_ResNet_18,  epoch 136, local model 15, internal_epoch   2,  Average loss: 0.0041, Accuracy: 5148/5582 (92.2250%)
___Test Local_ResNet_18 poisoned: False, epoch: 136: Average loss: 2.1121, Accuracy: 5359/10000 (53.5900%)
___Train Local_ResNet_18,  epoch 136, local model 33, internal_epoch   1,  Average loss: 0.0046, Accuracy: 4033/4433 (90.9768%)
___Train Local_ResNet_18,  epoch 136, local model 33, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4086/4433 (92.1723%)
___Test Local_ResNet_18 poisoned: False, epoch: 136: Average loss: 1.7992, Accuracy: 5731/10000 (57.3100%)
time spent on training: 268.64804911613464
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 136: Average loss: 1.8904, Accuracy: 5798/10000 (57.9800%)
___Test Target_ResNet_18 poisoned: True, epoch: 136: Average loss: 9.3673, Accuracy: 162/9900 (1.6364%)
Done in 294.1250603199005 sec.
Server Epoch:137 choose agents : [13, 36, 58, 71, 49, 78, 7, 93, 25, 61, 50, 85, 31, 5, 21, 27, 18, 33, 41, 76].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 137, local model 13, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4430/4885 (90.6858%), train_poison_data_count: 385
Global model norm: 44.75028096542384.
Norm before scaling: 44.741724367910344. Distance: 2.1146975581946172
Total norm for 4 adversaries is: 44.741724367910344. distance: 2.1146975581946172
___Test Local_ResNet_18 poisoned: True, epoch: 137: Average loss: 0.1104, Accuracy: 9634/9900 (97.3131%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 137, local model 36, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4751/5305 (89.5570%), train_poison_data_count: 415
Global model norm: 44.75028096542384.
Norm before scaling: 44.74608403126258. Distance: 2.250305578885734
Total norm for 4 adversaries is: 44.74608403126258. distance: 2.250305578885734
___Test Local_ResNet_18 poisoned: True, epoch: 137: Average loss: 0.1136, Accuracy: 9602/9900 (96.9899%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 137, local model 58, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4287/4717 (90.8840%), train_poison_data_count: 370
Global model norm: 44.75028096542384.
Norm before scaling: 44.73844342746516. Distance: 2.0462201650747995
Total norm for 4 adversaries is: 44.73844342746516. distance: 2.0462201650747995
___Test Local_ResNet_18 poisoned: True, epoch: 137: Average loss: 0.2247, Accuracy: 9336/9900 (94.3030%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 137, local model 71, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4548/5066 (89.7750%), train_poison_data_count: 400
Global model norm: 44.75028096542384.
Norm before scaling: 44.74026195764909. Distance: 2.1937069706622907
Total norm for 4 adversaries is: 44.74026195764909. distance: 2.1937069706622907
___Test Local_ResNet_18 poisoned: True, epoch: 137: Average loss: 0.3437, Accuracy: 9018/9900 (91.0909%)
___Train Local_ResNet_18,  epoch 137, local model 49, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4637/5197 (89.2246%)
___Train Local_ResNet_18,  epoch 137, local model 49, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4577/5197 (88.0700%)
___Test Local_ResNet_18 poisoned: False, epoch: 137: Average loss: 1.9826, Accuracy: 5458/10000 (54.5800%)
___Train Local_ResNet_18,  epoch 137, local model 78, internal_epoch   1,  Average loss: 0.0051, Accuracy: 3611/4025 (89.7143%)
___Train Local_ResNet_18,  epoch 137, local model 78, internal_epoch   2,  Average loss: 0.0036, Accuracy: 3738/4025 (92.8696%)
___Test Local_ResNet_18 poisoned: False, epoch: 137: Average loss: 1.9008, Accuracy: 5637/10000 (56.3700%)
___Train Local_ResNet_18,  epoch 137, local model 7, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4124/4481 (92.0330%)
___Train Local_ResNet_18,  epoch 137, local model 7, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4122/4481 (91.9884%)
___Test Local_ResNet_18 poisoned: False, epoch: 137: Average loss: 1.9759, Accuracy: 5599/10000 (55.9900%)
___Train Local_ResNet_18,  epoch 137, local model 93, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4124/4651 (88.6691%)
___Train Local_ResNet_18,  epoch 137, local model 93, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4254/4651 (91.4642%)
___Test Local_ResNet_18 poisoned: False, epoch: 137: Average loss: 1.9577, Accuracy: 5570/10000 (55.7000%)
___Train Local_ResNet_18,  epoch 137, local model 25, internal_epoch   1,  Average loss: 0.0039, Accuracy: 5468/5902 (92.6466%)
___Train Local_ResNet_18,  epoch 137, local model 25, internal_epoch   2,  Average loss: 0.0041, Accuracy: 5422/5902 (91.8672%)
___Test Local_ResNet_18 poisoned: False, epoch: 137: Average loss: 2.0123, Accuracy: 5573/10000 (55.7300%)
___Train Local_ResNet_18,  epoch 137, local model 61, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3652/4126 (88.5119%)
___Train Local_ResNet_18,  epoch 137, local model 61, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3809/4126 (92.3170%)
___Test Local_ResNet_18 poisoned: False, epoch: 137: Average loss: 1.7284, Accuracy: 5859/10000 (58.5900%)
___Train Local_ResNet_18,  epoch 137, local model 50, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3931/4368 (89.9954%)
___Train Local_ResNet_18,  epoch 137, local model 50, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4011/4368 (91.8269%)
___Test Local_ResNet_18 poisoned: False, epoch: 137: Average loss: 1.8916, Accuracy: 5665/10000 (56.6500%)
___Train Local_ResNet_18,  epoch 137, local model 85, internal_epoch   1,  Average loss: 0.0047, Accuracy: 5807/6391 (90.8621%)
___Train Local_ResNet_18,  epoch 137, local model 85, internal_epoch   2,  Average loss: 0.0048, Accuracy: 5794/6391 (90.6587%)
___Test Local_ResNet_18 poisoned: False, epoch: 137: Average loss: 2.0628, Accuracy: 5404/10000 (54.0400%)
___Train Local_ResNet_18,  epoch 137, local model 31, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3723/4175 (89.1737%)
___Train Local_ResNet_18,  epoch 137, local model 31, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3750/4175 (89.8204%)
___Test Local_ResNet_18 poisoned: False, epoch: 137: Average loss: 1.8630, Accuracy: 5724/10000 (57.2400%)
___Train Local_ResNet_18,  epoch 137, local model 5, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4163/4596 (90.5788%)
___Train Local_ResNet_18,  epoch 137, local model 5, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4227/4596 (91.9713%)
___Test Local_ResNet_18 poisoned: False, epoch: 137: Average loss: 2.0407, Accuracy: 5500/10000 (55.0000%)
___Train Local_ResNet_18,  epoch 137, local model 21, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4138/4634 (89.2965%)
___Train Local_ResNet_18,  epoch 137, local model 21, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4222/4634 (91.1092%)
___Test Local_ResNet_18 poisoned: False, epoch: 137: Average loss: 1.8914, Accuracy: 5670/10000 (56.7000%)
___Train Local_ResNet_18,  epoch 137, local model 27, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3763/4223 (89.1073%)
___Train Local_ResNet_18,  epoch 137, local model 27, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3903/4223 (92.4224%)
___Test Local_ResNet_18 poisoned: False, epoch: 137: Average loss: 1.8675, Accuracy: 5651/10000 (56.5100%)
___Train Local_ResNet_18,  epoch 137, local model 18, internal_epoch   1,  Average loss: 0.0047, Accuracy: 3562/3911 (91.0765%)
___Train Local_ResNet_18,  epoch 137, local model 18, internal_epoch   2,  Average loss: 0.0069, Accuracy: 3390/3911 (86.6786%)
___Test Local_ResNet_18 poisoned: False, epoch: 137: Average loss: 2.0413, Accuracy: 5436/10000 (54.3600%)
___Train Local_ResNet_18,  epoch 137, local model 33, internal_epoch   1,  Average loss: 0.0050, Accuracy: 3980/4433 (89.7812%)
___Train Local_ResNet_18,  epoch 137, local model 33, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4101/4433 (92.5107%)
___Test Local_ResNet_18 poisoned: False, epoch: 137: Average loss: 1.8386, Accuracy: 5712/10000 (57.1200%)
___Train Local_ResNet_18,  epoch 137, local model 41, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3864/4336 (89.1144%)
___Train Local_ResNet_18,  epoch 137, local model 41, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4019/4336 (92.6891%)
___Test Local_ResNet_18 poisoned: False, epoch: 137: Average loss: 1.9592, Accuracy: 5597/10000 (55.9700%)
___Train Local_ResNet_18,  epoch 137, local model 76, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3180/3638 (87.4107%)
___Train Local_ResNet_18,  epoch 137, local model 76, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3335/3638 (91.6712%)
___Test Local_ResNet_18 poisoned: False, epoch: 137: Average loss: 1.8758, Accuracy: 5679/10000 (56.7900%)
time spent on training: 236.9879560470581
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 137: Average loss: 1.9016, Accuracy: 5764/10000 (57.6400%)
___Test Target_ResNet_18 poisoned: True, epoch: 137: Average loss: 9.0215, Accuracy: 148/9900 (1.4949%)
Done in 262.5543496608734 sec.
Server Epoch:138 choose agents : [13, 36, 58, 71, 26, 42, 33, 8, 78, 73, 53, 21, 28, 72, 60, 30, 70, 38, 5, 86].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 138, local model 13, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4444/4885 (90.9724%), train_poison_data_count: 385
Global model norm: 44.779450853600245.
Norm before scaling: 44.77478772937888. Distance: 2.1121604330510237
Total norm for 4 adversaries is: 44.77478772937888. distance: 2.1121604330510237
___Test Local_ResNet_18 poisoned: True, epoch: 138: Average loss: 0.3071, Accuracy: 9181/9900 (92.7374%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 138, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4760/5305 (89.7267%), train_poison_data_count: 415
Global model norm: 44.779450853600245.
Norm before scaling: 44.77507808131104. Distance: 2.2782616049752376
Total norm for 4 adversaries is: 44.77507808131104. distance: 2.2782616049752376
___Test Local_ResNet_18 poisoned: True, epoch: 138: Average loss: 0.2319, Accuracy: 9320/9900 (94.1414%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 138, local model 58, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4311/4717 (91.3928%), train_poison_data_count: 370
Global model norm: 44.779450853600245.
Norm before scaling: 44.76517369973211. Distance: 1.9927355442558905
Total norm for 4 adversaries is: 44.76517369973211. distance: 1.9927355442558905
___Test Local_ResNet_18 poisoned: True, epoch: 138: Average loss: 0.1614, Accuracy: 9456/9900 (95.5152%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 138, local model 71, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4587/5066 (90.5448%), train_poison_data_count: 400
Global model norm: 44.779450853600245.
Norm before scaling: 44.77030271153873. Distance: 2.15474283370019
Total norm for 4 adversaries is: 44.77030271153873. distance: 2.15474283370019
___Test Local_ResNet_18 poisoned: True, epoch: 138: Average loss: 0.3855, Accuracy: 8963/9900 (90.5354%)
___Train Local_ResNet_18,  epoch 138, local model 26, internal_epoch   1,  Average loss: 0.0048, Accuracy: 3383/3756 (90.0692%)
___Train Local_ResNet_18,  epoch 138, local model 26, internal_epoch   2,  Average loss: 0.0036, Accuracy: 3500/3756 (93.1842%)
___Test Local_ResNet_18 poisoned: False, epoch: 138: Average loss: 1.8740, Accuracy: 5741/10000 (57.4100%)
___Train Local_ResNet_18,  epoch 138, local model 42, internal_epoch   1,  Average loss: 0.0049, Accuracy: 4920/5424 (90.7080%)
___Train Local_ResNet_18,  epoch 138, local model 42, internal_epoch   2,  Average loss: 0.0036, Accuracy: 5027/5424 (92.6807%)
___Test Local_ResNet_18 poisoned: False, epoch: 138: Average loss: 2.1856, Accuracy: 5287/10000 (52.8700%)
___Train Local_ResNet_18,  epoch 138, local model 33, internal_epoch   1,  Average loss: 0.0049, Accuracy: 4003/4433 (90.3000%)
___Train Local_ResNet_18,  epoch 138, local model 33, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4039/4433 (91.1121%)
___Test Local_ResNet_18 poisoned: False, epoch: 138: Average loss: 1.9568, Accuracy: 5600/10000 (56.0000%)
___Train Local_ResNet_18,  epoch 138, local model 8, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3989/4501 (88.6248%)
___Train Local_ResNet_18,  epoch 138, local model 8, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4082/4501 (90.6910%)
___Test Local_ResNet_18 poisoned: False, epoch: 138: Average loss: 1.9706, Accuracy: 5567/10000 (55.6700%)
___Train Local_ResNet_18,  epoch 138, local model 78, internal_epoch   1,  Average loss: 0.0048, Accuracy: 3642/4025 (90.4845%)
___Train Local_ResNet_18,  epoch 138, local model 78, internal_epoch   2,  Average loss: 0.0034, Accuracy: 3771/4025 (93.6894%)
___Test Local_ResNet_18 poisoned: False, epoch: 138: Average loss: 1.7692, Accuracy: 5815/10000 (58.1500%)
___Train Local_ResNet_18,  epoch 138, local model 73, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3806/4235 (89.8701%)
___Train Local_ResNet_18,  epoch 138, local model 73, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3824/4235 (90.2952%)
___Test Local_ResNet_18 poisoned: False, epoch: 138: Average loss: 1.9571, Accuracy: 5550/10000 (55.5000%)
___Train Local_ResNet_18,  epoch 138, local model 53, internal_epoch   1,  Average loss: 0.0045, Accuracy: 5580/6124 (91.1169%)
___Train Local_ResNet_18,  epoch 138, local model 53, internal_epoch   2,  Average loss: 0.0047, Accuracy: 5549/6124 (90.6107%)
___Test Local_ResNet_18 poisoned: False, epoch: 138: Average loss: 1.9600, Accuracy: 5505/10000 (55.0500%)
___Train Local_ResNet_18,  epoch 138, local model 21, internal_epoch   1,  Average loss: 0.0047, Accuracy: 4185/4634 (90.3107%)
___Train Local_ResNet_18,  epoch 138, local model 21, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4233/4634 (91.3466%)
___Test Local_ResNet_18 poisoned: False, epoch: 138: Average loss: 1.9209, Accuracy: 5638/10000 (56.3800%)
___Train Local_ResNet_18,  epoch 138, local model 28, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4203/4716 (89.1221%)
___Train Local_ResNet_18,  epoch 138, local model 28, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4284/4716 (90.8397%)
___Test Local_ResNet_18 poisoned: False, epoch: 138: Average loss: 2.0897, Accuracy: 5433/10000 (54.3300%)
___Train Local_ResNet_18,  epoch 138, local model 72, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4153/4767 (87.1198%)
___Train Local_ResNet_18,  epoch 138, local model 72, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4246/4767 (89.0707%)
___Test Local_ResNet_18 poisoned: False, epoch: 138: Average loss: 2.1289, Accuracy: 5372/10000 (53.7200%)
___Train Local_ResNet_18,  epoch 138, local model 60, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3361/3804 (88.3544%)
___Train Local_ResNet_18,  epoch 138, local model 60, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3517/3804 (92.4553%)
___Test Local_ResNet_18 poisoned: False, epoch: 138: Average loss: 1.9381, Accuracy: 5622/10000 (56.2200%)
___Train Local_ResNet_18,  epoch 138, local model 30, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3118/3472 (89.8041%)
___Train Local_ResNet_18,  epoch 138, local model 30, internal_epoch   2,  Average loss: 0.0035, Accuracy: 3248/3472 (93.5484%)
___Test Local_ResNet_18 poisoned: False, epoch: 138: Average loss: 1.9102, Accuracy: 5718/10000 (57.1800%)
___Train Local_ResNet_18,  epoch 138, local model 70, internal_epoch   1,  Average loss: 0.0045, Accuracy: 4917/5392 (91.1907%)
___Train Local_ResNet_18,  epoch 138, local model 70, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4883/5392 (90.5601%)
___Test Local_ResNet_18 poisoned: False, epoch: 138: Average loss: 1.9674, Accuracy: 5573/10000 (55.7300%)
___Train Local_ResNet_18,  epoch 138, local model 38, internal_epoch   1,  Average loss: 0.0044, Accuracy: 5268/5740 (91.7770%)
___Train Local_ResNet_18,  epoch 138, local model 38, internal_epoch   2,  Average loss: 0.0037, Accuracy: 5327/5740 (92.8049%)
___Test Local_ResNet_18 poisoned: False, epoch: 138: Average loss: 1.9055, Accuracy: 5650/10000 (56.5000%)
___Train Local_ResNet_18,  epoch 138, local model 5, internal_epoch   1,  Average loss: 0.0049, Accuracy: 4153/4596 (90.3612%)
___Train Local_ResNet_18,  epoch 138, local model 5, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4244/4596 (92.3412%)
___Test Local_ResNet_18 poisoned: False, epoch: 138: Average loss: 1.8972, Accuracy: 5673/10000 (56.7300%)
___Train Local_ResNet_18,  epoch 138, local model 86, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3190/3616 (88.2190%)
___Train Local_ResNet_18,  epoch 138, local model 86, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3342/3616 (92.4226%)
___Test Local_ResNet_18 poisoned: False, epoch: 138: Average loss: 1.8541, Accuracy: 5776/10000 (57.7600%)
time spent on training: 237.09306359291077
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 138: Average loss: 1.8894, Accuracy: 5769/10000 (57.6900%)
___Test Target_ResNet_18 poisoned: True, epoch: 138: Average loss: 9.3273, Accuracy: 126/9900 (1.2727%)
Done in 262.94474625587463 sec.
Server Epoch:139 choose agents : [13, 36, 58, 71, 62, 94, 57, 26, 42, 17, 35, 89, 11, 84, 98, 59, 69, 83, 90, 29].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 139, local model 13, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4445/4885 (90.9928%), train_poison_data_count: 385
Global model norm: 44.80926919141563.
Norm before scaling: 44.798060347938055. Distance: 2.115183765373025
Total norm for 4 adversaries is: 44.798060347938055. distance: 2.115183765373025
___Test Local_ResNet_18 poisoned: True, epoch: 139: Average loss: 0.1179, Accuracy: 9610/9900 (97.0707%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 139, local model 36, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4764/5305 (89.8021%), train_poison_data_count: 415
Global model norm: 44.80926919141563.
Norm before scaling: 44.80355886220145. Distance: 2.2524261110234263
Total norm for 4 adversaries is: 44.80355886220145. distance: 2.2524261110234263
___Test Local_ResNet_18 poisoned: True, epoch: 139: Average loss: 0.0736, Accuracy: 9705/9900 (98.0303%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 139, local model 58, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4292/4717 (90.9900%), train_poison_data_count: 370
Global model norm: 44.80926919141563.
Norm before scaling: 44.79814209491561. Distance: 2.0340261415135137
Total norm for 4 adversaries is: 44.79814209491561. distance: 2.0340261415135137
___Test Local_ResNet_18 poisoned: True, epoch: 139: Average loss: 0.0864, Accuracy: 9694/9900 (97.9192%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 139, local model 71, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4581/5066 (90.4264%), train_poison_data_count: 400
Global model norm: 44.80926919141563.
Norm before scaling: 44.8024158916298. Distance: 2.1991262738314084
Total norm for 4 adversaries is: 44.8024158916298. distance: 2.1991262738314084
___Test Local_ResNet_18 poisoned: True, epoch: 139: Average loss: 0.2544, Accuracy: 9290/9900 (93.8384%)
___Train Local_ResNet_18,  epoch 139, local model 62, internal_epoch   1,  Average loss: 0.0046, Accuracy: 4617/5063 (91.1910%)
___Train Local_ResNet_18,  epoch 139, local model 62, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4610/5063 (91.0527%)
___Test Local_ResNet_18 poisoned: False, epoch: 139: Average loss: 1.9889, Accuracy: 5613/10000 (56.1300%)
___Train Local_ResNet_18,  epoch 139, local model 94, internal_epoch   1,  Average loss: 0.0026, Accuracy: 4588/4804 (95.5037%)
___Train Local_ResNet_18,  epoch 139, local model 94, internal_epoch   2,  Average loss: 0.0032, Accuracy: 4510/4804 (93.8801%)
___Test Local_ResNet_18 poisoned: False, epoch: 139: Average loss: 1.8995, Accuracy: 5807/10000 (58.0700%)
___Train Local_ResNet_18,  epoch 139, local model 57, internal_epoch   1,  Average loss: 0.0053, Accuracy: 4080/4558 (89.5129%)
___Train Local_ResNet_18,  epoch 139, local model 57, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4168/4558 (91.4436%)
___Test Local_ResNet_18 poisoned: False, epoch: 139: Average loss: 1.8867, Accuracy: 5676/10000 (56.7600%)
___Train Local_ResNet_18,  epoch 139, local model 26, internal_epoch   1,  Average loss: 0.0046, Accuracy: 3418/3756 (91.0011%)
___Train Local_ResNet_18,  epoch 139, local model 26, internal_epoch   2,  Average loss: 0.0032, Accuracy: 3535/3756 (94.1161%)
___Test Local_ResNet_18 poisoned: False, epoch: 139: Average loss: 1.8301, Accuracy: 5827/10000 (58.2700%)
___Train Local_ResNet_18,  epoch 139, local model 42, internal_epoch   1,  Average loss: 0.0045, Accuracy: 4928/5424 (90.8555%)
___Train Local_ResNet_18,  epoch 139, local model 42, internal_epoch   2,  Average loss: 0.0038, Accuracy: 5008/5424 (92.3304%)
___Test Local_ResNet_18 poisoned: False, epoch: 139: Average loss: 1.9976, Accuracy: 5413/10000 (54.1300%)
___Train Local_ResNet_18,  epoch 139, local model 17, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4022/4511 (89.1598%)
___Train Local_ResNet_18,  epoch 139, local model 17, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4152/4511 (92.0417%)
___Test Local_ResNet_18 poisoned: False, epoch: 139: Average loss: 1.8324, Accuracy: 5748/10000 (57.4800%)
___Train Local_ResNet_18,  epoch 139, local model 35, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4663/5167 (90.2458%)
___Train Local_ResNet_18,  epoch 139, local model 35, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4764/5167 (92.2005%)
___Test Local_ResNet_18 poisoned: False, epoch: 139: Average loss: 2.1396, Accuracy: 5348/10000 (53.4800%)
___Train Local_ResNet_18,  epoch 139, local model 89, internal_epoch   1,  Average loss: 0.0035, Accuracy: 4075/4356 (93.5491%)
___Train Local_ResNet_18,  epoch 139, local model 89, internal_epoch   2,  Average loss: 0.0031, Accuracy: 4130/4356 (94.8118%)
___Test Local_ResNet_18 poisoned: False, epoch: 139: Average loss: 1.9658, Accuracy: 5639/10000 (56.3900%)
___Train Local_ResNet_18,  epoch 139, local model 11, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4606/5244 (87.8337%)
___Train Local_ResNet_18,  epoch 139, local model 11, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4708/5244 (89.7788%)
___Test Local_ResNet_18 poisoned: False, epoch: 139: Average loss: 1.9288, Accuracy: 5565/10000 (55.6500%)
___Train Local_ResNet_18,  epoch 139, local model 84, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4268/4793 (89.0465%)
___Train Local_ResNet_18,  epoch 139, local model 84, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4405/4793 (91.9049%)
___Test Local_ResNet_18 poisoned: False, epoch: 139: Average loss: 1.9410, Accuracy: 5641/10000 (56.4100%)
___Train Local_ResNet_18,  epoch 139, local model 98, internal_epoch   1,  Average loss: 0.0050, Accuracy: 3472/3828 (90.7001%)
___Train Local_ResNet_18,  epoch 139, local model 98, internal_epoch   2,  Average loss: 0.0036, Accuracy: 3583/3828 (93.5998%)
___Test Local_ResNet_18 poisoned: False, epoch: 139: Average loss: 1.7471, Accuracy: 5922/10000 (59.2200%)
___Train Local_ResNet_18,  epoch 139, local model 59, internal_epoch   1,  Average loss: 0.0048, Accuracy: 3673/4046 (90.7810%)
___Train Local_ResNet_18,  epoch 139, local model 59, internal_epoch   2,  Average loss: 0.0034, Accuracy: 3776/4046 (93.3267%)
___Test Local_ResNet_18 poisoned: False, epoch: 139: Average loss: 1.8587, Accuracy: 5814/10000 (58.1400%)
___Train Local_ResNet_18,  epoch 139, local model 69, internal_epoch   1,  Average loss: 0.0046, Accuracy: 3666/4013 (91.3531%)
___Train Local_ResNet_18,  epoch 139, local model 69, internal_epoch   2,  Average loss: 0.0035, Accuracy: 3737/4013 (93.1224%)
___Test Local_ResNet_18 poisoned: False, epoch: 139: Average loss: 1.7505, Accuracy: 5913/10000 (59.1300%)
___Train Local_ResNet_18,  epoch 139, local model 83, internal_epoch   1,  Average loss: 0.0054, Accuracy: 2928/3271 (89.5139%)
___Train Local_ResNet_18,  epoch 139, local model 83, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3018/3271 (92.2654%)
___Test Local_ResNet_18 poisoned: False, epoch: 139: Average loss: 1.7798, Accuracy: 5890/10000 (58.9000%)
___Train Local_ResNet_18,  epoch 139, local model 90, internal_epoch   1,  Average loss: 0.0044, Accuracy: 3999/4362 (91.6781%)
___Train Local_ResNet_18,  epoch 139, local model 90, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4044/4362 (92.7098%)
___Test Local_ResNet_18 poisoned: False, epoch: 139: Average loss: 1.8672, Accuracy: 5731/10000 (57.3100%)
___Train Local_ResNet_18,  epoch 139, local model 29, internal_epoch   1,  Average loss: 0.0043, Accuracy: 3954/4346 (90.9802%)
___Train Local_ResNet_18,  epoch 139, local model 29, internal_epoch   2,  Average loss: 0.0031, Accuracy: 4092/4346 (94.1555%)
___Test Local_ResNet_18 poisoned: False, epoch: 139: Average loss: 1.7956, Accuracy: 5846/10000 (58.4600%)
time spent on training: 235.2145290374756
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 139: Average loss: 1.9280, Accuracy: 5663/10000 (56.6300%)
___Test Target_ResNet_18 poisoned: True, epoch: 139: Average loss: 8.7425, Accuracy: 176/9900 (1.7778%)
Done in 260.73757100105286 sec.
Server Epoch:140 choose agents : [13, 36, 58, 71, 61, 40, 57, 73, 60, 85, 41, 10, 17, 64, 62, 20, 76, 48, 96, 9].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 140, local model 13, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4473/4885 (91.5660%), train_poison_data_count: 385
Global model norm: 44.8292414465366.
Norm before scaling: 44.8219173224544. Distance: 2.12479478181721
Total norm for 4 adversaries is: 44.8219173224544. distance: 2.12479478181721
___Test Local_ResNet_18 poisoned: True, epoch: 140: Average loss: 0.0725, Accuracy: 9700/9900 (97.9798%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 140, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4791/5305 (90.3110%), train_poison_data_count: 415
Global model norm: 44.8292414465366.
Norm before scaling: 44.81853194454346. Distance: 2.2022351571409016
Total norm for 4 adversaries is: 44.81853194454346. distance: 2.2022351571409016
___Test Local_ResNet_18 poisoned: True, epoch: 140: Average loss: 0.1592, Accuracy: 9502/9900 (95.9798%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 140, local model 58, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4251/4717 (90.1208%), train_poison_data_count: 370
Global model norm: 44.8292414465366.
Norm before scaling: 44.819350396027325. Distance: 2.1076489203387334
Total norm for 4 adversaries is: 44.819350396027325. distance: 2.1076489203387334
___Test Local_ResNet_18 poisoned: True, epoch: 140: Average loss: 0.0487, Accuracy: 9758/9900 (98.5657%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 140, local model 71, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4566/5066 (90.1303%), train_poison_data_count: 400
Global model norm: 44.8292414465366.
Norm before scaling: 44.822999881303964. Distance: 2.197166989973642
Total norm for 4 adversaries is: 44.822999881303964. distance: 2.197166989973642
___Test Local_ResNet_18 poisoned: True, epoch: 140: Average loss: 0.2712, Accuracy: 9221/9900 (93.1414%)
___Train Local_ResNet_18,  epoch 140, local model 61, internal_epoch   1,  Average loss: 0.0052, Accuracy: 3715/4126 (90.0388%)
___Train Local_ResNet_18,  epoch 140, local model 61, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3806/4126 (92.2443%)
___Test Local_ResNet_18 poisoned: False, epoch: 140: Average loss: 1.7590, Accuracy: 5848/10000 (58.4800%)
___Train Local_ResNet_18,  epoch 140, local model 40, internal_epoch   1,  Average loss: 0.0041, Accuracy: 5008/5455 (91.8057%)
___Train Local_ResNet_18,  epoch 140, local model 40, internal_epoch   2,  Average loss: 0.0040, Accuracy: 5016/5455 (91.9523%)
___Test Local_ResNet_18 poisoned: False, epoch: 140: Average loss: 1.8571, Accuracy: 5678/10000 (56.7800%)
___Train Local_ResNet_18,  epoch 140, local model 57, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4090/4558 (89.7323%)
___Train Local_ResNet_18,  epoch 140, local model 57, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4076/4558 (89.4252%)
___Test Local_ResNet_18 poisoned: False, epoch: 140: Average loss: 2.0608, Accuracy: 5315/10000 (53.1500%)
___Train Local_ResNet_18,  epoch 140, local model 73, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3807/4235 (89.8937%)
___Train Local_ResNet_18,  epoch 140, local model 73, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3882/4235 (91.6647%)
___Test Local_ResNet_18 poisoned: False, epoch: 140: Average loss: 1.9255, Accuracy: 5631/10000 (56.3100%)
___Train Local_ResNet_18,  epoch 140, local model 60, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3391/3804 (89.1430%)
___Train Local_ResNet_18,  epoch 140, local model 60, internal_epoch   2,  Average loss: 0.0036, Accuracy: 3541/3804 (93.0862%)
___Test Local_ResNet_18 poisoned: False, epoch: 140: Average loss: 1.7932, Accuracy: 5827/10000 (58.2700%)
___Train Local_ResNet_18,  epoch 140, local model 85, internal_epoch   1,  Average loss: 0.0048, Accuracy: 5796/6391 (90.6900%)
___Train Local_ResNet_18,  epoch 140, local model 85, internal_epoch   2,  Average loss: 0.0048, Accuracy: 5797/6391 (90.7057%)
___Test Local_ResNet_18 poisoned: False, epoch: 140: Average loss: 2.0345, Accuracy: 5483/10000 (54.8300%)
___Train Local_ResNet_18,  epoch 140, local model 41, internal_epoch   1,  Average loss: 0.0051, Accuracy: 3909/4336 (90.1522%)
___Train Local_ResNet_18,  epoch 140, local model 41, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3984/4336 (91.8819%)
___Test Local_ResNet_18 poisoned: False, epoch: 140: Average loss: 1.9652, Accuracy: 5532/10000 (55.3200%)
___Train Local_ResNet_18,  epoch 140, local model 10, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4190/4663 (89.8563%)
___Train Local_ResNet_18,  epoch 140, local model 10, internal_epoch   2,  Average loss: 0.0035, Accuracy: 4357/4663 (93.4377%)
___Test Local_ResNet_18 poisoned: False, epoch: 140: Average loss: 1.9154, Accuracy: 5678/10000 (56.7800%)
___Train Local_ResNet_18,  epoch 140, local model 17, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4020/4511 (89.1155%)
___Train Local_ResNet_18,  epoch 140, local model 17, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4138/4511 (91.7313%)
___Test Local_ResNet_18 poisoned: False, epoch: 140: Average loss: 1.8551, Accuracy: 5552/10000 (55.5200%)
___Train Local_ResNet_18,  epoch 140, local model 64, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4029/4503 (89.4737%)
___Train Local_ResNet_18,  epoch 140, local model 64, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4090/4503 (90.8283%)
___Test Local_ResNet_18 poisoned: False, epoch: 140: Average loss: 1.9697, Accuracy: 5673/10000 (56.7300%)
___Train Local_ResNet_18,  epoch 140, local model 62, internal_epoch   1,  Average loss: 0.0049, Accuracy: 4570/5063 (90.2627%)
___Train Local_ResNet_18,  epoch 140, local model 62, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4488/5063 (88.6431%)
___Test Local_ResNet_18 poisoned: False, epoch: 140: Average loss: 2.1205, Accuracy: 5346/10000 (53.4600%)
___Train Local_ResNet_18,  epoch 140, local model 20, internal_epoch   1,  Average loss: 0.0046, Accuracy: 3927/4315 (91.0081%)
___Train Local_ResNet_18,  epoch 140, local model 20, internal_epoch   2,  Average loss: 0.0035, Accuracy: 4012/4315 (92.9780%)
___Test Local_ResNet_18 poisoned: False, epoch: 140: Average loss: 1.8688, Accuracy: 5756/10000 (57.5600%)
___Train Local_ResNet_18,  epoch 140, local model 76, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3225/3638 (88.6476%)
___Train Local_ResNet_18,  epoch 140, local model 76, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3362/3638 (92.4134%)
___Test Local_ResNet_18 poisoned: False, epoch: 140: Average loss: 1.8476, Accuracy: 5703/10000 (57.0300%)
___Train Local_ResNet_18,  epoch 140, local model 48, internal_epoch   1,  Average loss: 0.0042, Accuracy: 4082/4441 (91.9162%)
___Train Local_ResNet_18,  epoch 140, local model 48, internal_epoch   2,  Average loss: 0.0036, Accuracy: 4131/4441 (93.0196%)
___Test Local_ResNet_18 poisoned: False, epoch: 140: Average loss: 2.0115, Accuracy: 5554/10000 (55.5400%)
___Train Local_ResNet_18,  epoch 140, local model 96, internal_epoch   1,  Average loss: 0.0037, Accuracy: 4377/4679 (93.5456%)
___Train Local_ResNet_18,  epoch 140, local model 96, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4309/4679 (92.0923%)
___Test Local_ResNet_18 poisoned: False, epoch: 140: Average loss: 1.9170, Accuracy: 5560/10000 (55.6000%)
___Train Local_ResNet_18,  epoch 140, local model 9, internal_epoch   1,  Average loss: 0.0049, Accuracy: 4749/5265 (90.1994%)
___Train Local_ResNet_18,  epoch 140, local model 9, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4781/5265 (90.8072%)
___Test Local_ResNet_18 poisoned: False, epoch: 140: Average loss: 2.0060, Accuracy: 5540/10000 (55.4000%)
time spent on training: 237.65956687927246
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 140: Average loss: 1.8576, Accuracy: 5800/10000 (58.0000%)
___Test Target_ResNet_18 poisoned: True, epoch: 140: Average loss: 9.0616, Accuracy: 151/9900 (1.5253%)
Done in 263.17458319664 sec.
Server Epoch:141 choose agents : [13, 36, 58, 71, 41, 98, 87, 93, 97, 80, 53, 4, 88, 0, 15, 35, 14, 2, 57, 67].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 141, local model 13, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4421/4885 (90.5015%), train_poison_data_count: 385
Global model norm: 44.862497442271454.
Norm before scaling: 44.85451063185772. Distance: 2.1448648606703244
Total norm for 4 adversaries is: 44.85451063185772. distance: 2.1448648606703244
___Test Local_ResNet_18 poisoned: True, epoch: 141: Average loss: 0.1051, Accuracy: 9658/9900 (97.5556%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 141, local model 36, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4778/5305 (90.0660%), train_poison_data_count: 415
Global model norm: 44.862497442271454.
Norm before scaling: 44.85355538487515. Distance: 2.2311494393220634
Total norm for 4 adversaries is: 44.85355538487515. distance: 2.2311494393220634
___Test Local_ResNet_18 poisoned: True, epoch: 141: Average loss: 0.0969, Accuracy: 9636/9900 (97.3333%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 141, local model 58, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4283/4717 (90.7992%), train_poison_data_count: 370
Global model norm: 44.862497442271454.
Norm before scaling: 44.85182581898841. Distance: 2.0156100960113954
Total norm for 4 adversaries is: 44.85182581898841. distance: 2.0156100960113954
___Test Local_ResNet_18 poisoned: True, epoch: 141: Average loss: 0.2839, Accuracy: 9219/9900 (93.1212%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 141, local model 71, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4542/5066 (89.6565%), train_poison_data_count: 400
Global model norm: 44.862497442271454.
Norm before scaling: 44.85566724271374. Distance: 2.2061125066778353
Total norm for 4 adversaries is: 44.85566724271374. distance: 2.2061125066778353
___Test Local_ResNet_18 poisoned: True, epoch: 141: Average loss: 0.1826, Accuracy: 9426/9900 (95.2121%)
___Train Local_ResNet_18,  epoch 141, local model 41, internal_epoch   1,  Average loss: 0.0047, Accuracy: 3939/4336 (90.8441%)
___Train Local_ResNet_18,  epoch 141, local model 41, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4000/4336 (92.2509%)
___Test Local_ResNet_18 poisoned: False, epoch: 141: Average loss: 1.9156, Accuracy: 5600/10000 (56.0000%)
___Train Local_ResNet_18,  epoch 141, local model 98, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3405/3828 (88.9498%)
___Train Local_ResNet_18,  epoch 141, local model 98, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3547/3828 (92.6594%)
___Test Local_ResNet_18 poisoned: False, epoch: 141: Average loss: 1.7578, Accuracy: 5896/10000 (58.9600%)
___Train Local_ResNet_18,  epoch 141, local model 87, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3271/3672 (89.0795%)
___Train Local_ResNet_18,  epoch 141, local model 87, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3316/3672 (90.3050%)
___Test Local_ResNet_18 poisoned: False, epoch: 141: Average loss: 1.8837, Accuracy: 5716/10000 (57.1600%)
___Train Local_ResNet_18,  epoch 141, local model 93, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4130/4651 (88.7981%)
___Train Local_ResNet_18,  epoch 141, local model 93, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4242/4651 (91.2062%)
___Test Local_ResNet_18 poisoned: False, epoch: 141: Average loss: 1.9698, Accuracy: 5501/10000 (55.0100%)
___Train Local_ResNet_18,  epoch 141, local model 97, internal_epoch   1,  Average loss: 0.0049, Accuracy: 3953/4361 (90.6443%)
___Train Local_ResNet_18,  epoch 141, local model 97, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3972/4361 (91.0800%)
___Test Local_ResNet_18 poisoned: False, epoch: 141: Average loss: 1.9829, Accuracy: 5557/10000 (55.5700%)
___Train Local_ResNet_18,  epoch 141, local model 80, internal_epoch   1,  Average loss: 0.0049, Accuracy: 4553/5025 (90.6070%)
___Train Local_ResNet_18,  epoch 141, local model 80, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4644/5025 (92.4179%)
___Test Local_ResNet_18 poisoned: False, epoch: 141: Average loss: 1.9751, Accuracy: 5645/10000 (56.4500%)
___Train Local_ResNet_18,  epoch 141, local model 53, internal_epoch   1,  Average loss: 0.0046, Accuracy: 5576/6124 (91.0516%)
___Train Local_ResNet_18,  epoch 141, local model 53, internal_epoch   2,  Average loss: 0.0041, Accuracy: 5648/6124 (92.2273%)
___Test Local_ResNet_18 poisoned: False, epoch: 141: Average loss: 1.9861, Accuracy: 5514/10000 (55.1400%)
___Train Local_ResNet_18,  epoch 141, local model 4, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3277/3704 (88.4719%)
___Train Local_ResNet_18,  epoch 141, local model 4, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3409/3704 (92.0356%)
___Test Local_ResNet_18 poisoned: False, epoch: 141: Average loss: 1.8656, Accuracy: 5710/10000 (57.1000%)
___Train Local_ResNet_18,  epoch 141, local model 88, internal_epoch   1,  Average loss: 0.0041, Accuracy: 4584/4934 (92.9064%)
___Train Local_ResNet_18,  epoch 141, local model 88, internal_epoch   2,  Average loss: 0.0063, Accuracy: 4333/4934 (87.8192%)
___Test Local_ResNet_18 poisoned: False, epoch: 141: Average loss: 2.0928, Accuracy: 5307/10000 (53.0700%)
___Train Local_ResNet_18,  epoch 141, local model 0, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4524/5017 (90.1734%)
___Train Local_ResNet_18,  epoch 141, local model 0, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4598/5017 (91.6484%)
___Test Local_ResNet_18 poisoned: False, epoch: 141: Average loss: 1.8287, Accuracy: 5752/10000 (57.5200%)
___Train Local_ResNet_18,  epoch 141, local model 15, internal_epoch   1,  Average loss: 0.0051, Accuracy: 5036/5582 (90.2186%)
___Train Local_ResNet_18,  epoch 141, local model 15, internal_epoch   2,  Average loss: 0.0045, Accuracy: 5135/5582 (91.9921%)
___Test Local_ResNet_18 poisoned: False, epoch: 141: Average loss: 2.0520, Accuracy: 5476/10000 (54.7600%)
___Train Local_ResNet_18,  epoch 141, local model 35, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4599/5167 (89.0072%)
___Train Local_ResNet_18,  epoch 141, local model 35, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4706/5167 (91.0780%)
___Test Local_ResNet_18 poisoned: False, epoch: 141: Average loss: 2.1849, Accuracy: 5186/10000 (51.8600%)
___Train Local_ResNet_18,  epoch 141, local model 14, internal_epoch   1,  Average loss: 0.0052, Accuracy: 3465/3861 (89.7436%)
___Train Local_ResNet_18,  epoch 141, local model 14, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3517/3861 (91.0904%)
___Test Local_ResNet_18 poisoned: False, epoch: 141: Average loss: 1.9921, Accuracy: 5518/10000 (55.1800%)
___Train Local_ResNet_18,  epoch 141, local model 2, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3232/3646 (88.6451%)
___Train Local_ResNet_18,  epoch 141, local model 2, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3364/3646 (92.2655%)
___Test Local_ResNet_18 poisoned: False, epoch: 141: Average loss: 1.7331, Accuracy: 5903/10000 (59.0300%)
___Train Local_ResNet_18,  epoch 141, local model 57, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4087/4558 (89.6665%)
___Train Local_ResNet_18,  epoch 141, local model 57, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4126/4558 (90.5222%)
___Test Local_ResNet_18 poisoned: False, epoch: 141: Average loss: 1.9909, Accuracy: 5569/10000 (55.6900%)
___Train Local_ResNet_18,  epoch 141, local model 67, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4589/5116 (89.6990%)
___Train Local_ResNet_18,  epoch 141, local model 67, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4636/5116 (90.6177%)
___Test Local_ResNet_18 poisoned: False, epoch: 141: Average loss: 1.9142, Accuracy: 5586/10000 (55.8600%)
time spent on training: 237.72409057617188
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 141: Average loss: 1.8514, Accuracy: 5857/10000 (58.5700%)
___Test Target_ResNet_18 poisoned: True, epoch: 141: Average loss: 8.8968, Accuracy: 167/9900 (1.6869%)
Done in 263.44380736351013 sec.
Server Epoch:142 choose agents : [13, 36, 58, 71, 17, 29, 94, 22, 81, 63, 85, 37, 65, 39, 64, 43, 84, 21, 91, 38].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 142, local model 13, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4435/4885 (90.7881%), train_poison_data_count: 385
Global model norm: 44.89585251715561.
Norm before scaling: 44.88661115887593. Distance: 2.156389757132965
Total norm for 4 adversaries is: 44.88661115887593. distance: 2.156389757132965
___Test Local_ResNet_18 poisoned: True, epoch: 142: Average loss: 0.0195, Accuracy: 9846/9900 (99.4545%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 142, local model 36, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4816/5305 (90.7823%), train_poison_data_count: 415
Global model norm: 44.89585251715561.
Norm before scaling: 44.885323444776326. Distance: 2.2152380213928615
Total norm for 4 adversaries is: 44.885323444776326. distance: 2.2152380213928615
___Test Local_ResNet_18 poisoned: True, epoch: 142: Average loss: 0.1235, Accuracy: 9593/9900 (96.8990%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 142, local model 58, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4269/4717 (90.5024%), train_poison_data_count: 370
Global model norm: 44.89585251715561.
Norm before scaling: 44.88535608001442. Distance: 2.0688176354360976
Total norm for 4 adversaries is: 44.88535608001442. distance: 2.0688176354360976
___Test Local_ResNet_18 poisoned: True, epoch: 142: Average loss: 0.0956, Accuracy: 9656/9900 (97.5354%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 142, local model 71, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4543/5066 (89.6763%), train_poison_data_count: 400
Global model norm: 44.89585251715561.
Norm before scaling: 44.88905730598842. Distance: 2.223886910094936
Total norm for 4 adversaries is: 44.88905730598842. distance: 2.223886910094936
___Test Local_ResNet_18 poisoned: True, epoch: 142: Average loss: 0.2311, Accuracy: 9301/9900 (93.9495%)
___Train Local_ResNet_18,  epoch 142, local model 17, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3974/4511 (88.0958%)
___Train Local_ResNet_18,  epoch 142, local model 17, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4165/4511 (92.3299%)
___Test Local_ResNet_18 poisoned: False, epoch: 142: Average loss: 1.8750, Accuracy: 5696/10000 (56.9600%)
___Train Local_ResNet_18,  epoch 142, local model 29, internal_epoch   1,  Average loss: 0.0046, Accuracy: 3947/4346 (90.8191%)
___Train Local_ResNet_18,  epoch 142, local model 29, internal_epoch   2,  Average loss: 0.0033, Accuracy: 4078/4346 (93.8334%)
___Test Local_ResNet_18 poisoned: False, epoch: 142: Average loss: 1.8077, Accuracy: 5844/10000 (58.4400%)
___Train Local_ResNet_18,  epoch 142, local model 94, internal_epoch   1,  Average loss: 0.0033, Accuracy: 4539/4804 (94.4838%)
___Train Local_ResNet_18,  epoch 142, local model 94, internal_epoch   2,  Average loss: 0.0069, Accuracy: 4218/4804 (87.8018%)
___Test Local_ResNet_18 poisoned: False, epoch: 142: Average loss: 2.2420, Accuracy: 5225/10000 (52.2500%)
___Train Local_ResNet_18,  epoch 142, local model 22, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4596/5232 (87.8440%)
___Train Local_ResNet_18,  epoch 142, local model 22, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4727/5232 (90.3479%)
___Test Local_ResNet_18 poisoned: False, epoch: 142: Average loss: 1.9346, Accuracy: 5574/10000 (55.7400%)
___Train Local_ResNet_18,  epoch 142, local model 81, internal_epoch   1,  Average loss: 0.0049, Accuracy: 4169/4618 (90.2772%)
___Train Local_ResNet_18,  epoch 142, local model 81, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4204/4618 (91.0351%)
___Test Local_ResNet_18 poisoned: False, epoch: 142: Average loss: 1.9178, Accuracy: 5631/10000 (56.3100%)
___Train Local_ResNet_18,  epoch 142, local model 63, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3254/3590 (90.6407%)
___Train Local_ResNet_18,  epoch 142, local model 63, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3229/3590 (89.9443%)
___Test Local_ResNet_18 poisoned: False, epoch: 142: Average loss: 2.1227, Accuracy: 5436/10000 (54.3600%)
___Train Local_ResNet_18,  epoch 142, local model 85, internal_epoch   1,  Average loss: 0.0048, Accuracy: 5784/6391 (90.5023%)
___Train Local_ResNet_18,  epoch 142, local model 85, internal_epoch   2,  Average loss: 0.0048, Accuracy: 5777/6391 (90.3927%)
___Test Local_ResNet_18 poisoned: False, epoch: 142: Average loss: 1.9372, Accuracy: 5690/10000 (56.9000%)
___Train Local_ResNet_18,  epoch 142, local model 37, internal_epoch   1,  Average loss: 0.0030, Accuracy: 4178/4354 (95.9577%)
___Train Local_ResNet_18,  epoch 142, local model 37, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4011/4354 (92.1222%)
___Test Local_ResNet_18 poisoned: False, epoch: 142: Average loss: 2.3341, Accuracy: 5062/10000 (50.6200%)
___Train Local_ResNet_18,  epoch 142, local model 65, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4569/5055 (90.3858%)
___Train Local_ResNet_18,  epoch 142, local model 65, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4657/5055 (92.1266%)
___Test Local_ResNet_18 poisoned: False, epoch: 142: Average loss: 1.8655, Accuracy: 5728/10000 (57.2800%)
___Train Local_ResNet_18,  epoch 142, local model 39, internal_epoch   1,  Average loss: 0.0050, Accuracy: 3470/3837 (90.4352%)
___Train Local_ResNet_18,  epoch 142, local model 39, internal_epoch   2,  Average loss: 0.0038, Accuracy: 3557/3837 (92.7026%)
___Test Local_ResNet_18 poisoned: False, epoch: 142: Average loss: 1.9399, Accuracy: 5660/10000 (56.6000%)
___Train Local_ResNet_18,  epoch 142, local model 64, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4044/4503 (89.8068%)
___Train Local_ResNet_18,  epoch 142, local model 64, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4109/4503 (91.2503%)
___Test Local_ResNet_18 poisoned: False, epoch: 142: Average loss: 1.8851, Accuracy: 5838/10000 (58.3800%)
___Train Local_ResNet_18,  epoch 142, local model 43, internal_epoch   1,  Average loss: 0.0045, Accuracy: 4196/4576 (91.6958%)
___Train Local_ResNet_18,  epoch 142, local model 43, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4234/4576 (92.5262%)
___Test Local_ResNet_18 poisoned: False, epoch: 142: Average loss: 1.9164, Accuracy: 5733/10000 (57.3300%)
___Train Local_ResNet_18,  epoch 142, local model 84, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4238/4793 (88.4206%)
___Train Local_ResNet_18,  epoch 142, local model 84, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4400/4793 (91.8005%)
___Test Local_ResNet_18 poisoned: False, epoch: 142: Average loss: 2.0377, Accuracy: 5524/10000 (55.2400%)
___Train Local_ResNet_18,  epoch 142, local model 21, internal_epoch   1,  Average loss: 0.0050, Accuracy: 4186/4634 (90.3323%)
___Train Local_ResNet_18,  epoch 142, local model 21, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4264/4634 (92.0155%)
___Test Local_ResNet_18 poisoned: False, epoch: 142: Average loss: 1.7265, Accuracy: 5934/10000 (59.3400%)
___Train Local_ResNet_18,  epoch 142, local model 91, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3599/4158 (86.5560%)
___Train Local_ResNet_18,  epoch 142, local model 91, internal_epoch   2,  Average loss: 0.0056, Accuracy: 3697/4158 (88.9129%)
___Test Local_ResNet_18 poisoned: False, epoch: 142: Average loss: 2.0545, Accuracy: 5398/10000 (53.9800%)
___Train Local_ResNet_18,  epoch 142, local model 38, internal_epoch   1,  Average loss: 0.0046, Accuracy: 5225/5740 (91.0279%)
___Train Local_ResNet_18,  epoch 142, local model 38, internal_epoch   2,  Average loss: 0.0040, Accuracy: 5292/5740 (92.1951%)
___Test Local_ResNet_18 poisoned: False, epoch: 142: Average loss: 1.9642, Accuracy: 5545/10000 (55.4500%)
time spent on training: 239.7139492034912
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 142: Average loss: 1.9683, Accuracy: 5660/10000 (56.6000%)
___Test Target_ResNet_18 poisoned: True, epoch: 142: Average loss: 9.4190, Accuracy: 95/9900 (0.9596%)
Done in 264.98690581321716 sec.
Server Epoch:143 choose agents : [13, 36, 58, 71, 23, 92, 66, 6, 73, 27, 40, 45, 26, 9, 65, 94, 62, 75, 83, 89].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 143, local model 13, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4385/4885 (89.7646%), train_poison_data_count: 385
Global model norm: 44.93027910517305.
Norm before scaling: 44.92383691367952. Distance: 2.212917560033008
Total norm for 4 adversaries is: 44.92383691367952. distance: 2.212917560033008
___Test Local_ResNet_18 poisoned: True, epoch: 143: Average loss: 0.1069, Accuracy: 9624/9900 (97.2121%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 143, local model 36, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4768/5305 (89.8775%), train_poison_data_count: 415
Global model norm: 44.93027910517305.
Norm before scaling: 44.92094700128424. Distance: 2.2633058451171064
Total norm for 4 adversaries is: 44.92094700128424. distance: 2.2633058451171064
___Test Local_ResNet_18 poisoned: True, epoch: 143: Average loss: 0.0847, Accuracy: 9676/9900 (97.7374%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 143, local model 58, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4241/4717 (89.9088%), train_poison_data_count: 370
Global model norm: 44.93027910517305.
Norm before scaling: 44.92051492506305. Distance: 2.103441270737873
Total norm for 4 adversaries is: 44.92051492506305. distance: 2.103441270737873
___Test Local_ResNet_18 poisoned: True, epoch: 143: Average loss: 0.2859, Accuracy: 9146/9900 (92.3838%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 143, local model 71, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4508/5066 (88.9854%), train_poison_data_count: 400
Global model norm: 44.93027910517305.
Norm before scaling: 44.92576341866658. Distance: 2.236930186424142
Total norm for 4 adversaries is: 44.92576341866658. distance: 2.236930186424142
___Test Local_ResNet_18 poisoned: True, epoch: 143: Average loss: 0.4462, Accuracy: 8786/9900 (88.7475%)
___Train Local_ResNet_18,  epoch 143, local model 23, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3736/4184 (89.2925%)
___Train Local_ResNet_18,  epoch 143, local model 23, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3821/4184 (91.3241%)
___Test Local_ResNet_18 poisoned: False, epoch: 143: Average loss: 1.9174, Accuracy: 5620/10000 (56.2000%)
___Train Local_ResNet_18,  epoch 143, local model 92, internal_epoch   1,  Average loss: 0.0050, Accuracy: 5662/6263 (90.4040%)
___Train Local_ResNet_18,  epoch 143, local model 92, internal_epoch   2,  Average loss: 0.0043, Accuracy: 5725/6263 (91.4099%)
___Test Local_ResNet_18 poisoned: False, epoch: 143: Average loss: 2.1587, Accuracy: 5327/10000 (53.2700%)
___Train Local_ResNet_18,  epoch 143, local model 66, internal_epoch   1,  Average loss: 0.0049, Accuracy: 4038/4456 (90.6194%)
___Train Local_ResNet_18,  epoch 143, local model 66, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4117/4456 (92.3923%)
___Test Local_ResNet_18 poisoned: False, epoch: 143: Average loss: 1.9786, Accuracy: 5543/10000 (55.4300%)
___Train Local_ResNet_18,  epoch 143, local model 6, internal_epoch   1,  Average loss: 0.0048, Accuracy: 4108/4538 (90.5245%)
___Train Local_ResNet_18,  epoch 143, local model 6, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4210/4538 (92.7721%)
___Test Local_ResNet_18 poisoned: False, epoch: 143: Average loss: 1.8971, Accuracy: 5721/10000 (57.2100%)
___Train Local_ResNet_18,  epoch 143, local model 73, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3809/4235 (89.9410%)
___Train Local_ResNet_18,  epoch 143, local model 73, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3802/4235 (89.7757%)
___Test Local_ResNet_18 poisoned: False, epoch: 143: Average loss: 2.0199, Accuracy: 5573/10000 (55.7300%)
___Train Local_ResNet_18,  epoch 143, local model 27, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3748/4223 (88.7521%)
___Train Local_ResNet_18,  epoch 143, local model 27, internal_epoch   2,  Average loss: 0.0038, Accuracy: 3912/4223 (92.6356%)
___Test Local_ResNet_18 poisoned: False, epoch: 143: Average loss: 1.8386, Accuracy: 5682/10000 (56.8200%)
___Train Local_ResNet_18,  epoch 143, local model 40, internal_epoch   1,  Average loss: 0.0045, Accuracy: 4948/5455 (90.7058%)
___Train Local_ResNet_18,  epoch 143, local model 40, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4934/5455 (90.4491%)
___Test Local_ResNet_18 poisoned: False, epoch: 143: Average loss: 1.8717, Accuracy: 5574/10000 (55.7400%)
___Train Local_ResNet_18,  epoch 143, local model 45, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4394/5037 (87.2345%)
___Train Local_ResNet_18,  epoch 143, local model 45, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4576/5037 (90.8477%)
___Test Local_ResNet_18 poisoned: False, epoch: 143: Average loss: 2.0053, Accuracy: 5458/10000 (54.5800%)
___Train Local_ResNet_18,  epoch 143, local model 26, internal_epoch   1,  Average loss: 0.0048, Accuracy: 3405/3756 (90.6550%)
___Train Local_ResNet_18,  epoch 143, local model 26, internal_epoch   2,  Average loss: 0.0034, Accuracy: 3510/3756 (93.4505%)
___Test Local_ResNet_18 poisoned: False, epoch: 143: Average loss: 1.8763, Accuracy: 5788/10000 (57.8800%)
___Train Local_ResNet_18,  epoch 143, local model 9, internal_epoch   1,  Average loss: 0.0052, Accuracy: 4745/5265 (90.1235%)
___Train Local_ResNet_18,  epoch 143, local model 9, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4763/5265 (90.4653%)
___Test Local_ResNet_18 poisoned: False, epoch: 143: Average loss: 1.8792, Accuracy: 5745/10000 (57.4500%)
___Train Local_ResNet_18,  epoch 143, local model 65, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4503/5055 (89.0801%)
___Train Local_ResNet_18,  epoch 143, local model 65, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4582/5055 (90.6429%)
___Test Local_ResNet_18 poisoned: False, epoch: 143: Average loss: 2.1280, Accuracy: 5349/10000 (53.4900%)
___Train Local_ResNet_18,  epoch 143, local model 94, internal_epoch   1,  Average loss: 0.0028, Accuracy: 4588/4804 (95.5037%)
___Train Local_ResNet_18,  epoch 143, local model 94, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4431/4804 (92.2356%)
___Test Local_ResNet_18 poisoned: False, epoch: 143: Average loss: 2.1550, Accuracy: 5419/10000 (54.1900%)
___Train Local_ResNet_18,  epoch 143, local model 62, internal_epoch   1,  Average loss: 0.0040, Accuracy: 4662/5063 (92.0798%)
___Train Local_ResNet_18,  epoch 143, local model 62, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4541/5063 (89.6899%)
___Test Local_ResNet_18 poisoned: False, epoch: 143: Average loss: 1.9656, Accuracy: 5552/10000 (55.5200%)
___Train Local_ResNet_18,  epoch 143, local model 75, internal_epoch   1,  Average loss: 0.0047, Accuracy: 3909/4295 (91.0128%)
___Train Local_ResNet_18,  epoch 143, local model 75, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3940/4295 (91.7346%)
___Test Local_ResNet_18 poisoned: False, epoch: 143: Average loss: 1.7951, Accuracy: 5844/10000 (58.4400%)
___Train Local_ResNet_18,  epoch 143, local model 83, internal_epoch   1,  Average loss: 0.0054, Accuracy: 2951/3271 (90.2171%)
___Train Local_ResNet_18,  epoch 143, local model 83, internal_epoch   2,  Average loss: 0.0057, Accuracy: 2898/3271 (88.5968%)
___Test Local_ResNet_18 poisoned: False, epoch: 143: Average loss: 1.9198, Accuracy: 5633/10000 (56.3300%)
___Train Local_ResNet_18,  epoch 143, local model 89, internal_epoch   1,  Average loss: 0.0033, Accuracy: 4096/4356 (94.0312%)
___Train Local_ResNet_18,  epoch 143, local model 89, internal_epoch   2,  Average loss: 0.0026, Accuracy: 4174/4356 (95.8219%)
___Test Local_ResNet_18 poisoned: False, epoch: 143: Average loss: 1.8853, Accuracy: 5730/10000 (57.3000%)
time spent on training: 238.15694379806519
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
Client 19 misclassified the most to class 13 with 1 misclassifications.
Client 19 assigned a score of 1.
Current susp_pair_clients: defaultdict(<class 'int'>, {19: 1})
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: [(19, 1)]
Top 3 clients: [(19, 1)]
Client 19 misclassification ratio: 1.0000
Client 19 ranked 1 with score 1. Assigned small weight: 0.001
Suspicious pairs analyzed across clients.
