current path: saved_models/model_cifar100_Dec.05_09.43.54_CerP_mkrum_0.0001_0.0001
Loading data
build_classes_dict done
train loaders done
get poison test loader
load data done
Loaded parameters from saved model: LR is 0.01 and current epoch is 71
create model done
Poisoned following participants: [13, 36, 58, 71]
We use following environment for graphs:  cifar100_CerP
Server Epoch:71 choose agents : [13, 36, 58, 71, 89, 99, 77, 65, 67, 61, 30, 1, 69, 81, 12, 17, 52, 15, 86, 40].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  71, local model 13, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4309/4885 (88.2088%), train_poison_data_count: 385
Global model norm: 42.432124970265015.
Norm before scaling: 42.44006717428488. Distance: 2.295586672327145
Total norm for 4 adversaries is: 42.44006717428488. distance: 2.295586672327145
___Test Local_ResNet_18 poisoned: True, epoch: 71: Average loss: 0.4415, Accuracy: 8840/9900 (89.2929%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  71, local model 36, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4737/5305 (89.2931%), train_poison_data_count: 415
Global model norm: 42.432124970265015.
Norm before scaling: 42.43537567170152. Distance: 2.251661746652434
Total norm for 4 adversaries is: 42.43537567170152. distance: 2.251661746652434
___Test Local_ResNet_18 poisoned: True, epoch: 71: Average loss: 0.7277, Accuracy: 8311/9900 (83.9495%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  71, local model 58, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4179/4717 (88.5944%), train_poison_data_count: 370
Global model norm: 42.432124970265015.
Norm before scaling: 42.438646258911966. Distance: 2.1782338754159345
Total norm for 4 adversaries is: 42.438646258911966. distance: 2.1782338754159345
___Test Local_ResNet_18 poisoned: True, epoch: 71: Average loss: 0.4304, Accuracy: 8877/9900 (89.6667%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  71, local model 71, internal_epoch   1,  Average loss: 0.0074, Accuracy: 4457/5066 (87.9787%), train_poison_data_count: 400
Global model norm: 42.432124970265015.
Norm before scaling: 42.44033898364709. Distance: 2.303273740440089
Total norm for 4 adversaries is: 42.44033898364709. distance: 2.303273740440089
___Test Local_ResNet_18 poisoned: True, epoch: 71: Average loss: 0.6076, Accuracy: 8492/9900 (85.7778%)
___Train Local_ResNet_18,  epoch  71, local model 89, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3840/4356 (88.1543%)
___Train Local_ResNet_18,  epoch  71, local model 89, internal_epoch   2,  Average loss: 0.0082, Accuracy: 3667/4356 (84.1827%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.4886, Accuracy: 4624/10000 (46.2400%)
___Train Local_ResNet_18,  epoch  71, local model 99, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3938/4465 (88.1971%)
___Train Local_ResNet_18,  epoch  71, local model 99, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4088/4465 (91.5566%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.0425, Accuracy: 5496/10000 (54.9600%)
___Train Local_ResNet_18,  epoch  71, local model 77, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4045/4647 (87.0454%)
___Train Local_ResNet_18,  epoch  71, local model 77, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4177/4647 (89.8859%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 1.9727, Accuracy: 5455/10000 (54.5500%)
___Train Local_ResNet_18,  epoch  71, local model 65, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4448/5055 (87.9921%)
___Train Local_ResNet_18,  epoch  71, local model 65, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4526/5055 (89.5351%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.1294, Accuracy: 5264/10000 (52.6400%)
___Train Local_ResNet_18,  epoch  71, local model 67, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4443/5116 (86.8452%)
___Train Local_ResNet_18,  epoch  71, local model 67, internal_epoch   2,  Average loss: 0.0067, Accuracy: 4442/5116 (86.8256%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.0275, Accuracy: 5253/10000 (52.5300%)
___Train Local_ResNet_18,  epoch  71, local model 61, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3631/4126 (88.0029%)
___Train Local_ResNet_18,  epoch  71, local model 61, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3754/4126 (90.9840%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 1.9696, Accuracy: 5479/10000 (54.7900%)
___Train Local_ResNet_18,  epoch  71, local model 30, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3080/3472 (88.7097%)
___Train Local_ResNet_18,  epoch  71, local model 30, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3217/3472 (92.6555%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.0722, Accuracy: 5474/10000 (54.7400%)
___Train Local_ResNet_18,  epoch  71, local model 1, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4429/4986 (88.8287%)
___Train Local_ResNet_18,  epoch  71, local model 1, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4447/4986 (89.1897%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.1008, Accuracy: 5401/10000 (54.0100%)
___Train Local_ResNet_18,  epoch  71, local model 69, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3537/4013 (88.1385%)
___Train Local_ResNet_18,  epoch  71, local model 69, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3676/4013 (91.6023%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 1.8136, Accuracy: 5731/10000 (57.3100%)
___Train Local_ResNet_18,  epoch  71, local model 81, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4040/4618 (87.4838%)
___Train Local_ResNet_18,  epoch  71, local model 81, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4095/4618 (88.6748%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.0568, Accuracy: 5382/10000 (53.8200%)
___Train Local_ResNet_18,  epoch  71, local model 12, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4431/5083 (87.1729%)
___Train Local_ResNet_18,  epoch  71, local model 12, internal_epoch   2,  Average loss: 0.0064, Accuracy: 4448/5083 (87.5074%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.0431, Accuracy: 5356/10000 (53.5600%)
___Train Local_ResNet_18,  epoch  71, local model 17, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3972/4511 (88.0514%)
___Train Local_ResNet_18,  epoch  71, local model 17, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4049/4511 (89.7584%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.2162, Accuracy: 5064/10000 (50.6400%)
___Train Local_ResNet_18,  epoch  71, local model 52, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3338/3797 (87.9115%)
___Train Local_ResNet_18,  epoch  71, local model 52, internal_epoch   2,  Average loss: 0.0055, Accuracy: 3380/3797 (89.0176%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 1.9955, Accuracy: 5425/10000 (54.2500%)
___Train Local_ResNet_18,  epoch  71, local model 15, internal_epoch   1,  Average loss: 0.0055, Accuracy: 5004/5582 (89.6453%)
___Train Local_ResNet_18,  epoch  71, local model 15, internal_epoch   2,  Average loss: 0.0047, Accuracy: 5059/5582 (90.6306%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.1067, Accuracy: 5292/10000 (52.9200%)
___Train Local_ResNet_18,  epoch  71, local model 86, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3152/3616 (87.1681%)
___Train Local_ResNet_18,  epoch  71, local model 86, internal_epoch   2,  Average loss: 0.0056, Accuracy: 3204/3616 (88.6062%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 2.1079, Accuracy: 5366/10000 (53.6600%)
___Train Local_ResNet_18,  epoch  71, local model 40, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4825/5455 (88.4510%)
___Train Local_ResNet_18,  epoch  71, local model 40, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4850/5455 (88.9093%)
___Test Local_ResNet_18 poisoned: False, epoch: 71: Average loss: 1.9214, Accuracy: 5409/10000 (54.0900%)
time spent on training: 266.0488033294678
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 71: Average loss: 1.1674, Accuracy: 6953/10000 (69.5300%)
___Test Target_ResNet_18 poisoned: True, epoch: 71: Average loss: 9.8902, Accuracy: 59/9900 (0.5960%)
Done in 297.0340702533722 sec.
Server Epoch:72 choose agents : [13, 36, 58, 71, 78, 52, 95, 7, 20, 73, 98, 74, 76, 9, 79, 48, 33, 12, 16, 84].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  72, local model 13, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4382/4885 (89.7032%), train_poison_data_count: 385
Global model norm: 42.46583386557289.
Norm before scaling: 42.47298658964013. Distance: 2.1617646394800585
Total norm for 4 adversaries is: 42.47298658964013. distance: 2.1617646394800585
___Test Local_ResNet_18 poisoned: True, epoch: 72: Average loss: 0.1874, Accuracy: 9404/9900 (94.9899%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  72, local model 36, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4748/5305 (89.5005%), train_poison_data_count: 415
Global model norm: 42.46583386557289.
Norm before scaling: 42.4691437849661. Distance: 2.2128455888924474
Total norm for 4 adversaries is: 42.4691437849661. distance: 2.2128455888924474
___Test Local_ResNet_18 poisoned: True, epoch: 72: Average loss: 0.4175, Accuracy: 8883/9900 (89.7273%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  72, local model 58, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4166/4717 (88.3188%), train_poison_data_count: 370
Global model norm: 42.46583386557289.
Norm before scaling: 42.473396142559785. Distance: 2.2063209673568656
Total norm for 4 adversaries is: 42.473396142559785. distance: 2.2063209673568656
___Test Local_ResNet_18 poisoned: True, epoch: 72: Average loss: 0.2120, Accuracy: 9373/9900 (94.6768%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  72, local model 71, internal_epoch   1,  Average loss: 0.0073, Accuracy: 4470/5066 (88.2353%), train_poison_data_count: 400
Global model norm: 42.46583386557289.
Norm before scaling: 42.476604888934155. Distance: 2.351374621822754
Total norm for 4 adversaries is: 42.476604888934155. distance: 2.351374621822754
___Test Local_ResNet_18 poisoned: True, epoch: 72: Average loss: 0.1851, Accuracy: 9387/9900 (94.8182%)
___Train Local_ResNet_18,  epoch  72, local model 78, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3591/4025 (89.2174%)
___Train Local_ResNet_18,  epoch  72, local model 78, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3710/4025 (92.1739%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 1.8539, Accuracy: 5604/10000 (56.0400%)
___Train Local_ResNet_18,  epoch  72, local model 52, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3321/3797 (87.4638%)
___Train Local_ResNet_18,  epoch  72, local model 52, internal_epoch   2,  Average loss: 0.0057, Accuracy: 3403/3797 (89.6234%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.0777, Accuracy: 5310/10000 (53.1000%)
___Train Local_ResNet_18,  epoch  72, local model 95, internal_epoch   1,  Average loss: 0.0077, Accuracy: 3928/4625 (84.9297%)
___Train Local_ResNet_18,  epoch  72, local model 95, internal_epoch   2,  Average loss: 0.0064, Accuracy: 4043/4625 (87.4162%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.1634, Accuracy: 5285/10000 (52.8500%)
___Train Local_ResNet_18,  epoch  72, local model 7, internal_epoch   1,  Average loss: 0.0081, Accuracy: 3860/4481 (86.1415%)
___Train Local_ResNet_18,  epoch  72, local model 7, internal_epoch   2,  Average loss: 0.0079, Accuracy: 3897/4481 (86.9672%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.1498, Accuracy: 5265/10000 (52.6500%)
___Train Local_ResNet_18,  epoch  72, local model 20, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3832/4315 (88.8065%)
___Train Local_ResNet_18,  epoch  72, local model 20, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3962/4315 (91.8192%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.0011, Accuracy: 5508/10000 (55.0800%)
___Train Local_ResNet_18,  epoch  72, local model 73, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3706/4235 (87.5089%)
___Train Local_ResNet_18,  epoch  72, local model 73, internal_epoch   2,  Average loss: 0.0055, Accuracy: 3803/4235 (89.7993%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.0898, Accuracy: 5422/10000 (54.2200%)
___Train Local_ResNet_18,  epoch  72, local model 98, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3378/3828 (88.2445%)
___Train Local_ResNet_18,  epoch  72, local model 98, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3487/3828 (91.0920%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 1.9512, Accuracy: 5445/10000 (54.4500%)
___Train Local_ResNet_18,  epoch  72, local model 74, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3825/4416 (86.6168%)
___Train Local_ResNet_18,  epoch  72, local model 74, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3939/4416 (89.1984%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 1.9140, Accuracy: 5553/10000 (55.5300%)
___Train Local_ResNet_18,  epoch  72, local model 76, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3160/3638 (86.8609%)
___Train Local_ResNet_18,  epoch  72, local model 76, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3278/3638 (90.1045%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 1.9897, Accuracy: 5465/10000 (54.6500%)
___Train Local_ResNet_18,  epoch  72, local model 9, internal_epoch   1,  Average loss: 0.0072, Accuracy: 4542/5265 (86.2678%)
___Train Local_ResNet_18,  epoch  72, local model 9, internal_epoch   2,  Average loss: 0.0072, Accuracy: 4496/5265 (85.3941%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 1.9714, Accuracy: 5436/10000 (54.3600%)
___Train Local_ResNet_18,  epoch  72, local model 79, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3356/3781 (88.7596%)
___Train Local_ResNet_18,  epoch  72, local model 79, internal_epoch   2,  Average loss: 0.0066, Accuracy: 3332/3781 (88.1248%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.2493, Accuracy: 5147/10000 (51.4700%)
___Train Local_ResNet_18,  epoch  72, local model 48, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3961/4441 (89.1916%)
___Train Local_ResNet_18,  epoch  72, local model 48, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3990/4441 (89.8446%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 2.1611, Accuracy: 5264/10000 (52.6400%)
___Train Local_ResNet_18,  epoch  72, local model 33, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3969/4433 (89.5330%)
___Train Local_ResNet_18,  epoch  72, local model 33, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3997/4433 (90.1647%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 1.9520, Accuracy: 5482/10000 (54.8200%)
___Train Local_ResNet_18,  epoch  72, local model 12, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4401/5083 (86.5827%)
___Train Local_ResNet_18,  epoch  72, local model 12, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4493/5083 (88.3927%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 1.9718, Accuracy: 5374/10000 (53.7400%)
___Train Local_ResNet_18,  epoch  72, local model 16, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4290/4928 (87.0536%)
___Train Local_ResNet_18,  epoch  72, local model 16, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4405/4928 (89.3872%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 1.8893, Accuracy: 5644/10000 (56.4400%)
___Train Local_ResNet_18,  epoch  72, local model 84, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4143/4793 (86.4386%)
___Train Local_ResNet_18,  epoch  72, local model 84, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4343/4793 (90.6113%)
___Test Local_ResNet_18 poisoned: False, epoch: 72: Average loss: 1.9487, Accuracy: 5485/10000 (54.8500%)
time spent on training: 262.01221323013306
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 72: Average loss: 1.1753, Accuracy: 6950/10000 (69.5000%)
___Test Target_ResNet_18 poisoned: True, epoch: 72: Average loss: 9.5212, Accuracy: 69/9900 (0.6970%)
Done in 292.6424124240875 sec.
Server Epoch:73 choose agents : [13, 36, 58, 71, 86, 39, 96, 76, 59, 34, 52, 80, 90, 57, 87, 82, 78, 10, 18, 0].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  73, local model 13, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4415/4885 (90.3787%), train_poison_data_count: 385
Global model norm: 42.508954709199216.
Norm before scaling: 42.50963671765718. Distance: 2.1058070772640294
Total norm for 4 adversaries is: 42.50963671765718. distance: 2.1058070772640294
___Test Local_ResNet_18 poisoned: True, epoch: 73: Average loss: 0.2128, Accuracy: 9339/9900 (94.3333%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  73, local model 36, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4733/5305 (89.2177%), train_poison_data_count: 415
Global model norm: 42.508954709199216.
Norm before scaling: 42.51308679486971. Distance: 2.203215035837543
Total norm for 4 adversaries is: 42.51308679486971. distance: 2.203215035837543
___Test Local_ResNet_18 poisoned: True, epoch: 73: Average loss: 0.0856, Accuracy: 9664/9900 (97.6162%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  73, local model 58, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4209/4717 (89.2304%), train_poison_data_count: 370
Global model norm: 42.508954709199216.
Norm before scaling: 42.512134928875746. Distance: 2.0861911119454764
Total norm for 4 adversaries is: 42.512134928875746. distance: 2.0861911119454764
___Test Local_ResNet_18 poisoned: True, epoch: 73: Average loss: 0.2059, Accuracy: 9345/9900 (94.3939%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  73, local model 71, internal_epoch   1,  Average loss: 0.0072, Accuracy: 4476/5066 (88.3537%), train_poison_data_count: 400
Global model norm: 42.508954709199216.
Norm before scaling: 42.51394101543707. Distance: 2.239980215938938
Total norm for 4 adversaries is: 42.51394101543707. distance: 2.239980215938938
___Test Local_ResNet_18 poisoned: True, epoch: 73: Average loss: 0.1767, Accuracy: 9435/9900 (95.3030%)
___Train Local_ResNet_18,  epoch  73, local model 86, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3127/3616 (86.4768%)
___Train Local_ResNet_18,  epoch  73, local model 86, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3265/3616 (90.2931%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 1.8503, Accuracy: 5714/10000 (57.1400%)
___Train Local_ResNet_18,  epoch  73, local model 39, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3400/3837 (88.6109%)
___Train Local_ResNet_18,  epoch  73, local model 39, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3509/3837 (91.4517%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 1.9035, Accuracy: 5579/10000 (55.7900%)
___Train Local_ResNet_18,  epoch  73, local model 96, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4138/4679 (88.4377%)
___Train Local_ResNet_18,  epoch  73, local model 96, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4247/4679 (90.7673%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 1.9269, Accuracy: 5590/10000 (55.9000%)
___Train Local_ResNet_18,  epoch  73, local model 76, internal_epoch   1,  Average loss: 0.0073, Accuracy: 3095/3638 (85.0742%)
___Train Local_ResNet_18,  epoch  73, local model 76, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3268/3638 (89.8296%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.0650, Accuracy: 5267/10000 (52.6700%)
___Train Local_ResNet_18,  epoch  73, local model 59, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3610/4046 (89.2239%)
___Train Local_ResNet_18,  epoch  73, local model 59, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3637/4046 (89.8913%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.0047, Accuracy: 5392/10000 (53.9200%)
___Train Local_ResNet_18,  epoch  73, local model 34, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3953/4518 (87.4945%)
___Train Local_ResNet_18,  epoch  73, local model 34, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4078/4518 (90.2612%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.1553, Accuracy: 5062/10000 (50.6200%)
___Train Local_ResNet_18,  epoch  73, local model 52, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3372/3797 (88.8070%)
___Train Local_ResNet_18,  epoch  73, local model 52, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3408/3797 (89.7551%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.1192, Accuracy: 5318/10000 (53.1800%)
___Train Local_ResNet_18,  epoch  73, local model 80, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4410/5025 (87.7612%)
___Train Local_ResNet_18,  epoch  73, local model 80, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4459/5025 (88.7363%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.2889, Accuracy: 5159/10000 (51.5900%)
___Train Local_ResNet_18,  epoch  73, local model 90, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3897/4362 (89.3398%)
___Train Local_ResNet_18,  epoch  73, local model 90, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3917/4362 (89.7983%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.1996, Accuracy: 5138/10000 (51.3800%)
___Train Local_ResNet_18,  epoch  73, local model 57, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3965/4558 (86.9899%)
___Train Local_ResNet_18,  epoch  73, local model 57, internal_epoch   2,  Average loss: 0.0062, Accuracy: 3992/4558 (87.5823%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.1305, Accuracy: 5154/10000 (51.5400%)
___Train Local_ResNet_18,  epoch  73, local model 87, internal_epoch   1,  Average loss: 0.0071, Accuracy: 3169/3672 (86.3017%)
___Train Local_ResNet_18,  epoch  73, local model 87, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3259/3672 (88.7527%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.0168, Accuracy: 5406/10000 (54.0600%)
___Train Local_ResNet_18,  epoch  73, local model 82, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4311/4874 (88.4489%)
___Train Local_ResNet_18,  epoch  73, local model 82, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4347/4874 (89.1875%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.1240, Accuracy: 5316/10000 (53.1600%)
___Train Local_ResNet_18,  epoch  73, local model 78, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3596/4025 (89.3416%)
___Train Local_ResNet_18,  epoch  73, local model 78, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3670/4025 (91.1801%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 1.9248, Accuracy: 5633/10000 (56.3300%)
___Train Local_ResNet_18,  epoch  73, local model 10, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4090/4663 (87.7118%)
___Train Local_ResNet_18,  epoch  73, local model 10, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4244/4663 (91.0144%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.0817, Accuracy: 5222/10000 (52.2200%)
___Train Local_ResNet_18,  epoch  73, local model 18, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3439/3911 (87.9315%)
___Train Local_ResNet_18,  epoch  73, local model 18, internal_epoch   2,  Average loss: 0.0066, Accuracy: 3441/3911 (87.9826%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 2.0285, Accuracy: 5277/10000 (52.7700%)
___Train Local_ResNet_18,  epoch  73, local model 0, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4400/5017 (87.7018%)
___Train Local_ResNet_18,  epoch  73, local model 0, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4520/5017 (90.0937%)
___Test Local_ResNet_18 poisoned: False, epoch: 73: Average loss: 1.8483, Accuracy: 5627/10000 (56.2700%)
time spent on training: 262.3137061595917
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 73: Average loss: 1.2086, Accuracy: 6843/10000 (68.4300%)
___Test Target_ResNet_18 poisoned: True, epoch: 73: Average loss: 9.5018, Accuracy: 49/9900 (0.4949%)
Done in 293.87428069114685 sec.
Server Epoch:74 choose agents : [13, 36, 58, 71, 53, 55, 91, 40, 17, 22, 11, 3, 61, 19, 27, 54, 96, 2, 86, 28].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  74, local model 13, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4388/4885 (89.8260%), train_poison_data_count: 385
Global model norm: 42.53932865504432.
Norm before scaling: 42.54265437659303. Distance: 2.1064717976864165
Total norm for 4 adversaries is: 42.54265437659303. distance: 2.1064717976864165
___Test Local_ResNet_18 poisoned: True, epoch: 74: Average loss: 0.6009, Accuracy: 8570/9900 (86.5657%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  74, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4762/5305 (89.7644%), train_poison_data_count: 415
Global model norm: 42.53932865504432.
Norm before scaling: 42.53993700317826. Distance: 2.1718126466431538
Total norm for 4 adversaries is: 42.53993700317826. distance: 2.1718126466431538
___Test Local_ResNet_18 poisoned: True, epoch: 74: Average loss: 0.1001, Accuracy: 9632/9900 (97.2929%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  74, local model 58, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4218/4717 (89.4212%), train_poison_data_count: 370
Global model norm: 42.53932865504432.
Norm before scaling: 42.542086238952834. Distance: 2.091868109963829
Total norm for 4 adversaries is: 42.542086238952834. distance: 2.091868109963829
___Test Local_ResNet_18 poisoned: True, epoch: 74: Average loss: 0.1827, Accuracy: 9422/9900 (95.1717%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  74, local model 71, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4484/5066 (88.5116%), train_poison_data_count: 400
Global model norm: 42.53932865504432.
Norm before scaling: 42.54505453092125. Distance: 2.2588136558661693
Total norm for 4 adversaries is: 42.54505453092125. distance: 2.2588136558661693
___Test Local_ResNet_18 poisoned: True, epoch: 74: Average loss: 0.3294, Accuracy: 9064/9900 (91.5556%)
___Train Local_ResNet_18,  epoch  74, local model 53, internal_epoch   1,  Average loss: 0.0072, Accuracy: 5263/6124 (85.9406%)
___Train Local_ResNet_18,  epoch  74, local model 53, internal_epoch   2,  Average loss: 0.0064, Accuracy: 5336/6124 (87.1326%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.1199, Accuracy: 5117/10000 (51.1700%)
___Train Local_ResNet_18,  epoch  74, local model 55, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3871/4356 (88.8659%)
___Train Local_ResNet_18,  epoch  74, local model 55, internal_epoch   2,  Average loss: 0.0100, Accuracy: 3577/4356 (82.1166%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.2404, Accuracy: 4992/10000 (49.9200%)
___Train Local_ResNet_18,  epoch  74, local model 91, internal_epoch   1,  Average loss: 0.0081, Accuracy: 3509/4158 (84.3915%)
___Train Local_ResNet_18,  epoch  74, local model 91, internal_epoch   2,  Average loss: 0.0069, Accuracy: 3587/4158 (86.2674%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.1153, Accuracy: 5109/10000 (51.0900%)
___Train Local_ResNet_18,  epoch  74, local model 40, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4844/5455 (88.7993%)
___Train Local_ResNet_18,  epoch  74, local model 40, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4913/5455 (90.0642%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 1.9065, Accuracy: 5525/10000 (55.2500%)
___Train Local_ResNet_18,  epoch  74, local model 17, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3908/4511 (86.6327%)
___Train Local_ResNet_18,  epoch  74, local model 17, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4060/4511 (90.0022%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.0428, Accuracy: 5271/10000 (52.7100%)
___Train Local_ResNet_18,  epoch  74, local model 22, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4513/5232 (86.2576%)
___Train Local_ResNet_18,  epoch  74, local model 22, internal_epoch   2,  Average loss: 0.0064, Accuracy: 4552/5232 (87.0031%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.0604, Accuracy: 5410/10000 (54.1000%)
___Train Local_ResNet_18,  epoch  74, local model 11, internal_epoch   1,  Average loss: 0.0074, Accuracy: 4498/5244 (85.7742%)
___Train Local_ResNet_18,  epoch  74, local model 11, internal_epoch   2,  Average loss: 0.0068, Accuracy: 4538/5244 (86.5370%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.1191, Accuracy: 5328/10000 (53.2800%)
___Train Local_ResNet_18,  epoch  74, local model 3, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4346/4918 (88.3693%)
___Train Local_ResNet_18,  epoch  74, local model 3, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4413/4918 (89.7316%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.0962, Accuracy: 5226/10000 (52.2600%)
___Train Local_ResNet_18,  epoch  74, local model 61, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3592/4126 (87.0577%)
___Train Local_ResNet_18,  epoch  74, local model 61, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3735/4126 (90.5235%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 1.8478, Accuracy: 5604/10000 (56.0400%)
___Train Local_ResNet_18,  epoch  74, local model 19, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4351/4928 (88.2914%)
___Train Local_ResNet_18,  epoch  74, local model 19, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4391/4928 (89.1031%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.1282, Accuracy: 5290/10000 (52.9000%)
___Train Local_ResNet_18,  epoch  74, local model 27, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3719/4223 (88.0654%)
___Train Local_ResNet_18,  epoch  74, local model 27, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3873/4223 (91.7121%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.0162, Accuracy: 5483/10000 (54.8300%)
___Train Local_ResNet_18,  epoch  74, local model 54, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4498/5195 (86.5833%)
___Train Local_ResNet_18,  epoch  74, local model 54, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4598/5195 (88.5082%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.1706, Accuracy: 5203/10000 (52.0300%)
___Train Local_ResNet_18,  epoch  74, local model 96, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4127/4679 (88.2026%)
___Train Local_ResNet_18,  epoch  74, local model 96, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4184/4679 (89.4208%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 2.0059, Accuracy: 5376/10000 (53.7600%)
___Train Local_ResNet_18,  epoch  74, local model 2, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3178/3646 (87.1640%)
___Train Local_ResNet_18,  epoch  74, local model 2, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3261/3646 (89.4405%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 1.8795, Accuracy: 5639/10000 (56.3900%)
___Train Local_ResNet_18,  epoch  74, local model 86, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3146/3616 (87.0022%)
___Train Local_ResNet_18,  epoch  74, local model 86, internal_epoch   2,  Average loss: 0.0056, Accuracy: 3213/3616 (88.8551%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 1.8672, Accuracy: 5680/10000 (56.8000%)
___Train Local_ResNet_18,  epoch  74, local model 28, internal_epoch   1,  Average loss: 0.0074, Accuracy: 4051/4716 (85.8991%)
___Train Local_ResNet_18,  epoch  74, local model 28, internal_epoch   2,  Average loss: 0.0065, Accuracy: 4129/4716 (87.5530%)
___Test Local_ResNet_18 poisoned: False, epoch: 74: Average loss: 1.9449, Accuracy: 5473/10000 (54.7300%)
time spent on training: 270.2301559448242
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 74: Average loss: 1.2396, Accuracy: 6770/10000 (67.7000%)
___Test Target_ResNet_18 poisoned: True, epoch: 74: Average loss: 9.5316, Accuracy: 37/9900 (0.3737%)
Done in 301.32149481773376 sec.
Server Epoch:75 choose agents : [13, 36, 58, 71, 53, 33, 79, 24, 80, 96, 47, 1, 20, 74, 94, 84, 22, 44, 46, 50].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  75, local model 13, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4396/4885 (89.9898%), train_poison_data_count: 385
Global model norm: 42.580223572136454.
Norm before scaling: 42.58460243160446. Distance: 2.1308910391996028
Total norm for 4 adversaries is: 42.58460243160446. distance: 2.1308910391996028
___Test Local_ResNet_18 poisoned: True, epoch: 75: Average loss: 0.1680, Accuracy: 9484/9900 (95.7980%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  75, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4781/5305 (90.1225%), train_poison_data_count: 415
Global model norm: 42.580223572136454.
Norm before scaling: 42.57660977808487. Distance: 2.167495153437105
Total norm for 4 adversaries is: 42.57660977808487. distance: 2.167495153437105
___Test Local_ResNet_18 poisoned: True, epoch: 75: Average loss: 0.1046, Accuracy: 9628/9900 (97.2525%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  75, local model 58, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4203/4717 (89.1032%), train_poison_data_count: 370
Global model norm: 42.580223572136454.
Norm before scaling: 42.58295987457527. Distance: 2.107736021426034
Total norm for 4 adversaries is: 42.58295987457527. distance: 2.107736021426034
___Test Local_ResNet_18 poisoned: True, epoch: 75: Average loss: 0.1711, Accuracy: 9449/9900 (95.4444%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  75, local model 71, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4477/5066 (88.3735%), train_poison_data_count: 400
Global model norm: 42.580223572136454.
Norm before scaling: 42.58910552218357. Distance: 2.2887603247850796
Total norm for 4 adversaries is: 42.58910552218357. distance: 2.2887603247850796
___Test Local_ResNet_18 poisoned: True, epoch: 75: Average loss: 0.2130, Accuracy: 9338/9900 (94.3232%)
___Train Local_ResNet_18,  epoch  75, local model 53, internal_epoch   1,  Average loss: 0.0074, Accuracy: 5231/6124 (85.4180%)
___Train Local_ResNet_18,  epoch  75, local model 53, internal_epoch   2,  Average loss: 0.0063, Accuracy: 5368/6124 (87.6551%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 2.0113, Accuracy: 5343/10000 (53.4300%)
___Train Local_ResNet_18,  epoch  75, local model 33, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3900/4433 (87.9765%)
___Train Local_ResNet_18,  epoch  75, local model 33, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4020/4433 (90.6835%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.9676, Accuracy: 5528/10000 (55.2800%)
___Train Local_ResNet_18,  epoch  75, local model 79, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3367/3781 (89.0505%)
___Train Local_ResNet_18,  epoch  75, local model 79, internal_epoch   2,  Average loss: 0.0070, Accuracy: 3279/3781 (86.7231%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 2.3511, Accuracy: 4929/10000 (49.2900%)
___Train Local_ResNet_18,  epoch  75, local model 24, internal_epoch   1,  Average loss: 0.0071, Accuracy: 3528/3969 (88.8889%)
___Train Local_ResNet_18,  epoch  75, local model 24, internal_epoch   2,  Average loss: 0.0064, Accuracy: 3562/3969 (89.7455%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.9206, Accuracy: 5564/10000 (55.6400%)
___Train Local_ResNet_18,  epoch  75, local model 80, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4456/5025 (88.6766%)
___Train Local_ResNet_18,  epoch  75, local model 80, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4535/5025 (90.2488%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 2.0925, Accuracy: 5299/10000 (52.9900%)
___Train Local_ResNet_18,  epoch  75, local model 96, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4129/4679 (88.2454%)
___Train Local_ResNet_18,  epoch  75, local model 96, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4233/4679 (90.4680%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.9802, Accuracy: 5518/10000 (55.1800%)
___Train Local_ResNet_18,  epoch  75, local model 47, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4124/4707 (87.6142%)
___Train Local_ResNet_18,  epoch  75, local model 47, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4256/4707 (90.4185%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.9406, Accuracy: 5534/10000 (55.3400%)
___Train Local_ResNet_18,  epoch  75, local model 1, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4393/4986 (88.1067%)
___Train Local_ResNet_18,  epoch  75, local model 1, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4432/4986 (88.8889%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.9261, Accuracy: 5511/10000 (55.1100%)
___Train Local_ResNet_18,  epoch  75, local model 20, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3853/4315 (89.2932%)
___Train Local_ResNet_18,  epoch  75, local model 20, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3932/4315 (91.1240%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.7948, Accuracy: 5661/10000 (56.6100%)
___Train Local_ResNet_18,  epoch  75, local model 74, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3823/4416 (86.5716%)
___Train Local_ResNet_18,  epoch  75, local model 74, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3954/4416 (89.5380%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.9406, Accuracy: 5533/10000 (55.3300%)
___Train Local_ResNet_18,  epoch  75, local model 94, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4251/4804 (88.4888%)
___Train Local_ResNet_18,  epoch  75, local model 94, internal_epoch   2,  Average loss: 0.0081, Accuracy: 4042/4804 (84.1382%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 2.1789, Accuracy: 5195/10000 (51.9500%)
___Train Local_ResNet_18,  epoch  75, local model 84, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4141/4793 (86.3968%)
___Train Local_ResNet_18,  epoch  75, local model 84, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4289/4793 (89.4847%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 2.0263, Accuracy: 5363/10000 (53.6300%)
___Train Local_ResNet_18,  epoch  75, local model 22, internal_epoch   1,  Average loss: 0.0073, Accuracy: 4507/5232 (86.1430%)
___Train Local_ResNet_18,  epoch  75, local model 22, internal_epoch   2,  Average loss: 0.0064, Accuracy: 4552/5232 (87.0031%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 2.0255, Accuracy: 5319/10000 (53.1900%)
___Train Local_ResNet_18,  epoch  75, local model 44, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4071/4662 (87.3230%)
___Train Local_ResNet_18,  epoch  75, local model 44, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4219/4662 (90.4976%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 2.0734, Accuracy: 5241/10000 (52.4100%)
___Train Local_ResNet_18,  epoch  75, local model 46, internal_epoch   1,  Average loss: 0.0074, Accuracy: 4244/4956 (85.6336%)
___Train Local_ResNet_18,  epoch  75, local model 46, internal_epoch   2,  Average loss: 0.0065, Accuracy: 4331/4956 (87.3890%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 2.1490, Accuracy: 5181/10000 (51.8100%)
___Train Local_ResNet_18,  epoch  75, local model 50, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3817/4368 (87.3855%)
___Train Local_ResNet_18,  epoch  75, local model 50, internal_epoch   2,  Average loss: 0.0061, Accuracy: 3864/4368 (88.4615%)
___Test Local_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.8995, Accuracy: 5476/10000 (54.7600%)
time spent on training: 270.27263379096985
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 75: Average loss: 1.2634, Accuracy: 6768/10000 (67.6800%)
___Test Target_ResNet_18 poisoned: True, epoch: 75: Average loss: 9.6236, Accuracy: 42/9900 (0.4242%)
Done in 301.1595811843872 sec.
Server Epoch:76 choose agents : [13, 36, 58, 71, 53, 25, 47, 77, 68, 92, 10, 46, 59, 23, 32, 21, 98, 76, 79, 39].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  76, local model 13, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4367/4885 (89.3961%), train_poison_data_count: 385
Global model norm: 42.6182079105611.
Norm before scaling: 42.62247976420424. Distance: 2.1690942540528497
Total norm for 4 adversaries is: 42.62247976420424. distance: 2.1690942540528497
___Test Local_ResNet_18 poisoned: True, epoch: 76: Average loss: 0.2808, Accuracy: 9200/9900 (92.9293%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  76, local model 36, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4747/5305 (89.4816%), train_poison_data_count: 415
Global model norm: 42.6182079105611.
Norm before scaling: 42.6174689209315. Distance: 2.17657532917522
Total norm for 4 adversaries is: 42.6174689209315. distance: 2.17657532917522
___Test Local_ResNet_18 poisoned: True, epoch: 76: Average loss: 0.2347, Accuracy: 9308/9900 (94.0202%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  76, local model 58, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4241/4717 (89.9088%), train_poison_data_count: 370
Global model norm: 42.6182079105611.
Norm before scaling: 42.6184026808879. Distance: 2.0689082151457936
Total norm for 4 adversaries is: 42.6184026808879. distance: 2.0689082151457936
___Test Local_ResNet_18 poisoned: True, epoch: 76: Average loss: 0.1816, Accuracy: 9427/9900 (95.2222%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  76, local model 71, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4485/5066 (88.5314%), train_poison_data_count: 400
Global model norm: 42.6182079105611.
Norm before scaling: 42.62778210999474. Distance: 2.281644917624311
Total norm for 4 adversaries is: 42.62778210999474. distance: 2.281644917624311
___Test Local_ResNet_18 poisoned: True, epoch: 76: Average loss: 0.1464, Accuracy: 9534/9900 (96.3030%)
___Train Local_ResNet_18,  epoch  76, local model 53, internal_epoch   1,  Average loss: 0.0071, Accuracy: 5295/6124 (86.4631%)
___Train Local_ResNet_18,  epoch  76, local model 53, internal_epoch   2,  Average loss: 0.0066, Accuracy: 5294/6124 (86.4468%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 2.0893, Accuracy: 5317/10000 (53.1700%)
___Train Local_ResNet_18,  epoch  76, local model 25, internal_epoch   1,  Average loss: 0.0073, Accuracy: 5068/5902 (85.8692%)
___Train Local_ResNet_18,  epoch  76, local model 25, internal_epoch   2,  Average loss: 0.0066, Accuracy: 5122/5902 (86.7841%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 2.0600, Accuracy: 5370/10000 (53.7000%)
___Train Local_ResNet_18,  epoch  76, local model 47, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4158/4707 (88.3365%)
___Train Local_ResNet_18,  epoch  76, local model 47, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4207/4707 (89.3775%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.8637, Accuracy: 5604/10000 (56.0400%)
___Train Local_ResNet_18,  epoch  76, local model 77, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4077/4647 (87.7340%)
___Train Local_ResNet_18,  epoch  76, local model 77, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4179/4647 (89.9290%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.9427, Accuracy: 5548/10000 (55.4800%)
___Train Local_ResNet_18,  epoch  76, local model 68, internal_epoch   1,  Average loss: 0.0060, Accuracy: 2927/3297 (88.7777%)
___Train Local_ResNet_18,  epoch  76, local model 68, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3016/3297 (91.4771%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.7714, Accuracy: 5772/10000 (57.7200%)
___Train Local_ResNet_18,  epoch  76, local model 92, internal_epoch   1,  Average loss: 0.0061, Accuracy: 5528/6263 (88.2644%)
___Train Local_ResNet_18,  epoch  76, local model 92, internal_epoch   2,  Average loss: 0.0051, Accuracy: 5646/6263 (90.1485%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 2.1173, Accuracy: 5198/10000 (51.9800%)
___Train Local_ResNet_18,  epoch  76, local model 10, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4127/4663 (88.5053%)
___Train Local_ResNet_18,  epoch  76, local model 10, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4229/4663 (90.6927%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 2.0884, Accuracy: 5175/10000 (51.7500%)
___Train Local_ResNet_18,  epoch  76, local model 46, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4292/4956 (86.6021%)
___Train Local_ResNet_18,  epoch  76, local model 46, internal_epoch   2,  Average loss: 0.0063, Accuracy: 4352/4956 (87.8128%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 2.2385, Accuracy: 5093/10000 (50.9300%)
___Train Local_ResNet_18,  epoch  76, local model 59, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3590/4046 (88.7296%)
___Train Local_ResNet_18,  epoch  76, local model 59, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3707/4046 (91.6214%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.9301, Accuracy: 5580/10000 (55.8000%)
___Train Local_ResNet_18,  epoch  76, local model 23, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3687/4184 (88.1214%)
___Train Local_ResNet_18,  epoch  76, local model 23, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3806/4184 (90.9656%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.7917, Accuracy: 5675/10000 (56.7500%)
___Train Local_ResNet_18,  epoch  76, local model 32, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4866/5591 (87.0327%)
___Train Local_ResNet_18,  epoch  76, local model 32, internal_epoch   2,  Average loss: 0.0064, Accuracy: 4867/5591 (87.0506%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 2.2436, Accuracy: 5102/10000 (51.0200%)
___Train Local_ResNet_18,  epoch  76, local model 21, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4059/4634 (87.5917%)
___Train Local_ResNet_18,  epoch  76, local model 21, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4189/4634 (90.3971%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 2.0520, Accuracy: 5387/10000 (53.8700%)
___Train Local_ResNet_18,  epoch  76, local model 98, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3333/3828 (87.0690%)
___Train Local_ResNet_18,  epoch  76, local model 98, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3503/3828 (91.5099%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.9381, Accuracy: 5537/10000 (55.3700%)
___Train Local_ResNet_18,  epoch  76, local model 76, internal_epoch   1,  Average loss: 0.0076, Accuracy: 3086/3638 (84.8268%)
___Train Local_ResNet_18,  epoch  76, local model 76, internal_epoch   2,  Average loss: 0.0057, Accuracy: 3242/3638 (89.1149%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.9202, Accuracy: 5447/10000 (54.4700%)
___Train Local_ResNet_18,  epoch  76, local model 79, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3355/3781 (88.7331%)
___Train Local_ResNet_18,  epoch  76, local model 79, internal_epoch   2,  Average loss: 0.0059, Accuracy: 3348/3781 (88.5480%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 2.1446, Accuracy: 5189/10000 (51.8900%)
___Train Local_ResNet_18,  epoch  76, local model 39, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3384/3837 (88.1939%)
___Train Local_ResNet_18,  epoch  76, local model 39, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3519/3837 (91.7123%)
___Test Local_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.9612, Accuracy: 5511/10000 (55.1100%)
time spent on training: 268.00239515304565
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 76: Average loss: 1.2445, Accuracy: 6857/10000 (68.5700%)
___Test Target_ResNet_18 poisoned: True, epoch: 76: Average loss: 9.3073, Accuracy: 85/9900 (0.8586%)
Done in 298.7024099826813 sec.
Server Epoch:77 choose agents : [13, 36, 58, 71, 8, 31, 86, 21, 57, 35, 89, 28, 53, 65, 80, 3, 27, 7, 76, 69].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  77, local model 13, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4384/4885 (89.7441%), train_poison_data_count: 385
Global model norm: 42.66316192855597.
Norm before scaling: 42.66580564901696. Distance: 2.11587348504248
Total norm for 4 adversaries is: 42.66580564901696. distance: 2.11587348504248
___Test Local_ResNet_18 poisoned: True, epoch: 77: Average loss: 0.2205, Accuracy: 9371/9900 (94.6566%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  77, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4756/5305 (89.6513%), train_poison_data_count: 415
Global model norm: 42.66316192855597.
Norm before scaling: 42.6635496272506. Distance: 2.158847626299244
Total norm for 4 adversaries is: 42.6635496272506. distance: 2.158847626299244
___Test Local_ResNet_18 poisoned: True, epoch: 77: Average loss: 0.1748, Accuracy: 9465/9900 (95.6061%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  77, local model 58, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4181/4717 (88.6368%), train_poison_data_count: 370
Global model norm: 42.66316192855597.
Norm before scaling: 42.66551524833903. Distance: 2.0949184516567216
Total norm for 4 adversaries is: 42.66551524833903. distance: 2.0949184516567216
___Test Local_ResNet_18 poisoned: True, epoch: 77: Average loss: 0.1518, Accuracy: 9523/9900 (96.1919%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  77, local model 71, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4477/5066 (88.3735%), train_poison_data_count: 400
Global model norm: 42.66316192855597.
Norm before scaling: 42.667678185234664. Distance: 2.2176743169863116
Total norm for 4 adversaries is: 42.667678185234664. distance: 2.2176743169863116
___Test Local_ResNet_18 poisoned: True, epoch: 77: Average loss: 0.1793, Accuracy: 9448/9900 (95.4343%)
___Train Local_ResNet_18,  epoch  77, local model 8, internal_epoch   1,  Average loss: 0.0075, Accuracy: 3850/4501 (85.5365%)
___Train Local_ResNet_18,  epoch  77, local model 8, internal_epoch   2,  Average loss: 0.0065, Accuracy: 3948/4501 (87.7138%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 2.0376, Accuracy: 5397/10000 (53.9700%)
___Train Local_ResNet_18,  epoch  77, local model 31, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3646/4175 (87.3293%)
___Train Local_ResNet_18,  epoch  77, local model 31, internal_epoch   2,  Average loss: 0.0059, Accuracy: 3705/4175 (88.7425%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.9148, Accuracy: 5452/10000 (54.5200%)
___Train Local_ResNet_18,  epoch  77, local model 86, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3108/3616 (85.9513%)
___Train Local_ResNet_18,  epoch  77, local model 86, internal_epoch   2,  Average loss: 0.0057, Accuracy: 3200/3616 (88.4956%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.9742, Accuracy: 5463/10000 (54.6300%)
___Train Local_ResNet_18,  epoch  77, local model 21, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4044/4634 (87.2680%)
___Train Local_ResNet_18,  epoch  77, local model 21, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4135/4634 (89.2318%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.9501, Accuracy: 5491/10000 (54.9100%)
___Train Local_ResNet_18,  epoch  77, local model 57, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3938/4558 (86.3975%)
___Train Local_ResNet_18,  epoch  77, local model 57, internal_epoch   2,  Average loss: 0.0063, Accuracy: 4008/4558 (87.9333%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 2.0697, Accuracy: 5328/10000 (53.2800%)
___Train Local_ResNet_18,  epoch  77, local model 35, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4544/5167 (87.9427%)
___Train Local_ResNet_18,  epoch  77, local model 35, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4620/5167 (89.4136%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 2.0388, Accuracy: 5399/10000 (53.9900%)
___Train Local_ResNet_18,  epoch  77, local model 89, internal_epoch   1,  Average loss: 0.0051, Accuracy: 3932/4356 (90.2663%)
___Train Local_ResNet_18,  epoch  77, local model 89, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3871/4356 (88.8659%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 2.1537, Accuracy: 5173/10000 (51.7300%)
___Train Local_ResNet_18,  epoch  77, local model 28, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4097/4716 (86.8745%)
___Train Local_ResNet_18,  epoch  77, local model 28, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4166/4716 (88.3376%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 2.0401, Accuracy: 5343/10000 (53.4300%)
___Train Local_ResNet_18,  epoch  77, local model 53, internal_epoch   1,  Average loss: 0.0068, Accuracy: 5319/6124 (86.8550%)
___Train Local_ResNet_18,  epoch  77, local model 53, internal_epoch   2,  Average loss: 0.0064, Accuracy: 5339/6124 (87.1816%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.9693, Accuracy: 5435/10000 (54.3500%)
___Train Local_ResNet_18,  epoch  77, local model 65, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4412/5055 (87.2799%)
___Train Local_ResNet_18,  epoch  77, local model 65, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4547/5055 (89.9505%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 2.0149, Accuracy: 5410/10000 (54.1000%)
___Train Local_ResNet_18,  epoch  77, local model 80, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4463/5025 (88.8159%)
___Train Local_ResNet_18,  epoch  77, local model 80, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4564/5025 (90.8259%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 2.1673, Accuracy: 5344/10000 (53.4400%)
___Train Local_ResNet_18,  epoch  77, local model 3, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4322/4918 (87.8813%)
___Train Local_ResNet_18,  epoch  77, local model 3, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4424/4918 (89.9553%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 2.1491, Accuracy: 5205/10000 (52.0500%)
___Train Local_ResNet_18,  epoch  77, local model 27, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3685/4223 (87.2602%)
___Train Local_ResNet_18,  epoch  77, local model 27, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3804/4223 (90.0781%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.9870, Accuracy: 5473/10000 (54.7300%)
___Train Local_ResNet_18,  epoch  77, local model 7, internal_epoch   1,  Average loss: 0.0083, Accuracy: 3860/4481 (86.1415%)
___Train Local_ResNet_18,  epoch  77, local model 7, internal_epoch   2,  Average loss: 0.0074, Accuracy: 3897/4481 (86.9672%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 2.0437, Accuracy: 5444/10000 (54.4400%)
___Train Local_ResNet_18,  epoch  77, local model 76, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3169/3638 (87.1083%)
___Train Local_ResNet_18,  epoch  77, local model 76, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3269/3638 (89.8571%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.9384, Accuracy: 5568/10000 (55.6800%)
___Train Local_ResNet_18,  epoch  77, local model 69, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3565/4013 (88.8363%)
___Train Local_ResNet_18,  epoch  77, local model 69, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3687/4013 (91.8764%)
___Test Local_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.8380, Accuracy: 5680/10000 (56.8000%)
time spent on training: 267.4257137775421
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 77: Average loss: 1.2193, Accuracy: 6891/10000 (68.9100%)
___Test Target_ResNet_18 poisoned: True, epoch: 77: Average loss: 9.4800, Accuracy: 63/9900 (0.6364%)
Done in 298.6605758666992 sec.
Server Epoch:78 choose agents : [13, 36, 58, 71, 2, 8, 93, 35, 40, 32, 96, 0, 84, 66, 42, 31, 67, 4, 22, 30].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  78, local model 13, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4409/4885 (90.2559%), train_poison_data_count: 385
Global model norm: 42.70103675602107.
Norm before scaling: 42.70297063638401. Distance: 2.0903105312525767
Total norm for 4 adversaries is: 42.70297063638401. distance: 2.0903105312525767
___Test Local_ResNet_18 poisoned: True, epoch: 78: Average loss: 0.2746, Accuracy: 9224/9900 (93.1717%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  78, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4752/5305 (89.5759%), train_poison_data_count: 415
Global model norm: 42.70103675602107.
Norm before scaling: 42.700822351474535. Distance: 2.1679322385720545
Total norm for 4 adversaries is: 42.700822351474535. distance: 2.1679322385720545
___Test Local_ResNet_18 poisoned: True, epoch: 78: Average loss: 0.2450, Accuracy: 9322/9900 (94.1616%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  78, local model 58, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4230/4717 (89.6756%), train_poison_data_count: 370
Global model norm: 42.70103675602107.
Norm before scaling: 42.70241463688339. Distance: 2.0537562127231235
Total norm for 4 adversaries is: 42.70241463688339. distance: 2.0537562127231235
___Test Local_ResNet_18 poisoned: True, epoch: 78: Average loss: 0.2847, Accuracy: 9207/9900 (93.0000%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  78, local model 71, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4491/5066 (88.6498%), train_poison_data_count: 400
Global model norm: 42.70103675602107.
Norm before scaling: 42.706619471455326. Distance: 2.243704359180106
Total norm for 4 adversaries is: 42.706619471455326. distance: 2.243704359180106
___Test Local_ResNet_18 poisoned: True, epoch: 78: Average loss: 0.1135, Accuracy: 9594/9900 (96.9091%)
___Train Local_ResNet_18,  epoch  78, local model 2, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3166/3646 (86.8349%)
___Train Local_ResNet_18,  epoch  78, local model 2, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3311/3646 (90.8118%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.7541, Accuracy: 5845/10000 (58.4500%)
___Train Local_ResNet_18,  epoch  78, local model 8, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3904/4501 (86.7363%)
___Train Local_ResNet_18,  epoch  78, local model 8, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4051/4501 (90.0022%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.9967, Accuracy: 5467/10000 (54.6700%)
___Train Local_ResNet_18,  epoch  78, local model 93, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4074/4651 (87.5941%)
___Train Local_ResNet_18,  epoch  78, local model 93, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4196/4651 (90.2172%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.9575, Accuracy: 5497/10000 (54.9700%)
___Train Local_ResNet_18,  epoch  78, local model 35, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4569/5167 (88.4266%)
___Train Local_ResNet_18,  epoch  78, local model 35, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4673/5167 (90.4393%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.9730, Accuracy: 5446/10000 (54.4600%)
___Train Local_ResNet_18,  epoch  78, local model 40, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4844/5455 (88.7993%)
___Train Local_ResNet_18,  epoch  78, local model 40, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4829/5455 (88.5243%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 2.1048, Accuracy: 5274/10000 (52.7400%)
___Train Local_ResNet_18,  epoch  78, local model 32, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4822/5591 (86.2458%)
___Train Local_ResNet_18,  epoch  78, local model 32, internal_epoch   2,  Average loss: 0.0064, Accuracy: 4857/5591 (86.8718%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 2.0945, Accuracy: 5213/10000 (52.1300%)
___Train Local_ResNet_18,  epoch  78, local model 96, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4167/4679 (89.0575%)
___Train Local_ResNet_18,  epoch  78, local model 96, internal_epoch   2,  Average loss: 0.0062, Accuracy: 4117/4679 (87.9889%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 2.1568, Accuracy: 5147/10000 (51.4700%)
___Train Local_ResNet_18,  epoch  78, local model 0, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4427/5017 (88.2400%)
___Train Local_ResNet_18,  epoch  78, local model 0, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4511/5017 (89.9143%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.9071, Accuracy: 5611/10000 (56.1100%)
___Train Local_ResNet_18,  epoch  78, local model 84, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4217/4793 (87.9825%)
___Train Local_ResNet_18,  epoch  78, local model 84, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4284/4793 (89.3803%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 2.0368, Accuracy: 5353/10000 (53.5300%)
___Train Local_ResNet_18,  epoch  78, local model 66, internal_epoch   1,  Average loss: 0.0052, Accuracy: 4014/4456 (90.0808%)
___Train Local_ResNet_18,  epoch  78, local model 66, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4102/4456 (92.0557%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 2.0184, Accuracy: 5523/10000 (55.2300%)
___Train Local_ResNet_18,  epoch  78, local model 42, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4796/5424 (88.4218%)
___Train Local_ResNet_18,  epoch  78, local model 42, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4917/5424 (90.6527%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 2.0672, Accuracy: 5340/10000 (53.4000%)
___Train Local_ResNet_18,  epoch  78, local model 31, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3613/4175 (86.5389%)
___Train Local_ResNet_18,  epoch  78, local model 31, internal_epoch   2,  Average loss: 0.0068, Accuracy: 3642/4175 (87.2335%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 2.0759, Accuracy: 5354/10000 (53.5400%)
___Train Local_ResNet_18,  epoch  78, local model 67, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4475/5116 (87.4707%)
___Train Local_ResNet_18,  epoch  78, local model 67, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4557/5116 (89.0735%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.9702, Accuracy: 5462/10000 (54.6200%)
___Train Local_ResNet_18,  epoch  78, local model 4, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3252/3704 (87.7970%)
___Train Local_ResNet_18,  epoch  78, local model 4, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3317/3704 (89.5518%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.8925, Accuracy: 5590/10000 (55.9000%)
___Train Local_ResNet_18,  epoch  78, local model 22, internal_epoch   1,  Average loss: 0.0076, Accuracy: 4451/5232 (85.0726%)
___Train Local_ResNet_18,  epoch  78, local model 22, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4650/5232 (88.8761%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.9593, Accuracy: 5376/10000 (53.7600%)
___Train Local_ResNet_18,  epoch  78, local model 30, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3068/3472 (88.3641%)
___Train Local_ResNet_18,  epoch  78, local model 30, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3173/3472 (91.3882%)
___Test Local_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.9401, Accuracy: 5648/10000 (56.4800%)
time spent on training: 269.01085233688354
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 78: Average loss: 1.2367, Accuracy: 6841/10000 (68.4100%)
___Test Target_ResNet_18 poisoned: True, epoch: 78: Average loss: 9.5157, Accuracy: 81/9900 (0.8182%)
Done in 299.8589837551117 sec.
Server Epoch:79 choose agents : [13, 36, 58, 71, 63, 50, 4, 19, 55, 18, 93, 23, 29, 84, 60, 1, 53, 47, 73, 59].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  79, local model 13, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4371/4885 (89.4780%), train_poison_data_count: 385
Global model norm: 42.73507626252775.
Norm before scaling: 42.73769982495695. Distance: 2.0925121918645555
Total norm for 4 adversaries is: 42.73769982495695. distance: 2.0925121918645555
___Test Local_ResNet_18 poisoned: True, epoch: 79: Average loss: 0.3801, Accuracy: 8959/9900 (90.4949%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  79, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4751/5305 (89.5570%), train_poison_data_count: 415
Global model norm: 42.73507626252775.
Norm before scaling: 42.734185042996465. Distance: 2.1812858600455978
Total norm for 4 adversaries is: 42.734185042996465. distance: 2.1812858600455978
___Test Local_ResNet_18 poisoned: True, epoch: 79: Average loss: 0.2146, Accuracy: 9382/9900 (94.7677%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  79, local model 58, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4221/4717 (89.4848%), train_poison_data_count: 370
Global model norm: 42.73507626252775.
Norm before scaling: 42.735727526585556. Distance: 2.0653936721150736
Total norm for 4 adversaries is: 42.735727526585556. distance: 2.0653936721150736
___Test Local_ResNet_18 poisoned: True, epoch: 79: Average loss: 0.1798, Accuracy: 9455/9900 (95.5051%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  79, local model 71, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4490/5066 (88.6301%), train_poison_data_count: 400
Global model norm: 42.73507626252775.
Norm before scaling: 42.74238670329197. Distance: 2.26072721208593
Total norm for 4 adversaries is: 42.74238670329197. distance: 2.26072721208593
___Test Local_ResNet_18 poisoned: True, epoch: 79: Average loss: 0.2773, Accuracy: 9189/9900 (92.8182%)
___Train Local_ResNet_18,  epoch  79, local model 63, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3203/3590 (89.2201%)
___Train Local_ResNet_18,  epoch  79, local model 63, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3312/3590 (92.2563%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.9916, Accuracy: 5591/10000 (55.9100%)
___Train Local_ResNet_18,  epoch  79, local model 50, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3827/4368 (87.6145%)
___Train Local_ResNet_18,  epoch  79, local model 50, internal_epoch   2,  Average loss: 0.0059, Accuracy: 3872/4368 (88.6447%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.9780, Accuracy: 5286/10000 (52.8600%)
___Train Local_ResNet_18,  epoch  79, local model 4, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3249/3704 (87.7160%)
___Train Local_ResNet_18,  epoch  79, local model 4, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3359/3704 (90.6857%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.9104, Accuracy: 5575/10000 (55.7500%)
___Train Local_ResNet_18,  epoch  79, local model 19, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4296/4928 (87.1753%)
___Train Local_ResNet_18,  epoch  79, local model 19, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4363/4928 (88.5349%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 2.0503, Accuracy: 5337/10000 (53.3700%)
___Train Local_ResNet_18,  epoch  79, local model 55, internal_epoch   1,  Average loss: 0.0050, Accuracy: 3957/4356 (90.8402%)
___Train Local_ResNet_18,  epoch  79, local model 55, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3932/4356 (90.2663%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 2.1221, Accuracy: 5245/10000 (52.4500%)
___Train Local_ResNet_18,  epoch  79, local model 18, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3503/3911 (89.5679%)
___Train Local_ResNet_18,  epoch  79, local model 18, internal_epoch   2,  Average loss: 0.0069, Accuracy: 3418/3911 (87.3945%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 2.1707, Accuracy: 5214/10000 (52.1400%)
___Train Local_ResNet_18,  epoch  79, local model 93, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4089/4651 (87.9166%)
___Train Local_ResNet_18,  epoch  79, local model 93, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4178/4651 (89.8301%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 2.0679, Accuracy: 5376/10000 (53.7600%)
___Train Local_ResNet_18,  epoch  79, local model 23, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3700/4184 (88.4321%)
___Train Local_ResNet_18,  epoch  79, local model 23, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3785/4184 (90.4637%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.9143, Accuracy: 5526/10000 (55.2600%)
___Train Local_ResNet_18,  epoch  79, local model 29, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3906/4346 (89.8757%)
___Train Local_ResNet_18,  epoch  79, local model 29, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4022/4346 (92.5449%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.8656, Accuracy: 5702/10000 (57.0200%)
___Train Local_ResNet_18,  epoch  79, local model 84, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4165/4793 (86.8976%)
___Train Local_ResNet_18,  epoch  79, local model 84, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4363/4793 (91.0286%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.9375, Accuracy: 5580/10000 (55.8000%)
___Train Local_ResNet_18,  epoch  79, local model 60, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3380/3804 (88.8538%)
___Train Local_ResNet_18,  epoch  79, local model 60, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3490/3804 (91.7455%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.9179, Accuracy: 5622/10000 (56.2200%)
___Train Local_ResNet_18,  epoch  79, local model 1, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4431/4986 (88.8688%)
___Train Local_ResNet_18,  epoch  79, local model 1, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4471/4986 (89.6711%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.8364, Accuracy: 5749/10000 (57.4900%)
___Train Local_ResNet_18,  epoch  79, local model 53, internal_epoch   1,  Average loss: 0.0070, Accuracy: 5282/6124 (86.2508%)
___Train Local_ResNet_18,  epoch  79, local model 53, internal_epoch   2,  Average loss: 0.0068, Accuracy: 5284/6124 (86.2835%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.9944, Accuracy: 5410/10000 (54.1000%)
___Train Local_ResNet_18,  epoch  79, local model 47, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4118/4707 (87.4867%)
___Train Local_ResNet_18,  epoch  79, local model 47, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4289/4707 (91.1196%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.9659, Accuracy: 5466/10000 (54.6600%)
___Train Local_ResNet_18,  epoch  79, local model 73, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3783/4235 (89.3270%)
___Train Local_ResNet_18,  epoch  79, local model 73, internal_epoch   2,  Average loss: 0.0060, Accuracy: 3754/4235 (88.6423%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 2.0218, Accuracy: 5407/10000 (54.0700%)
___Train Local_ResNet_18,  epoch  79, local model 59, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3603/4046 (89.0509%)
___Train Local_ResNet_18,  epoch  79, local model 59, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3720/4046 (91.9427%)
___Test Local_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.9890, Accuracy: 5437/10000 (54.3700%)
time spent on training: 266.16349601745605
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 79: Average loss: 1.2468, Accuracy: 6842/10000 (68.4200%)
___Test Target_ResNet_18 poisoned: True, epoch: 79: Average loss: 9.5578, Accuracy: 90/9900 (0.9091%)
Done in 297.2669723033905 sec.
Server Epoch:80 choose agents : [13, 36, 58, 71, 1, 21, 28, 53, 3, 52, 15, 46, 33, 37, 16, 18, 7, 49, 40, 97].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  80, local model 13, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4405/4885 (90.1740%), train_poison_data_count: 385
Global model norm: 42.782436981342.
Norm before scaling: 42.78424021690113. Distance: 2.1073172245433716
Total norm for 4 adversaries is: 42.78424021690113. distance: 2.1073172245433716
___Test Local_ResNet_18 poisoned: True, epoch: 80: Average loss: 0.1205, Accuracy: 9584/9900 (96.8081%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  80, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4736/5305 (89.2743%), train_poison_data_count: 415
Global model norm: 42.782436981342.
Norm before scaling: 42.78648416894128. Distance: 2.187624682551599
Total norm for 4 adversaries is: 42.78648416894128. distance: 2.187624682551599
___Test Local_ResNet_18 poisoned: True, epoch: 80: Average loss: 0.1187, Accuracy: 9608/9900 (97.0505%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  80, local model 58, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4252/4717 (90.1420%), train_poison_data_count: 370
Global model norm: 42.782436981342.
Norm before scaling: 42.78093327585462. Distance: 2.012750749782375
Total norm for 4 adversaries is: 42.78093327585462. distance: 2.012750749782375
___Test Local_ResNet_18 poisoned: True, epoch: 80: Average loss: 0.3246, Accuracy: 9112/9900 (92.0404%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  80, local model 71, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4481/5066 (88.4524%), train_poison_data_count: 400
Global model norm: 42.782436981342.
Norm before scaling: 42.78854399334374. Distance: 2.2730251082423605
Total norm for 4 adversaries is: 42.78854399334374. distance: 2.2730251082423605
___Test Local_ResNet_18 poisoned: True, epoch: 80: Average loss: 0.2753, Accuracy: 9208/9900 (93.0101%)
___Train Local_ResNet_18,  epoch  80, local model 1, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4436/4986 (88.9691%)
___Train Local_ResNet_18,  epoch  80, local model 1, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4493/4986 (90.1123%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 1.9321, Accuracy: 5595/10000 (55.9500%)
___Train Local_ResNet_18,  epoch  80, local model 21, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4038/4634 (87.1385%)
___Train Local_ResNet_18,  epoch  80, local model 21, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4137/4634 (89.2749%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 1.9117, Accuracy: 5605/10000 (56.0500%)
___Train Local_ResNet_18,  epoch  80, local model 28, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4137/4716 (87.7226%)
___Train Local_ResNet_18,  epoch  80, local model 28, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4235/4716 (89.8007%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 1.9059, Accuracy: 5452/10000 (54.5200%)
___Train Local_ResNet_18,  epoch  80, local model 53, internal_epoch   1,  Average loss: 0.0060, Accuracy: 5416/6124 (88.4389%)
___Train Local_ResNet_18,  epoch  80, local model 53, internal_epoch   2,  Average loss: 0.0053, Accuracy: 5503/6124 (89.8596%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.0191, Accuracy: 5387/10000 (53.8700%)
___Train Local_ResNet_18,  epoch  80, local model 3, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4350/4918 (88.4506%)
___Train Local_ResNet_18,  epoch  80, local model 3, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4493/4918 (91.3583%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.0528, Accuracy: 5354/10000 (53.5400%)
___Train Local_ResNet_18,  epoch  80, local model 52, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3353/3797 (88.3066%)
___Train Local_ResNet_18,  epoch  80, local model 52, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3428/3797 (90.2818%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.0046, Accuracy: 5378/10000 (53.7800%)
___Train Local_ResNet_18,  epoch  80, local model 15, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4978/5582 (89.1795%)
___Train Local_ResNet_18,  epoch  80, local model 15, internal_epoch   2,  Average loss: 0.0048, Accuracy: 5067/5582 (90.7739%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.1088, Accuracy: 5265/10000 (52.6500%)
___Train Local_ResNet_18,  epoch  80, local model 46, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4291/4956 (86.5819%)
___Train Local_ResNet_18,  epoch  80, local model 46, internal_epoch   2,  Average loss: 0.0063, Accuracy: 4334/4956 (87.4496%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.0401, Accuracy: 5323/10000 (53.2300%)
___Train Local_ResNet_18,  epoch  80, local model 33, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3945/4433 (88.9917%)
___Train Local_ResNet_18,  epoch  80, local model 33, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4011/4433 (90.4805%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 1.8321, Accuracy: 5753/10000 (57.5300%)
___Train Local_ResNet_18,  epoch  80, local model 37, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3860/4354 (88.6541%)
___Train Local_ResNet_18,  epoch  80, local model 37, internal_epoch   2,  Average loss: 0.0104, Accuracy: 3491/4354 (80.1791%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.4294, Accuracy: 4755/10000 (47.5500%)
___Train Local_ResNet_18,  epoch  80, local model 16, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4315/4928 (87.5609%)
___Train Local_ResNet_18,  epoch  80, local model 16, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4408/4928 (89.4481%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 1.9494, Accuracy: 5464/10000 (54.6400%)
___Train Local_ResNet_18,  epoch  80, local model 18, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3529/3911 (90.2327%)
___Train Local_ResNet_18,  epoch  80, local model 18, internal_epoch   2,  Average loss: 0.0056, Accuracy: 3526/3911 (90.1560%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 1.9361, Accuracy: 5582/10000 (55.8200%)
___Train Local_ResNet_18,  epoch  80, local model 7, internal_epoch   1,  Average loss: 0.0072, Accuracy: 3932/4481 (87.7483%)
___Train Local_ResNet_18,  epoch  80, local model 7, internal_epoch   2,  Average loss: 0.0074, Accuracy: 3913/4481 (87.3243%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.0010, Accuracy: 5508/10000 (55.0800%)
___Train Local_ResNet_18,  epoch  80, local model 49, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4586/5197 (88.2432%)
___Train Local_ResNet_18,  epoch  80, local model 49, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4614/5197 (88.7820%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.0845, Accuracy: 5240/10000 (52.4000%)
___Train Local_ResNet_18,  epoch  80, local model 40, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4818/5455 (88.3226%)
___Train Local_ResNet_18,  epoch  80, local model 40, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4868/5455 (89.2392%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.0099, Accuracy: 5364/10000 (53.6400%)
___Train Local_ResNet_18,  epoch  80, local model 97, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3800/4361 (87.1360%)
___Train Local_ResNet_18,  epoch  80, local model 97, internal_epoch   2,  Average loss: 0.0078, Accuracy: 3689/4361 (84.5907%)
___Test Local_ResNet_18 poisoned: False, epoch: 80: Average loss: 2.2897, Accuracy: 5044/10000 (50.4400%)
time spent on training: 272.3953619003296
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 80: Average loss: 1.2806, Accuracy: 6798/10000 (67.9800%)
___Test Target_ResNet_18 poisoned: True, epoch: 80: Average loss: 10.1137, Accuracy: 51/9900 (0.5152%)
Done in 303.30092310905457 sec.
Server Epoch:81 choose agents : [13, 36, 58, 71, 19, 23, 47, 98, 64, 44, 73, 11, 84, 7, 29, 97, 65, 54, 20, 10].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  81, local model 13, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4407/4885 (90.2149%), train_poison_data_count: 385
Global model norm: 42.82400905979174.
Norm before scaling: 42.82550697716914. Distance: 2.0775052630820325
Total norm for 4 adversaries is: 42.82550697716914. distance: 2.0775052630820325
___Test Local_ResNet_18 poisoned: True, epoch: 81: Average loss: 0.1960, Accuracy: 9449/9900 (95.4444%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  81, local model 36, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4777/5305 (90.0471%), train_poison_data_count: 415
Global model norm: 42.82400905979174.
Norm before scaling: 42.822637942010296. Distance: 2.160677358949063
Total norm for 4 adversaries is: 42.822637942010296. distance: 2.160677358949063
___Test Local_ResNet_18 poisoned: True, epoch: 81: Average loss: 0.2296, Accuracy: 9343/9900 (94.3737%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  81, local model 58, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4215/4717 (89.3576%), train_poison_data_count: 370
Global model norm: 42.82400905979174.
Norm before scaling: 42.822763368330165. Distance: 2.060899055359538
Total norm for 4 adversaries is: 42.822763368330165. distance: 2.060899055359538
___Test Local_ResNet_18 poisoned: True, epoch: 81: Average loss: 0.1900, Accuracy: 9420/9900 (95.1515%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  81, local model 71, internal_epoch   1,  Average loss: 0.0072, Accuracy: 4459/5066 (88.0182%), train_poison_data_count: 400
Global model norm: 42.82400905979174.
Norm before scaling: 42.82839577167233. Distance: 2.2810335448531576
Total norm for 4 adversaries is: 42.82839577167233. distance: 2.2810335448531576
___Test Local_ResNet_18 poisoned: True, epoch: 81: Average loss: 0.2315, Accuracy: 9323/9900 (94.1717%)
___Train Local_ResNet_18,  epoch  81, local model 19, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4299/4928 (87.2362%)
___Train Local_ResNet_18,  epoch  81, local model 19, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4406/4928 (89.4075%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.9249, Accuracy: 5447/10000 (54.4700%)
___Train Local_ResNet_18,  epoch  81, local model 23, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3743/4184 (89.4598%)
___Train Local_ResNet_18,  epoch  81, local model 23, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3779/4184 (90.3203%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.9992, Accuracy: 5407/10000 (54.0700%)
___Train Local_ResNet_18,  epoch  81, local model 47, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4174/4707 (88.6764%)
___Train Local_ResNet_18,  epoch  81, local model 47, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4259/4707 (90.4823%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 2.0839, Accuracy: 5342/10000 (53.4200%)
___Train Local_ResNet_18,  epoch  81, local model 98, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3367/3828 (87.9572%)
___Train Local_ResNet_18,  epoch  81, local model 98, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3526/3828 (92.1108%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.8281, Accuracy: 5717/10000 (57.1700%)
___Train Local_ResNet_18,  epoch  81, local model 64, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3930/4503 (87.2751%)
___Train Local_ResNet_18,  epoch  81, local model 64, internal_epoch   2,  Average loss: 0.0057, Accuracy: 3994/4503 (88.6964%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 2.0199, Accuracy: 5428/10000 (54.2800%)
___Train Local_ResNet_18,  epoch  81, local model 44, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4140/4662 (88.8031%)
___Train Local_ResNet_18,  epoch  81, local model 44, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4238/4662 (90.9052%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.9745, Accuracy: 5561/10000 (55.6100%)
___Train Local_ResNet_18,  epoch  81, local model 73, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3714/4235 (87.6978%)
___Train Local_ResNet_18,  epoch  81, local model 73, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3807/4235 (89.8937%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.8933, Accuracy: 5660/10000 (56.6000%)
___Train Local_ResNet_18,  epoch  81, local model 11, internal_epoch   1,  Average loss: 0.0080, Accuracy: 4405/5244 (84.0008%)
___Train Local_ResNet_18,  epoch  81, local model 11, internal_epoch   2,  Average loss: 0.0070, Accuracy: 4520/5244 (86.1937%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.9742, Accuracy: 5370/10000 (53.7000%)
___Train Local_ResNet_18,  epoch  81, local model 84, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4163/4793 (86.8558%)
___Train Local_ResNet_18,  epoch  81, local model 84, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4298/4793 (89.6724%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 2.0206, Accuracy: 5389/10000 (53.8900%)
___Train Local_ResNet_18,  epoch  81, local model 7, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4018/4481 (89.6675%)
___Train Local_ResNet_18,  epoch  81, local model 7, internal_epoch   2,  Average loss: 0.0067, Accuracy: 3941/4481 (87.9491%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 2.0918, Accuracy: 5361/10000 (53.6100%)
___Train Local_ResNet_18,  epoch  81, local model 29, internal_epoch   1,  Average loss: 0.0052, Accuracy: 3907/4346 (89.8988%)
___Train Local_ResNet_18,  epoch  81, local model 29, internal_epoch   2,  Average loss: 0.0037, Accuracy: 4039/4346 (92.9360%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.7825, Accuracy: 5841/10000 (58.4100%)
___Train Local_ResNet_18,  epoch  81, local model 97, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3777/4361 (86.6086%)
___Train Local_ResNet_18,  epoch  81, local model 97, internal_epoch   2,  Average loss: 0.0074, Accuracy: 3741/4361 (85.7831%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 2.2191, Accuracy: 5041/10000 (50.4100%)
___Train Local_ResNet_18,  epoch  81, local model 65, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4474/5055 (88.5064%)
___Train Local_ResNet_18,  epoch  81, local model 65, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4539/5055 (89.7923%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.9607, Accuracy: 5512/10000 (55.1200%)
___Train Local_ResNet_18,  epoch  81, local model 54, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4493/5195 (86.4870%)
___Train Local_ResNet_18,  epoch  81, local model 54, internal_epoch   2,  Average loss: 0.0067, Accuracy: 4530/5195 (87.1992%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 2.1515, Accuracy: 5201/10000 (52.0100%)
___Train Local_ResNet_18,  epoch  81, local model 20, internal_epoch   1,  Average loss: 0.0052, Accuracy: 3872/4315 (89.7335%)
___Train Local_ResNet_18,  epoch  81, local model 20, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3982/4315 (92.2827%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.9685, Accuracy: 5522/10000 (55.2200%)
___Train Local_ResNet_18,  epoch  81, local model 10, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4164/4663 (89.2987%)
___Train Local_ResNet_18,  epoch  81, local model 10, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4250/4663 (91.1430%)
___Test Local_ResNet_18 poisoned: False, epoch: 81: Average loss: 2.1518, Accuracy: 5206/10000 (52.0600%)
time spent on training: 268.44847774505615
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 81: Average loss: 1.2712, Accuracy: 6826/10000 (68.2600%)
___Test Target_ResNet_18 poisoned: True, epoch: 81: Average loss: 10.1065, Accuracy: 45/9900 (0.4545%)
Done in 299.5071141719818 sec.
Server Epoch:82 choose agents : [13, 36, 58, 71, 20, 63, 96, 35, 51, 98, 73, 77, 3, 33, 7, 75, 64, 37, 1, 92].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  82, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4400/4885 (90.0716%), train_poison_data_count: 385
Global model norm: 42.858492061630855.
Norm before scaling: 42.85937215184096. Distance: 2.0751567091997694
Total norm for 4 adversaries is: 42.85937215184096. distance: 2.0751567091997694
___Test Local_ResNet_18 poisoned: True, epoch: 82: Average loss: 0.1712, Accuracy: 9470/9900 (95.6566%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  82, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4763/5305 (89.7832%), train_poison_data_count: 415
Global model norm: 42.858492061630855.
Norm before scaling: 42.8612262633359. Distance: 2.182495823841972
Total norm for 4 adversaries is: 42.8612262633359. distance: 2.182495823841972
___Test Local_ResNet_18 poisoned: True, epoch: 82: Average loss: 0.3137, Accuracy: 9172/9900 (92.6465%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  82, local model 58, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4233/4717 (89.7392%), train_poison_data_count: 370
Global model norm: 42.858492061630855.
Norm before scaling: 42.85530906023707. Distance: 2.013778195316972
Total norm for 4 adversaries is: 42.85530906023707. distance: 2.013778195316972
___Test Local_ResNet_18 poisoned: True, epoch: 82: Average loss: 0.1824, Accuracy: 9441/9900 (95.3636%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  82, local model 71, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4487/5066 (88.5709%), train_poison_data_count: 400
Global model norm: 42.858492061630855.
Norm before scaling: 42.86385207203297. Distance: 2.2488292191161356
Total norm for 4 adversaries is: 42.86385207203297. distance: 2.2488292191161356
___Test Local_ResNet_18 poisoned: True, epoch: 82: Average loss: 0.2026, Accuracy: 9372/9900 (94.6667%)
___Train Local_ResNet_18,  epoch  82, local model 20, internal_epoch   1,  Average loss: 0.0051, Accuracy: 3909/4315 (90.5910%)
___Train Local_ResNet_18,  epoch  82, local model 20, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3929/4315 (91.0545%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.8992, Accuracy: 5612/10000 (56.1200%)
___Train Local_ResNet_18,  epoch  82, local model 63, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3218/3590 (89.6379%)
___Train Local_ResNet_18,  epoch  82, local model 63, internal_epoch   2,  Average loss: 0.0060, Accuracy: 3224/3590 (89.8050%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 2.0742, Accuracy: 5427/10000 (54.2700%)
___Train Local_ResNet_18,  epoch  82, local model 96, internal_epoch   1,  Average loss: 0.0049, Accuracy: 4234/4679 (90.4894%)
___Train Local_ResNet_18,  epoch  82, local model 96, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4299/4679 (91.8786%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.9419, Accuracy: 5510/10000 (55.1000%)
___Train Local_ResNet_18,  epoch  82, local model 35, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4573/5167 (88.5040%)
___Train Local_ResNet_18,  epoch  82, local model 35, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4656/5167 (90.1103%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 2.0846, Accuracy: 5343/10000 (53.4300%)
___Train Local_ResNet_18,  epoch  82, local model 51, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3348/3775 (88.6887%)
___Train Local_ResNet_18,  epoch  82, local model 51, internal_epoch   2,  Average loss: 0.0035, Accuracy: 3533/3775 (93.5894%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.8298, Accuracy: 5740/10000 (57.4000%)
___Train Local_ResNet_18,  epoch  82, local model 98, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3376/3828 (88.1923%)
___Train Local_ResNet_18,  epoch  82, local model 98, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3510/3828 (91.6928%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.8988, Accuracy: 5570/10000 (55.7000%)
___Train Local_ResNet_18,  epoch  82, local model 73, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3741/4235 (88.3353%)
___Train Local_ResNet_18,  epoch  82, local model 73, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3850/4235 (90.9091%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.8537, Accuracy: 5681/10000 (56.8100%)
___Train Local_ResNet_18,  epoch  82, local model 77, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4098/4647 (88.1859%)
___Train Local_ResNet_18,  epoch  82, local model 77, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4232/4647 (91.0695%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.9390, Accuracy: 5511/10000 (55.1100%)
___Train Local_ResNet_18,  epoch  82, local model 3, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4307/4918 (87.5763%)
___Train Local_ResNet_18,  epoch  82, local model 3, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4437/4918 (90.2196%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 2.0482, Accuracy: 5204/10000 (52.0400%)
___Train Local_ResNet_18,  epoch  82, local model 33, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3968/4433 (89.5105%)
___Train Local_ResNet_18,  epoch  82, local model 33, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4023/4433 (90.7512%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.9554, Accuracy: 5601/10000 (56.0100%)
___Train Local_ResNet_18,  epoch  82, local model 7, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3985/4481 (88.9310%)
___Train Local_ResNet_18,  epoch  82, local model 7, internal_epoch   2,  Average loss: 0.0072, Accuracy: 3959/4481 (88.3508%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.9562, Accuracy: 5656/10000 (56.5600%)
___Train Local_ResNet_18,  epoch  82, local model 75, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3764/4295 (87.6368%)
___Train Local_ResNet_18,  epoch  82, local model 75, internal_epoch   2,  Average loss: 0.0073, Accuracy: 3698/4295 (86.1001%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 2.1521, Accuracy: 5152/10000 (51.5200%)
___Train Local_ResNet_18,  epoch  82, local model 64, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3977/4503 (88.3189%)
___Train Local_ResNet_18,  epoch  82, local model 64, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4030/4503 (89.4959%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.9360, Accuracy: 5499/10000 (54.9900%)
___Train Local_ResNet_18,  epoch  82, local model 37, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3905/4354 (89.6876%)
___Train Local_ResNet_18,  epoch  82, local model 37, internal_epoch   2,  Average loss: 0.0078, Accuracy: 3715/4354 (85.3238%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 2.5844, Accuracy: 4793/10000 (47.9300%)
___Train Local_ResNet_18,  epoch  82, local model 1, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4442/4986 (89.0895%)
___Train Local_ResNet_18,  epoch  82, local model 1, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4509/4986 (90.4332%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.9702, Accuracy: 5543/10000 (55.4300%)
___Train Local_ResNet_18,  epoch  82, local model 92, internal_epoch   1,  Average loss: 0.0058, Accuracy: 5570/6263 (88.9350%)
___Train Local_ResNet_18,  epoch  82, local model 92, internal_epoch   2,  Average loss: 0.0042, Accuracy: 5770/6263 (92.1284%)
___Test Local_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.9085, Accuracy: 5594/10000 (55.9400%)
time spent on training: 269.272221326828
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 82: Average loss: 1.3380, Accuracy: 6681/10000 (66.8100%)
___Test Target_ResNet_18 poisoned: True, epoch: 82: Average loss: 10.2590, Accuracy: 62/9900 (0.6263%)
Done in 300.12034821510315 sec.
Server Epoch:83 choose agents : [13, 36, 58, 71, 27, 40, 15, 99, 32, 18, 55, 45, 96, 90, 34, 12, 69, 49, 68, 48].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  83, local model 13, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4391/4885 (89.8874%), train_poison_data_count: 385
Global model norm: 42.89571207309435.
Norm before scaling: 42.895071775405476. Distance: 2.111453805124113
Total norm for 4 adversaries is: 42.895071775405476. distance: 2.111453805124113
___Test Local_ResNet_18 poisoned: True, epoch: 83: Average loss: 0.1667, Accuracy: 9496/9900 (95.9192%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  83, local model 36, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4695/5305 (88.5014%), train_poison_data_count: 415
Global model norm: 42.89571207309435.
Norm before scaling: 42.89875833630707. Distance: 2.294684682722517
Total norm for 4 adversaries is: 42.89875833630707. distance: 2.294684682722517
___Test Local_ResNet_18 poisoned: True, epoch: 83: Average loss: 0.0696, Accuracy: 9732/9900 (98.3030%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  83, local model 58, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4224/4717 (89.5484%), train_poison_data_count: 370
Global model norm: 42.89571207309435.
Norm before scaling: 42.89585151443479. Distance: 2.0679435564155884
Total norm for 4 adversaries is: 42.89585151443479. distance: 2.0679435564155884
___Test Local_ResNet_18 poisoned: True, epoch: 83: Average loss: 0.1532, Accuracy: 9519/9900 (96.1515%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  83, local model 71, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4463/5066 (88.0971%), train_poison_data_count: 400
Global model norm: 42.89571207309435.
Norm before scaling: 42.900578023222046. Distance: 2.268483640729921
Total norm for 4 adversaries is: 42.900578023222046. distance: 2.268483640729921
___Test Local_ResNet_18 poisoned: True, epoch: 83: Average loss: 0.0958, Accuracy: 9666/9900 (97.6364%)
___Train Local_ResNet_18,  epoch  83, local model 27, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3713/4223 (87.9233%)
___Train Local_ResNet_18,  epoch  83, local model 27, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3851/4223 (91.1911%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.9732, Accuracy: 5407/10000 (54.0700%)
___Train Local_ResNet_18,  epoch  83, local model 40, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4840/5455 (88.7259%)
___Train Local_ResNet_18,  epoch  83, local model 40, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4869/5455 (89.2576%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 2.0688, Accuracy: 5272/10000 (52.7200%)
___Train Local_ResNet_18,  epoch  83, local model 15, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4980/5582 (89.2153%)
___Train Local_ResNet_18,  epoch  83, local model 15, internal_epoch   2,  Average loss: 0.0043, Accuracy: 5123/5582 (91.7771%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 2.0042, Accuracy: 5411/10000 (54.1100%)
___Train Local_ResNet_18,  epoch  83, local model 99, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3949/4465 (88.4434%)
___Train Local_ResNet_18,  epoch  83, local model 99, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4092/4465 (91.6461%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.8617, Accuracy: 5732/10000 (57.3200%)
___Train Local_ResNet_18,  epoch  83, local model 32, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4900/5591 (87.6409%)
___Train Local_ResNet_18,  epoch  83, local model 32, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4977/5591 (89.0181%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 2.1849, Accuracy: 5178/10000 (51.7800%)
___Train Local_ResNet_18,  epoch  83, local model 18, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3484/3911 (89.0821%)
___Train Local_ResNet_18,  epoch  83, local model 18, internal_epoch   2,  Average loss: 0.0070, Accuracy: 3392/3911 (86.7297%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.9961, Accuracy: 5467/10000 (54.6700%)
___Train Local_ResNet_18,  epoch  83, local model 55, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3927/4356 (90.1515%)
___Train Local_ResNet_18,  epoch  83, local model 55, internal_epoch   2,  Average loss: 0.0122, Accuracy: 3412/4356 (78.3287%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 2.5553, Accuracy: 4621/10000 (46.2100%)
___Train Local_ResNet_18,  epoch  83, local model 45, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4414/5037 (87.6315%)
___Train Local_ResNet_18,  epoch  83, local model 45, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4537/5037 (90.0735%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.9098, Accuracy: 5495/10000 (54.9500%)
___Train Local_ResNet_18,  epoch  83, local model 96, internal_epoch   1,  Average loss: 0.0048, Accuracy: 4242/4679 (90.6604%)
___Train Local_ResNet_18,  epoch  83, local model 96, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4336/4679 (92.6694%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 2.0216, Accuracy: 5412/10000 (54.1200%)
___Train Local_ResNet_18,  epoch  83, local model 90, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3926/4362 (90.0046%)
___Train Local_ResNet_18,  epoch  83, local model 90, internal_epoch   2,  Average loss: 0.0055, Accuracy: 3928/4362 (90.0504%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 2.1413, Accuracy: 5208/10000 (52.0800%)
___Train Local_ResNet_18,  epoch  83, local model 34, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4046/4518 (89.5529%)
___Train Local_ResNet_18,  epoch  83, local model 34, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4118/4518 (91.1465%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.9879, Accuracy: 5404/10000 (54.0400%)
___Train Local_ResNet_18,  epoch  83, local model 12, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4457/5083 (87.6844%)
___Train Local_ResNet_18,  epoch  83, local model 12, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4494/5083 (88.4124%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 2.1391, Accuracy: 5166/10000 (51.6600%)
___Train Local_ResNet_18,  epoch  83, local model 69, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3555/4013 (88.5871%)
___Train Local_ResNet_18,  epoch  83, local model 69, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3716/4013 (92.5991%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.7798, Accuracy: 5709/10000 (57.0900%)
___Train Local_ResNet_18,  epoch  83, local model 49, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4559/5197 (87.7237%)
___Train Local_ResNet_18,  epoch  83, local model 49, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4707/5197 (90.5715%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.9986, Accuracy: 5459/10000 (54.5900%)
___Train Local_ResNet_18,  epoch  83, local model 68, internal_epoch   1,  Average loss: 0.0061, Accuracy: 2920/3297 (88.5654%)
___Train Local_ResNet_18,  epoch  83, local model 68, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3032/3297 (91.9624%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.8734, Accuracy: 5586/10000 (55.8600%)
___Train Local_ResNet_18,  epoch  83, local model 48, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3968/4441 (89.3492%)
___Train Local_ResNet_18,  epoch  83, local model 48, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4051/4441 (91.2182%)
___Test Local_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.9921, Accuracy: 5545/10000 (55.4500%)
time spent on training: 270.4436209201813
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 83: Average loss: 1.4213, Accuracy: 6591/10000 (65.9100%)
___Test Target_ResNet_18 poisoned: True, epoch: 83: Average loss: 10.3938, Accuracy: 42/9900 (0.4242%)
Done in 301.3706521987915 sec.
Server Epoch:84 choose agents : [13, 36, 58, 71, 8, 17, 37, 29, 47, 32, 77, 6, 88, 94, 92, 7, 62, 27, 48, 26].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  84, local model 13, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4367/4885 (89.3961%), train_poison_data_count: 385
Global model norm: 42.93805011246945.
Norm before scaling: 42.938500716140524. Distance: 2.1239064712765647
Total norm for 4 adversaries is: 42.938500716140524. distance: 2.1239064712765647
___Test Local_ResNet_18 poisoned: True, epoch: 84: Average loss: 0.2760, Accuracy: 9259/9900 (93.5253%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  84, local model 36, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4729/5305 (89.1423%), train_poison_data_count: 415
Global model norm: 42.93805011246945.
Norm before scaling: 42.93786105652417. Distance: 2.2141538484044636
Total norm for 4 adversaries is: 42.93786105652417. distance: 2.2141538484044636
___Test Local_ResNet_18 poisoned: True, epoch: 84: Average loss: 0.2638, Accuracy: 9292/9900 (93.8586%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  84, local model 58, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4242/4717 (89.9300%), train_poison_data_count: 370
Global model norm: 42.93805011246945.
Norm before scaling: 42.93653195551764. Distance: 2.0489001556913267
Total norm for 4 adversaries is: 42.93653195551764. distance: 2.0489001556913267
___Test Local_ResNet_18 poisoned: True, epoch: 84: Average loss: 0.3881, Accuracy: 8931/9900 (90.2121%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  84, local model 71, internal_epoch   1,  Average loss: 0.0076, Accuracy: 4458/5066 (87.9984%), train_poison_data_count: 400
Global model norm: 42.93805011246945.
Norm before scaling: 42.942450758526086. Distance: 2.2956597882799166
Total norm for 4 adversaries is: 42.942450758526086. distance: 2.2956597882799166
___Test Local_ResNet_18 poisoned: True, epoch: 84: Average loss: 0.3247, Accuracy: 9089/9900 (91.8081%)
___Train Local_ResNet_18,  epoch  84, local model 8, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3964/4501 (88.0693%)
___Train Local_ResNet_18,  epoch  84, local model 8, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4052/4501 (90.0244%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 2.0150, Accuracy: 5472/10000 (54.7200%)
___Train Local_ResNet_18,  epoch  84, local model 17, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3942/4511 (87.3864%)
___Train Local_ResNet_18,  epoch  84, local model 17, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4107/4511 (91.0441%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.9112, Accuracy: 5514/10000 (55.1400%)
___Train Local_ResNet_18,  epoch  84, local model 37, internal_epoch   1,  Average loss: 0.0047, Accuracy: 3997/4354 (91.8006%)
___Train Local_ResNet_18,  epoch  84, local model 37, internal_epoch   2,  Average loss: 0.0090, Accuracy: 3634/4354 (83.4635%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 2.4239, Accuracy: 4697/10000 (46.9700%)
___Train Local_ResNet_18,  epoch  84, local model 29, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3900/4346 (89.7377%)
___Train Local_ResNet_18,  epoch  84, local model 29, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3993/4346 (91.8776%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.9677, Accuracy: 5504/10000 (55.0400%)
___Train Local_ResNet_18,  epoch  84, local model 47, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4139/4707 (87.9329%)
___Train Local_ResNet_18,  epoch  84, local model 47, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4279/4707 (90.9072%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.9320, Accuracy: 5501/10000 (55.0100%)
___Train Local_ResNet_18,  epoch  84, local model 32, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4825/5591 (86.2994%)
___Train Local_ResNet_18,  epoch  84, local model 32, internal_epoch   2,  Average loss: 0.0063, Accuracy: 4894/5591 (87.5335%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 2.0695, Accuracy: 5288/10000 (52.8800%)
___Train Local_ResNet_18,  epoch  84, local model 77, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4052/4647 (87.1960%)
___Train Local_ResNet_18,  epoch  84, local model 77, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4222/4647 (90.8543%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.9036, Accuracy: 5603/10000 (56.0300%)
___Train Local_ResNet_18,  epoch  84, local model 6, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4020/4538 (88.5853%)
___Train Local_ResNet_18,  epoch  84, local model 6, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4176/4538 (92.0229%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.9322, Accuracy: 5627/10000 (56.2700%)
___Train Local_ResNet_18,  epoch  84, local model 88, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4291/4934 (86.9680%)
___Train Local_ResNet_18,  epoch  84, local model 88, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4415/4934 (89.4812%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 2.0526, Accuracy: 5401/10000 (54.0100%)
___Train Local_ResNet_18,  epoch  84, local model 94, internal_epoch   1,  Average loss: 0.0051, Accuracy: 4343/4804 (90.4038%)
___Train Local_ResNet_18,  epoch  84, local model 94, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4351/4804 (90.5704%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 2.0162, Accuracy: 5544/10000 (55.4400%)
___Train Local_ResNet_18,  epoch  84, local model 92, internal_epoch   1,  Average loss: 0.0057, Accuracy: 5577/6263 (89.0468%)
___Train Local_ResNet_18,  epoch  84, local model 92, internal_epoch   2,  Average loss: 0.0049, Accuracy: 5647/6263 (90.1645%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 2.1630, Accuracy: 5174/10000 (51.7400%)
___Train Local_ResNet_18,  epoch  84, local model 7, internal_epoch   1,  Average loss: 0.0071, Accuracy: 3979/4481 (88.7971%)
___Train Local_ResNet_18,  epoch  84, local model 7, internal_epoch   2,  Average loss: 0.0067, Accuracy: 3993/4481 (89.1096%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 2.0577, Accuracy: 5401/10000 (54.0100%)
___Train Local_ResNet_18,  epoch  84, local model 62, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4347/5063 (85.8582%)
___Train Local_ResNet_18,  epoch  84, local model 62, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4452/5063 (87.9321%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.9445, Accuracy: 5545/10000 (55.4500%)
___Train Local_ResNet_18,  epoch  84, local model 27, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3666/4223 (86.8103%)
___Train Local_ResNet_18,  epoch  84, local model 27, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3860/4223 (91.4042%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 2.0432, Accuracy: 5376/10000 (53.7600%)
___Train Local_ResNet_18,  epoch  84, local model 48, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3969/4441 (89.3718%)
___Train Local_ResNet_18,  epoch  84, local model 48, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4085/4441 (91.9838%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 2.0657, Accuracy: 5407/10000 (54.0700%)
___Train Local_ResNet_18,  epoch  84, local model 26, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3332/3756 (88.7114%)
___Train Local_ResNet_18,  epoch  84, local model 26, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3486/3756 (92.8115%)
___Test Local_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.9405, Accuracy: 5589/10000 (55.8900%)
time spent on training: 271.9369070529938
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 84: Average loss: 1.4197, Accuracy: 6583/10000 (65.8300%)
___Test Target_ResNet_18 poisoned: True, epoch: 84: Average loss: 10.6997, Accuracy: 45/9900 (0.4545%)
Done in 302.7275414466858 sec.
Server Epoch:85 choose agents : [13, 36, 58, 71, 11, 16, 60, 69, 91, 15, 40, 37, 33, 2, 34, 73, 90, 70, 32, 26].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  85, local model 13, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4374/4885 (89.5394%), train_poison_data_count: 385
Global model norm: 42.977266201519264.
Norm before scaling: 42.979130848314774. Distance: 2.1753078199023066
Total norm for 4 adversaries is: 42.979130848314774. distance: 2.1753078199023066
___Test Local_ResNet_18 poisoned: True, epoch: 85: Average loss: 0.1266, Accuracy: 9571/9900 (96.6768%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  85, local model 36, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4723/5305 (89.0292%), train_poison_data_count: 415
Global model norm: 42.977266201519264.
Norm before scaling: 42.97680606298007. Distance: 2.276472864107826
Total norm for 4 adversaries is: 42.97680606298007. distance: 2.276472864107826
___Test Local_ResNet_18 poisoned: True, epoch: 85: Average loss: 0.0580, Accuracy: 9746/9900 (98.4444%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  85, local model 58, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4193/4717 (88.8912%), train_poison_data_count: 370
Global model norm: 42.977266201519264.
Norm before scaling: 42.97994740464732. Distance: 2.1089021505969017
Total norm for 4 adversaries is: 42.97994740464732. distance: 2.1089021505969017
___Test Local_ResNet_18 poisoned: True, epoch: 85: Average loss: 0.2720, Accuracy: 9213/9900 (93.0606%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  85, local model 71, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4467/5066 (88.1761%), train_poison_data_count: 400
Global model norm: 42.977266201519264.
Norm before scaling: 42.98380560100877. Distance: 2.3168037163609787
Total norm for 4 adversaries is: 42.98380560100877. distance: 2.3168037163609787
___Test Local_ResNet_18 poisoned: True, epoch: 85: Average loss: 0.2324, Accuracy: 9292/9900 (93.8586%)
___Train Local_ResNet_18,  epoch  85, local model 11, internal_epoch   1,  Average loss: 0.0080, Accuracy: 4420/5244 (84.2868%)
___Train Local_ResNet_18,  epoch  85, local model 11, internal_epoch   2,  Average loss: 0.0066, Accuracy: 4555/5244 (86.8612%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 2.0785, Accuracy: 5293/10000 (52.9300%)
___Train Local_ResNet_18,  epoch  85, local model 16, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4307/4928 (87.3985%)
___Train Local_ResNet_18,  epoch  85, local model 16, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4477/4928 (90.8482%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.8987, Accuracy: 5666/10000 (56.6600%)
___Train Local_ResNet_18,  epoch  85, local model 60, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3386/3804 (89.0116%)
___Train Local_ResNet_18,  epoch  85, local model 60, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3500/3804 (92.0084%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.9341, Accuracy: 5567/10000 (55.6700%)
___Train Local_ResNet_18,  epoch  85, local model 69, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3562/4013 (88.7615%)
___Train Local_ResNet_18,  epoch  85, local model 69, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3682/4013 (91.7518%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.9308, Accuracy: 5565/10000 (55.6500%)
___Train Local_ResNet_18,  epoch  85, local model 91, internal_epoch   1,  Average loss: 0.0078, Accuracy: 3519/4158 (84.6320%)
___Train Local_ResNet_18,  epoch  85, local model 91, internal_epoch   2,  Average loss: 0.0065, Accuracy: 3636/4158 (87.4459%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 2.0595, Accuracy: 5225/10000 (52.2500%)
___Train Local_ResNet_18,  epoch  85, local model 15, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4971/5582 (89.0541%)
___Train Local_ResNet_18,  epoch  85, local model 15, internal_epoch   2,  Average loss: 0.0052, Accuracy: 5037/5582 (90.2365%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 2.0188, Accuracy: 5357/10000 (53.5700%)
___Train Local_ResNet_18,  epoch  85, local model 40, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4818/5455 (88.3226%)
___Train Local_ResNet_18,  epoch  85, local model 40, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4947/5455 (90.6874%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.9202, Accuracy: 5500/10000 (55.0000%)
___Train Local_ResNet_18,  epoch  85, local model 37, internal_epoch   1,  Average loss: 0.0043, Accuracy: 4057/4354 (93.1787%)
___Train Local_ResNet_18,  epoch  85, local model 37, internal_epoch   2,  Average loss: 0.0076, Accuracy: 3763/4354 (86.4263%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 2.6244, Accuracy: 4742/10000 (47.4200%)
___Train Local_ResNet_18,  epoch  85, local model 33, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3921/4433 (88.4503%)
___Train Local_ResNet_18,  epoch  85, local model 33, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3988/4433 (89.9617%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.9194, Accuracy: 5553/10000 (55.5300%)
___Train Local_ResNet_18,  epoch  85, local model 2, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3154/3646 (86.5058%)
___Train Local_ResNet_18,  epoch  85, local model 2, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3343/3646 (91.6895%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.8323, Accuracy: 5664/10000 (56.6400%)
___Train Local_ResNet_18,  epoch  85, local model 34, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4034/4518 (89.2873%)
___Train Local_ResNet_18,  epoch  85, local model 34, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4089/4518 (90.5046%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.9573, Accuracy: 5498/10000 (54.9800%)
___Train Local_ResNet_18,  epoch  85, local model 73, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3737/4235 (88.2409%)
___Train Local_ResNet_18,  epoch  85, local model 73, internal_epoch   2,  Average loss: 0.0057, Accuracy: 3805/4235 (89.8465%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 2.1278, Accuracy: 5240/10000 (52.4000%)
___Train Local_ResNet_18,  epoch  85, local model 90, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3905/4362 (89.5232%)
___Train Local_ResNet_18,  epoch  85, local model 90, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3973/4362 (91.0821%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.9727, Accuracy: 5519/10000 (55.1900%)
___Train Local_ResNet_18,  epoch  85, local model 70, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4758/5392 (88.2418%)
___Train Local_ResNet_18,  epoch  85, local model 70, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4731/5392 (87.7411%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 2.1020, Accuracy: 5389/10000 (53.8900%)
___Train Local_ResNet_18,  epoch  85, local model 32, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4830/5591 (86.3888%)
___Train Local_ResNet_18,  epoch  85, local model 32, internal_epoch   2,  Average loss: 0.0064, Accuracy: 4894/5591 (87.5335%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 2.0866, Accuracy: 5209/10000 (52.0900%)
___Train Local_ResNet_18,  epoch  85, local model 26, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3331/3756 (88.6848%)
___Train Local_ResNet_18,  epoch  85, local model 26, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3450/3756 (91.8530%)
___Test Local_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.9640, Accuracy: 5569/10000 (55.6900%)
time spent on training: 269.87716913223267
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 85: Average loss: 1.4277, Accuracy: 6541/10000 (65.4100%)
___Test Target_ResNet_18 poisoned: True, epoch: 85: Average loss: 10.3997, Accuracy: 74/9900 (0.7475%)
Done in 300.91630506515503 sec.
Server Epoch:86 choose agents : [13, 36, 58, 71, 21, 64, 16, 60, 63, 77, 95, 55, 52, 66, 78, 30, 68, 74, 89, 76].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  86, local model 13, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4384/4885 (89.7441%), train_poison_data_count: 385
Global model norm: 43.01011077533107.
Norm before scaling: 43.014023024565056. Distance: 2.1491973088261638
Total norm for 4 adversaries is: 43.014023024565056. distance: 2.1491973088261638
___Test Local_ResNet_18 poisoned: True, epoch: 86: Average loss: 0.1452, Accuracy: 9515/9900 (96.1111%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  86, local model 36, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4691/5305 (88.4260%), train_poison_data_count: 415
Global model norm: 43.01011077533107.
Norm before scaling: 43.012359971891364. Distance: 2.3054706859160374
Total norm for 4 adversaries is: 43.012359971891364. distance: 2.3054706859160374
___Test Local_ResNet_18 poisoned: True, epoch: 86: Average loss: 0.0314, Accuracy: 9811/9900 (99.1010%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  86, local model 58, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4162/4717 (88.2340%), train_poison_data_count: 370
Global model norm: 43.01011077533107.
Norm before scaling: 43.01257424252529. Distance: 2.156714900664954
Total norm for 4 adversaries is: 43.01257424252529. distance: 2.156714900664954
___Test Local_ResNet_18 poisoned: True, epoch: 86: Average loss: 0.1491, Accuracy: 9538/9900 (96.3434%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  86, local model 71, internal_epoch   1,  Average loss: 0.0075, Accuracy: 4419/5066 (87.2286%), train_poison_data_count: 400
Global model norm: 43.01011077533107.
Norm before scaling: 43.01788667773848. Distance: 2.3926391095544135
Total norm for 4 adversaries is: 43.01788667773848. distance: 2.3926391095544135
___Test Local_ResNet_18 poisoned: True, epoch: 86: Average loss: 0.0926, Accuracy: 9664/9900 (97.6162%)
___Train Local_ResNet_18,  epoch  86, local model 21, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4080/4634 (88.0449%)
___Train Local_ResNet_18,  epoch  86, local model 21, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4199/4634 (90.6129%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.9084, Accuracy: 5629/10000 (56.2900%)
___Train Local_ResNet_18,  epoch  86, local model 64, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3958/4503 (87.8970%)
___Train Local_ResNet_18,  epoch  86, local model 64, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4018/4503 (89.2294%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 2.0612, Accuracy: 5376/10000 (53.7600%)
___Train Local_ResNet_18,  epoch  86, local model 16, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4283/4928 (86.9115%)
___Train Local_ResNet_18,  epoch  86, local model 16, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4500/4928 (91.3149%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.7875, Accuracy: 5796/10000 (57.9600%)
___Train Local_ResNet_18,  epoch  86, local model 60, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3325/3804 (87.4080%)
___Train Local_ResNet_18,  epoch  86, local model 60, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3454/3804 (90.7992%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.9562, Accuracy: 5546/10000 (55.4600%)
___Train Local_ResNet_18,  epoch  86, local model 63, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3150/3590 (87.7437%)
___Train Local_ResNet_18,  epoch  86, local model 63, internal_epoch   2,  Average loss: 0.0064, Accuracy: 3169/3590 (88.2730%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 2.1004, Accuracy: 5370/10000 (53.7000%)
___Train Local_ResNet_18,  epoch  86, local model 77, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4054/4647 (87.2391%)
___Train Local_ResNet_18,  epoch  86, local model 77, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4237/4647 (91.1771%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.9380, Accuracy: 5494/10000 (54.9400%)
___Train Local_ResNet_18,  epoch  86, local model 95, internal_epoch   1,  Average loss: 0.0079, Accuracy: 3936/4625 (85.1027%)
___Train Local_ResNet_18,  epoch  86, local model 95, internal_epoch   2,  Average loss: 0.0062, Accuracy: 4035/4625 (87.2432%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 2.1471, Accuracy: 5380/10000 (53.8000%)
___Train Local_ResNet_18,  epoch  86, local model 55, internal_epoch   1,  Average loss: 0.0044, Accuracy: 3985/4356 (91.4830%)
___Train Local_ResNet_18,  epoch  86, local model 55, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4030/4356 (92.5161%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.9176, Accuracy: 5632/10000 (56.3200%)
___Train Local_ResNet_18,  epoch  86, local model 52, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3334/3797 (87.8062%)
___Train Local_ResNet_18,  epoch  86, local model 52, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3459/3797 (91.0982%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 2.0004, Accuracy: 5513/10000 (55.1300%)
___Train Local_ResNet_18,  epoch  86, local model 66, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3969/4456 (89.0709%)
___Train Local_ResNet_18,  epoch  86, local model 66, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4084/4456 (91.6517%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.8724, Accuracy: 5759/10000 (57.5900%)
___Train Local_ResNet_18,  epoch  86, local model 78, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3561/4025 (88.4720%)
___Train Local_ResNet_18,  epoch  86, local model 78, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3717/4025 (92.3478%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.8678, Accuracy: 5655/10000 (56.5500%)
___Train Local_ResNet_18,  epoch  86, local model 30, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3069/3472 (88.3929%)
___Train Local_ResNet_18,  epoch  86, local model 30, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3153/3472 (90.8122%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.9774, Accuracy: 5495/10000 (54.9500%)
___Train Local_ResNet_18,  epoch  86, local model 68, internal_epoch   1,  Average loss: 0.0067, Accuracy: 2867/3297 (86.9578%)
___Train Local_ResNet_18,  epoch  86, local model 68, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3029/3297 (91.8714%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.8803, Accuracy: 5631/10000 (56.3100%)
___Train Local_ResNet_18,  epoch  86, local model 74, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3813/4416 (86.3451%)
___Train Local_ResNet_18,  epoch  86, local model 74, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3995/4416 (90.4665%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.9818, Accuracy: 5502/10000 (55.0200%)
___Train Local_ResNet_18,  epoch  86, local model 89, internal_epoch   1,  Average loss: 0.0049, Accuracy: 3947/4356 (90.6107%)
___Train Local_ResNet_18,  epoch  86, local model 89, internal_epoch   2,  Average loss: 0.0036, Accuracy: 4076/4356 (93.5721%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.9668, Accuracy: 5559/10000 (55.5900%)
___Train Local_ResNet_18,  epoch  86, local model 76, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3132/3638 (86.0913%)
___Train Local_ResNet_18,  epoch  86, local model 76, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3313/3638 (91.0665%)
___Test Local_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.8200, Accuracy: 5643/10000 (56.4300%)
time spent on training: 261.3938612937927
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 86: Average loss: 1.3882, Accuracy: 6600/10000 (66.0000%)
___Test Target_ResNet_18 poisoned: True, epoch: 86: Average loss: 10.4827, Accuracy: 53/9900 (0.5354%)
Done in 292.3254783153534 sec.
Server Epoch:87 choose agents : [13, 36, 58, 71, 31, 46, 45, 84, 60, 70, 99, 5, 53, 83, 63, 8, 22, 87, 27, 37].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  87, local model 13, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4354/4885 (89.1300%), train_poison_data_count: 385
Global model norm: 43.044444690923825.
Norm before scaling: 43.04852963017799. Distance: 2.2194592054330036
Total norm for 4 adversaries is: 43.04852963017799. distance: 2.2194592054330036
___Test Local_ResNet_18 poisoned: True, epoch: 87: Average loss: 0.1955, Accuracy: 9451/9900 (95.4646%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  87, local model 36, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4714/5305 (88.8596%), train_poison_data_count: 415
Global model norm: 43.044444690923825.
Norm before scaling: 43.04521179863171. Distance: 2.2512709948436065
Total norm for 4 adversaries is: 43.04521179863171. distance: 2.2512709948436065
___Test Local_ResNet_18 poisoned: True, epoch: 87: Average loss: 0.1730, Accuracy: 9460/9900 (95.5556%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  87, local model 58, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4204/4717 (89.1244%), train_poison_data_count: 370
Global model norm: 43.044444690923825.
Norm before scaling: 43.04123573542949. Distance: 2.077935575872555
Total norm for 4 adversaries is: 43.04123573542949. distance: 2.077935575872555
___Test Local_ResNet_18 poisoned: True, epoch: 87: Average loss: 0.1018, Accuracy: 9632/9900 (97.2929%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  87, local model 71, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4465/5066 (88.1366%), train_poison_data_count: 400
Global model norm: 43.044444690923825.
Norm before scaling: 43.05083920040787. Distance: 2.2959372753653593
Total norm for 4 adversaries is: 43.05083920040787. distance: 2.2959372753653593
___Test Local_ResNet_18 poisoned: True, epoch: 87: Average loss: 0.1348, Accuracy: 9579/9900 (96.7576%)
___Train Local_ResNet_18,  epoch  87, local model 31, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3610/4175 (86.4671%)
___Train Local_ResNet_18,  epoch  87, local model 31, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3708/4175 (88.8144%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.9351, Accuracy: 5471/10000 (54.7100%)
___Train Local_ResNet_18,  epoch  87, local model 46, internal_epoch   1,  Average loss: 0.0076, Accuracy: 4222/4956 (85.1897%)
___Train Local_ResNet_18,  epoch  87, local model 46, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4417/4956 (89.1243%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.9841, Accuracy: 5545/10000 (55.4500%)
___Train Local_ResNet_18,  epoch  87, local model 45, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4380/5037 (86.9565%)
___Train Local_ResNet_18,  epoch  87, local model 45, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4584/5037 (91.0066%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.9665, Accuracy: 5428/10000 (54.2800%)
___Train Local_ResNet_18,  epoch  87, local model 84, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4160/4793 (86.7932%)
___Train Local_ResNet_18,  epoch  87, local model 84, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4311/4793 (89.9437%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.9466, Accuracy: 5509/10000 (55.0900%)
___Train Local_ResNet_18,  epoch  87, local model 60, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3332/3804 (87.5920%)
___Train Local_ResNet_18,  epoch  87, local model 60, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3428/3804 (90.1157%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.9559, Accuracy: 5508/10000 (55.0800%)
___Train Local_ResNet_18,  epoch  87, local model 70, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4749/5392 (88.0749%)
___Train Local_ResNet_18,  epoch  87, local model 70, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4804/5392 (89.0950%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.0169, Accuracy: 5493/10000 (54.9300%)
___Train Local_ResNet_18,  epoch  87, local model 99, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3919/4465 (87.7716%)
___Train Local_ResNet_18,  epoch  87, local model 99, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4081/4465 (91.3998%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.9254, Accuracy: 5523/10000 (55.2300%)
___Train Local_ResNet_18,  epoch  87, local model 5, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4084/4596 (88.8599%)
___Train Local_ResNet_18,  epoch  87, local model 5, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4244/4596 (92.3412%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.0077, Accuracy: 5473/10000 (54.7300%)
___Train Local_ResNet_18,  epoch  87, local model 53, internal_epoch   1,  Average loss: 0.0062, Accuracy: 5382/6124 (87.8837%)
___Train Local_ResNet_18,  epoch  87, local model 53, internal_epoch   2,  Average loss: 0.0056, Accuracy: 5441/6124 (88.8472%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.0397, Accuracy: 5303/10000 (53.0300%)
___Train Local_ResNet_18,  epoch  87, local model 83, internal_epoch   1,  Average loss: 0.0067, Accuracy: 2855/3271 (87.2822%)
___Train Local_ResNet_18,  epoch  87, local model 83, internal_epoch   2,  Average loss: 0.0051, Accuracy: 2959/3271 (90.4616%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.9378, Accuracy: 5526/10000 (55.2600%)
___Train Local_ResNet_18,  epoch  87, local model 63, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3169/3590 (88.2730%)
___Train Local_ResNet_18,  epoch  87, local model 63, internal_epoch   2,  Average loss: 0.0060, Accuracy: 3216/3590 (89.5822%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.0080, Accuracy: 5547/10000 (55.4700%)
___Train Local_ResNet_18,  epoch  87, local model 8, internal_epoch   1,  Average loss: 0.0071, Accuracy: 3861/4501 (85.7809%)
___Train Local_ResNet_18,  epoch  87, local model 8, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4018/4501 (89.2691%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.1879, Accuracy: 5200/10000 (52.0000%)
___Train Local_ResNet_18,  epoch  87, local model 22, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4547/5232 (86.9075%)
___Train Local_ResNet_18,  epoch  87, local model 22, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4634/5232 (88.5703%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.1293, Accuracy: 5185/10000 (51.8500%)
___Train Local_ResNet_18,  epoch  87, local model 87, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3208/3672 (87.3638%)
___Train Local_ResNet_18,  epoch  87, local model 87, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3277/3672 (89.2429%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.0850, Accuracy: 5391/10000 (53.9100%)
___Train Local_ResNet_18,  epoch  87, local model 27, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3692/4223 (87.4260%)
___Train Local_ResNet_18,  epoch  87, local model 27, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3832/4223 (90.7412%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.9065, Accuracy: 5653/10000 (56.5300%)
___Train Local_ResNet_18,  epoch  87, local model 37, internal_epoch   1,  Average loss: 0.0036, Accuracy: 4125/4354 (94.7405%)
___Train Local_ResNet_18,  epoch  87, local model 37, internal_epoch   2,  Average loss: 0.0108, Accuracy: 3518/4354 (80.7993%)
___Test Local_ResNet_18 poisoned: False, epoch: 87: Average loss: 2.4807, Accuracy: 4738/10000 (47.3800%)
time spent on training: 268.02441692352295
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 87: Average loss: 1.4456, Accuracy: 6490/10000 (64.9000%)
___Test Target_ResNet_18 poisoned: True, epoch: 87: Average loss: 10.0854, Accuracy: 111/9900 (1.1212%)
Done in 299.18216156959534 sec.
Server Epoch:88 choose agents : [13, 36, 58, 71, 15, 77, 99, 12, 74, 46, 90, 55, 79, 63, 93, 44, 30, 42, 83, 45].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  88, local model 13, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4374/4885 (89.5394%), train_poison_data_count: 385
Global model norm: 43.089240155606134.
Norm before scaling: 43.09313247382058. Distance: 2.1605864332761
Total norm for 4 adversaries is: 43.09313247382058. distance: 2.1605864332761
___Test Local_ResNet_18 poisoned: True, epoch: 88: Average loss: 0.2017, Accuracy: 9404/9900 (94.9899%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  88, local model 36, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4743/5305 (89.4062%), train_poison_data_count: 415
Global model norm: 43.089240155606134.
Norm before scaling: 43.08914525117158. Distance: 2.210010347644177
Total norm for 4 adversaries is: 43.08914525117158. distance: 2.210010347644177
___Test Local_ResNet_18 poisoned: True, epoch: 88: Average loss: 0.1261, Accuracy: 9598/9900 (96.9495%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  88, local model 58, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4165/4717 (88.2976%), train_poison_data_count: 370
Global model norm: 43.089240155606134.
Norm before scaling: 43.09053480119648. Distance: 2.1874315523610446
Total norm for 4 adversaries is: 43.09053480119648. distance: 2.1874315523610446
___Test Local_ResNet_18 poisoned: True, epoch: 88: Average loss: 0.0610, Accuracy: 9750/9900 (98.4848%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  88, local model 71, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4432/5066 (87.4852%), train_poison_data_count: 400
Global model norm: 43.089240155606134.
Norm before scaling: 43.09697628876503. Distance: 2.307007736980162
Total norm for 4 adversaries is: 43.09697628876503. distance: 2.307007736980162
___Test Local_ResNet_18 poisoned: True, epoch: 88: Average loss: 0.1397, Accuracy: 9548/9900 (96.4444%)
___Train Local_ResNet_18,  epoch  88, local model 15, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4943/5582 (88.5525%)
___Train Local_ResNet_18,  epoch  88, local model 15, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4985/5582 (89.3049%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 2.1021, Accuracy: 5314/10000 (53.1400%)
___Train Local_ResNet_18,  epoch  88, local model 77, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4012/4647 (86.3353%)
___Train Local_ResNet_18,  epoch  88, local model 77, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4222/4647 (90.8543%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.9634, Accuracy: 5512/10000 (55.1200%)
___Train Local_ResNet_18,  epoch  88, local model 99, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3921/4465 (87.8163%)
___Train Local_ResNet_18,  epoch  88, local model 99, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4111/4465 (92.0717%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.8658, Accuracy: 5731/10000 (57.3100%)
___Train Local_ResNet_18,  epoch  88, local model 12, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4401/5083 (86.5827%)
___Train Local_ResNet_18,  epoch  88, local model 12, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4488/5083 (88.2943%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 2.0822, Accuracy: 5352/10000 (53.5200%)
___Train Local_ResNet_18,  epoch  88, local model 74, internal_epoch   1,  Average loss: 0.0077, Accuracy: 3732/4416 (84.5109%)
___Train Local_ResNet_18,  epoch  88, local model 74, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3995/4416 (90.4665%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.9059, Accuracy: 5536/10000 (55.3600%)
___Train Local_ResNet_18,  epoch  88, local model 46, internal_epoch   1,  Average loss: 0.0075, Accuracy: 4228/4956 (85.3107%)
___Train Local_ResNet_18,  epoch  88, local model 46, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4377/4956 (88.3172%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 2.1776, Accuracy: 5144/10000 (51.4400%)
___Train Local_ResNet_18,  epoch  88, local model 90, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3862/4362 (88.5374%)
___Train Local_ResNet_18,  epoch  88, local model 90, internal_epoch   2,  Average loss: 0.0059, Accuracy: 3871/4362 (88.7437%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 2.1542, Accuracy: 5146/10000 (51.4600%)
___Train Local_ResNet_18,  epoch  88, local model 55, internal_epoch   1,  Average loss: 0.0051, Accuracy: 3947/4356 (90.6107%)
___Train Local_ResNet_18,  epoch  88, local model 55, internal_epoch   2,  Average loss: 0.0057, Accuracy: 3904/4356 (89.6235%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 2.1611, Accuracy: 5235/10000 (52.3500%)
___Train Local_ResNet_18,  epoch  88, local model 79, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3284/3781 (86.8553%)
___Train Local_ResNet_18,  epoch  88, local model 79, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3423/3781 (90.5316%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 2.1364, Accuracy: 5288/10000 (52.8800%)
___Train Local_ResNet_18,  epoch  88, local model 63, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3127/3590 (87.1031%)
___Train Local_ResNet_18,  epoch  88, local model 63, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3256/3590 (90.6964%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.9535, Accuracy: 5536/10000 (55.3600%)
___Train Local_ResNet_18,  epoch  88, local model 93, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4053/4651 (87.1425%)
___Train Local_ResNet_18,  epoch  88, local model 93, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4238/4651 (91.1202%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.9532, Accuracy: 5522/10000 (55.2200%)
___Train Local_ResNet_18,  epoch  88, local model 44, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4065/4662 (87.1943%)
___Train Local_ResNet_18,  epoch  88, local model 44, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4241/4662 (90.9695%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.8612, Accuracy: 5553/10000 (55.5300%)
___Train Local_ResNet_18,  epoch  88, local model 30, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3046/3472 (87.7304%)
___Train Local_ResNet_18,  epoch  88, local model 30, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3210/3472 (92.4539%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.9518, Accuracy: 5532/10000 (55.3200%)
___Train Local_ResNet_18,  epoch  88, local model 42, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4803/5424 (88.5509%)
___Train Local_ResNet_18,  epoch  88, local model 42, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4940/5424 (91.0767%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 2.0576, Accuracy: 5331/10000 (53.3100%)
___Train Local_ResNet_18,  epoch  88, local model 83, internal_epoch   1,  Average loss: 0.0065, Accuracy: 2837/3271 (86.7319%)
___Train Local_ResNet_18,  epoch  88, local model 83, internal_epoch   2,  Average loss: 0.0057, Accuracy: 2910/3271 (88.9636%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.9640, Accuracy: 5550/10000 (55.5000%)
___Train Local_ResNet_18,  epoch  88, local model 45, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4318/5037 (85.7256%)
___Train Local_ResNet_18,  epoch  88, local model 45, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4514/5037 (89.6168%)
___Test Local_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.8810, Accuracy: 5594/10000 (55.9400%)
time spent on training: 266.5712640285492
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 88: Average loss: 1.4342, Accuracy: 6483/10000 (64.8300%)
___Test Target_ResNet_18 poisoned: True, epoch: 88: Average loss: 9.8312, Accuracy: 125/9900 (1.2626%)
Done in 297.6474378108978 sec.
Server Epoch:89 choose agents : [13, 36, 58, 71, 56, 69, 54, 24, 55, 48, 34, 18, 90, 60, 27, 21, 37, 11, 45, 4].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  89, local model 13, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4383/4885 (89.7236%), train_poison_data_count: 385
Global model norm: 43.12132711940882.
Norm before scaling: 43.122388677732566. Distance: 2.115289830038304
Total norm for 4 adversaries is: 43.122388677732566. distance: 2.115289830038304
___Test Local_ResNet_18 poisoned: True, epoch: 89: Average loss: 0.2330, Accuracy: 9301/9900 (93.9495%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  89, local model 36, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4714/5305 (88.8596%), train_poison_data_count: 415
Global model norm: 43.12132711940882.
Norm before scaling: 43.12211975209547. Distance: 2.2747400491616103
Total norm for 4 adversaries is: 43.12211975209547. distance: 2.2747400491616103
___Test Local_ResNet_18 poisoned: True, epoch: 89: Average loss: 0.1084, Accuracy: 9610/9900 (97.0707%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  89, local model 58, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4221/4717 (89.4848%), train_poison_data_count: 370
Global model norm: 43.12132711940882.
Norm before scaling: 43.11666869252105. Distance: 2.0374485219993566
Total norm for 4 adversaries is: 43.11666869252105. distance: 2.0374485219993566
___Test Local_ResNet_18 poisoned: True, epoch: 89: Average loss: 0.3745, Accuracy: 9033/9900 (91.2424%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  89, local model 71, internal_epoch   1,  Average loss: 0.0075, Accuracy: 4432/5066 (87.4852%), train_poison_data_count: 400
Global model norm: 43.12132711940882.
Norm before scaling: 43.129462235174145. Distance: 2.343384676118049
Total norm for 4 adversaries is: 43.129462235174145. distance: 2.343384676118049
___Test Local_ResNet_18 poisoned: True, epoch: 89: Average loss: 0.4498, Accuracy: 8796/9900 (88.8485%)
___Train Local_ResNet_18,  epoch  89, local model 56, internal_epoch   1,  Average loss: 0.0073, Accuracy: 4254/4989 (85.2676%)
___Train Local_ResNet_18,  epoch  89, local model 56, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4440/4989 (88.9958%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.9427, Accuracy: 5552/10000 (55.5200%)
___Train Local_ResNet_18,  epoch  89, local model 69, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3544/4013 (88.3130%)
___Train Local_ResNet_18,  epoch  89, local model 69, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3702/4013 (92.2502%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.8063, Accuracy: 5758/10000 (57.5800%)
___Train Local_ResNet_18,  epoch  89, local model 54, internal_epoch   1,  Average loss: 0.0077, Accuracy: 4452/5195 (85.6978%)
___Train Local_ResNet_18,  epoch  89, local model 54, internal_epoch   2,  Average loss: 0.0073, Accuracy: 4477/5195 (86.1790%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 2.1958, Accuracy: 5211/10000 (52.1100%)
___Train Local_ResNet_18,  epoch  89, local model 24, internal_epoch   1,  Average loss: 0.0073, Accuracy: 3480/3969 (87.6795%)
___Train Local_ResNet_18,  epoch  89, local model 24, internal_epoch   2,  Average loss: 0.0060, Accuracy: 3562/3969 (89.7455%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.8155, Accuracy: 5761/10000 (57.6100%)
___Train Local_ResNet_18,  epoch  89, local model 55, internal_epoch   1,  Average loss: 0.0038, Accuracy: 4060/4356 (93.2048%)
___Train Local_ResNet_18,  epoch  89, local model 55, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4033/4356 (92.5849%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 2.0379, Accuracy: 5379/10000 (53.7900%)
___Train Local_ResNet_18,  epoch  89, local model 48, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3921/4441 (88.2909%)
___Train Local_ResNet_18,  epoch  89, local model 48, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4066/4441 (91.5560%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.9233, Accuracy: 5677/10000 (56.7700%)
___Train Local_ResNet_18,  epoch  89, local model 34, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4014/4518 (88.8446%)
___Train Local_ResNet_18,  epoch  89, local model 34, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4123/4518 (91.2572%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.9400, Accuracy: 5484/10000 (54.8400%)
___Train Local_ResNet_18,  epoch  89, local model 18, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3443/3911 (88.0338%)
___Train Local_ResNet_18,  epoch  89, local model 18, internal_epoch   2,  Average loss: 0.0078, Accuracy: 3331/3911 (85.1700%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 2.1212, Accuracy: 5209/10000 (52.0900%)
___Train Local_ResNet_18,  epoch  89, local model 90, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3870/4362 (88.7208%)
___Train Local_ResNet_18,  epoch  89, local model 90, internal_epoch   2,  Average loss: 0.0059, Accuracy: 3872/4362 (88.7666%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 2.0353, Accuracy: 5327/10000 (53.2700%)
___Train Local_ResNet_18,  epoch  89, local model 60, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3352/3804 (88.1178%)
___Train Local_ResNet_18,  epoch  89, local model 60, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3468/3804 (91.1672%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 2.0130, Accuracy: 5496/10000 (54.9600%)
___Train Local_ResNet_18,  epoch  89, local model 27, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3687/4223 (87.3076%)
___Train Local_ResNet_18,  epoch  89, local model 27, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3858/4223 (91.3569%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 2.0017, Accuracy: 5408/10000 (54.0800%)
___Train Local_ResNet_18,  epoch  89, local model 21, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4060/4634 (87.6133%)
___Train Local_ResNet_18,  epoch  89, local model 21, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4222/4634 (91.1092%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.8160, Accuracy: 5705/10000 (57.0500%)
___Train Local_ResNet_18,  epoch  89, local model 37, internal_epoch   1,  Average loss: 0.0030, Accuracy: 4159/4354 (95.5214%)
___Train Local_ResNet_18,  epoch  89, local model 37, internal_epoch   2,  Average loss: 0.0089, Accuracy: 3653/4354 (83.8999%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 2.4572, Accuracy: 4824/10000 (48.2400%)
___Train Local_ResNet_18,  epoch  89, local model 11, internal_epoch   1,  Average loss: 0.0086, Accuracy: 4343/5244 (82.8185%)
___Train Local_ResNet_18,  epoch  89, local model 11, internal_epoch   2,  Average loss: 0.0067, Accuracy: 4563/5244 (87.0137%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.8870, Accuracy: 5558/10000 (55.5800%)
___Train Local_ResNet_18,  epoch  89, local model 45, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4366/5037 (86.6786%)
___Train Local_ResNet_18,  epoch  89, local model 45, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4569/5037 (90.7088%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 2.0194, Accuracy: 5403/10000 (54.0300%)
___Train Local_ResNet_18,  epoch  89, local model 4, internal_epoch   1,  Average loss: 0.0074, Accuracy: 3168/3704 (85.5292%)
___Train Local_ResNet_18,  epoch  89, local model 4, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3333/3704 (89.9838%)
___Test Local_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.9062, Accuracy: 5509/10000 (55.0900%)
time spent on training: 265.0011339187622
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 89: Average loss: 1.5057, Accuracy: 6409/10000 (64.0900%)
___Test Target_ResNet_18 poisoned: True, epoch: 89: Average loss: 9.5372, Accuracy: 140/9900 (1.4141%)
Done in 296.1003749370575 sec.
Server Epoch:90 choose agents : [13, 36, 58, 71, 74, 49, 3, 92, 2, 47, 62, 75, 84, 6, 12, 76, 53, 81, 24, 91].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  90, local model 13, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4360/4885 (89.2528%), train_poison_data_count: 385
Global model norm: 43.15985344297117.
Norm before scaling: 43.16260249227623. Distance: 2.1544550183129463
Total norm for 4 adversaries is: 43.16260249227623. distance: 2.1544550183129463
___Test Local_ResNet_18 poisoned: True, epoch: 90: Average loss: 0.1666, Accuracy: 9474/9900 (95.6970%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  90, local model 36, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4707/5305 (88.7276%), train_poison_data_count: 415
Global model norm: 43.15985344297117.
Norm before scaling: 43.16318508723609. Distance: 2.256595904181355
Total norm for 4 adversaries is: 43.16318508723609. distance: 2.256595904181355
___Test Local_ResNet_18 poisoned: True, epoch: 90: Average loss: 0.1442, Accuracy: 9554/9900 (96.5051%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  90, local model 58, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4166/4717 (88.3188%), train_poison_data_count: 370
Global model norm: 43.15985344297117.
Norm before scaling: 43.15965545941024. Distance: 2.1125085232353946
Total norm for 4 adversaries is: 43.15965545941024. distance: 2.1125085232353946
___Test Local_ResNet_18 poisoned: True, epoch: 90: Average loss: 0.1499, Accuracy: 9487/9900 (95.8283%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  90, local model 71, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4450/5066 (87.8405%), train_poison_data_count: 400
Global model norm: 43.15985344297117.
Norm before scaling: 43.165009180795096. Distance: 2.294651849971874
Total norm for 4 adversaries is: 43.165009180795096. distance: 2.294651849971874
___Test Local_ResNet_18 poisoned: True, epoch: 90: Average loss: 0.2709, Accuracy: 9243/9900 (93.3636%)
___Train Local_ResNet_18,  epoch  90, local model 74, internal_epoch   1,  Average loss: 0.0071, Accuracy: 3798/4416 (86.0054%)
___Train Local_ResNet_18,  epoch  90, local model 74, internal_epoch   2,  Average loss: 0.0055, Accuracy: 3946/4416 (89.3569%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.8706, Accuracy: 5560/10000 (55.6000%)
___Train Local_ResNet_18,  epoch  90, local model 49, internal_epoch   1,  Average loss: 0.0072, Accuracy: 4473/5197 (86.0689%)
___Train Local_ResNet_18,  epoch  90, local model 49, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4563/5197 (87.8007%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.9232, Accuracy: 5531/10000 (55.3100%)
___Train Local_ResNet_18,  epoch  90, local model 3, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4267/4918 (86.7629%)
___Train Local_ResNet_18,  epoch  90, local model 3, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4417/4918 (89.8129%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 2.0773, Accuracy: 5307/10000 (53.0700%)
___Train Local_ResNet_18,  epoch  90, local model 92, internal_epoch   1,  Average loss: 0.0061, Accuracy: 5531/6263 (88.3123%)
___Train Local_ResNet_18,  epoch  90, local model 92, internal_epoch   2,  Average loss: 0.0053, Accuracy: 5604/6263 (89.4779%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 2.1791, Accuracy: 5216/10000 (52.1600%)
___Train Local_ResNet_18,  epoch  90, local model 2, internal_epoch   1,  Average loss: 0.0073, Accuracy: 3110/3646 (85.2990%)
___Train Local_ResNet_18,  epoch  90, local model 2, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3284/3646 (90.0713%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.8189, Accuracy: 5701/10000 (57.0100%)
___Train Local_ResNet_18,  epoch  90, local model 47, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4145/4707 (88.0603%)
___Train Local_ResNet_18,  epoch  90, local model 47, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4291/4707 (91.1621%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.7992, Accuracy: 5759/10000 (57.5900%)
___Train Local_ResNet_18,  epoch  90, local model 62, internal_epoch   1,  Average loss: 0.0076, Accuracy: 4345/5063 (85.8187%)
___Train Local_ResNet_18,  epoch  90, local model 62, internal_epoch   2,  Average loss: 0.0082, Accuracy: 4239/5063 (83.7251%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 2.2201, Accuracy: 5016/10000 (50.1600%)
___Train Local_ResNet_18,  epoch  90, local model 75, internal_epoch   1,  Average loss: 0.0076, Accuracy: 3639/4295 (84.7264%)
___Train Local_ResNet_18,  epoch  90, local model 75, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3843/4295 (89.4761%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 2.0113, Accuracy: 5415/10000 (54.1500%)
___Train Local_ResNet_18,  epoch  90, local model 84, internal_epoch   1,  Average loss: 0.0072, Accuracy: 4103/4793 (85.6040%)
___Train Local_ResNet_18,  epoch  90, local model 84, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4307/4793 (89.8602%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 2.0554, Accuracy: 5333/10000 (53.3300%)
___Train Local_ResNet_18,  epoch  90, local model 6, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4009/4538 (88.3429%)
___Train Local_ResNet_18,  epoch  90, local model 6, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4168/4538 (91.8466%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.9223, Accuracy: 5568/10000 (55.6800%)
___Train Local_ResNet_18,  epoch  90, local model 12, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4419/5083 (86.9368%)
___Train Local_ResNet_18,  epoch  90, local model 12, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4498/5083 (88.4910%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.9871, Accuracy: 5400/10000 (54.0000%)
___Train Local_ResNet_18,  epoch  90, local model 76, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3120/3638 (85.7614%)
___Train Local_ResNet_18,  epoch  90, local model 76, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3238/3638 (89.0049%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.8095, Accuracy: 5674/10000 (56.7400%)
___Train Local_ResNet_18,  epoch  90, local model 53, internal_epoch   1,  Average loss: 0.0064, Accuracy: 5345/6124 (87.2796%)
___Train Local_ResNet_18,  epoch  90, local model 53, internal_epoch   2,  Average loss: 0.0054, Accuracy: 5479/6124 (89.4677%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.9821, Accuracy: 5489/10000 (54.8900%)
___Train Local_ResNet_18,  epoch  90, local model 81, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4027/4618 (87.2023%)
___Train Local_ResNet_18,  epoch  90, local model 81, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4072/4618 (88.1767%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.9903, Accuracy: 5393/10000 (53.9300%)
___Train Local_ResNet_18,  epoch  90, local model 24, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3514/3969 (88.5362%)
___Train Local_ResNet_18,  epoch  90, local model 24, internal_epoch   2,  Average loss: 0.0065, Accuracy: 3549/3969 (89.4180%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.8594, Accuracy: 5785/10000 (57.8500%)
___Train Local_ResNet_18,  epoch  90, local model 91, internal_epoch   1,  Average loss: 0.0086, Accuracy: 3458/4158 (83.1650%)
___Train Local_ResNet_18,  epoch  90, local model 91, internal_epoch   2,  Average loss: 0.0062, Accuracy: 3666/4158 (88.1674%)
___Test Local_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.9135, Accuracy: 5438/10000 (54.3800%)
time spent on training: 268.9716594219208
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 90: Average loss: 1.4804, Accuracy: 6423/10000 (64.2300%)
___Test Target_ResNet_18 poisoned: True, epoch: 90: Average loss: 9.8806, Accuracy: 120/9900 (1.2121%)
Done in 301.7486877441406 sec.
Server Epoch:91 choose agents : [13, 36, 58, 71, 28, 7, 97, 84, 75, 11, 56, 49, 89, 77, 69, 6, 47, 92, 73, 14].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  91, local model 13, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4332/4885 (88.6796%), train_poison_data_count: 385
Global model norm: 43.20001684117872.
Norm before scaling: 43.202250499738874. Distance: 2.1118755072112996
Total norm for 4 adversaries is: 43.202250499738874. distance: 2.1118755072112996
___Test Local_ResNet_18 poisoned: True, epoch: 91: Average loss: 0.2758, Accuracy: 9225/9900 (93.1818%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  91, local model 36, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4684/5305 (88.2941%), train_poison_data_count: 415
Global model norm: 43.20001684117872.
Norm before scaling: 43.20124459063289. Distance: 2.2720042951435806
Total norm for 4 adversaries is: 43.20124459063289. distance: 2.2720042951435806
___Test Local_ResNet_18 poisoned: True, epoch: 91: Average loss: 0.1936, Accuracy: 9399/9900 (94.9394%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  91, local model 58, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4175/4717 (88.5096%), train_poison_data_count: 370
Global model norm: 43.20001684117872.
Norm before scaling: 43.19725745643828. Distance: 2.076846654551023
Total norm for 4 adversaries is: 43.19725745643828. distance: 2.076846654551023
___Test Local_ResNet_18 poisoned: True, epoch: 91: Average loss: 0.1614, Accuracy: 9467/9900 (95.6263%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  91, local model 71, internal_epoch   1,  Average loss: 0.0073, Accuracy: 4444/5066 (87.7221%), train_poison_data_count: 400
Global model norm: 43.20001684117872.
Norm before scaling: 43.203479598454365. Distance: 2.291985217987113
Total norm for 4 adversaries is: 43.203479598454365. distance: 2.291985217987113
___Test Local_ResNet_18 poisoned: True, epoch: 91: Average loss: 0.2918, Accuracy: 9162/9900 (92.5455%)
___Train Local_ResNet_18,  epoch  91, local model 28, internal_epoch   1,  Average loss: 0.0075, Accuracy: 4046/4716 (85.7930%)
___Train Local_ResNet_18,  epoch  91, local model 28, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4189/4716 (88.8253%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.0784, Accuracy: 5334/10000 (53.3400%)
___Train Local_ResNet_18,  epoch  91, local model 7, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3928/4481 (87.6590%)
___Train Local_ResNet_18,  epoch  91, local model 7, internal_epoch   2,  Average loss: 0.0062, Accuracy: 3946/4481 (88.0607%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.1539, Accuracy: 5351/10000 (53.5100%)
___Train Local_ResNet_18,  epoch  91, local model 97, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3862/4361 (88.5577%)
___Train Local_ResNet_18,  epoch  91, local model 97, internal_epoch   2,  Average loss: 0.0066, Accuracy: 3817/4361 (87.5258%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.9711, Accuracy: 5350/10000 (53.5000%)
___Train Local_ResNet_18,  epoch  91, local model 84, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4155/4793 (86.6889%)
___Train Local_ResNet_18,  epoch  91, local model 84, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4349/4793 (90.7365%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.9915, Accuracy: 5447/10000 (54.4700%)
___Train Local_ResNet_18,  epoch  91, local model 75, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3740/4295 (87.0780%)
___Train Local_ResNet_18,  epoch  91, local model 75, internal_epoch   2,  Average loss: 0.0065, Accuracy: 3788/4295 (88.1956%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.0623, Accuracy: 5317/10000 (53.1700%)
___Train Local_ResNet_18,  epoch  91, local model 11, internal_epoch   1,  Average loss: 0.0084, Accuracy: 4388/5244 (83.6766%)
___Train Local_ResNet_18,  epoch  91, local model 11, internal_epoch   2,  Average loss: 0.0067, Accuracy: 4539/5244 (86.5561%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.9712, Accuracy: 5455/10000 (54.5500%)
___Train Local_ResNet_18,  epoch  91, local model 56, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4286/4989 (85.9090%)
___Train Local_ResNet_18,  epoch  91, local model 56, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4455/4989 (89.2965%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.8897, Accuracy: 5671/10000 (56.7100%)
___Train Local_ResNet_18,  epoch  91, local model 49, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4539/5197 (87.3388%)
___Train Local_ResNet_18,  epoch  91, local model 49, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4610/5197 (88.7050%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.0198, Accuracy: 5432/10000 (54.3200%)
___Train Local_ResNet_18,  epoch  91, local model 89, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3898/4356 (89.4858%)
___Train Local_ResNet_18,  epoch  91, local model 89, internal_epoch   2,  Average loss: 0.0080, Accuracy: 3691/4356 (84.7337%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.3480, Accuracy: 4778/10000 (47.7800%)
___Train Local_ResNet_18,  epoch  91, local model 77, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4029/4647 (86.7011%)
___Train Local_ResNet_18,  epoch  91, local model 77, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4192/4647 (90.2087%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.8989, Accuracy: 5611/10000 (56.1100%)
___Train Local_ResNet_18,  epoch  91, local model 69, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3565/4013 (88.8363%)
___Train Local_ResNet_18,  epoch  91, local model 69, internal_epoch   2,  Average loss: 0.0037, Accuracy: 3744/4013 (93.2968%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.7419, Accuracy: 5778/10000 (57.7800%)
___Train Local_ResNet_18,  epoch  91, local model 6, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3986/4538 (87.8361%)
___Train Local_ResNet_18,  epoch  91, local model 6, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4166/4538 (91.8026%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.8079, Accuracy: 5653/10000 (56.5300%)
___Train Local_ResNet_18,  epoch  91, local model 47, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4095/4707 (86.9981%)
___Train Local_ResNet_18,  epoch  91, local model 47, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4264/4707 (90.5885%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.8404, Accuracy: 5678/10000 (56.7800%)
___Train Local_ResNet_18,  epoch  91, local model 92, internal_epoch   1,  Average loss: 0.0061, Accuracy: 5506/6263 (87.9131%)
___Train Local_ResNet_18,  epoch  91, local model 92, internal_epoch   2,  Average loss: 0.0043, Accuracy: 5733/6263 (91.5376%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.0681, Accuracy: 5388/10000 (53.8800%)
___Train Local_ResNet_18,  epoch  91, local model 73, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3729/4235 (88.0519%)
___Train Local_ResNet_18,  epoch  91, local model 73, internal_epoch   2,  Average loss: 0.0061, Accuracy: 3741/4235 (88.3353%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.0334, Accuracy: 5408/10000 (54.0800%)
___Train Local_ResNet_18,  epoch  91, local model 14, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3356/3861 (86.9205%)
___Train Local_ResNet_18,  epoch  91, local model 14, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3478/3861 (90.0803%)
___Test Local_ResNet_18 poisoned: False, epoch: 91: Average loss: 2.0388, Accuracy: 5390/10000 (53.9000%)
time spent on training: 269.60265159606934
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 91: Average loss: 1.5146, Accuracy: 6404/10000 (64.0400%)
___Test Target_ResNet_18 poisoned: True, epoch: 91: Average loss: 9.6511, Accuracy: 152/9900 (1.5354%)
Done in 300.69322061538696 sec.
Server Epoch:92 choose agents : [13, 36, 58, 71, 65, 98, 97, 69, 34, 57, 61, 96, 73, 45, 87, 16, 55, 66, 84, 80].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  92, local model 13, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4329/4885 (88.6182%), train_poison_data_count: 385
Global model norm: 43.23124085134354.
Norm before scaling: 43.23232371127606. Distance: 2.1917367505760548
Total norm for 4 adversaries is: 43.23232371127606. distance: 2.1917367505760548
___Test Local_ResNet_18 poisoned: True, epoch: 92: Average loss: 0.0802, Accuracy: 9687/9900 (97.8485%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  92, local model 36, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4701/5305 (88.6145%), train_poison_data_count: 415
Global model norm: 43.23124085134354.
Norm before scaling: 43.233621130941025. Distance: 2.249189018749965
Total norm for 4 adversaries is: 43.233621130941025. distance: 2.249189018749965
___Test Local_ResNet_18 poisoned: True, epoch: 92: Average loss: 0.2010, Accuracy: 9454/9900 (95.4949%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  92, local model 58, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4196/4717 (88.9548%), train_poison_data_count: 370
Global model norm: 43.23124085134354.
Norm before scaling: 43.23106437225219. Distance: 2.0833377710930927
Total norm for 4 adversaries is: 43.23106437225219. distance: 2.0833377710930927
___Test Local_ResNet_18 poisoned: True, epoch: 92: Average loss: 0.1554, Accuracy: 9519/9900 (96.1515%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  92, local model 71, internal_epoch   1,  Average loss: 0.0076, Accuracy: 4437/5066 (87.5839%), train_poison_data_count: 400
Global model norm: 43.23124085134354.
Norm before scaling: 43.23569494506608. Distance: 2.3342373890384436
Total norm for 4 adversaries is: 43.23569494506608. distance: 2.3342373890384436
___Test Local_ResNet_18 poisoned: True, epoch: 92: Average loss: 0.0927, Accuracy: 9664/9900 (97.6162%)
___Train Local_ResNet_18,  epoch  92, local model 65, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4449/5055 (88.0119%)
___Train Local_ResNet_18,  epoch  92, local model 65, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4586/5055 (90.7221%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.8933, Accuracy: 5563/10000 (55.6300%)
___Train Local_ResNet_18,  epoch  92, local model 98, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3327/3828 (86.9122%)
___Train Local_ResNet_18,  epoch  92, local model 98, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3547/3828 (92.6594%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.8971, Accuracy: 5617/10000 (56.1700%)
___Train Local_ResNet_18,  epoch  92, local model 97, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3847/4361 (88.2137%)
___Train Local_ResNet_18,  epoch  92, local model 97, internal_epoch   2,  Average loss: 0.0056, Accuracy: 3903/4361 (89.4978%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.9871, Accuracy: 5513/10000 (55.1300%)
___Train Local_ResNet_18,  epoch  92, local model 69, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3540/4013 (88.2133%)
___Train Local_ResNet_18,  epoch  92, local model 69, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3728/4013 (92.8981%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.8701, Accuracy: 5659/10000 (56.5900%)
___Train Local_ResNet_18,  epoch  92, local model 34, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3991/4518 (88.3355%)
___Train Local_ResNet_18,  epoch  92, local model 34, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4137/4518 (91.5671%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.9174, Accuracy: 5582/10000 (55.8200%)
___Train Local_ResNet_18,  epoch  92, local model 57, internal_epoch   1,  Average loss: 0.0071, Accuracy: 3930/4558 (86.2220%)
___Train Local_ResNet_18,  epoch  92, local model 57, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4068/4558 (89.2497%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 2.1250, Accuracy: 5164/10000 (51.6400%)
___Train Local_ResNet_18,  epoch  92, local model 61, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3602/4126 (87.3000%)
___Train Local_ResNet_18,  epoch  92, local model 61, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3779/4126 (91.5899%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.8745, Accuracy: 5589/10000 (55.8900%)
___Train Local_ResNet_18,  epoch  92, local model 96, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4245/4679 (90.7245%)
___Train Local_ResNet_18,  epoch  92, local model 96, internal_epoch   2,  Average loss: 0.0082, Accuracy: 3958/4679 (84.5907%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 2.0850, Accuracy: 5173/10000 (51.7300%)
___Train Local_ResNet_18,  epoch  92, local model 73, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3760/4235 (88.7839%)
___Train Local_ResNet_18,  epoch  92, local model 73, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3802/4235 (89.7757%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.9801, Accuracy: 5574/10000 (55.7400%)
___Train Local_ResNet_18,  epoch  92, local model 45, internal_epoch   1,  Average loss: 0.0073, Accuracy: 4302/5037 (85.4080%)
___Train Local_ResNet_18,  epoch  92, local model 45, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4573/5037 (90.7882%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.8999, Accuracy: 5553/10000 (55.5300%)
___Train Local_ResNet_18,  epoch  92, local model 87, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3185/3672 (86.7375%)
___Train Local_ResNet_18,  epoch  92, local model 87, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3385/3672 (92.1841%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.8556, Accuracy: 5699/10000 (56.9900%)
___Train Local_ResNet_18,  epoch  92, local model 16, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4301/4928 (87.2768%)
___Train Local_ResNet_18,  epoch  92, local model 16, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4410/4928 (89.4886%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 2.0070, Accuracy: 5462/10000 (54.6200%)
___Train Local_ResNet_18,  epoch  92, local model 55, internal_epoch   1,  Average loss: 0.0043, Accuracy: 4021/4356 (92.3095%)
___Train Local_ResNet_18,  epoch  92, local model 55, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3895/4356 (89.4169%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 2.0521, Accuracy: 5344/10000 (53.4400%)
___Train Local_ResNet_18,  epoch  92, local model 66, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3957/4456 (88.8016%)
___Train Local_ResNet_18,  epoch  92, local model 66, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4113/4456 (92.3025%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 2.0310, Accuracy: 5487/10000 (54.8700%)
___Train Local_ResNet_18,  epoch  92, local model 84, internal_epoch   1,  Average loss: 0.0071, Accuracy: 4125/4793 (86.0630%)
___Train Local_ResNet_18,  epoch  92, local model 84, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4344/4793 (90.6322%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.9311, Accuracy: 5664/10000 (56.6400%)
___Train Local_ResNet_18,  epoch  92, local model 80, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4411/5025 (87.7811%)
___Train Local_ResNet_18,  epoch  92, local model 80, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4570/5025 (90.9453%)
___Test Local_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.9454, Accuracy: 5550/10000 (55.5000%)
time spent on training: 262.97904658317566
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 92: Average loss: 1.5147, Accuracy: 6361/10000 (63.6100%)
___Test Target_ResNet_18 poisoned: True, epoch: 92: Average loss: 9.8157, Accuracy: 103/9900 (1.0404%)
Done in 293.774537563324 sec.
Server Epoch:93 choose agents : [13, 36, 58, 71, 29, 23, 55, 2, 12, 89, 57, 31, 30, 8, 42, 7, 40, 22, 85, 51].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  93, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4359/4885 (89.2323%), train_poison_data_count: 385
Global model norm: 43.26923767194122.
Norm before scaling: 43.27263282899626. Distance: 2.1449872419782623
Total norm for 4 adversaries is: 43.27263282899626. distance: 2.1449872419782623
___Test Local_ResNet_18 poisoned: True, epoch: 93: Average loss: 0.1150, Accuracy: 9604/9900 (97.0101%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  93, local model 36, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4726/5305 (89.0858%), train_poison_data_count: 415
Global model norm: 43.26923767194122.
Norm before scaling: 43.27007978600802. Distance: 2.271746553885431
Total norm for 4 adversaries is: 43.27007978600802. distance: 2.271746553885431
___Test Local_ResNet_18 poisoned: True, epoch: 93: Average loss: 0.1067, Accuracy: 9616/9900 (97.1313%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  93, local model 58, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4222/4717 (89.5060%), train_poison_data_count: 370
Global model norm: 43.26923767194122.
Norm before scaling: 43.26703568483892. Distance: 2.0518376417939286
Total norm for 4 adversaries is: 43.26703568483892. distance: 2.0518376417939286
___Test Local_ResNet_18 poisoned: True, epoch: 93: Average loss: 0.2105, Accuracy: 9373/9900 (94.6768%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  93, local model 71, internal_epoch   1,  Average loss: 0.0072, Accuracy: 4430/5066 (87.4457%), train_poison_data_count: 400
Global model norm: 43.26923767194122.
Norm before scaling: 43.27381902589529. Distance: 2.287889720466517
Total norm for 4 adversaries is: 43.27381902589529. distance: 2.287889720466517
___Test Local_ResNet_18 poisoned: True, epoch: 93: Average loss: 0.2459, Accuracy: 9287/9900 (93.8081%)
___Train Local_ResNet_18,  epoch  93, local model 29, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3858/4346 (88.7713%)
___Train Local_ResNet_18,  epoch  93, local model 29, internal_epoch   2,  Average loss: 0.0036, Accuracy: 4056/4346 (93.3272%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 1.8917, Accuracy: 5620/10000 (56.2000%)
___Train Local_ResNet_18,  epoch  93, local model 23, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3662/4184 (87.5239%)
___Train Local_ResNet_18,  epoch  93, local model 23, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3794/4184 (90.6788%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 1.9311, Accuracy: 5543/10000 (55.4300%)
___Train Local_ResNet_18,  epoch  93, local model 55, internal_epoch   1,  Average loss: 0.0045, Accuracy: 4000/4356 (91.8274%)
___Train Local_ResNet_18,  epoch  93, local model 55, internal_epoch   2,  Average loss: 0.0061, Accuracy: 3871/4356 (88.8659%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.0501, Accuracy: 5427/10000 (54.2700%)
___Train Local_ResNet_18,  epoch  93, local model 2, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3180/3646 (87.2189%)
___Train Local_ResNet_18,  epoch  93, local model 2, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3345/3646 (91.7444%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 1.8397, Accuracy: 5751/10000 (57.5100%)
___Train Local_ResNet_18,  epoch  93, local model 12, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4472/5083 (87.9795%)
___Train Local_ResNet_18,  epoch  93, local model 12, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4477/5083 (88.0779%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.2019, Accuracy: 5049/10000 (50.4900%)
___Train Local_ResNet_18,  epoch  93, local model 89, internal_epoch   1,  Average loss: 0.0046, Accuracy: 3978/4356 (91.3223%)
___Train Local_ResNet_18,  epoch  93, local model 89, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3882/4356 (89.1185%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.0851, Accuracy: 5198/10000 (51.9800%)
___Train Local_ResNet_18,  epoch  93, local model 57, internal_epoch   1,  Average loss: 0.0071, Accuracy: 3939/4558 (86.4195%)
___Train Local_ResNet_18,  epoch  93, local model 57, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4041/4558 (88.6573%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.0395, Accuracy: 5438/10000 (54.3800%)
___Train Local_ResNet_18,  epoch  93, local model 31, internal_epoch   1,  Average loss: 0.0072, Accuracy: 3610/4175 (86.4671%)
___Train Local_ResNet_18,  epoch  93, local model 31, internal_epoch   2,  Average loss: 0.0056, Accuracy: 3727/4175 (89.2695%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 1.9547, Accuracy: 5508/10000 (55.0800%)
___Train Local_ResNet_18,  epoch  93, local model 30, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3053/3472 (87.9320%)
___Train Local_ResNet_18,  epoch  93, local model 30, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3162/3472 (91.0714%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.1081, Accuracy: 5438/10000 (54.3800%)
___Train Local_ResNet_18,  epoch  93, local model 8, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3936/4501 (87.4472%)
___Train Local_ResNet_18,  epoch  93, local model 8, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4038/4501 (89.7134%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.0397, Accuracy: 5430/10000 (54.3000%)
___Train Local_ResNet_18,  epoch  93, local model 42, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4806/5424 (88.6062%)
___Train Local_ResNet_18,  epoch  93, local model 42, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4961/5424 (91.4639%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.1086, Accuracy: 5309/10000 (53.0900%)
___Train Local_ResNet_18,  epoch  93, local model 7, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3954/4481 (88.2392%)
___Train Local_ResNet_18,  epoch  93, local model 7, internal_epoch   2,  Average loss: 0.0069, Accuracy: 4005/4481 (89.3774%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.0256, Accuracy: 5493/10000 (54.9300%)
___Train Local_ResNet_18,  epoch  93, local model 40, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4751/5455 (87.0944%)
___Train Local_ResNet_18,  epoch  93, local model 40, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4883/5455 (89.5142%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.0876, Accuracy: 5285/10000 (52.8500%)
___Train Local_ResNet_18,  epoch  93, local model 22, internal_epoch   1,  Average loss: 0.0072, Accuracy: 4511/5232 (86.2194%)
___Train Local_ResNet_18,  epoch  93, local model 22, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4690/5232 (89.6407%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.0661, Accuracy: 5310/10000 (53.1000%)
___Train Local_ResNet_18,  epoch  93, local model 85, internal_epoch   1,  Average loss: 0.0074, Accuracy: 5457/6391 (85.3857%)
___Train Local_ResNet_18,  epoch  93, local model 85, internal_epoch   2,  Average loss: 0.0066, Accuracy: 5552/6391 (86.8722%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 2.0456, Accuracy: 5305/10000 (53.0500%)
___Train Local_ResNet_18,  epoch  93, local model 51, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3354/3775 (88.8477%)
___Train Local_ResNet_18,  epoch  93, local model 51, internal_epoch   2,  Average loss: 0.0034, Accuracy: 3544/3775 (93.8808%)
___Test Local_ResNet_18 poisoned: False, epoch: 93: Average loss: 1.8589, Accuracy: 5696/10000 (56.9600%)
time spent on training: 268.73688983917236
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 93: Average loss: 1.4698, Accuracy: 6446/10000 (64.4600%)
___Test Target_ResNet_18 poisoned: True, epoch: 93: Average loss: 9.9161, Accuracy: 99/9900 (1.0000%)
Done in 300.05733036994934 sec.
Server Epoch:94 choose agents : [13, 36, 58, 71, 78, 27, 76, 62, 82, 94, 91, 34, 73, 88, 85, 75, 26, 7, 31, 63].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  94, local model 13, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4366/4885 (89.3756%), train_poison_data_count: 385
Global model norm: 43.31515481582341.
Norm before scaling: 43.313114398600455. Distance: 2.1658448959497925
Total norm for 4 adversaries is: 43.313114398600455. distance: 2.1658448959497925
___Test Local_ResNet_18 poisoned: True, epoch: 94: Average loss: 0.1324, Accuracy: 9532/9900 (96.2828%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  94, local model 36, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4738/5305 (89.3120%), train_poison_data_count: 415
Global model norm: 43.31515481582341.
Norm before scaling: 43.31021002018101. Distance: 2.2002192604735864
Total norm for 4 adversaries is: 43.31021002018101. distance: 2.2002192604735864
___Test Local_ResNet_18 poisoned: True, epoch: 94: Average loss: 0.1169, Accuracy: 9585/9900 (96.8182%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  94, local model 58, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4211/4717 (89.2728%), train_poison_data_count: 370
Global model norm: 43.31515481582341.
Norm before scaling: 43.310059229568715. Distance: 2.0301854792078906
Total norm for 4 adversaries is: 43.310059229568715. distance: 2.0301854792078906
___Test Local_ResNet_18 poisoned: True, epoch: 94: Average loss: 0.1291, Accuracy: 9571/9900 (96.6768%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  94, local model 71, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4414/5066 (87.1299%), train_poison_data_count: 400
Global model norm: 43.31515481582341.
Norm before scaling: 43.31927199494326. Distance: 2.2975337323025564
Total norm for 4 adversaries is: 43.31927199494326. distance: 2.2975337323025564
___Test Local_ResNet_18 poisoned: True, epoch: 94: Average loss: 0.1462, Accuracy: 9512/9900 (96.0808%)
___Train Local_ResNet_18,  epoch  94, local model 78, internal_epoch   1,  Average loss: 0.0060, Accuracy: 3558/4025 (88.3975%)
___Train Local_ResNet_18,  epoch  94, local model 78, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3717/4025 (92.3478%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 1.7508, Accuracy: 5825/10000 (58.2500%)
___Train Local_ResNet_18,  epoch  94, local model 27, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3715/4223 (87.9706%)
___Train Local_ResNet_18,  epoch  94, local model 27, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3857/4223 (91.3332%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.0917, Accuracy: 5226/10000 (52.2600%)
___Train Local_ResNet_18,  epoch  94, local model 76, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3180/3638 (87.4107%)
___Train Local_ResNet_18,  epoch  94, local model 76, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3344/3638 (91.9186%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 1.9146, Accuracy: 5557/10000 (55.5700%)
___Train Local_ResNet_18,  epoch  94, local model 62, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4408/5063 (87.0630%)
___Train Local_ResNet_18,  epoch  94, local model 62, internal_epoch   2,  Average loss: 0.0062, Accuracy: 4453/5063 (87.9518%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.0965, Accuracy: 5342/10000 (53.4200%)
___Train Local_ResNet_18,  epoch  94, local model 82, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4248/4874 (87.1563%)
___Train Local_ResNet_18,  epoch  94, local model 82, internal_epoch   2,  Average loss: 0.0065, Accuracy: 4261/4874 (87.4231%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.2830, Accuracy: 5043/10000 (50.4300%)
___Train Local_ResNet_18,  epoch  94, local model 94, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4327/4804 (90.0708%)
___Train Local_ResNet_18,  epoch  94, local model 94, internal_epoch   2,  Average loss: 0.0066, Accuracy: 4186/4804 (87.1357%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.2759, Accuracy: 5245/10000 (52.4500%)
___Train Local_ResNet_18,  epoch  94, local model 91, internal_epoch   1,  Average loss: 0.0077, Accuracy: 3536/4158 (85.0409%)
___Train Local_ResNet_18,  epoch  94, local model 91, internal_epoch   2,  Average loss: 0.0060, Accuracy: 3680/4158 (88.5041%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 1.8796, Accuracy: 5489/10000 (54.8900%)
___Train Local_ResNet_18,  epoch  94, local model 34, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4001/4518 (88.5569%)
___Train Local_ResNet_18,  epoch  94, local model 34, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4172/4518 (92.3417%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 1.8609, Accuracy: 5507/10000 (55.0700%)
___Train Local_ResNet_18,  epoch  94, local model 73, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3763/4235 (88.8548%)
___Train Local_ResNet_18,  epoch  94, local model 73, internal_epoch   2,  Average loss: 0.0065, Accuracy: 3723/4235 (87.9103%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.0901, Accuracy: 5338/10000 (53.3800%)
___Train Local_ResNet_18,  epoch  94, local model 88, internal_epoch   1,  Average loss: 0.0075, Accuracy: 4226/4934 (85.6506%)
___Train Local_ResNet_18,  epoch  94, local model 88, internal_epoch   2,  Average loss: 0.0079, Accuracy: 4187/4934 (84.8602%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.3132, Accuracy: 5009/10000 (50.0900%)
___Train Local_ResNet_18,  epoch  94, local model 85, internal_epoch   1,  Average loss: 0.0064, Accuracy: 5586/6391 (87.4042%)
___Train Local_ResNet_18,  epoch  94, local model 85, internal_epoch   2,  Average loss: 0.0056, Accuracy: 5701/6391 (89.2036%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.0329, Accuracy: 5297/10000 (52.9700%)
___Train Local_ResNet_18,  epoch  94, local model 75, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3757/4295 (87.4738%)
___Train Local_ResNet_18,  epoch  94, local model 75, internal_epoch   2,  Average loss: 0.0064, Accuracy: 3805/4295 (88.5914%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.0701, Accuracy: 5335/10000 (53.3500%)
___Train Local_ResNet_18,  epoch  94, local model 26, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3352/3756 (89.2439%)
___Train Local_ResNet_18,  epoch  94, local model 26, internal_epoch   2,  Average loss: 0.0036, Accuracy: 3495/3756 (93.0511%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 1.9697, Accuracy: 5606/10000 (56.0600%)
___Train Local_ResNet_18,  epoch  94, local model 7, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3960/4481 (88.3731%)
___Train Local_ResNet_18,  epoch  94, local model 7, internal_epoch   2,  Average loss: 0.0066, Accuracy: 3981/4481 (88.8418%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 1.9173, Accuracy: 5585/10000 (55.8500%)
___Train Local_ResNet_18,  epoch  94, local model 31, internal_epoch   1,  Average loss: 0.0071, Accuracy: 3626/4175 (86.8503%)
___Train Local_ResNet_18,  epoch  94, local model 31, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3715/4175 (88.9820%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 1.9470, Accuracy: 5479/10000 (54.7900%)
___Train Local_ResNet_18,  epoch  94, local model 63, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3178/3590 (88.5237%)
___Train Local_ResNet_18,  epoch  94, local model 63, internal_epoch   2,  Average loss: 0.0062, Accuracy: 3182/3590 (88.6351%)
___Test Local_ResNet_18 poisoned: False, epoch: 94: Average loss: 2.0210, Accuracy: 5459/10000 (54.5900%)
time spent on training: 266.45515298843384
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 94: Average loss: 1.4844, Accuracy: 6425/10000 (64.2500%)
___Test Target_ResNet_18 poisoned: True, epoch: 94: Average loss: 9.8809, Accuracy: 96/9900 (0.9697%)
Done in 297.56952381134033 sec.
Server Epoch:95 choose agents : [13, 36, 58, 71, 98, 18, 90, 49, 96, 84, 67, 95, 81, 83, 31, 86, 7, 50, 38, 77].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  95, local model 13, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4377/4885 (89.6008%), train_poison_data_count: 385
Global model norm: 43.35572619782334.
Norm before scaling: 43.35613022768882. Distance: 2.1361116596425704
Total norm for 4 adversaries is: 43.35613022768882. distance: 2.1361116596425704
___Test Local_ResNet_18 poisoned: True, epoch: 95: Average loss: 0.2563, Accuracy: 9260/9900 (93.5354%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  95, local model 36, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4750/5305 (89.5382%), train_poison_data_count: 415
Global model norm: 43.35572619782334.
Norm before scaling: 43.35479846343064. Distance: 2.1733396791977864
Total norm for 4 adversaries is: 43.35479846343064. distance: 2.1733396791977864
___Test Local_ResNet_18 poisoned: True, epoch: 95: Average loss: 0.3135, Accuracy: 9147/9900 (92.3939%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  95, local model 58, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4216/4717 (89.3788%), train_poison_data_count: 370
Global model norm: 43.35572619782334.
Norm before scaling: 43.35643148792561. Distance: 2.0368133651711426
Total norm for 4 adversaries is: 43.35643148792561. distance: 2.0368133651711426
___Test Local_ResNet_18 poisoned: True, epoch: 95: Average loss: 0.1049, Accuracy: 9653/9900 (97.5051%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  95, local model 71, internal_epoch   1,  Average loss: 0.0072, Accuracy: 4438/5066 (87.6036%), train_poison_data_count: 400
Global model norm: 43.35572619782334.
Norm before scaling: 43.360639058151. Distance: 2.292122107823148
Total norm for 4 adversaries is: 43.360639058151. distance: 2.292122107823148
___Test Local_ResNet_18 poisoned: True, epoch: 95: Average loss: 0.1406, Accuracy: 9544/9900 (96.4040%)
___Train Local_ResNet_18,  epoch  95, local model 98, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3372/3828 (88.0878%)
___Train Local_ResNet_18,  epoch  95, local model 98, internal_epoch   2,  Average loss: 0.0041, Accuracy: 3546/3828 (92.6332%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.7968, Accuracy: 5787/10000 (57.8700%)
___Train Local_ResNet_18,  epoch  95, local model 18, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3486/3911 (89.1332%)
___Train Local_ResNet_18,  epoch  95, local model 18, internal_epoch   2,  Average loss: 0.0070, Accuracy: 3370/3911 (86.1672%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 2.0895, Accuracy: 5380/10000 (53.8000%)
___Train Local_ResNet_18,  epoch  95, local model 90, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3919/4362 (89.8441%)
___Train Local_ResNet_18,  epoch  95, local model 90, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3965/4362 (90.8987%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.9895, Accuracy: 5412/10000 (54.1200%)
___Train Local_ResNet_18,  epoch  95, local model 49, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4629/5197 (89.0706%)
___Train Local_ResNet_18,  epoch  95, local model 49, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4668/5197 (89.8211%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 2.0908, Accuracy: 5299/10000 (52.9900%)
___Train Local_ResNet_18,  epoch  95, local model 96, internal_epoch   1,  Average loss: 0.0041, Accuracy: 4313/4679 (92.1778%)
___Train Local_ResNet_18,  epoch  95, local model 96, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4364/4679 (93.2678%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.9228, Accuracy: 5564/10000 (55.6400%)
___Train Local_ResNet_18,  epoch  95, local model 84, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4143/4793 (86.4386%)
___Train Local_ResNet_18,  epoch  95, local model 84, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4300/4793 (89.7142%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 2.0002, Accuracy: 5542/10000 (55.4200%)
___Train Local_ResNet_18,  epoch  95, local model 67, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4444/5116 (86.8647%)
___Train Local_ResNet_18,  epoch  95, local model 67, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4600/5116 (89.9140%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 2.0291, Accuracy: 5401/10000 (54.0100%)
___Train Local_ResNet_18,  epoch  95, local model 95, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4064/4625 (87.8703%)
___Train Local_ResNet_18,  epoch  95, local model 95, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4132/4625 (89.3405%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.9640, Accuracy: 5497/10000 (54.9700%)
___Train Local_ResNet_18,  epoch  95, local model 81, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4112/4618 (89.0429%)
___Train Local_ResNet_18,  epoch  95, local model 81, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4130/4618 (89.4327%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 2.0312, Accuracy: 5422/10000 (54.2200%)
___Train Local_ResNet_18,  epoch  95, local model 83, internal_epoch   1,  Average loss: 0.0058, Accuracy: 2883/3271 (88.1382%)
___Train Local_ResNet_18,  epoch  95, local model 83, internal_epoch   2,  Average loss: 0.0046, Accuracy: 2971/3271 (90.8285%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.9065, Accuracy: 5512/10000 (55.1200%)
___Train Local_ResNet_18,  epoch  95, local model 31, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3680/4175 (88.1437%)
___Train Local_ResNet_18,  epoch  95, local model 31, internal_epoch   2,  Average loss: 0.0049, Accuracy: 3791/4175 (90.8024%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.9214, Accuracy: 5524/10000 (55.2400%)
___Train Local_ResNet_18,  epoch  95, local model 86, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3110/3616 (86.0066%)
___Train Local_ResNet_18,  epoch  95, local model 86, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3318/3616 (91.7588%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.8442, Accuracy: 5764/10000 (57.6400%)
___Train Local_ResNet_18,  epoch  95, local model 7, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3917/4481 (87.4135%)
___Train Local_ResNet_18,  epoch  95, local model 7, internal_epoch   2,  Average loss: 0.0066, Accuracy: 3980/4481 (88.8195%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 2.3708, Accuracy: 5093/10000 (50.9300%)
___Train Local_ResNet_18,  epoch  95, local model 50, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3840/4368 (87.9121%)
___Train Local_ResNet_18,  epoch  95, local model 50, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3904/4368 (89.3773%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.8932, Accuracy: 5595/10000 (55.9500%)
___Train Local_ResNet_18,  epoch  95, local model 38, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4971/5740 (86.6028%)
___Train Local_ResNet_18,  epoch  95, local model 38, internal_epoch   2,  Average loss: 0.0048, Accuracy: 5181/5740 (90.2613%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 2.0012, Accuracy: 5498/10000 (54.9800%)
___Train Local_ResNet_18,  epoch  95, local model 77, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4083/4647 (87.8631%)
___Train Local_ResNet_18,  epoch  95, local model 77, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4216/4647 (90.7252%)
___Test Local_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.9112, Accuracy: 5613/10000 (56.1300%)
time spent on training: 266.5227575302124
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 95: Average loss: 1.4974, Accuracy: 6397/10000 (63.9700%)
___Test Target_ResNet_18 poisoned: True, epoch: 95: Average loss: 8.5391, Accuracy: 270/9900 (2.7273%)
Done in 296.793909072876 sec.
Server Epoch:96 choose agents : [13, 36, 58, 71, 32, 46, 17, 69, 63, 84, 60, 39, 97, 62, 50, 96, 9, 72, 25, 27].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  96, local model 13, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4399/4885 (90.0512%), train_poison_data_count: 385
Global model norm: 43.389453249843015.
Norm before scaling: 43.386281066318936. Distance: 2.0574763991716147
Total norm for 4 adversaries is: 43.386281066318936. distance: 2.0574763991716147
___Test Local_ResNet_18 poisoned: True, epoch: 96: Average loss: 0.2858, Accuracy: 9151/9900 (92.4343%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  96, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4783/5305 (90.1602%), train_poison_data_count: 415
Global model norm: 43.389453249843015.
Norm before scaling: 43.382337669605676. Distance: 2.13809399744844
Total norm for 4 adversaries is: 43.382337669605676. distance: 2.13809399744844
___Test Local_ResNet_18 poisoned: True, epoch: 96: Average loss: 0.2480, Accuracy: 9296/9900 (93.8990%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  96, local model 58, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4222/4717 (89.5060%), train_poison_data_count: 370
Global model norm: 43.389453249843015.
Norm before scaling: 43.38771736971982. Distance: 2.0335603925949215
Total norm for 4 adversaries is: 43.38771736971982. distance: 2.0335603925949215
___Test Local_ResNet_18 poisoned: True, epoch: 96: Average loss: 0.1502, Accuracy: 9500/9900 (95.9596%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  96, local model 71, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4450/5066 (87.8405%), train_poison_data_count: 400
Global model norm: 43.389453249843015.
Norm before scaling: 43.3946407823917. Distance: 2.270106021236949
Total norm for 4 adversaries is: 43.3946407823917. distance: 2.270106021236949
___Test Local_ResNet_18 poisoned: True, epoch: 96: Average loss: 0.1447, Accuracy: 9523/9900 (96.1919%)
___Train Local_ResNet_18,  epoch  96, local model 32, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4849/5591 (86.7287%)
___Train Local_ResNet_18,  epoch  96, local model 32, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4966/5591 (88.8213%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.0278, Accuracy: 5382/10000 (53.8200%)
___Train Local_ResNet_18,  epoch  96, local model 46, internal_epoch   1,  Average loss: 0.0074, Accuracy: 4257/4956 (85.8959%)
___Train Local_ResNet_18,  epoch  96, local model 46, internal_epoch   2,  Average loss: 0.0065, Accuracy: 4311/4956 (86.9855%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 1.9921, Accuracy: 5391/10000 (53.9100%)
___Train Local_ResNet_18,  epoch  96, local model 17, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3915/4511 (86.7879%)
___Train Local_ResNet_18,  epoch  96, local model 17, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4108/4511 (91.0663%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 1.9523, Accuracy: 5434/10000 (54.3400%)
___Train Local_ResNet_18,  epoch  96, local model 69, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3564/4013 (88.8114%)
___Train Local_ResNet_18,  epoch  96, local model 69, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3682/4013 (91.7518%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 1.8987, Accuracy: 5601/10000 (56.0100%)
___Train Local_ResNet_18,  epoch  96, local model 63, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3165/3590 (88.1616%)
___Train Local_ResNet_18,  epoch  96, local model 63, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3285/3590 (91.5042%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.0516, Accuracy: 5452/10000 (54.5200%)
___Train Local_ResNet_18,  epoch  96, local model 84, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4188/4793 (87.3774%)
___Train Local_ResNet_18,  epoch  96, local model 84, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4348/4793 (90.7156%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 1.9903, Accuracy: 5502/10000 (55.0200%)
___Train Local_ResNet_18,  epoch  96, local model 60, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3375/3804 (88.7224%)
___Train Local_ResNet_18,  epoch  96, local model 60, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3463/3804 (91.0358%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.0036, Accuracy: 5458/10000 (54.5800%)
___Train Local_ResNet_18,  epoch  96, local model 39, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3386/3837 (88.2460%)
___Train Local_ResNet_18,  epoch  96, local model 39, internal_epoch   2,  Average loss: 0.0040, Accuracy: 3541/3837 (92.2856%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 1.8777, Accuracy: 5645/10000 (56.4500%)
___Train Local_ResNet_18,  epoch  96, local model 97, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3891/4361 (89.2227%)
___Train Local_ResNet_18,  epoch  96, local model 97, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3893/4361 (89.2685%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.0271, Accuracy: 5507/10000 (55.0700%)
___Train Local_ResNet_18,  epoch  96, local model 62, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4455/5063 (87.9913%)
___Train Local_ResNet_18,  epoch  96, local model 62, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4461/5063 (88.1098%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.1596, Accuracy: 5143/10000 (51.4300%)
___Train Local_ResNet_18,  epoch  96, local model 50, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3765/4368 (86.1951%)
___Train Local_ResNet_18,  epoch  96, local model 50, internal_epoch   2,  Average loss: 0.0053, Accuracy: 3903/4368 (89.3544%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.0054, Accuracy: 5389/10000 (53.8900%)
___Train Local_ResNet_18,  epoch  96, local model 96, internal_epoch   1,  Average loss: 0.0042, Accuracy: 4318/4679 (92.2847%)
___Train Local_ResNet_18,  epoch  96, local model 96, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4150/4679 (88.6942%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.1043, Accuracy: 5329/10000 (53.2900%)
___Train Local_ResNet_18,  epoch  96, local model 9, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4690/5265 (89.0788%)
___Train Local_ResNet_18,  epoch  96, local model 9, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4726/5265 (89.7626%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.0807, Accuracy: 5403/10000 (54.0300%)
___Train Local_ResNet_18,  epoch  96, local model 72, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4133/4767 (86.7002%)
___Train Local_ResNet_18,  epoch  96, local model 72, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4242/4767 (88.9868%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.1222, Accuracy: 5370/10000 (53.7000%)
___Train Local_ResNet_18,  epoch  96, local model 25, internal_epoch   1,  Average loss: 0.0065, Accuracy: 5188/5902 (87.9024%)
___Train Local_ResNet_18,  epoch  96, local model 25, internal_epoch   2,  Average loss: 0.0077, Accuracy: 5007/5902 (84.8356%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 2.1929, Accuracy: 5180/10000 (51.8000%)
___Train Local_ResNet_18,  epoch  96, local model 27, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3712/4223 (87.8996%)
___Train Local_ResNet_18,  epoch  96, local model 27, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3870/4223 (91.6410%)
___Test Local_ResNet_18 poisoned: False, epoch: 96: Average loss: 1.9783, Accuracy: 5526/10000 (55.2600%)
time spent on training: 270.04969358444214
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 96: Average loss: 1.4867, Accuracy: 6445/10000 (64.4500%)
___Test Target_ResNet_18 poisoned: True, epoch: 96: Average loss: 8.7330, Accuracy: 250/9900 (2.5253%)
Done in 300.9355049133301 sec.
Server Epoch:97 choose agents : [13, 36, 58, 71, 52, 14, 47, 34, 69, 35, 24, 48, 57, 99, 76, 6, 38, 39, 97, 84].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  97, local model 13, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4412/4885 (90.3173%), train_poison_data_count: 385
Global model norm: 43.43674403568798.
Norm before scaling: 43.43260567075803. Distance: 2.0346948609521425
Total norm for 4 adversaries is: 43.43260567075803. distance: 2.0346948609521425
___Test Local_ResNet_18 poisoned: True, epoch: 97: Average loss: 0.3459, Accuracy: 9002/9900 (90.9293%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  97, local model 36, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4722/5305 (89.0104%), train_poison_data_count: 415
Global model norm: 43.43674403568798.
Norm before scaling: 43.435282654736746. Distance: 2.2093843322297824
Total norm for 4 adversaries is: 43.435282654736746. distance: 2.2093843322297824
___Test Local_ResNet_18 poisoned: True, epoch: 97: Average loss: 0.1991, Accuracy: 9372/9900 (94.6667%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  97, local model 58, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4224/4717 (89.5484%), train_poison_data_count: 370
Global model norm: 43.43674403568798.
Norm before scaling: 43.43127484619379. Distance: 2.031896634979668
Total norm for 4 adversaries is: 43.43127484619379. distance: 2.031896634979668
___Test Local_ResNet_18 poisoned: True, epoch: 97: Average loss: 0.1944, Accuracy: 9402/9900 (94.9697%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  97, local model 71, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4453/5066 (87.8997%), train_poison_data_count: 400
Global model norm: 43.43674403568798.
Norm before scaling: 43.441075898224625. Distance: 2.284578586174319
Total norm for 4 adversaries is: 43.441075898224625. distance: 2.284578586174319
___Test Local_ResNet_18 poisoned: True, epoch: 97: Average loss: 0.1427, Accuracy: 9527/9900 (96.2323%)
___Train Local_ResNet_18,  epoch  97, local model 52, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3378/3797 (88.9650%)
___Train Local_ResNet_18,  epoch  97, local model 52, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3458/3797 (91.0719%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.8137, Accuracy: 5683/10000 (56.8300%)
___Train Local_ResNet_18,  epoch  97, local model 14, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3401/3861 (88.0860%)
___Train Local_ResNet_18,  epoch  97, local model 14, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3493/3861 (90.4688%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.9490, Accuracy: 5533/10000 (55.3300%)
___Train Local_ResNet_18,  epoch  97, local model 47, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4157/4707 (88.3153%)
___Train Local_ResNet_18,  epoch  97, local model 47, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4285/4707 (91.0346%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.8824, Accuracy: 5640/10000 (56.4000%)
___Train Local_ResNet_18,  epoch  97, local model 34, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4008/4518 (88.7118%)
___Train Local_ResNet_18,  epoch  97, local model 34, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4133/4518 (91.4785%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 2.0248, Accuracy: 5395/10000 (53.9500%)
___Train Local_ResNet_18,  epoch  97, local model 69, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3562/4013 (88.7615%)
___Train Local_ResNet_18,  epoch  97, local model 69, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3680/4013 (91.7020%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.9281, Accuracy: 5538/10000 (55.3800%)
___Train Local_ResNet_18,  epoch  97, local model 35, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4602/5167 (89.0652%)
___Train Local_ResNet_18,  epoch  97, local model 35, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4701/5167 (90.9812%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 2.1378, Accuracy: 5307/10000 (53.0700%)
___Train Local_ResNet_18,  epoch  97, local model 24, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3514/3969 (88.5362%)
___Train Local_ResNet_18,  epoch  97, local model 24, internal_epoch   2,  Average loss: 0.0059, Accuracy: 3613/3969 (91.0305%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.9628, Accuracy: 5735/10000 (57.3500%)
___Train Local_ResNet_18,  epoch  97, local model 48, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3974/4441 (89.4844%)
___Train Local_ResNet_18,  epoch  97, local model 48, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4073/4441 (91.7136%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 2.0234, Accuracy: 5507/10000 (55.0700%)
___Train Local_ResNet_18,  epoch  97, local model 57, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3983/4558 (87.3848%)
___Train Local_ResNet_18,  epoch  97, local model 57, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4075/4558 (89.4032%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 2.0516, Accuracy: 5300/10000 (53.0000%)
___Train Local_ResNet_18,  epoch  97, local model 99, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3953/4465 (88.5330%)
___Train Local_ResNet_18,  epoch  97, local model 99, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4125/4465 (92.3852%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.7754, Accuracy: 5811/10000 (58.1100%)
___Train Local_ResNet_18,  epoch  97, local model 76, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3181/3638 (87.4382%)
___Train Local_ResNet_18,  epoch  97, local model 76, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3337/3638 (91.7262%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.8689, Accuracy: 5673/10000 (56.7300%)
___Train Local_ResNet_18,  epoch  97, local model 6, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4027/4538 (88.7395%)
___Train Local_ResNet_18,  epoch  97, local model 6, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4193/4538 (92.3975%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.7662, Accuracy: 5760/10000 (57.6000%)
___Train Local_ResNet_18,  epoch  97, local model 38, internal_epoch   1,  Average loss: 0.0062, Accuracy: 5049/5740 (87.9617%)
___Train Local_ResNet_18,  epoch  97, local model 38, internal_epoch   2,  Average loss: 0.0044, Accuracy: 5248/5740 (91.4286%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 2.1983, Accuracy: 5186/10000 (51.8600%)
___Train Local_ResNet_18,  epoch  97, local model 39, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3369/3837 (87.8030%)
___Train Local_ResNet_18,  epoch  97, local model 39, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3520/3837 (91.7383%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.8865, Accuracy: 5609/10000 (56.0900%)
___Train Local_ResNet_18,  epoch  97, local model 97, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3895/4361 (89.3144%)
___Train Local_ResNet_18,  epoch  97, local model 97, internal_epoch   2,  Average loss: 0.0077, Accuracy: 3690/4361 (84.6136%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 2.0528, Accuracy: 5348/10000 (53.4800%)
___Train Local_ResNet_18,  epoch  97, local model 84, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4173/4793 (87.0645%)
___Train Local_ResNet_18,  epoch  97, local model 84, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4313/4793 (89.9854%)
___Test Local_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.9892, Accuracy: 5507/10000 (55.0700%)
time spent on training: 265.93217635154724
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 97: Average loss: 1.4552, Accuracy: 6494/10000 (64.9400%)
___Test Target_ResNet_18 poisoned: True, epoch: 97: Average loss: 8.8289, Accuracy: 219/9900 (2.2121%)
Done in 297.71306252479553 sec.
Server Epoch:98 choose agents : [13, 36, 58, 71, 72, 48, 55, 85, 23, 29, 45, 21, 88, 42, 79, 14, 65, 33, 35, 63].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  98, local model 13, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4400/4885 (90.0716%), train_poison_data_count: 385
Global model norm: 43.46861801291968.
Norm before scaling: 43.46578159796364. Distance: 2.068588633164665
Total norm for 4 adversaries is: 43.46578159796364. distance: 2.068588633164665
___Test Local_ResNet_18 poisoned: True, epoch: 98: Average loss: 0.2647, Accuracy: 9214/9900 (93.0707%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  98, local model 36, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4712/5305 (88.8219%), train_poison_data_count: 415
Global model norm: 43.46861801291968.
Norm before scaling: 43.46631379091529. Distance: 2.195371905300281
Total norm for 4 adversaries is: 43.46631379091529. distance: 2.195371905300281
___Test Local_ResNet_18 poisoned: True, epoch: 98: Average loss: 0.1226, Accuracy: 9577/9900 (96.7374%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  98, local model 58, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4227/4717 (89.6120%), train_poison_data_count: 370
Global model norm: 43.46861801291968.
Norm before scaling: 43.46448829980703. Distance: 2.0051704568299433
Total norm for 4 adversaries is: 43.46448829980703. distance: 2.0051704568299433
___Test Local_ResNet_18 poisoned: True, epoch: 98: Average loss: 0.1569, Accuracy: 9494/9900 (95.8990%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  98, local model 71, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4483/5066 (88.4919%), train_poison_data_count: 400
Global model norm: 43.46861801291968.
Norm before scaling: 43.47131383973948. Distance: 2.229030913975893
Total norm for 4 adversaries is: 43.47131383973948. distance: 2.229030913975893
___Test Local_ResNet_18 poisoned: True, epoch: 98: Average loss: 0.2465, Accuracy: 9264/9900 (93.5758%)
___Train Local_ResNet_18,  epoch  98, local model 72, internal_epoch   1,  Average loss: 0.0072, Accuracy: 4084/4767 (85.6723%)
___Train Local_ResNet_18,  epoch  98, local model 72, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4282/4767 (89.8259%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.1484, Accuracy: 5179/10000 (51.7900%)
___Train Local_ResNet_18,  epoch  98, local model 48, internal_epoch   1,  Average loss: 0.0053, Accuracy: 3992/4441 (89.8897%)
___Train Local_ResNet_18,  epoch  98, local model 48, internal_epoch   2,  Average loss: 0.0038, Accuracy: 4134/4441 (93.0871%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.0484, Accuracy: 5475/10000 (54.7500%)
___Train Local_ResNet_18,  epoch  98, local model 55, internal_epoch   1,  Average loss: 0.0040, Accuracy: 4036/4356 (92.6538%)
___Train Local_ResNet_18,  epoch  98, local model 55, internal_epoch   2,  Average loss: 0.0056, Accuracy: 3968/4356 (91.0927%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.2591, Accuracy: 5142/10000 (51.4200%)
___Train Local_ResNet_18,  epoch  98, local model 85, internal_epoch   1,  Average loss: 0.0064, Accuracy: 5554/6391 (86.9035%)
___Train Local_ResNet_18,  epoch  98, local model 85, internal_epoch   2,  Average loss: 0.0059, Accuracy: 5631/6391 (88.1083%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.1080, Accuracy: 5205/10000 (52.0500%)
___Train Local_ResNet_18,  epoch  98, local model 23, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3696/4184 (88.3365%)
___Train Local_ResNet_18,  epoch  98, local model 23, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3737/4184 (89.3164%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 1.9806, Accuracy: 5426/10000 (54.2600%)
___Train Local_ResNet_18,  epoch  98, local model 29, internal_epoch   1,  Average loss: 0.0051, Accuracy: 3902/4346 (89.7837%)
___Train Local_ResNet_18,  epoch  98, local model 29, internal_epoch   2,  Average loss: 0.0037, Accuracy: 4042/4346 (93.0051%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 1.7653, Accuracy: 5843/10000 (58.4300%)
___Train Local_ResNet_18,  epoch  98, local model 45, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4351/5037 (86.3808%)
___Train Local_ResNet_18,  epoch  98, local model 45, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4592/5037 (91.1654%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 1.9738, Accuracy: 5446/10000 (54.4600%)
___Train Local_ResNet_18,  epoch  98, local model 21, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4097/4634 (88.4117%)
___Train Local_ResNet_18,  epoch  98, local model 21, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4216/4634 (90.9797%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 1.8586, Accuracy: 5667/10000 (56.6700%)
___Train Local_ResNet_18,  epoch  98, local model 88, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4375/4934 (88.6704%)
___Train Local_ResNet_18,  epoch  98, local model 88, internal_epoch   2,  Average loss: 0.0062, Accuracy: 4358/4934 (88.3259%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.1363, Accuracy: 5165/10000 (51.6500%)
___Train Local_ResNet_18,  epoch  98, local model 42, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4811/5424 (88.6984%)
___Train Local_ResNet_18,  epoch  98, local model 42, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4930/5424 (90.8923%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 1.9738, Accuracy: 5520/10000 (55.2000%)
___Train Local_ResNet_18,  epoch  98, local model 79, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3354/3781 (88.7067%)
___Train Local_ResNet_18,  epoch  98, local model 79, internal_epoch   2,  Average loss: 0.0066, Accuracy: 3310/3781 (87.5430%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.0047, Accuracy: 5314/10000 (53.1400%)
___Train Local_ResNet_18,  epoch  98, local model 14, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3400/3861 (88.0601%)
___Train Local_ResNet_18,  epoch  98, local model 14, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3477/3861 (90.0544%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 1.8629, Accuracy: 5679/10000 (56.7900%)
___Train Local_ResNet_18,  epoch  98, local model 65, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4503/5055 (89.0801%)
___Train Local_ResNet_18,  epoch  98, local model 65, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4666/5055 (92.3046%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 1.8527, Accuracy: 5746/10000 (57.4600%)
___Train Local_ResNet_18,  epoch  98, local model 33, internal_epoch   1,  Average loss: 0.0056, Accuracy: 3961/4433 (89.3526%)
___Train Local_ResNet_18,  epoch  98, local model 33, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4041/4433 (91.1572%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 1.7953, Accuracy: 5787/10000 (57.8700%)
___Train Local_ResNet_18,  epoch  98, local model 35, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4573/5167 (88.5040%)
___Train Local_ResNet_18,  epoch  98, local model 35, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4686/5167 (90.6909%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.1244, Accuracy: 5284/10000 (52.8400%)
___Train Local_ResNet_18,  epoch  98, local model 63, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3181/3590 (88.6072%)
___Train Local_ResNet_18,  epoch  98, local model 63, internal_epoch   2,  Average loss: 0.0066, Accuracy: 3146/3590 (87.6323%)
___Test Local_ResNet_18 poisoned: False, epoch: 98: Average loss: 2.0507, Accuracy: 5409/10000 (54.0900%)
time spent on training: 265.12986063957214
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 98: Average loss: 1.6762, Accuracy: 6143/10000 (61.4300%)
___Test Target_ResNet_18 poisoned: True, epoch: 98: Average loss: 6.5068, Accuracy: 897/9900 (9.0606%)
Done in 296.1370966434479 sec.
Server Epoch:99 choose agents : [13, 36, 58, 71, 50, 98, 55, 14, 30, 6, 70, 75, 73, 66, 9, 48, 69, 99, 92, 1].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  99, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4405/4885 (90.1740%), train_poison_data_count: 385
Global model norm: 43.49949347540943.
Norm before scaling: 43.49838078433926. Distance: 2.1155169325574437
Total norm for 4 adversaries is: 43.49838078433926. distance: 2.1155169325574437
___Test Local_ResNet_18 poisoned: True, epoch: 99: Average loss: 0.2685, Accuracy: 9226/9900 (93.1919%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  99, local model 36, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4740/5305 (89.3497%), train_poison_data_count: 415
Global model norm: 43.49949347540943.
Norm before scaling: 43.49788406312139. Distance: 2.1641898548096776
Total norm for 4 adversaries is: 43.49788406312139. distance: 2.1641898548096776
___Test Local_ResNet_18 poisoned: True, epoch: 99: Average loss: 0.2442, Accuracy: 9304/9900 (93.9798%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  99, local model 58, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4215/4717 (89.3576%), train_poison_data_count: 370
Global model norm: 43.49949347540943.
Norm before scaling: 43.497790050275114. Distance: 2.05214228924587
Total norm for 4 adversaries is: 43.497790050275114. distance: 2.05214228924587
___Test Local_ResNet_18 poisoned: True, epoch: 99: Average loss: 0.2153, Accuracy: 9340/9900 (94.3434%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch  99, local model 71, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4452/5066 (87.8800%), train_poison_data_count: 400
Global model norm: 43.49949347540943.
Norm before scaling: 43.503584790778305. Distance: 2.2712320333556457
Total norm for 4 adversaries is: 43.503584790778305. distance: 2.2712320333556457
___Test Local_ResNet_18 poisoned: True, epoch: 99: Average loss: 0.1767, Accuracy: 9460/9900 (95.5556%)
___Train Local_ResNet_18,  epoch  99, local model 50, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3815/4368 (87.3397%)
___Train Local_ResNet_18,  epoch  99, local model 50, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3910/4368 (89.5147%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.9312, Accuracy: 5519/10000 (55.1900%)
___Train Local_ResNet_18,  epoch  99, local model 98, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3372/3828 (88.0878%)
___Train Local_ResNet_18,  epoch  99, local model 98, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3528/3828 (92.1630%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.7663, Accuracy: 5800/10000 (58.0000%)
___Train Local_ResNet_18,  epoch  99, local model 55, internal_epoch   1,  Average loss: 0.0034, Accuracy: 4120/4356 (94.5822%)
___Train Local_ResNet_18,  epoch  99, local model 55, internal_epoch   2,  Average loss: 0.0069, Accuracy: 3786/4356 (86.9146%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 2.2396, Accuracy: 5064/10000 (50.6400%)
___Train Local_ResNet_18,  epoch  99, local model 14, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3377/3861 (87.4644%)
___Train Local_ResNet_18,  epoch  99, local model 14, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3497/3861 (90.5724%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.8733, Accuracy: 5682/10000 (56.8200%)
___Train Local_ResNet_18,  epoch  99, local model 30, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3049/3472 (87.8168%)
___Train Local_ResNet_18,  epoch  99, local model 30, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3211/3472 (92.4827%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.9812, Accuracy: 5502/10000 (55.0200%)
___Train Local_ResNet_18,  epoch  99, local model 6, internal_epoch   1,  Average loss: 0.0054, Accuracy: 4073/4538 (89.7532%)
___Train Local_ResNet_18,  epoch  99, local model 6, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4194/4538 (92.4196%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.8537, Accuracy: 5696/10000 (56.9600%)
___Train Local_ResNet_18,  epoch  99, local model 70, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4775/5392 (88.5571%)
___Train Local_ResNet_18,  epoch  99, local model 70, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4848/5392 (89.9110%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.9381, Accuracy: 5519/10000 (55.1900%)
___Train Local_ResNet_18,  epoch  99, local model 75, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3740/4295 (87.0780%)
___Train Local_ResNet_18,  epoch  99, local model 75, internal_epoch   2,  Average loss: 0.0073, Accuracy: 3718/4295 (86.5658%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.9911, Accuracy: 5364/10000 (53.6400%)
___Train Local_ResNet_18,  epoch  99, local model 73, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3744/4235 (88.4061%)
___Train Local_ResNet_18,  epoch  99, local model 73, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3826/4235 (90.3424%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.8720, Accuracy: 5685/10000 (56.8500%)
___Train Local_ResNet_18,  epoch  99, local model 66, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3991/4456 (89.5646%)
___Train Local_ResNet_18,  epoch  99, local model 66, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4080/4456 (91.5619%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.9881, Accuracy: 5561/10000 (55.6100%)
___Train Local_ResNet_18,  epoch  99, local model 9, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4594/5265 (87.2555%)
___Train Local_ResNet_18,  epoch  99, local model 9, internal_epoch   2,  Average loss: 0.0059, Accuracy: 4650/5265 (88.3191%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 2.0341, Accuracy: 5366/10000 (53.6600%)
___Train Local_ResNet_18,  epoch  99, local model 48, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3996/4441 (89.9797%)
___Train Local_ResNet_18,  epoch  99, local model 48, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4111/4441 (92.5692%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 2.0078, Accuracy: 5508/10000 (55.0800%)
___Train Local_ResNet_18,  epoch  99, local model 69, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3569/4013 (88.9360%)
___Train Local_ResNet_18,  epoch  99, local model 69, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3712/4013 (92.4994%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.8462, Accuracy: 5680/10000 (56.8000%)
___Train Local_ResNet_18,  epoch  99, local model 99, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3894/4465 (87.2116%)
___Train Local_ResNet_18,  epoch  99, local model 99, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4109/4465 (92.0269%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.8241, Accuracy: 5699/10000 (56.9900%)
___Train Local_ResNet_18,  epoch  99, local model 92, internal_epoch   1,  Average loss: 0.0061, Accuracy: 5530/6263 (88.2963%)
___Train Local_ResNet_18,  epoch  99, local model 92, internal_epoch   2,  Average loss: 0.0045, Accuracy: 5718/6263 (91.2981%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.9164, Accuracy: 5582/10000 (55.8200%)
___Train Local_ResNet_18,  epoch  99, local model 1, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4372/4986 (87.6855%)
___Train Local_ResNet_18,  epoch  99, local model 1, internal_epoch   2,  Average loss: 0.0047, Accuracy: 4508/4986 (90.4132%)
___Test Local_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.8613, Accuracy: 5710/10000 (57.1000%)
time spent on training: 269.4441123008728
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 99: Average loss: 1.6718, Accuracy: 6150/10000 (61.5000%)
___Test Target_ResNet_18 poisoned: True, epoch: 99: Average loss: 6.6872, Accuracy: 742/9900 (7.4949%)
Done in 300.0670247077942 sec.
Server Epoch:100 choose agents : [13, 36, 58, 71, 91, 35, 98, 10, 33, 23, 28, 27, 96, 4, 39, 14, 42, 43, 78, 51].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 100, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4376/4885 (89.5803%), train_poison_data_count: 385
Global model norm: 43.532126303545205.
Norm before scaling: 43.533013805795996. Distance: 2.1310583034006076
Total norm for 4 adversaries is: 43.533013805795996. distance: 2.1310583034006076
___Test Local_ResNet_18 poisoned: True, epoch: 100: Average loss: 0.1548, Accuracy: 9503/9900 (95.9899%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 100, local model 36, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4732/5305 (89.1989%), train_poison_data_count: 415
Global model norm: 43.532126303545205.
Norm before scaling: 43.531603327711814. Distance: 2.1864098148375497
Total norm for 4 adversaries is: 43.531603327711814. distance: 2.1864098148375497
___Test Local_ResNet_18 poisoned: True, epoch: 100: Average loss: 0.1684, Accuracy: 9515/9900 (96.1111%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 100, local model 58, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4201/4717 (89.0608%), train_poison_data_count: 370
Global model norm: 43.532126303545205.
Norm before scaling: 43.52841906848401. Distance: 2.0415430874954823
Total norm for 4 adversaries is: 43.52841906848401. distance: 2.0415430874954823
___Test Local_ResNet_18 poisoned: True, epoch: 100: Average loss: 0.1877, Accuracy: 9408/9900 (95.0303%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 100, local model 71, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4463/5066 (88.0971%), train_poison_data_count: 400
Global model norm: 43.532126303545205.
Norm before scaling: 43.534602291507014. Distance: 2.2647818213131776
Total norm for 4 adversaries is: 43.534602291507014. distance: 2.2647818213131776
___Test Local_ResNet_18 poisoned: True, epoch: 100: Average loss: 0.2030, Accuracy: 9389/9900 (94.8384%)
___Train Local_ResNet_18,  epoch 100, local model 91, internal_epoch   1,  Average loss: 0.0078, Accuracy: 3509/4158 (84.3915%)
___Train Local_ResNet_18,  epoch 100, local model 91, internal_epoch   2,  Average loss: 0.0066, Accuracy: 3611/4158 (86.8446%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 2.1258, Accuracy: 5200/10000 (52.0000%)
___Train Local_ResNet_18,  epoch 100, local model 35, internal_epoch   1,  Average loss: 0.0063, Accuracy: 4541/5167 (87.8847%)
___Train Local_ResNet_18,  epoch 100, local model 35, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4672/5167 (90.4200%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.9588, Accuracy: 5492/10000 (54.9200%)
___Train Local_ResNet_18,  epoch 100, local model 98, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3344/3828 (87.3563%)
___Train Local_ResNet_18,  epoch 100, local model 98, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3464/3828 (90.4911%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.8505, Accuracy: 5646/10000 (56.4600%)
___Train Local_ResNet_18,  epoch 100, local model 10, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4145/4663 (88.8913%)
___Train Local_ResNet_18,  epoch 100, local model 10, internal_epoch   2,  Average loss: 0.0042, Accuracy: 4279/4663 (91.7650%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.9341, Accuracy: 5513/10000 (55.1300%)
___Train Local_ResNet_18,  epoch 100, local model 33, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3943/4433 (88.9465%)
___Train Local_ResNet_18,  epoch 100, local model 33, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4062/4433 (91.6309%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.9233, Accuracy: 5596/10000 (55.9600%)
___Train Local_ResNet_18,  epoch 100, local model 23, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3670/4184 (87.7151%)
___Train Local_ResNet_18,  epoch 100, local model 23, internal_epoch   2,  Average loss: 0.0050, Accuracy: 3765/4184 (89.9857%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.8776, Accuracy: 5656/10000 (56.5600%)
___Train Local_ResNet_18,  epoch 100, local model 28, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4093/4716 (86.7897%)
___Train Local_ResNet_18,  epoch 100, local model 28, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4193/4716 (88.9101%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 2.0536, Accuracy: 5241/10000 (52.4100%)
___Train Local_ResNet_18,  epoch 100, local model 27, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3744/4223 (88.6574%)
___Train Local_ResNet_18,  epoch 100, local model 27, internal_epoch   2,  Average loss: 0.0043, Accuracy: 3861/4223 (91.4279%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.8489, Accuracy: 5618/10000 (56.1800%)
___Train Local_ResNet_18,  epoch 100, local model 96, internal_epoch   1,  Average loss: 0.0044, Accuracy: 4313/4679 (92.1778%)
___Train Local_ResNet_18,  epoch 100, local model 96, internal_epoch   2,  Average loss: 0.0054, Accuracy: 4214/4679 (90.0620%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 2.1053, Accuracy: 5318/10000 (53.1800%)
___Train Local_ResNet_18,  epoch 100, local model 4, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3203/3704 (86.4741%)
___Train Local_ResNet_18,  epoch 100, local model 4, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3352/3704 (90.4968%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.8619, Accuracy: 5737/10000 (57.3700%)
___Train Local_ResNet_18,  epoch 100, local model 39, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3379/3837 (88.0636%)
___Train Local_ResNet_18,  epoch 100, local model 39, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3539/3837 (92.2335%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.8674, Accuracy: 5672/10000 (56.7200%)
___Train Local_ResNet_18,  epoch 100, local model 14, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3391/3861 (87.8270%)
___Train Local_ResNet_18,  epoch 100, local model 14, internal_epoch   2,  Average loss: 0.0055, Accuracy: 3450/3861 (89.3551%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.9061, Accuracy: 5675/10000 (56.7500%)
___Train Local_ResNet_18,  epoch 100, local model 42, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4816/5424 (88.7906%)
___Train Local_ResNet_18,  epoch 100, local model 42, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4940/5424 (91.0767%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 2.2524, Accuracy: 5190/10000 (51.9000%)
___Train Local_ResNet_18,  epoch 100, local model 43, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4049/4576 (88.4834%)
___Train Local_ResNet_18,  epoch 100, local model 43, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4175/4576 (91.2369%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.8426, Accuracy: 5738/10000 (57.3800%)
___Train Local_ResNet_18,  epoch 100, local model 78, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3570/4025 (88.6957%)
___Train Local_ResNet_18,  epoch 100, local model 78, internal_epoch   2,  Average loss: 0.0037, Accuracy: 3747/4025 (93.0932%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.7733, Accuracy: 5740/10000 (57.4000%)
___Train Local_ResNet_18,  epoch 100, local model 51, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3356/3775 (88.9007%)
___Train Local_ResNet_18,  epoch 100, local model 51, internal_epoch   2,  Average loss: 0.0035, Accuracy: 3522/3775 (93.2980%)
___Test Local_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.8611, Accuracy: 5727/10000 (57.2700%)
time spent on training: 264.492155790329
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 100: Average loss: 1.6357, Accuracy: 6229/10000 (62.2900%)
___Test Target_ResNet_18 poisoned: True, epoch: 100: Average loss: 7.1049, Accuracy: 517/9900 (5.2222%)
Done in 295.2175304889679 sec.
Server Epoch:101 choose agents : [13, 36, 58, 71, 43, 87, 81, 6, 80, 63, 47, 3, 41, 25, 48, 22, 94, 24, 70, 98].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 101, local model 13, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4403/4885 (90.1331%), train_poison_data_count: 385
Global model norm: 43.56031704089314.
Norm before scaling: 43.557866335790166. Distance: 2.087940640113646
Total norm for 4 adversaries is: 43.557866335790166. distance: 2.087940640113646
___Test Local_ResNet_18 poisoned: True, epoch: 101: Average loss: 0.1669, Accuracy: 9476/9900 (95.7172%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 101, local model 36, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4729/5305 (89.1423%), train_poison_data_count: 415
Global model norm: 43.56031704089314.
Norm before scaling: 43.55910501700893. Distance: 2.2227547193010957
Total norm for 4 adversaries is: 43.55910501700893. distance: 2.2227547193010957
___Test Local_ResNet_18 poisoned: True, epoch: 101: Average loss: 0.3386, Accuracy: 9057/9900 (91.4848%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 101, local model 58, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4245/4717 (89.9936%), train_poison_data_count: 370
Global model norm: 43.56031704089314.
Norm before scaling: 43.557057811062606. Distance: 1.9954297179918892
Total norm for 4 adversaries is: 43.557057811062606. distance: 1.9954297179918892
___Test Local_ResNet_18 poisoned: True, epoch: 101: Average loss: 0.2863, Accuracy: 9184/9900 (92.7677%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 101, local model 71, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4500/5066 (88.8275%), train_poison_data_count: 400
Global model norm: 43.56031704089314.
Norm before scaling: 43.56008584818862. Distance: 2.247630461066534
Total norm for 4 adversaries is: 43.56008584818862. distance: 2.247630461066534
___Test Local_ResNet_18 poisoned: True, epoch: 101: Average loss: 0.0719, Accuracy: 9698/9900 (97.9596%)
___Train Local_ResNet_18,  epoch 101, local model 43, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4028/4576 (88.0245%)
___Train Local_ResNet_18,  epoch 101, local model 43, internal_epoch   2,  Average loss: 0.0044, Accuracy: 4218/4576 (92.1766%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.9428, Accuracy: 5576/10000 (55.7600%)
___Train Local_ResNet_18,  epoch 101, local model 87, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3222/3672 (87.7451%)
___Train Local_ResNet_18,  epoch 101, local model 87, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3341/3672 (90.9858%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.9346, Accuracy: 5433/10000 (54.3300%)
___Train Local_ResNet_18,  epoch 101, local model 81, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4123/4618 (89.2811%)
___Train Local_ResNet_18,  epoch 101, local model 81, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4108/4618 (88.9563%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 2.0375, Accuracy: 5472/10000 (54.7200%)
___Train Local_ResNet_18,  epoch 101, local model 6, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4045/4538 (89.1362%)
___Train Local_ResNet_18,  epoch 101, local model 6, internal_epoch   2,  Average loss: 0.0037, Accuracy: 4221/4538 (93.0145%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.8272, Accuracy: 5736/10000 (57.3600%)
___Train Local_ResNet_18,  epoch 101, local model 80, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4442/5025 (88.3980%)
___Train Local_ResNet_18,  epoch 101, local model 80, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4618/5025 (91.9005%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 2.0415, Accuracy: 5465/10000 (54.6500%)
___Train Local_ResNet_18,  epoch 101, local model 63, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3175/3590 (88.4401%)
___Train Local_ResNet_18,  epoch 101, local model 63, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3208/3590 (89.3593%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 2.1060, Accuracy: 5301/10000 (53.0100%)
___Train Local_ResNet_18,  epoch 101, local model 47, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4149/4707 (88.1453%)
___Train Local_ResNet_18,  epoch 101, local model 47, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4295/4707 (91.2471%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.9990, Accuracy: 5439/10000 (54.3900%)
___Train Local_ResNet_18,  epoch 101, local model 3, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4316/4918 (87.7593%)
___Train Local_ResNet_18,  epoch 101, local model 3, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4441/4918 (90.3009%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.9920, Accuracy: 5378/10000 (53.7800%)
___Train Local_ResNet_18,  epoch 101, local model 41, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3816/4336 (88.0074%)
___Train Local_ResNet_18,  epoch 101, local model 41, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3957/4336 (91.2592%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 2.0232, Accuracy: 5406/10000 (54.0600%)
___Train Local_ResNet_18,  epoch 101, local model 25, internal_epoch   1,  Average loss: 0.0052, Accuracy: 5300/5902 (89.8001%)
___Train Local_ResNet_18,  epoch 101, local model 25, internal_epoch   2,  Average loss: 0.0060, Accuracy: 5213/5902 (88.3260%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 2.1207, Accuracy: 5284/10000 (52.8400%)
___Train Local_ResNet_18,  epoch 101, local model 48, internal_epoch   1,  Average loss: 0.0054, Accuracy: 3995/4441 (89.9572%)
___Train Local_ResNet_18,  epoch 101, local model 48, internal_epoch   2,  Average loss: 0.0039, Accuracy: 4076/4441 (91.7811%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 2.0435, Accuracy: 5384/10000 (53.8400%)
___Train Local_ResNet_18,  epoch 101, local model 22, internal_epoch   1,  Average loss: 0.0074, Accuracy: 4458/5232 (85.2064%)
___Train Local_ResNet_18,  epoch 101, local model 22, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4657/5232 (89.0099%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.9701, Accuracy: 5409/10000 (54.0900%)
___Train Local_ResNet_18,  epoch 101, local model 94, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4283/4804 (89.1549%)
___Train Local_ResNet_18,  epoch 101, local model 94, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4301/4804 (89.5296%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 2.0517, Accuracy: 5432/10000 (54.3200%)
___Train Local_ResNet_18,  epoch 101, local model 24, internal_epoch   1,  Average loss: 0.0068, Accuracy: 3539/3969 (89.1660%)
___Train Local_ResNet_18,  epoch 101, local model 24, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3639/3969 (91.6856%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.9147, Accuracy: 5710/10000 (57.1000%)
___Train Local_ResNet_18,  epoch 101, local model 70, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4782/5392 (88.6869%)
___Train Local_ResNet_18,  epoch 101, local model 70, internal_epoch   2,  Average loss: 0.0049, Accuracy: 4878/5392 (90.4674%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 2.0214, Accuracy: 5466/10000 (54.6600%)
___Train Local_ResNet_18,  epoch 101, local model 98, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3353/3828 (87.5914%)
___Train Local_ResNet_18,  epoch 101, local model 98, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3507/3828 (91.6144%)
___Test Local_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.8559, Accuracy: 5707/10000 (57.0700%)
time spent on training: 267.08803629875183
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 101: Average loss: 1.5817, Accuracy: 6293/10000 (62.9300%)
___Test Target_ResNet_18 poisoned: True, epoch: 101: Average loss: 7.1505, Accuracy: 570/9900 (5.7576%)
Done in 297.96235823631287 sec.
Server Epoch:102 choose agents : [13, 36, 58, 71, 22, 46, 62, 78, 48, 95, 32, 15, 25, 6, 80, 27, 97, 37, 87, 89].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 102, local model 13, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4437/4885 (90.8291%), train_poison_data_count: 385
Global model norm: 43.60167098736727.
Norm before scaling: 43.59885302793598. Distance: 2.044954286917802
Total norm for 4 adversaries is: 43.59885302793598. distance: 2.044954286917802
___Test Local_ResNet_18 poisoned: True, epoch: 102: Average loss: 0.1261, Accuracy: 9580/9900 (96.7677%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 102, local model 36, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4720/5305 (88.9727%), train_poison_data_count: 415
Global model norm: 43.60167098736727.
Norm before scaling: 43.6004825110378. Distance: 2.2244338183170913
Total norm for 4 adversaries is: 43.6004825110378. distance: 2.2244338183170913
___Test Local_ResNet_18 poisoned: True, epoch: 102: Average loss: 0.2043, Accuracy: 9406/9900 (95.0101%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 102, local model 58, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4211/4717 (89.2728%), train_poison_data_count: 370
Global model norm: 43.60167098736727.
Norm before scaling: 43.595740881958584. Distance: 2.002704103619417
Total norm for 4 adversaries is: 43.595740881958584. distance: 2.002704103619417
___Test Local_ResNet_18 poisoned: True, epoch: 102: Average loss: 0.2296, Accuracy: 9328/9900 (94.2222%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 102, local model 71, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4489/5066 (88.6103%), train_poison_data_count: 400
Global model norm: 43.60167098736727.
Norm before scaling: 43.60080868032295. Distance: 2.231556962640332
Total norm for 4 adversaries is: 43.60080868032295. distance: 2.231556962640332
___Test Local_ResNet_18 poisoned: True, epoch: 102: Average loss: 0.1455, Accuracy: 9517/9900 (96.1313%)
___Train Local_ResNet_18,  epoch 102, local model 22, internal_epoch   1,  Average loss: 0.0075, Accuracy: 4457/5232 (85.1873%)
___Train Local_ResNet_18,  epoch 102, local model 22, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4603/5232 (87.9778%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.0919, Accuracy: 5266/10000 (52.6600%)
___Train Local_ResNet_18,  epoch 102, local model 46, internal_epoch   1,  Average loss: 0.0070, Accuracy: 4281/4956 (86.3801%)
___Train Local_ResNet_18,  epoch 102, local model 46, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4366/4956 (88.0952%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.2237, Accuracy: 5142/10000 (51.4200%)
___Train Local_ResNet_18,  epoch 102, local model 62, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4435/5063 (87.5963%)
___Train Local_ResNet_18,  epoch 102, local model 62, internal_epoch   2,  Average loss: 0.0061, Accuracy: 4491/5063 (88.7024%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 1.9499, Accuracy: 5526/10000 (55.2600%)
___Train Local_ResNet_18,  epoch 102, local model 78, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3591/4025 (89.2174%)
___Train Local_ResNet_18,  epoch 102, local model 78, internal_epoch   2,  Average loss: 0.0037, Accuracy: 3744/4025 (93.0186%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 1.8517, Accuracy: 5731/10000 (57.3100%)
___Train Local_ResNet_18,  epoch 102, local model 48, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3954/4441 (89.0340%)
___Train Local_ResNet_18,  epoch 102, local model 48, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4106/4441 (92.4567%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.0246, Accuracy: 5449/10000 (54.4900%)
___Train Local_ResNet_18,  epoch 102, local model 95, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4050/4625 (87.5676%)
___Train Local_ResNet_18,  epoch 102, local model 95, internal_epoch   2,  Average loss: 0.0063, Accuracy: 4048/4625 (87.5243%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.0530, Accuracy: 5363/10000 (53.6300%)
___Train Local_ResNet_18,  epoch 102, local model 32, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4831/5591 (86.4067%)
___Train Local_ResNet_18,  epoch 102, local model 32, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4923/5591 (88.0522%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.2906, Accuracy: 5134/10000 (51.3400%)
___Train Local_ResNet_18,  epoch 102, local model 15, internal_epoch   1,  Average loss: 0.0053, Accuracy: 5008/5582 (89.7169%)
___Train Local_ResNet_18,  epoch 102, local model 15, internal_epoch   2,  Average loss: 0.0046, Accuracy: 5071/5582 (90.8456%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.1317, Accuracy: 5227/10000 (52.2700%)
___Train Local_ResNet_18,  epoch 102, local model 25, internal_epoch   1,  Average loss: 0.0045, Accuracy: 5416/5902 (91.7655%)
___Train Local_ResNet_18,  epoch 102, local model 25, internal_epoch   2,  Average loss: 0.0046, Accuracy: 5360/5902 (90.8167%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.1025, Accuracy: 5411/10000 (54.1100%)
___Train Local_ResNet_18,  epoch 102, local model 6, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4055/4538 (89.3565%)
___Train Local_ResNet_18,  epoch 102, local model 6, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4208/4538 (92.7281%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 1.8357, Accuracy: 5669/10000 (56.6900%)
___Train Local_ResNet_18,  epoch 102, local model 80, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4455/5025 (88.6567%)
___Train Local_ResNet_18,  epoch 102, local model 80, internal_epoch   2,  Average loss: 0.0043, Accuracy: 4606/5025 (91.6617%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 1.9993, Accuracy: 5454/10000 (54.5400%)
___Train Local_ResNet_18,  epoch 102, local model 27, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3728/4223 (88.2785%)
___Train Local_ResNet_18,  epoch 102, local model 27, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3846/4223 (91.0727%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 1.7989, Accuracy: 5746/10000 (57.4600%)
___Train Local_ResNet_18,  epoch 102, local model 97, internal_epoch   1,  Average loss: 0.0055, Accuracy: 3888/4361 (89.1539%)
___Train Local_ResNet_18,  epoch 102, local model 97, internal_epoch   2,  Average loss: 0.0061, Accuracy: 3856/4361 (88.4201%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.1704, Accuracy: 5233/10000 (52.3300%)
___Train Local_ResNet_18,  epoch 102, local model 37, internal_epoch   1,  Average loss: 0.0037, Accuracy: 4122/4354 (94.6716%)
___Train Local_ResNet_18,  epoch 102, local model 37, internal_epoch   2,  Average loss: 0.0058, Accuracy: 3908/4354 (89.7565%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.1483, Accuracy: 5142/10000 (51.4200%)
___Train Local_ResNet_18,  epoch 102, local model 87, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3239/3672 (88.2081%)
___Train Local_ResNet_18,  epoch 102, local model 87, internal_epoch   2,  Average loss: 0.0047, Accuracy: 3338/3672 (90.9041%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 1.9051, Accuracy: 5601/10000 (56.0100%)
___Train Local_ResNet_18,  epoch 102, local model 89, internal_epoch   1,  Average loss: 0.0048, Accuracy: 3960/4356 (90.9091%)
___Train Local_ResNet_18,  epoch 102, local model 89, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3932/4356 (90.2663%)
___Test Local_ResNet_18 poisoned: False, epoch: 102: Average loss: 2.2840, Accuracy: 4983/10000 (49.8300%)
time spent on training: 267.1141526699066
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 102: Average loss: 1.5975, Accuracy: 6252/10000 (62.5200%)
___Test Target_ResNet_18 poisoned: True, epoch: 102: Average loss: 7.0601, Accuracy: 652/9900 (6.5859%)
Done in 297.8849015235901 sec.
Server Epoch:103 choose agents : [13, 36, 58, 71, 98, 73, 4, 59, 16, 38, 12, 43, 77, 42, 64, 85, 17, 66, 94, 60].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 103, local model 13, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4359/4885 (89.2323%), train_poison_data_count: 385
Global model norm: 43.63305239974336.
Norm before scaling: 43.633389516104096. Distance: 2.129027308950517
Total norm for 4 adversaries is: 43.633389516104096. distance: 2.129027308950517
___Test Local_ResNet_18 poisoned: True, epoch: 103: Average loss: 0.0870, Accuracy: 9683/9900 (97.8081%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 103, local model 36, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4743/5305 (89.4062%), train_poison_data_count: 415
Global model norm: 43.63305239974336.
Norm before scaling: 43.62877457255848. Distance: 2.145991149827212
Total norm for 4 adversaries is: 43.62877457255848. distance: 2.145991149827212
___Test Local_ResNet_18 poisoned: True, epoch: 103: Average loss: 0.1854, Accuracy: 9449/9900 (95.4444%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 103, local model 58, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4238/4717 (89.8452%), train_poison_data_count: 370
Global model norm: 43.63305239974336.
Norm before scaling: 43.63053863255859. Distance: 2.0257262022731326
Total norm for 4 adversaries is: 43.63053863255859. distance: 2.0257262022731326
___Test Local_ResNet_18 poisoned: True, epoch: 103: Average loss: 0.4906, Accuracy: 8768/9900 (88.5657%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 103, local model 71, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4437/5066 (87.5839%), train_poison_data_count: 400
Global model norm: 43.63305239974336.
Norm before scaling: 43.636466806463176. Distance: 2.307513247169831
Total norm for 4 adversaries is: 43.636466806463176. distance: 2.307513247169831
___Test Local_ResNet_18 poisoned: True, epoch: 103: Average loss: 0.1297, Accuracy: 9598/9900 (96.9495%)
___Train Local_ResNet_18,  epoch 103, local model 98, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3384/3828 (88.4013%)
___Train Local_ResNet_18,  epoch 103, local model 98, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3483/3828 (90.9875%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.8612, Accuracy: 5735/10000 (57.3500%)
___Train Local_ResNet_18,  epoch 103, local model 73, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3760/4235 (88.7839%)
___Train Local_ResNet_18,  epoch 103, local model 73, internal_epoch   2,  Average loss: 0.0052, Accuracy: 3836/4235 (90.5785%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.9502, Accuracy: 5536/10000 (55.3600%)
___Train Local_ResNet_18,  epoch 103, local model 4, internal_epoch   1,  Average loss: 0.0067, Accuracy: 3212/3704 (86.7171%)
___Train Local_ResNet_18,  epoch 103, local model 4, internal_epoch   2,  Average loss: 0.0054, Accuracy: 3314/3704 (89.4708%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.8510, Accuracy: 5703/10000 (57.0300%)
___Train Local_ResNet_18,  epoch 103, local model 59, internal_epoch   1,  Average loss: 0.0057, Accuracy: 3601/4046 (89.0015%)
___Train Local_ResNet_18,  epoch 103, local model 59, internal_epoch   2,  Average loss: 0.0039, Accuracy: 3746/4046 (92.5853%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.7845, Accuracy: 5836/10000 (58.3600%)
___Train Local_ResNet_18,  epoch 103, local model 16, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4350/4928 (88.2711%)
___Train Local_ResNet_18,  epoch 103, local model 16, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4472/4928 (90.7468%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.9024, Accuracy: 5542/10000 (55.4200%)
___Train Local_ResNet_18,  epoch 103, local model 38, internal_epoch   1,  Average loss: 0.0064, Accuracy: 5006/5740 (87.2125%)
___Train Local_ResNet_18,  epoch 103, local model 38, internal_epoch   2,  Average loss: 0.0056, Accuracy: 5108/5740 (88.9895%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 2.1770, Accuracy: 5230/10000 (52.3000%)
___Train Local_ResNet_18,  epoch 103, local model 12, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4428/5083 (87.1139%)
___Train Local_ResNet_18,  epoch 103, local model 12, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4514/5083 (88.8058%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.9236, Accuracy: 5509/10000 (55.0900%)
___Train Local_ResNet_18,  epoch 103, local model 43, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4044/4576 (88.3741%)
___Train Local_ResNet_18,  epoch 103, local model 43, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4136/4576 (90.3846%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.9247, Accuracy: 5560/10000 (55.6000%)
___Train Local_ResNet_18,  epoch 103, local model 77, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4060/4647 (87.3682%)
___Train Local_ResNet_18,  epoch 103, local model 77, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4245/4647 (91.3493%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.9180, Accuracy: 5473/10000 (54.7300%)
___Train Local_ResNet_18,  epoch 103, local model 42, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4832/5424 (89.0855%)
___Train Local_ResNet_18,  epoch 103, local model 42, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4946/5424 (91.1873%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 2.1818, Accuracy: 5143/10000 (51.4300%)
___Train Local_ResNet_18,  epoch 103, local model 64, internal_epoch   1,  Average loss: 0.0070, Accuracy: 3896/4503 (86.5201%)
___Train Local_ResNet_18,  epoch 103, local model 64, internal_epoch   2,  Average loss: 0.0055, Accuracy: 4026/4503 (89.4071%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.9793, Accuracy: 5507/10000 (55.0700%)
___Train Local_ResNet_18,  epoch 103, local model 85, internal_epoch   1,  Average loss: 0.0066, Accuracy: 5554/6391 (86.9035%)
___Train Local_ResNet_18,  epoch 103, local model 85, internal_epoch   2,  Average loss: 0.0060, Accuracy: 5649/6391 (88.3899%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.9652, Accuracy: 5428/10000 (54.2800%)
___Train Local_ResNet_18,  epoch 103, local model 17, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3939/4511 (87.3199%)
___Train Local_ResNet_18,  epoch 103, local model 17, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4054/4511 (89.8692%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 2.0146, Accuracy: 5355/10000 (53.5500%)
___Train Local_ResNet_18,  epoch 103, local model 66, internal_epoch   1,  Average loss: 0.0053, Accuracy: 4021/4456 (90.2379%)
___Train Local_ResNet_18,  epoch 103, local model 66, internal_epoch   2,  Average loss: 0.0041, Accuracy: 4113/4456 (92.3025%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.9665, Accuracy: 5540/10000 (55.4000%)
___Train Local_ResNet_18,  epoch 103, local model 94, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4271/4804 (88.9051%)
___Train Local_ResNet_18,  epoch 103, local model 94, internal_epoch   2,  Average loss: 0.0075, Accuracy: 4084/4804 (85.0125%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 2.3193, Accuracy: 5146/10000 (51.4600%)
___Train Local_ResNet_18,  epoch 103, local model 60, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3331/3804 (87.5657%)
___Train Local_ResNet_18,  epoch 103, local model 60, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3453/3804 (90.7729%)
___Test Local_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.9457, Accuracy: 5577/10000 (55.7700%)
time spent on training: 267.24298334121704
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 103: Average loss: 1.6256, Accuracy: 6230/10000 (62.3000%)
___Test Target_ResNet_18 poisoned: True, epoch: 103: Average loss: 6.5947, Accuracy: 929/9900 (9.3838%)
Done in 298.4298429489136 sec.
Server Epoch:104 choose agents : [13, 36, 58, 71, 16, 45, 70, 8, 60, 39, 62, 7, 34, 76, 10, 95, 49, 12, 98, 4].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 104, local model 13, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4403/4885 (90.1331%), train_poison_data_count: 385
Global model norm: 43.66921531480658.
Norm before scaling: 43.66790148515483. Distance: 2.1179607710622945
Total norm for 4 adversaries is: 43.66790148515483. distance: 2.1179607710622945
___Test Local_ResNet_18 poisoned: True, epoch: 104: Average loss: 0.1428, Accuracy: 9523/9900 (96.1919%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 104, local model 36, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4734/5305 (89.2366%), train_poison_data_count: 415
Global model norm: 43.66921531480658.
Norm before scaling: 43.666995758291954. Distance: 2.2271437572231694
Total norm for 4 adversaries is: 43.666995758291954. distance: 2.2271437572231694
___Test Local_ResNet_18 poisoned: True, epoch: 104: Average loss: 0.1702, Accuracy: 9465/9900 (95.6061%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 104, local model 58, internal_epoch   1,  Average loss: 0.0059, Accuracy: 4206/4717 (89.1668%), train_poison_data_count: 370
Global model norm: 43.66921531480658.
Norm before scaling: 43.66630666647484. Distance: 2.045722695315856
Total norm for 4 adversaries is: 43.66630666647484. distance: 2.045722695315856
___Test Local_ResNet_18 poisoned: True, epoch: 104: Average loss: 0.2114, Accuracy: 9346/9900 (94.4040%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 104, local model 71, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4471/5066 (88.2550%), train_poison_data_count: 400
Global model norm: 43.66921531480658.
Norm before scaling: 43.671355095295304. Distance: 2.2653784255976595
Total norm for 4 adversaries is: 43.671355095295304. distance: 2.2653784255976595
___Test Local_ResNet_18 poisoned: True, epoch: 104: Average loss: 0.1258, Accuracy: 9592/9900 (96.8889%)
___Train Local_ResNet_18,  epoch 104, local model 16, internal_epoch   1,  Average loss: 0.0060, Accuracy: 4334/4928 (87.9464%)
___Train Local_ResNet_18,  epoch 104, local model 16, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4473/4928 (90.7670%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.8393, Accuracy: 5704/10000 (57.0400%)
___Train Local_ResNet_18,  epoch 104, local model 45, internal_epoch   1,  Average loss: 0.0069, Accuracy: 4359/5037 (86.5396%)
___Train Local_ResNet_18,  epoch 104, local model 45, internal_epoch   2,  Average loss: 0.0050, Accuracy: 4526/5037 (89.8551%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.9184, Accuracy: 5537/10000 (55.3700%)
___Train Local_ResNet_18,  epoch 104, local model 70, internal_epoch   1,  Average loss: 0.0056, Accuracy: 4815/5392 (89.2990%)
___Train Local_ResNet_18,  epoch 104, local model 70, internal_epoch   2,  Average loss: 0.0053, Accuracy: 4853/5392 (90.0037%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 2.0173, Accuracy: 5537/10000 (55.3700%)
___Train Local_ResNet_18,  epoch 104, local model 8, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3937/4501 (87.4695%)
___Train Local_ResNet_18,  epoch 104, local model 8, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4054/4501 (90.0689%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.9808, Accuracy: 5456/10000 (54.5600%)
___Train Local_ResNet_18,  epoch 104, local model 60, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3331/3804 (87.5657%)
___Train Local_ResNet_18,  epoch 104, local model 60, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3457/3804 (90.8780%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.9688, Accuracy: 5501/10000 (55.0100%)
___Train Local_ResNet_18,  epoch 104, local model 39, internal_epoch   1,  Average loss: 0.0065, Accuracy: 3361/3837 (87.5945%)
___Train Local_ResNet_18,  epoch 104, local model 39, internal_epoch   2,  Average loss: 0.0042, Accuracy: 3534/3837 (92.1032%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.9221, Accuracy: 5510/10000 (55.1000%)
___Train Local_ResNet_18,  epoch 104, local model 62, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4440/5063 (87.6950%)
___Train Local_ResNet_18,  epoch 104, local model 62, internal_epoch   2,  Average loss: 0.0071, Accuracy: 4363/5063 (86.1742%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 2.1951, Accuracy: 5086/10000 (50.8600%)
___Train Local_ResNet_18,  epoch 104, local model 7, internal_epoch   1,  Average loss: 0.0062, Accuracy: 3993/4481 (89.1096%)
___Train Local_ResNet_18,  epoch 104, local model 7, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4060/4481 (90.6048%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.9370, Accuracy: 5618/10000 (56.1800%)
___Train Local_ResNet_18,  epoch 104, local model 34, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4027/4518 (89.1324%)
___Train Local_ResNet_18,  epoch 104, local model 34, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4110/4518 (90.9695%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.9057, Accuracy: 5544/10000 (55.4400%)
___Train Local_ResNet_18,  epoch 104, local model 76, internal_epoch   1,  Average loss: 0.0069, Accuracy: 3136/3638 (86.2012%)
___Train Local_ResNet_18,  epoch 104, local model 76, internal_epoch   2,  Average loss: 0.0051, Accuracy: 3268/3638 (89.8296%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.8032, Accuracy: 5732/10000 (57.3200%)
___Train Local_ResNet_18,  epoch 104, local model 10, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4155/4663 (89.1057%)
___Train Local_ResNet_18,  epoch 104, local model 10, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4309/4663 (92.4083%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.8967, Accuracy: 5641/10000 (56.4100%)
___Train Local_ResNet_18,  epoch 104, local model 95, internal_epoch   1,  Average loss: 0.0067, Accuracy: 4016/4625 (86.8324%)
___Train Local_ResNet_18,  epoch 104, local model 95, internal_epoch   2,  Average loss: 0.0060, Accuracy: 4064/4625 (87.8703%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 2.0335, Accuracy: 5427/10000 (54.2700%)
___Train Local_ResNet_18,  epoch 104, local model 49, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4545/5197 (87.4543%)
___Train Local_ResNet_18,  epoch 104, local model 49, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4650/5197 (89.4747%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 2.1202, Accuracy: 5325/10000 (53.2500%)
___Train Local_ResNet_18,  epoch 104, local model 12, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4438/5083 (87.3106%)
___Train Local_ResNet_18,  epoch 104, local model 12, internal_epoch   2,  Average loss: 0.0052, Accuracy: 4578/5083 (90.0649%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.9869, Accuracy: 5412/10000 (54.1200%)
___Train Local_ResNet_18,  epoch 104, local model 98, internal_epoch   1,  Average loss: 0.0063, Accuracy: 3372/3828 (88.0878%)
___Train Local_ResNet_18,  epoch 104, local model 98, internal_epoch   2,  Average loss: 0.0044, Accuracy: 3497/3828 (91.3532%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.8967, Accuracy: 5649/10000 (56.4900%)
___Train Local_ResNet_18,  epoch 104, local model 4, internal_epoch   1,  Average loss: 0.0071, Accuracy: 3170/3704 (85.5832%)
___Train Local_ResNet_18,  epoch 104, local model 4, internal_epoch   2,  Average loss: 0.0048, Accuracy: 3344/3704 (90.2808%)
___Test Local_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.9280, Accuracy: 5653/10000 (56.5300%)
time spent on training: 267.3768153190613
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
No suspicious behavior detected for client 15.
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: []
Top 3 clients: []
Suspicious pairs analyzed across clients.
No non-suspicious updates to aggregate.
___Test Target_ResNet_18 poisoned: False, epoch: 104: Average loss: 1.5394, Accuracy: 6363/10000 (63.6300%)
___Test Target_ResNet_18 poisoned: True, epoch: 104: Average loss: 7.3420, Accuracy: 655/9900 (6.6162%)
Done in 298.2602541446686 sec.
Server Epoch:105 choose agents : [13, 36, 58, 71, 14, 23, 45, 49, 80, 67, 7, 43, 22, 37, 83, 40, 61, 52, 4, 88].
poison local model 13 index 0 
poison_now
start trigger fine-tuning
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 105, local model 13, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4394/4885 (89.9488%), train_poison_data_count: 385
Global model norm: 43.705048056099166.
Norm before scaling: 43.70190995361359. Distance: 2.1312487112807688
Total norm for 4 adversaries is: 43.70190995361359. distance: 2.1312487112807688
___Test Local_ResNet_18 poisoned: True, epoch: 105: Average loss: 0.2299, Accuracy: 9321/9900 (94.1515%)
poison local model 36 index 1 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 105, local model 36, internal_epoch   1,  Average loss: 0.0058, Accuracy: 4736/5305 (89.2743%), train_poison_data_count: 415
Global model norm: 43.705048056099166.
Norm before scaling: 43.705103917030534. Distance: 2.2145977657370577
Total norm for 4 adversaries is: 43.705103917030534. distance: 2.2145977657370577
___Test Local_ResNet_18 poisoned: True, epoch: 105: Average loss: 0.1112, Accuracy: 9604/9900 (97.0101%)
poison local model 58 index 2 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 105, local model 58, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4238/4717 (89.8452%), train_poison_data_count: 370
Global model norm: 43.705048056099166.
Norm before scaling: 43.70083174623225. Distance: 2.0250812467123716
Total norm for 4 adversaries is: 43.70083174623225. distance: 2.0250812467123716
___Test Local_ResNet_18 poisoned: True, epoch: 105: Average loss: 0.1997, Accuracy: 9408/9900 (95.0303%)
poison local model 71 index 3 
poison_now
normally training
save normal model, normally training ending
Current lr: [0.005]
___PoisonTrain Local_ResNet_18 , epoch 105, local model 71, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4457/5066 (87.9787%), train_poison_data_count: 400
Global model norm: 43.705048056099166.
Norm before scaling: 43.7065018135889. Distance: 2.264569582600565
Total norm for 4 adversaries is: 43.7065018135889. distance: 2.264569582600565
___Test Local_ResNet_18 poisoned: True, epoch: 105: Average loss: 0.2332, Accuracy: 9333/9900 (94.2727%)
___Train Local_ResNet_18,  epoch 105, local model 14, internal_epoch   1,  Average loss: 0.0059, Accuracy: 3426/3861 (88.7335%)
___Train Local_ResNet_18,  epoch 105, local model 14, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3535/3861 (91.5566%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.9724, Accuracy: 5499/10000 (54.9900%)
___Train Local_ResNet_18,  epoch 105, local model 23, internal_epoch   1,  Average loss: 0.0058, Accuracy: 3730/4184 (89.1491%)
___Train Local_ResNet_18,  epoch 105, local model 23, internal_epoch   2,  Average loss: 0.0046, Accuracy: 3824/4184 (91.3958%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.8859, Accuracy: 5598/10000 (55.9800%)
___Train Local_ResNet_18,  epoch 105, local model 45, internal_epoch   1,  Average loss: 0.0064, Accuracy: 4396/5037 (87.2742%)
___Train Local_ResNet_18,  epoch 105, local model 45, internal_epoch   2,  Average loss: 0.0048, Accuracy: 4575/5037 (90.8279%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 2.0986, Accuracy: 5285/10000 (52.8500%)
___Train Local_ResNet_18,  epoch 105, local model 49, internal_epoch   1,  Average loss: 0.0065, Accuracy: 4557/5197 (87.6852%)
___Train Local_ResNet_18,  epoch 105, local model 49, internal_epoch   2,  Average loss: 0.0062, Accuracy: 4567/5197 (87.8776%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 2.0677, Accuracy: 5326/10000 (53.2600%)
___Train Local_ResNet_18,  epoch 105, local model 80, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4400/5025 (87.5622%)
___Train Local_ResNet_18,  epoch 105, local model 80, internal_epoch   2,  Average loss: 0.0045, Accuracy: 4579/5025 (91.1244%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 2.0022, Accuracy: 5474/10000 (54.7400%)
___Train Local_ResNet_18,  epoch 105, local model 67, internal_epoch   1,  Average loss: 0.0066, Accuracy: 4483/5116 (87.6271%)
___Train Local_ResNet_18,  epoch 105, local model 67, internal_epoch   2,  Average loss: 0.0058, Accuracy: 4519/5116 (88.3307%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 2.0495, Accuracy: 5368/10000 (53.6800%)
___Train Local_ResNet_18,  epoch 105, local model 7, internal_epoch   1,  Average loss: 0.0062, Accuracy: 4054/4481 (90.4709%)
___Train Local_ResNet_18,  epoch 105, local model 7, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4067/4481 (90.7610%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 2.0316, Accuracy: 5505/10000 (55.0500%)
___Train Local_ResNet_18,  epoch 105, local model 43, internal_epoch   1,  Average loss: 0.0055, Accuracy: 4074/4576 (89.0297%)
___Train Local_ResNet_18,  epoch 105, local model 43, internal_epoch   2,  Average loss: 0.0046, Accuracy: 4174/4576 (91.2150%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.9698, Accuracy: 5498/10000 (54.9800%)
___Train Local_ResNet_18,  epoch 105, local model 22, internal_epoch   1,  Average loss: 0.0068, Accuracy: 4549/5232 (86.9457%)
___Train Local_ResNet_18,  epoch 105, local model 22, internal_epoch   2,  Average loss: 0.0056, Accuracy: 4651/5232 (88.8953%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.9886, Accuracy: 5618/10000 (56.1800%)
___Train Local_ResNet_18,  epoch 105, local model 37, internal_epoch   1,  Average loss: 0.0027, Accuracy: 4140/4354 (95.0850%)
___Train Local_ResNet_18,  epoch 105, local model 37, internal_epoch   2,  Average loss: 0.0040, Accuracy: 4082/4354 (93.7529%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 2.0052, Accuracy: 5613/10000 (56.1300%)
___Train Local_ResNet_18,  epoch 105, local model 83, internal_epoch   1,  Average loss: 0.0059, Accuracy: 2896/3271 (88.5356%)
___Train Local_ResNet_18,  epoch 105, local model 83, internal_epoch   2,  Average loss: 0.0057, Accuracy: 2904/3271 (88.7802%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.9297, Accuracy: 5570/10000 (55.7000%)
___Train Local_ResNet_18,  epoch 105, local model 40, internal_epoch   1,  Average loss: 0.0061, Accuracy: 4770/5455 (87.4427%)
___Train Local_ResNet_18,  epoch 105, local model 40, internal_epoch   2,  Average loss: 0.0051, Accuracy: 4907/5455 (89.9542%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 2.0663, Accuracy: 5301/10000 (53.0100%)
___Train Local_ResNet_18,  epoch 105, local model 61, internal_epoch   1,  Average loss: 0.0061, Accuracy: 3630/4126 (87.9787%)
___Train Local_ResNet_18,  epoch 105, local model 61, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3756/4126 (91.0325%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.8868, Accuracy: 5568/10000 (55.6800%)
___Train Local_ResNet_18,  epoch 105, local model 52, internal_epoch   1,  Average loss: 0.0064, Accuracy: 3312/3797 (87.2268%)
___Train Local_ResNet_18,  epoch 105, local model 52, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3465/3797 (91.2563%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.9789, Accuracy: 5603/10000 (56.0300%)
___Train Local_ResNet_18,  epoch 105, local model 4, internal_epoch   1,  Average loss: 0.0066, Accuracy: 3213/3704 (86.7441%)
___Train Local_ResNet_18,  epoch 105, local model 4, internal_epoch   2,  Average loss: 0.0045, Accuracy: 3382/3704 (91.3067%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 1.7766, Accuracy: 5866/10000 (58.6600%)
___Train Local_ResNet_18,  epoch 105, local model 88, internal_epoch   1,  Average loss: 0.0057, Accuracy: 4364/4934 (88.4475%)
___Train Local_ResNet_18,  epoch 105, local model 88, internal_epoch   2,  Average loss: 0.0057, Accuracy: 4400/4934 (89.1771%)
___Test Local_ResNet_18 poisoned: False, epoch: 105: Average loss: 2.0650, Accuracy: 5336/10000 (53.3600%)
time spent on training: 264.8867301940918
!!!!!!! Updates: 20, Expected shape: (20, 2820740)
Collected gradients for 20 agents.
users count: 20 and corrupted count: 4.
Selected all 20 users.
Original model state backed up.
Validation completed, confusion matrix created.
Validation completed, confusion matrix created.
Validation completed for user 2, confusion matrix appended.
No suspicious behavior detected for client 2.
No suspicious behavior detected for user 2.
Validation completed, confusion matrix created.
Validation completed for user 1, confusion matrix appended.
No suspicious behavior detected for client 1.
No suspicious behavior detected for user 1.
Validation completed, confusion matrix created.
Validation completed for user 0, confusion matrix appended.
No suspicious behavior detected for client 0.
No suspicious behavior detected for user 0.
Validation completed, confusion matrix created.
Validation completed for user 18, confusion matrix appended.
No suspicious behavior detected for client 18.
No suspicious behavior detected for user 18.
Validation completed, confusion matrix created.
Validation completed for user 4, confusion matrix appended.
No suspicious behavior detected for client 4.
No suspicious behavior detected for user 4.
Validation completed, confusion matrix created.
Validation completed for user 17, confusion matrix appended.
No suspicious behavior detected for client 17.
No suspicious behavior detected for user 17.
Validation completed, confusion matrix created.
Validation completed for user 16, confusion matrix appended.
No suspicious behavior detected for client 16.
No suspicious behavior detected for user 16.
Validation completed, confusion matrix created.
Validation completed for user 5, confusion matrix appended.
No suspicious behavior detected for client 5.
No suspicious behavior detected for user 5.
Validation completed, confusion matrix created.
Validation completed for user 3, confusion matrix appended.
No suspicious behavior detected for client 3.
No suspicious behavior detected for user 3.
Validation completed, confusion matrix created.
Validation completed for user 11, confusion matrix appended.
No suspicious behavior detected for client 11.
No suspicious behavior detected for user 11.
Validation completed, confusion matrix created.
Validation completed for user 8, confusion matrix appended.
No suspicious behavior detected for client 8.
No suspicious behavior detected for user 8.
Validation completed, confusion matrix created.
Validation completed for user 6, confusion matrix appended.
No suspicious behavior detected for client 6.
No suspicious behavior detected for user 6.
Validation completed, confusion matrix created.
Validation completed for user 14, confusion matrix appended.
No suspicious behavior detected for client 14.
No suspicious behavior detected for user 14.
Validation completed, confusion matrix created.
Validation completed for user 10, confusion matrix appended.
No suspicious behavior detected for client 10.
No suspicious behavior detected for user 10.
Validation completed, confusion matrix created.
Validation completed for user 12, confusion matrix appended.
No suspicious behavior detected for client 12.
No suspicious behavior detected for user 12.
Validation completed, confusion matrix created.
Validation completed for user 9, confusion matrix appended.
No suspicious behavior detected for client 9.
No suspicious behavior detected for user 9.
Validation completed, confusion matrix created.
Validation completed for user 15, confusion matrix appended.
Client 15 misclassified the most to class 2 with 1 misclassifications.
Client 15 assigned a score of 1.
Current susp_pair_clients: defaultdict(<class 'int'>, {15: 1})
No suspicious behavior detected for user 15.
Validation completed, confusion matrix created.
Validation completed for user 7, confusion matrix appended.
No suspicious behavior detected for client 7.
No suspicious behavior detected for user 7.
Validation completed, confusion matrix created.
Validation completed for user 19, confusion matrix appended.
No suspicious behavior detected for client 19.
No suspicious behavior detected for user 19.
Validation completed, confusion matrix created.
Validation completed for user 13, confusion matrix appended.
No suspicious behavior detected for client 13.
No suspicious behavior detected for user 13.
Type of susp_pair_clients before calling assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on entry to assign_weights_based_on_misclassification: <class 'collections.defaultdict'>
susp_pair_clients type on susp_clients_dict = susp_pair_client: <class 'collections.defaultdict'>
Sorted clients with their scores: [(15, 1)]
Top 3 clients: [(15, 1)]
Client 15 misclassification ratio: 1.0000
Client 15 ranked 1 with score 1. Assigned small weight: 0.001
Suspicious pairs analyzed across clients.
